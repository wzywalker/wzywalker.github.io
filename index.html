<!DOCTYPE HTML>
<html lang="english">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,AlanDecode,Galileo,blog" />
    <meta name="generator" content="Maverick 1.2.1" />
    <meta name="template" content="Prism" />
    <link rel="alternate" type="application/rss+xml" title="walker's code blog &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="walker's code blog &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="/assets/prism-b9d78ff38a.css">
    <link rel="stylesheet" href="/assets/ExSearch/ExSearch-182e5a8869.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "/b098f530e4b4a4a690a595806babc6a7.json"
        }

    </script>
    
<title>walker's code blog</title>
<meta name="author" content="walker" />
<meta name="description" content="coder, reader" />
<meta property="og:title" content="walker's code blog" />
<meta property="og:description" content="coder, reader" />
<meta property="og:site_name" content="walker's code blog" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/" />
<meta property="og:image" content="walker's code blog" />
<meta name="twitter:title" content="walker's code blog" />
<meta name="twitter:description" content="coder, reader" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="/android-chrome-512x512.png" />


    
</head>

<body>
    <div class="container prism-container">
        <header class="prism-header" id="prism__header">
            <h1 class="text-uppercase brand"><a class="no-link" href="/" target="_self">walker's code blog</a></h1>
            <p>coder, reader</p>
            <nav class="prism-nav"><ul><li><a class="no-link text-uppercase link-active" href="/" target="_self">Home</a></li><li><a class="no-link text-uppercase " href="/archives/" target="_self">Archives</a></li><li><a class="no-link text-uppercase " href="/about/" target="_self">About</a></li><li><a href="#" target="_self" class="search-form-input no-link text-uppercase">Search</a></li></ul></nav>
        </header>
        <div class="prism-wrapper" id="prism__wrapper">
            
<main>    
    

<section id="prism__post-list" class="prism-section row">
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/collectionview_diffable_datasource/" target="_self">Collection View With Diffable Datasource</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/collectionview_diffable_datasource/" target="_self">
                <time class="text-uppercase">
                    September 09 2022
                </time>
            </a>
        </div>
        <div class="prism-content"><p>è¿™ç¯‡æ–‡ç« æœ‰</p><ul>
<li>collection viewè‡ªå®šä¹‰å¸ƒå±€çš„ä¸€äº›å¿ƒå¾—ä½“ä¼šå’ŒæŸ¥é˜…æ–‡æ¡£æ—¶çš„ä¸€äº›ç¬”è®°</li>
<li>Compositional layoutç¬”è®° ï¼ˆå°‘é‡ï¼‰</li>
<li>diffable datasourceç¬”è®°</li>
</ul>
<h1>Compositional Layout</h1>
<ul>
<li>Group å®½é«˜ç»™å¤Ÿï¼ˆæˆ–estimateï¼‰ï¼ŒItemå›ºå®šå¤§å°ï¼Œå°±æˆäº†ä¸€ä¸ªFlowLayout</li>
<li>è®¾å®šsectionå‚ç›´æ–¹å‘è¡Œä¸ºä¸ºæ»šåŠ¨(åˆ†é¡µï¼Œé è¾¹ç­‰ï¼‰ï¼Œåˆ™ä¸ä¼šæŠ˜è¡Œ<ul>
<li><code>.continuousGroupLeadingBoundary</code> çš„æ„æ€æ˜¯å¦‚æœä¸€è¡Œæ‘†ä¸ä¸‹ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¼šæŠ˜è¡Œï¼Œè¿™ä¸€è¡Œåé¢å°±ä¼šå‰©ä¸‹ç©ºç™½ï¼Œå½“ä½ åšæˆcontinousåï¼Œä¸‹ä¸€ä¸ªå…ƒç´ ä¹Ÿä¼šæ’åœ¨ç©ºç™½åï¼Œè€Œä¸æ˜¯ç›´æ¥å°±æ¥åœ¨åé¢äº†</li>
<li><code>.paging</code>å’Œ<code>.groupPageing</code>çš„åŒºåˆ«åˆ™æ˜¯ä¸€æ¬¡æ»šåŠ¨ä¸€é¡µè¿˜æ˜¯ä¸€ä¸ªgroup</li>
</ul>
</li>
</ul>
<h1>Diffable Data Sources</h1>
<ul>
<li>A <em>diffable data source</em> stores a list of section and item <em>identifiers</em><ul>
<li>In contrast, a custom data source that conforms to <a href="https://developer.apple.com/documentation/uikit/uicollectionviewdatasource"><code>UICollectionViewDataSource</code></a> uses <em>indices</em> and <em>index paths</em>, which arenâ€™t stable.<ul>
<li>They represent the <strong>location</strong> of sections and items, which can change as the data source adds, removes, and rearranges the contents of a collection view.</li>
<li>ç›¸åDiffable Data Sourceå´èƒ½æ ¹æ®identifierè¿½æº¯åˆ°å…¶location</li>
</ul>
</li>
</ul>
</li>
<li>To use a value as an identifier, its data type must conform to the <a href="https://developer.apple.com/documentation/swift/hashable"><code>Hashable</code></a> protocol.<ul>
<li>Hashingèƒ½è®©é›†åˆæˆä¸ºâ€œé”®â€ï¼Œæä¾›å¿«é€Ÿlookupèƒ½åŠ›<ul>
<li>æ¯”å¦‚set, dictionary, snapshot</li>
</ul>
</li>
<li>can determine the differences between its <strong>current</strong> snapshot and <strong>another</strong> snapshot.</li>
</ul>
</li>
</ul>
<h3>Define the Diffable Data Source</h3>
<div class="highlight"><pre><span></span><span class="p">@</span><span class="n">preconcurrency</span> <span class="p">@</span><span class="n">MainActor</span> <span class="kd">class</span> <span class="bp">UICollectionViewDiffableDataSource</span><span class="p">&lt;</span><span class="n">SectionIdentifierType</span><span class="p">,</span> <span class="n">ItemIdentifierType</span><span class="p">&gt;</span> <span class="p">:</span> <span class="bp">NSObject</span> <span class="k">where</span> <span class="n">SectionIdentifierType</span> <span class="p">:</span> <span class="nb">Hashable</span><span class="p">,</span> <span class="n">SectionIdentifierType</span> <span class="p">:</span> <span class="n">Sendable</span><span class="p">,</span> <span class="n">ItemIdentifierType</span> <span class="p">:</span> <span class="nb">Hashable</span><span class="p">,</span> <span class="n">ItemIdentifierType</span> <span class="p">:</span> <span class="n">Sendable</span>

<span class="c1">// å£°æ˜ç¤ºä¾‹</span>
<span class="kd">private</span> <span class="kd">var</span> <span class="nv">recipeListDataSource</span><span class="p">:</span> <span class="bp">UICollectionViewDiffableDataSource</span><span class="p">&lt;</span><span class="n">RecipeListSection</span><span class="p">,</span> <span class="n">Recipe</span><span class="p">.</span><span class="n">ID</span><span class="p">&gt;</span><span class="o">!</span>

<span class="kd">private</span> <span class="kd">enum</span> <span class="nc">RecipeListSection</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">main</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">Recipe</span><span class="p">:</span> <span class="n">Identifiable</span><span class="p">,</span> <span class="n">Codable</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">id</span><span class="p">:</span> <span class="nb">Int</span>
    <span class="kd">var</span> <span class="nv">title</span><span class="p">:</span> <span class="nb">String</span>
    <span class="kd">var</span> <span class="nv">prepTime</span><span class="p">:</span> <span class="nb">Int</span>   <span class="c1">// In seconds.</span>
    <span class="kd">var</span> <span class="nv">cookTime</span><span class="p">:</span> <span class="nb">Int</span>   <span class="c1">// In seconds.</span>
    <span class="kd">var</span> <span class="nv">servings</span><span class="p">:</span> <span class="nb">String</span>
    <span class="kd">var</span> <span class="nv">ingredients</span><span class="p">:</span> <span class="nb">String</span>
    <span class="kd">var</span> <span class="nv">directions</span><span class="p">:</span> <span class="nb">String</span>
    <span class="kd">var</span> <span class="nv">isFavorite</span><span class="p">:</span> <span class="nb">Bool</span>
    <span class="kd">var</span> <span class="nv">collections</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">]</span>
    <span class="n">fileprivate</span> <span class="kd">var</span> <span class="nv">addedOn</span><span class="p">:</span> <span class="n">Date</span><span class="p">?</span> <span class="p">=</span> <span class="n">Date</span><span class="p">()</span>
    <span class="n">fileprivate</span> <span class="kd">var</span> <span class="nv">imageNames</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
<ol>
<li>sectionæ˜¯æšä¸¾ï¼Œæšä¸¾å°±æ˜¯æ­£æ•´æ•°</li>
<li>Recipe conforming to <code>Identifiable</code>ï¼Œautomatically exposes the associated type <a href="https://developer.apple.com/documentation/swift/identifiable/id-swift.associatedtype"><code>ID</code></a></li>
<li>æ•´ä¸ª<code>Recipe</code>ç»“æ„ä½“ä¸å¿…æ˜¯<code>Hashable</code>çš„ï¼Œå› ä¸ºå­˜åœ¨Datasourceå’ŒSnapshoté‡Œçš„ä»…ä»…åªæ˜¯<code>identifiers</code><ol>
<li>Using the <code>Recipe.ID</code> as the item identifier type for the <code>recipeListDataSource</code> means that the <strong>data source</strong>, and any <strong>snapshots</strong> applied to it, <strong>contains only</strong> <code>Recipe.ID</code> values and not the complete recipe data.</li>
</ol>
</li>
</ol>
<h3>Configure the Diffable Data Source</h3>
<div class="highlight"><pre><span></span><span class="c1">// Create a cell registration that the diffable data source will use.</span>
<span class="kd">let</span> <span class="nv">recipeCellRegistration</span> <span class="p">=</span> <span class="bp">UICollectionView</span><span class="p">.</span><span class="n">CellRegistration</span><span class="p">&lt;</span><span class="bp">UICollectionViewListCell</span><span class="p">,</span> <span class="n">Recipe</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">cell</span><span class="p">,</span> <span class="n">indexPath</span><span class="p">,</span> <span class="n">recipe</span> <span class="k">in</span>
    <span class="c1">// ä¼šå¸¦ç€cellå¯¹è±¡ï¼Œä½ç½®å’Œåº”çš„æ•°æ®æºæ•°æ®æ¥è¯·æ±‚é…ç½®å½“å‰cell </span>
    <span class="c1">// è¿™é‡Œè¿›è¡Œäº†ä¸¤ç§é…ç½®ï¼Œ</span>
    <span class="c1">// 1. ä¸€ç§æ˜¯å¯¹contentConfigurationè¿›è¡Œé…ç½®ï¼ˆåº”è¯¥å°±æ˜¯åŒ…äº†ä¸€å±‚ï¼Œæ²¡å¯¹cellæš´éœ²å‡ºæ¥çš„subviewç›´æ¥è¿›è¡Œè®¾ç½®ï¼‰</span>
    <span class="kd">var</span> <span class="nv">contentConfiguration</span> <span class="p">=</span> <span class="bp">UIListContentConfiguration</span><span class="p">.</span><span class="n">subtitleCell</span><span class="p">()</span>
    <span class="n">contentConfiguration</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">recipe</span><span class="p">.</span><span class="n">title</span>
    <span class="n">contentConfiguration</span><span class="p">.</span><span class="n">secondaryText</span> <span class="p">=</span> <span class="n">recipe</span><span class="p">.</span><span class="n">subtitle</span>
    <span class="n">contentConfiguration</span><span class="p">.</span><span class="n">image</span> <span class="p">=</span> <span class="n">recipe</span><span class="p">.</span><span class="n">smallImage</span>
    <span class="n">contentConfiguration</span><span class="p">.</span><span class="n">imageProperties</span><span class="p">.</span><span class="n">cornerRadius</span> <span class="p">=</span> <span class="mi">4</span>
    <span class="n">contentConfiguration</span><span class="p">.</span><span class="n">imageProperties</span><span class="p">.</span><span class="n">maximumSize</span> <span class="p">=</span> <span class="n">CGSize</span><span class="p">(</span><span class="n">width</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">60</span><span class="p">)</span>

    <span class="n">cell</span><span class="p">.</span><span class="n">contentConfiguration</span> <span class="p">=</span> <span class="n">contentConfiguration</span>

    <span class="c1">// 2. è¿™é‡Œå°±æ˜¯ç›´æ¥å¯¹cellçš„subviewæ¥è¿›è¡Œè®¾ç½®äº†ï¼Œæ‰€ä»¥ç†è®ºä¸Šä¸Šä¸€èŠ‚çš„å†…å®¹åº”è¯¥ä¹Ÿå¯ä»¥ç›´æ¥å¯¹cellæ¥é…ç½®</span>
    <span class="k">if</span> <span class="n">recipe</span><span class="p">.</span><span class="n">isFavorite</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">image</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">systemName</span><span class="p">:</span> <span class="s">&quot;heart.fill&quot;</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">accessoryConfiguration</span> <span class="p">=</span> <span class="bp">UICellAccessory</span><span class="p">.</span><span class="n">CustomViewConfiguration</span><span class="p">(</span><span class="n">customView</span><span class="p">:</span> <span class="bp">UIImageView</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">image</span><span class="p">),</span> <span class="n">placement</span><span class="p">:</span> <span class="p">.</span><span class="n">trailing</span><span class="p">(</span><span class="n">displayed</span><span class="p">:</span> <span class="p">.</span><span class="n">always</span><span class="p">),</span> <span class="n">cell</span><span class="p">.</span><span class="n">accessories</span> <span class="p">=</span> <span class="p">[.</span><span class="n">customView</span><span class="p">(</span><span class="n">configuration</span><span class="p">:</span> <span class="n">accessoryConfiguration</span><span class="p">)]</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">cell</span><span class="p">.</span><span class="n">accessories</span> <span class="p">=</span> <span class="p">[]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Create the diffable data source and its cell provider.</span>
<span class="n">recipeListDataSource</span> <span class="p">=</span> <span class="bp">UICollectionViewDiffableDataSource</span><span class="p">(</span><span class="n">collectionView</span><span class="p">:</span> <span class="n">collectionView</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">collectionView</span><span class="p">,</span> <span class="n">indexPath</span><span class="p">,</span> <span class="n">identifier</span> <span class="p">-&gt;</span> <span class="bp">UICollectionViewCell</span> <span class="k">in</span>
    <span class="c1">// `identifier` is an instance of `Recipe.ID`. Use it to</span>
    <span class="c1">// retrieve the recipe from the backing data store.</span>
    <span class="kd">let</span> <span class="nv">recipe</span> <span class="p">=</span> <span class="n">dataStore</span><span class="p">.</span><span class="n">recipe</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">identifier</span><span class="p">)</span><span class="o">!</span>
    <span class="c1">// è¿™é‡Œæ—¢æ˜¯ä¼ å…¥æ³¨å†Œcellçš„æ–¹æ³•çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯é‚£ä¸ªæ–¹æ³•çš„handleré‡Œä¸‰ä¸ªå‚æ•°çš„æ¥æº</span>
    <span class="k">return</span> <span class="n">collectionView</span><span class="p">.</span><span class="n">dequeueConfiguredReusableCell</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="n">recipeCellRegistration</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">recipe</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>The <code>configureDataSource()</code> method creates a cell <strong>registration</strong> and provides a handler closure that <strong>configures each cell</strong> with data from a recipe.</li>
</ul>
<h3>Load the Diffable Data Source with Identifiers</h3>
<div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">func</span> <span class="nf">loadRecipeData</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Retrieve the list of recipe identifiers determined based on a</span>
    <span class="c1">// selected sidebar item such as All Recipes or Favorites.</span>
    <span class="k">guard</span> <span class="kd">let</span> <span class="nv">recipeIds</span> <span class="p">=</span> <span class="n">recipeSplitViewController</span><span class="p">.</span><span class="n">selectedRecipes</span><span class="p">?.</span><span class="n">recipeIds</span><span class="p">()</span>
    <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

    <span class="c1">// Update the collection view by adding the recipe identifiers to</span>
    <span class="c1">// a new snapshot, and apply the snapshot to the diffable data source.</span>
    <span class="kd">var</span> <span class="nv">snapshot</span> <span class="p">=</span> <span class="bp">NSDiffableDataSourceSnapshot</span><span class="p">&lt;</span><span class="n">RecipeListSection</span><span class="p">,</span> <span class="n">Recipe</span><span class="p">.</span><span class="n">ID</span><span class="p">&gt;()</span>
    <span class="n">snapshot</span><span class="p">.</span><span class="n">appendSections</span><span class="p">([.</span><span class="n">main</span><span class="p">])</span>
    <span class="n">snapshot</span><span class="p">.</span><span class="n">appendItems</span><span class="p">(</span><span class="n">recipeIds</span><span class="p">,</span> <span class="n">toSection</span><span class="p">:</span> <span class="p">.</span><span class="n">main</span><span class="p">)</span>
    <span class="n">recipeListDataSource</span><span class="p">.</span><span class="n">applySnapshotUsingReloadData</span><span class="p">(</span><span class="n">snapshot</span><span class="p">)</span> <span class="c1">// åˆå§‹åŒ–ç”¨è¿™ä¸ªï¼Œreloadä»£è¡¨å®Œå…¨é‡è®¾</span>
    <span class="c1">// æ›´æ–°çš„è¯ç”¨ apply(_:animatingDifferences:) è¿™æ ·æœ‰åŠ¨ç”»</span>
<span class="p">}</span>
</pre></div>
<h3>Insert, Delete, and Move Items</h3>
<ul>
<li>To <strong>handle changes</strong> to a data collection, the app <strong>creates a new snapshot</strong> that represents the current state of the data collection and <strong>applies</strong> it to the diffable data source.</li>
<li>The data source <strong>compares</strong> its current snapshot with the new snapshot to <strong>determine the changes</strong>.</li>
<li>Then it performs the necessary inserts, deletes, and moves into the collection view based on those changes.</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nv">snapshot</span> <span class="p">=</span> <span class="bp">NSDiffableDataSourceSnapshot</span><span class="p">&lt;</span><span class="n">RecipeListSection</span><span class="p">,</span> <span class="n">Recipe</span><span class="p">.</span><span class="n">ID</span><span class="p">&gt;()</span>
<span class="n">snapshot</span><span class="p">.</span><span class="n">appendSections</span><span class="p">([.</span><span class="n">main</span><span class="p">])</span> <span class="c1">// sectionæ˜¯ç›´æ¥é‡å»ºçš„ï¼Œè€Œä¸æ˜¯ä»å“ªå»retrieveä¸€ä¸ª, å› ä¸ºå®ƒä»£è¡¨çš„æ˜¯IDï¼Œåªè¦å€¼ä¸€è‡´å°±è¡Œ</span>
<span class="n">snapshot</span><span class="p">.</span><span class="n">appendItems</span><span class="p">(</span><span class="n">selectedRecipeIds</span><span class="p">,</span> <span class="n">toSection</span><span class="p">:</span> <span class="p">.</span><span class="n">main</span><span class="p">)</span> <span class="c1">// è¿™é‡Œæ˜¯.mainçš„å…¨é‡æ•°æ®ï¼Œå³å¢åˆ åçš„ç»“æœé›†</span>
<span class="n">recipeListDataSource</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">animatingDifferences</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</pre></div>
<ul>
<li>å¢åˆ å…¶å®å°±æ˜¯æ–°å»ºä¸€ä¸ªsnapshotï¼Œdatasourceä¼šæ ¹æ®identifiersæ¥æ¯”è¾ƒå“ªäº›å¤šäº†å“ªäº›å°‘äº†ã€‚<ul>
<li>å› ä¸ºåªæ¯”è¾ƒâ€œæ•°é‡â€œï¼Œæ‰€ä»¥åªè¦ç”¨è¿™äº›idå»æ–°å»ºsnapshotå°±å¯ä»¥äº†ï¼Œä¸å­˜åœ¨æŠŠæ—§çš„<strong>retrieve</strong>å‡ºæ¥</li>
</ul>
</li>
</ul>
<h3>Update Existing Items</h3>
<ul>
<li>To handle changes to the properties of an <strong>EXISTING</strong> item, an app retrieves the <strong>current snapshot</strong> from the diffable data source and calls either <a href="https://developer.apple.com/documentation/uikit/nsdiffabledatasourcesnapshot/3804468-reconfigureitems"><code>reconfigureItems(_:)</code></a> or <a href="https://developer.apple.com/documentation/uikit/nsdiffabledatasourcesnapshot/3375783-reloaditems"><code>reloadItems(_:)</code></a> on the snapshot.  -&gt; then <code>Apply</code> to snapshot</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nv">snapshot</span> <span class="p">=</span> <span class="n">recipeListDataSource</span><span class="p">.</span><span class="n">snapshot</span><span class="p">()</span>  <span class="c1">// è¿™æ¬¡æ˜¯retrieveäº†</span>
<span class="c1">// Update the recipe&#39;s data displayed in the collection view.</span>
<span class="n">snapshot</span><span class="p">.</span><span class="n">reconfigureItems</span><span class="p">([</span><span class="n">recipeId</span><span class="p">])</span> <span class="c1">// ä¼ å…¥identifier</span>
<span class="n">recipeListDataSource</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">animatingDifferences</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</pre></div>
<ul>
<li>the data source invokes its cell provider closure,</li>
</ul>
<h3>Populate Snapshots with Lightweight Data Structures</h3>
<ul>
<li>å¯¹æ•´ä¸ªitemå¯¹è±¡åšHashï¼Œé€‚ç”¨äºå¿«é€Ÿå»ºæ¨¡ï¼Œæˆ–æ•°æ®æºä¸ä¼šå˜æ›´çš„åœºæ™¯ï¼ˆæ¯”å¦‚èœå•ï¼‰ã€‚<ul>
<li>å› ä¸ºitemå¯¹è±¡çš„ä»»ä½•å±æ€§å˜åŒ–éƒ½ä¼šè¢«è®¤ä¸ºæœ‰è¿‡æ”¹åŠ¨å¯¼è‡´é‡ç»˜ï¼Œä¹Ÿä¼šäº§ç”Ÿä¸€äº›å‰¯ä½œç”¨ï¼Œæ¯”å¦‚é‡ç»˜ä¹‹å‰çš„çŠ¶æ€éƒ½ä¼šè¢«æ¸…æ‰ï¼ˆå¦‚selectedï¼‰</li>
</ul>
</li>
<li>å®è·µä¸­ï¼Œä¸ä¼šå¯¹è®¾ç½®datasourceçš„æ—¶å€™ä¸“é—¨ç»™ä¸ªidentifieré›†åˆï¼Œè€Œæ•°æ®æºç”¨åˆ«çš„é›†åˆï¼Œæ¯æ¬¡éƒ½æ˜¯ç”¨identifierä»é›†åˆé‡Œæ‰¾itemè¿™ç§æ–¹å¼ï¼Œè€Œæ˜¯é‡å†™itemçš„hashæ–¹æ³•å’Œequalæ–¹æ³•ï¼Œè®©å…¶åªè§‚å¯Ÿidå­—æ®µ</li>
</ul>
<h3>NSDiffableDataSourceSnapshot</h3>
<ul>
<li>A representation of <strong>the state of the data</strong> in a <code>view</code> at a <strong>specific point in time</strong>.</li>
<li>Diffable data sources use <em>snapshots</em> to provide data for collection views and table views.</li>
<li>You use a snapshot to set up the <strong>initial state</strong> of the data that a view displays, and you use snapshots to reflect <strong>changes to the data</strong> that the view displays.</li>
<li>The data in a snapshot is made up of the <strong>sections</strong> and <strong>items</strong><ul>
<li>Each of your sections and items must have unique identifiers that conform to the <a href="https://developer.apple.com/documentation/swift/hashable"><code>Hashable</code></a> protocol.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1">// Create a snapshot.</span>
<span class="kd">var</span> <span class="nv">snapshot</span> <span class="p">=</span> <span class="bp">NSDiffableDataSourceSnapshot</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">UUID</span><span class="p">&gt;()</span>        

<span class="c1">// Populate the snapshot.</span>
<span class="n">snapshot</span><span class="p">.</span><span class="n">appendSections</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
<span class="n">snapshot</span><span class="p">.</span><span class="n">appendItems</span><span class="p">([</span><span class="n">UUID</span><span class="p">(),</span> <span class="n">UUID</span><span class="p">(),</span> <span class="n">UUID</span><span class="p">()])</span>

<span class="c1">// Apply the snapshot.</span>
<span class="n">dataSource</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">animatingDifferences</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</pre></div>
<h2>NSDiffableDataSourceSectionSnapshot</h2>
<ul>
<li><p>A representation of <strong>the state of the data</strong> in a <code>layout section</code> at a specific point in time.</p><ul>
<li>æ³¨æ„ä¸<code>dataSourceSnapshot</code>å®šä¹‰çš„åŒºåˆ«</li>
</ul>
</li>
<li><p>A section snapshot represents the data for a single section in a collection view or table view.</p></li>
<li><p>Through a section snapshot, you set up the <strong>initial state</strong> of the data that displays in an individual section of your view, and later <strong>update that data</strong>.</p></li>
<li><p>You can use section snapshots <strong>with</strong> or <strong>instead</strong> of an <a href="https://developer.apple.com/documentation/uikit/nsdiffabledatasourcesnapshot"><code>NSDiffableDataSourceSnapshot</code></a></p></li>
<li><p>Use a section snapshot when you need precise management of the data in a section of your layout</p><ul>
<li>such as when the sections of your layout acquire their data from <strong>different sources</strong>.</li>
<li>ä¸åŒçš„sectionæ¥è‡ªä¸åŒçš„æ•°æ®æºçš„è¯ï¼Œå€¾å‘äºç”¨sectionSnapshot</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">section</span> <span class="k">in</span> <span class="n">Section</span><span class="p">.</span><span class="n">allCases</span> <span class="p">{</span>
    <span class="c1">// Create a section snapshot</span>
    <span class="kd">var</span> <span class="nv">sectionSnapshot</span> <span class="p">=</span> <span class="bp">NSDiffableDataSourceSectionSnapshot</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">&gt;()</span>

    <span class="c1">// Populate the section snapshot</span>
    <span class="n">sectionSnapshot</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">&quot;Food&quot;</span><span class="p">,</span> <span class="s">&quot;Drinks&quot;</span><span class="p">])</span>
    <span class="n">sectionSnapshot</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">&quot;ğŸ&quot;</span><span class="p">,</span> <span class="s">&quot;ğŸ“&quot;</span><span class="p">,</span> <span class="s">&quot;ğŸ¥&quot;</span><span class="p">],</span> <span class="n">to</span><span class="p">:</span> <span class="s">&quot;Food&quot;</span><span class="p">)</span>

    <span class="c1">// Apply the section snapshot</span>
    <span class="n">dataSource</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="n">sectionSnapshot</span><span class="p">,</span>
                     <span class="n">to</span><span class="p">:</span> <span class="n">section</span><span class="p">,</span>
                     <span class="n">animatingDifferences</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<h1>è‹¹æœCollectionViewæ•™ç¨‹æ–‡æ¡£</h1>
<p><strong>The Layout Object Controls the Visual Presentation</strong></p><ul>
<li>The layout object is solely responsible for determining the <strong>placement and visual styling</strong> of items within the collection view</li>
<li>do not confuse what a layout object does with the <code>layoutSubviews</code> method used to reposition child views inside a parent view.<ul>
<li>A layout object <strong>never</strong> touches the views it manages directly because it <strong>does not actually own</strong> any of those views.</li>
<li>it generates attributes that describe the location, size, and visual appearance of the cells, supplementary views, and decoration views in the collection view.</li>
<li>It is then the job of the collection view to apply those attributes to the actual view objects.</li>
<li>è¿™å°±æ˜¯éœ€è¦æä¾›ä¸¤ä¸ªä»£ç†æ–¹æ³•çš„åŸå› ï¼Œä¸€ä¸ªæä¾›viewï¼Œä¸€ä¸ªæä¾›å¸ƒå±€é…ç½®</li>
</ul>
</li>
</ul>
<p><strong>Transitioning Between Layouts</strong></p><ul>
<li>The easiest way to transition between layouts is by using the <code>setCollectionViewLayout:animated:</code> method.</li>
<li>However, if you require control of the transition or want it to be interactive, use a <code>UICollectionViewTransitionLayout</code> object.</li>
<li>The <code>UICollectionViewTransitionLayout</code> class is a special type of layout that gets installed as the collection viewâ€™s layout object when transitioning to a new layout.<ul>
<li>With a transition layout object, you can have objects follow a <strong>non linear</strong> path, use a different <strong>timing algorithm</strong>, or move according to incoming touch events.</li>
</ul>
</li>
<li>The <code>UICollectionViewLayout</code> class provides <strong>several methods</strong> for <strong>tracking</strong> the transition between layouts.</li>
<li><code>UICollectionViewTransitionLayout</code> objects track the completion of a transition through the <code>transitionProgress</code> property.</li>
<li>As the transition occurs, your code updates this property <strong>periodically</strong> to indicate the completion percentage of the transition.</li>
</ul>
<p>é€šç”¨æµç¨‹ï¼š</p><ol>
<li>Create an instance of the standard class or your own custom class using the <code>initWithCurrentLayout:nextLayout:</code> method.</li>
<li>Communicate the progress of the transition by periodically modifying the <code>transitionProgress</code> property. Do not forget to invalidate the layout using the collection viewâ€™s <code>invalidateLayout</code> method after changing the transitionâ€™s progress.</li>
<li>Implement the <code>collectionView:transitionLayoutForOldLayout:newLayout:</code> method in your collection viewâ€™s delegate and return your transition layout object.</li>
<li>Optionally modify values for your layout using the <code>updateValue:forAnimatedKey:</code> method to indicate changed values relevant to your layout object. The stable value in this case is 0.</li>
</ol>
<p><strong>Customizing the Flow Layout Attributes</strong></p><ul>
<li>Flowlayoutåœ¨ä¸€æ¡çº¿ä¸Šæ’åˆ—å…ƒç´ ï¼Œåˆ°è¾¾äº†è¾¹ç•Œå°±æ¢è¡Œï¼Œæ–°èµ·ä¸€æ¡çº¿</li>
<li>å…ƒç´ å¤§å°å¯ä»¥é€šè¿‡<code>itemSize</code> å±æ€§è®¾ç½®ï¼Œå¦‚æœå¤§å°ä¸åŒï¼Œåˆ™é€šè¿‡<code>[collectionView:layout:sizeForItemAtIndexPath:](https://developer.apple.com/documentation/uikit/uicollectionviewdelegateflowlayout/1617708-collectionview)</code>ä»£ç†æ–¹æ³•è®¾ç½®</li>
<li>ä½†æ˜¯ï¼ŒåŒä¸€è¡Œä¸Šä¸åŒçš„é«˜åº¦çš„cellä¼šå‚ç›´å±…ä¸­æ’åˆ—ï¼Œè¿™ç‚¹è¦æ³¨æ„</li>
<li><code>minimum spacing</code>è®¾ç½®çš„åªæ˜¯åŒä¸€è¡Œå…ƒç´ çš„â€œæœ€å°é—´è·â€ï¼Œå¦‚æœå¸ƒå±€çš„æ—¶å€™ä¸€è¡Œä¸‹ä¸€ä¸ªå…ƒç´ æ”¾ä¸ä¸‹äº†ï¼Œä½†æ˜¯å‰©ä½™çš„ç©ºé—´å¾ˆå¤šï¼Œè¿™ä¸ªä¸€è¡Œçš„å…ƒç´ é—´è·ä¼šæ‹‰å¤§<ul>
<li>è¡Œé—´è·åŒç†ï¼Œæ ¹æ®ä¸Šä¸€æ¡æè¿°ï¼Œå…ƒç´ æ˜¯å‚ç›´å±…ä¸­æ’åˆ—çš„ï¼Œæ‰€ä»¥æœ€å°è¡Œé—´è·è®¾ç½®çš„æ˜¯ä¸Šä¸‹ä¸¤è¡Œé—´æœ€é«˜çš„å…ƒç´ çš„è·ç¦»</li>
</ul>
</li>
</ul>
</div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/collectionview_diffable_datasource/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/calayer_mask/" target="_self">CALayeråº”ç”¨maskå®ç°ä¸ºæ–‡å­—éƒ¨åˆ†æ¶‚æŠ¹</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/calayer_mask/" target="_self">
                <time class="text-uppercase">
                    July 14 2022
                </time>
            </a>
        </div>
        <div class="prism-content"><p>å…ˆçœ‹æ•ˆæœï¼Œç™½åº•é»‘å­—ï¼Œéšç€æ‹–åŠ¨ï¼Œé€æ¸å˜æˆé»‘åº•ç™½å­—ï¼ˆæ³¨ï¼šå› ä¸ºé¡¹ç›®å…³ç³»ï¼Œæ•ˆæœæ˜¯å¸¦ç€åº•è‰²æ‹–åŠ¨ï¼Œæ‰€ä»¥ä»¥è¿™ç§æ•ˆæœæ¥è®²è§£ï¼Œå¦‚æœåªæ˜¯æ”¹æ–‡å­—é¢œè‰²ï¼Œå°±æ˜¯åªæ¶‚æŠ¹æ–‡å­—ï¼Œä¼šç¨å¾®ç®€å•ä¸€äº›ï¼Œè¯·è§¦ç±»æ—é€šï¼‰</p><figure  style="flex: 106.89655172413794" ><img width="1116" height="522" src="/archives/assets/ffbec7d6d811b8fd6cca175ce25a294e.gif" alt="20220714161447"/></figure><p>æ€è·¯ï¼šåº•å±‚ï¼ˆç™½åº•é»‘å­—ï¼‰ï¼Œè¡¨å±‚ï¼ˆé»‘åº•ç™½å­—ï¼‰ï¼Œå¯¹è¡¨å±‚åº”ç”¨è’™æ¿ï¼Œè’™æ¿çš„frameç”±æ‰‹åŠ¿æ§åˆ¶</p><figure class="vertical-figure" style="flex: 49.69230769230769" ><img width="646" height="650" src="/archives/assets/6f6838054b30d06ed348b1f6a24d1abf.png" alt="image-20220714193234444"/></figure><p>æœ¬è´¨ä¸Šæ˜¯CALayerçš„maskï¼Œä½†æˆ‘ä»¬å…ˆç”¨ä¸¤ä¸ªUIViewæ¥å®ç°ä¸€ä¸‹ï¼Œå› ä¸ºå®ƒç›´è§‚ä¸”ç®€å•ï¼š</p><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">viewDidLoad</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="c1">// create wrapper view çœç•¥</span>

<span class="w">    </span><span class="c1">// åº•å±‚ç™½åº•é»‘å­—</span>
<span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIColor</span><span class="p">.</span><span class="n">whiteColor</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="bp">UILabel</span><span class="w"> </span><span class="o">*</span><span class="n">lbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">createLabel</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">lbl</span><span class="p">.</span><span class="n">textColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIColor</span><span class="p">.</span><span class="n">blackColor</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="n">lbl</span><span class="p">];</span><span class="w"></span>

<span class="w">    </span><span class="c1">// è¡¨å±‚é»‘åº•</span>
<span class="w">    </span><span class="bp">UIView</span><span class="w"> </span><span class="o">*</span><span class="n">cover</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIView</span><span class="w"> </span><span class="n">new</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">cover</span><span class="p">.</span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIColor</span><span class="p">.</span><span class="n">blackColor</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">cover</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="n">cover</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ç™½å­—</span>
<span class="w">    </span><span class="bp">UILabel</span><span class="w"> </span><span class="o">*</span><span class="n">lbl2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">createLabel</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">lbl2</span><span class="p">.</span><span class="n">textColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIColor</span><span class="p">.</span><span class="n">whiteColor</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">cover</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="n">lbl2</span><span class="p">];</span><span class="w"></span>

<span class="w">    </span><span class="c1">// maskçš„widthä»0åˆ°100%</span>
<span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIView</span><span class="w"> </span><span class="n">new</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">mask</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">mask</span><span class="p">.</span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIColor</span><span class="w"> </span><span class="n">blackColor</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">cover</span><span class="p">.</span><span class="n">maskView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">mask</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">-</span> <span class="p">(</span><span class="bp">UILabel</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nf">createLabel</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>

<span class="p">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">slidechanged:</span><span class="p">(</span><span class="bp">UISlider</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">sender</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">mask</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sender</span><span class="p">.</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>UIViewå½“ç„¶æœ¬è´¨ä¸Šç”¨çš„éƒ½æ˜¯CALayerï¼Œé‚£ä¹ˆæˆ‘ç”¨CALayeræ”¹å†™ä¼šæ€æ ·å‘¢ï¼Ÿ</p><p>ç»“æ„ï¼šUIViewé»‘åº•+CATextLayer Mask &gt; CAShapeLayeré»‘åº• &gt; CATextLayerç™½å­—ï¼Œ å¯¹<code>shapeLayer</code>åº”ç”¨mask</p><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">viewDidLoad</span><span class="p">];</span><span class="w"></span>
<span class="w">  </span><span class="c1">// create wrapper çœç•¥</span>

<span class="w">  </span><span class="c1">// åº•éƒ¨æ–‡å­—ï¼Œé»‘åº•+æ–‡å­—mask</span>
<span class="w">  </span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIColor</span><span class="w"> </span><span class="n">blackColor</span><span class="p">];</span><span class="w"></span>
<span class="w">  </span><span class="bp">CATextLayer</span><span class="w"> </span><span class="o">*</span><span class="n">bottom</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">createTextLayer</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">frame</span><span class="p">];</span><span class="w"></span>
<span class="w">  </span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bottom</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">// é¡¶éƒ¨èƒŒæ™¯layer+é¡¶éƒ¨æ–‡å­—layer</span>
<span class="w">  </span><span class="bp">CAShapeLayer</span><span class="w"> </span><span class="o">*</span><span class="n">top</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">CAShapeLayer</span><span class="w"> </span><span class="n">new</span><span class="p">];</span><span class="w"></span>
<span class="w">  </span><span class="n">top</span><span class="p">.</span><span class="n">backgroundColor</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIColor</span><span class="w"> </span><span class="n">redColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">;</span><span class="w">  </span><span class="c1">// åŸæœ¬æ˜¯é»‘åº•ç™½å­—ï¼Œåé¢è§£é‡Šä¸ºä»€ä¹ˆæ”¹æˆäº†çº¢åº•</span>
<span class="w">  </span><span class="n">top</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="bp">CATextLayer</span><span class="w"> </span><span class="o">*</span><span class="n">toptext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">createTextLayer</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">bounds</span><span class="p">];</span><span class="w"></span>
<span class="w">  </span><span class="n">toptext</span><span class="p">.</span><span class="n">foregroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIColor</span><span class="w"> </span><span class="n">whiteColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="n">top</span><span class="w"> </span><span class="n">addSublayer</span><span class="o">:</span><span class="n">toptext</span><span class="p">];</span><span class="w"></span>
<span class="w">  </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">layer</span><span class="w"> </span><span class="n">addSublayer</span><span class="o">:</span><span class="n">top</span><span class="p">];</span><span class="w"></span>

<span class="w">  </span><span class="nb">self</span><span class="p">.</span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">CAShapeLayer</span><span class="w"> </span><span class="n">new</span><span class="p">];</span><span class="w"></span>
<span class="w">  </span><span class="nb">self</span><span class="p">.</span><span class="n">mask</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRectMake</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="nb">self</span><span class="p">.</span><span class="n">mask</span><span class="p">.</span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIColor</span><span class="w"> </span><span class="n">blackColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">top</span><span class="p">.</span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">mask</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">-</span> <span class="p">(</span><span class="bp">CATextLayer</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nf">createTextLayer:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">frame</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">CATextLayer</span><span class="w"> </span><span class="o">*</span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">CATextLayer</span><span class="w"> </span><span class="n">new</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">layer</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">layer</span><span class="p">.</span><span class="n">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">__bridge</span><span class="w"> </span><span class="n">CFTypeRef</span><span class="p">)[</span><span class="bp">UIFont</span><span class="w"> </span><span class="n">systemFontOfSize</span><span class="o">:</span><span class="mf">12.0f</span><span class="w"> </span><span class="n">weight</span><span class="o">:</span><span class="n">UIFontWeightHeavy</span><span class="p">];</span><span class="w">  </span><span class="c1">// è¿™é‡Œå­—å·æ˜¯æ— æ•ˆçš„</span>
<span class="w">    </span><span class="n">layer</span><span class="p">.</span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">73.0f</span><span class="p">;</span><span class="w"> </span><span class="c1">// åœ¨è¿™é‡Œè®¾ç½®å­—å·</span>
<span class="w">    </span><span class="n">layer</span><span class="p">.</span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;Hello WestWorld&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">layer</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>ç»“æœå´å¾—åˆ°è¿™ä¸ªï¼š</p><figure  style="flex: 189.3491124260355" ><img width="1280" height="338" src="/archives/assets/41856510dfd32672a9312a09ce95245d.gif" alt="20220714180940"/></figure><p>é»‘åº•åªå‰©ä¸‹äº†é»‘è¾¹ï¼Œè§‚å¯Ÿåˆ°ä¸‰ä¸ªç°è±¡ï¼š</p><ol>
<li>å¯¹æ ¹layerè¿›è¡Œmaskï¼Œå…¶sublayeréƒ½æ˜¯è¢«maskçš„</li>
<li>ç”¨æ–‡å­—å¯¹æ–‡å­—åšmaskï¼Œæ˜¯ä¼šæè¾¹çš„ï¼ˆè¿™ä¸€ç‚¹åšäº†é¢å¤–å‡ ä¸ªæµ‹è¯•è¯æ˜äº†ï¼‰</li>
<li>åŠ¨ç”»æ²¡æœ‰é‚£ä¹ˆè·Ÿæ‰‹ï¼ˆäººåœ¨å‰é¢è·‘ï¼Œé­‚åœ¨åé¢è¿½ï¼‰ï¼Œéƒ½æœ‰åŠ¨é‡çš„æ„Ÿè§‰äº†ï¼Œå¯¹æ¯”UIViewçš„æ–¹æ¡ˆçœ‹çœ‹</li>
</ol>
<p>å…ˆæ¥æ‹£ç¬¬äºŒä¸ªè½¯æŸ¿å­æï¼ŒçŒœæµ‹ç”¨<code>CAShapeLayer</code>æ¥åšcoveråº”è¯¥ä¸ä¼šæœ‰æè¾¹ï¼Œä¹Ÿå°±æ˜¯è¯´æ³¨é‡Šæ‰ä»¥ä¸‹å‡ è¡Œ</p><div class="highlight"><pre><span></span><span class="bp">CATextLayer</span><span class="w"> </span><span class="o">*</span><span class="n">toptext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">createTextLayer</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">frame</span><span class="p">];</span><span class="w"></span>
<span class="n">toptext</span><span class="p">.</span><span class="n">foregroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIColor</span><span class="w"> </span><span class="n">whiteColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">;</span><span class="w"></span>
<span class="p">[</span><span class="n">top</span><span class="w"> </span><span class="n">addSublayer</span><span class="o">:</span><span class="n">toptext</span><span class="p">];</span><span class="w"></span>
</pre></div>
<p>æ•ˆæœå¦‚æœŸæœ›çš„é‚£æ ·ï¼Œï¼ˆè¿™æ¬¡æ²¡æœ‰æè¾¹äº†ï¼Œæ‰€ä»¥å°±æ¢äº†ä¸ªé¢œè‰²ï¼Œä¸ç„¶ç™½åº•ç™½å­—å°±çœ‹ä¸è§äº†ï¼‰</p><figure  style="flex: 200.32051282051282" ><img width="1250" height="312" src="/archives/assets/2594836c148deacd8a75f4b8fbd2ee29.gif" alt="20220714184942"/></figure><p>è¿™æ¬¡æˆ‘ä»¬ä¸ç”¨æ ¹layeråšmaskï¼Œæ·»åŠ ä¸€ä¸ªå±‚ï¼š</p><div class="highlight"><pre><span></span><span class="c1">// åº•éƒ¨æ–‡å­—ï¼Œé»‘åº•+æ–‡å­—mask</span>
<span class="bp">CATextLayer</span><span class="w"> </span><span class="o">*</span><span class="n">bottom</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">createTextLayer</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">bounds</span><span class="p">];</span><span class="w"></span>
<span class="c1">// self.wrapper.backgroundColor = [UIColor blackColor];</span>
<span class="c1">// self.wrapper.layer.mask = bottom; </span>
<span class="c1">// å¯¹æ ¹layerè¿›è¡Œmaskï¼Œä¼šæŠŠsublayerå…¨éƒ¨maskäº†</span>
<span class="c1">// æ‰€ä»¥æ·»åŠ ä¸€ä¸ªlayer</span>
<span class="bp">CAShapeLayer</span><span class="w"> </span><span class="o">*</span><span class="n">bottomShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">CAShapeLayer</span><span class="w"> </span><span class="n">new</span><span class="p">];</span><span class="w"></span>
<span class="n">bottomShape</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span><span class="w"></span>
<span class="n">bottomShape</span><span class="p">.</span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIColor</span><span class="w"> </span><span class="n">blackColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">;</span><span class="w"></span>
<span class="n">bottomShape</span><span class="p">.</span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bottom</span><span class="p">;</span><span class="w"></span>
<span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">wrapper</span><span class="p">.</span><span class="n">layer</span><span class="w"> </span><span class="n">addSublayer</span><span class="o">:</span><span class="n">bottomShape</span><span class="p">];</span><span class="w"></span>
</pre></div>
<figure  style="flex: 181.14285714285714" ><img width="1268" height="350" src="/archives/assets/03ebfa11434ae205e656839d6c410f6b.gif" alt="20220714191352"/></figure><p>ç°åœ¨å¦‚æ„¿ä»¥å¿ï¼Œæ•´ä¸ªç»“æ„ä¹Ÿåªæœ‰ä¸€ä¸ªUIViewäº†ï¼Œç›¸æ¯”UViewçš„æ–¹æ¡ˆï¼Œæ˜¾ç„¶åœ¨æŸ¥çœ‹è§†å›¾ç»“æ„çš„æ—¶å€™è¦ç®€åŒ–å¾—å¤šï¼Œï¼ˆåŠ¨ç”»æ•ˆæœä»ç„¶æ˜¯é­‚åœ¨åé¢è¿½...ï¼‰ï¼Œä½†æ˜¯ï¼Œè¿™æ¬¡ä»ç„¶æ˜¯æ–‡å­—å¯¹æ–‡å­—åšmaskï¼Œè¿™æ¬¡å´æ²¡æœ‰æè¾¹äº†ï¼š</p><figure  style="flex: 268.01801801801804" ><img width="1190" height="222" src="/archives/assets/661881063d03936442e6722d2ad82063.png" alt="image-20220714191856600"/></figure><p>éš¾é“åªæœ‰æ ¹layerä¸Šæ‰ä¼šæï¼Ÿä¸ç»§ç»­æ¢ç´¢äº†ã€‚</p><p>æœ€åï¼Œè§£é‡Šä¸€ä¸‹å¯¹ç›´æ¥æ“ä½œCALayerä¸ºä»€ä¹ˆååº”è¿˜æ…¢åŠæ‹å‘¢ï¼Ÿå› ä¸ºCALayerçš„å¤§éƒ¨åˆ†å±æ€§çš„æ”¹å˜æ˜¯è‡ªå¸¦äº†åŠ¨ç”»çš„ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œå¾—åˆ°äº†å……åˆ†çš„è¯æ˜ã€‚</p><p>è¡¥å……ä¸€ä¸‹å…¨éƒ¨ç”¨<code>CALayer</code>çš„ç»“æ„
<figure  style="flex: 67.69662921348315" ><img width="964" height="712" src="/archives/assets/98c14a7ed3a8bfe08ed578b50521d239.png" alt=""/></figure></p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/calayer_mask/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/advanced-graphics-with-core-animation/" target="_self">Advanced Graphics With Core Animation ç¬”è®°</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/advanced-graphics-with-core-animation/" target="_self">
                <time class="text-uppercase">
                    June 25 2022
                </time>
            </a>
        </div>
        <div class="prism-content"><h1>Core Animation</h1>
<p><a href="https://academy.realm.io/posts/tryswift-tim-oliver-advanced-graphics-with-core-animation/">Source</a></p><p><strong>Core Graphics</strong></p><ul>
<li>Core Animation is supposed to be the graphics system of the framework, but there is also Core Graphics.</li>
<li>Core Graphics is entirely done on the CPU, and cannot be performed on the GPU.<ul>
<li>Because it is an entirely CPU-bound operation</li>
</ul>
</li>
<li>you can <strong>combine</strong> it with Core Animation.<ul>
<li>You can use <code>Core Graphics</code> to create the actual bitmaps, and use <code>Core Animation</code> to display them to create some cool effects.</li>
</ul>
</li>
</ul>
<p><strong>Core Animation</strong></p><ul>
<li>It is comprised of a series of <strong>layout objects</strong>. &gt;&gt;&gt; typically <code>CALayer</code></li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">import</span> <span class="nc">QuartzCore</span>

<span class="kd">let</span> <span class="nv">newLayer</span> <span class="p">=</span> <span class="bp">CALayer</span><span class="p">()</span>
<span class="n">newLayer</span><span class="p">.</span><span class="n">frame</span> <span class="p">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">newLayer</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">redColor</span><span class="p">().</span><span class="n">CGColor</span>
<span class="n">newLayer</span><span class="p">.</span><span class="n">cornerRadius</span> <span class="p">=</span> <span class="mi">10</span>
</pre></div>
<p><strong>UIKit</strong></p><ul>
<li>Everything you see when you look at a <code>UIView</code> is <strong>not</strong> being done on the <code>UIView</code> level, but by a <strong>backing layer</strong> attached to that view.</li>
<li>The layer is providing the <strong>visual content</strong>,</li>
<li><code>UIView</code> is providing <strong>other</strong> things:<ul>
<li>order layout functionality, touch recognition, guest recognizers.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="bp">UIView</span> <span class="p">{</span>
   <span class="kd">public</span> <span class="kd">var</span> <span class="nv">layer</span><span class="p">:</span> <span class="bp">CALayer</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p><strong>ä¸ºä»€ä¹ˆä¸è®©UIViewç›´æ¥ç»§æ‰¿CALayer</strong></p><ul>
<li>CALayerç¡®å®æœ‰è‡ªå·±çš„å­ç±»</li>
<li>å®ƒä»¬å¯ä»¥æ’å…¥UIViewçš„subLayerä¸­ï¼Œå¹¶æŒ‡å®šå…¶ä¸ºæš´éœ²çš„é‚£ä¸ªlayerï¼Œè¿™ç§è®¾è®¡å†³å®šäº†å®ƒéœ€è¦æœ‰ä¸€ä¸ªâ€œå®¹å™¨&quot;</li>
<li>æ¯”å¦‚ç”¨ä¸€ä¸ªæ¸å˜çš„layerå­ç±»æ¥æ›¿æ¢åŸæ¥çš„layer:</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyGradientClass</span> <span class="p">:</span> <span class="bp">UIView</span> <span class="p">{</span>
    <span class="kr">override</span> <span class="kd">class</span> <span class="nc">func</span> <span class="n">layerClass</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">AnyClass</span> <span class="p">{</span>
       <span class="k">return</span> <span class="bp">CAGradientLayer</span><span class="p">.</span><span class="kc">self</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>Mapping contents to CALayer: <code>someLayer.contents = someImage.CGImage</code><ul>
<li>the <code>.contents</code> property is <code>animatable</code></li>
</ul>
</li>
</ul>
<p>Scale (with <code>contentGravity</code> property):</p><figure  style="flex: 102.4390243902439" ><img width="1848" height="902" src="/archives/assets/faa855dd2861cf296eb2c4ef5e8cf430.png" alt="image-20220515014627253"/></figure><ul>
<li>åœºæ™¯ä¸€ï¼šå±å¹•å‘ä¸‹æ‹‰ï¼ŒèƒŒæ™¯å›¾è¶Šå˜è¶Šå¤§ï¼ˆæ ¹æ®è®¾ç½®çš„å¡«å……å’Œå˜å½¢æ–¹å¼ï¼Œä»¥åŠå®¹å™¨çš„frameï¼‰</li>
<li>åœºæ™¯äºŒï¼šç±»ä¼¼macOSçš„dockerï¼Œé¼ æ ‡ï¼ˆæ»‘å—/sliderï¼‰åœ¨å›¾æ ‡ä¸Šæ»šè¿‡çš„æ—¶å€™æ”¾å¤§ï¼Œå¤„ç†ä¸ºä¸€ä¸ªæ»‘å—ï¼Œå’Œå·¦å³ä¸¤ä¸ªlayerï¼Œåˆ†åˆ«è®¾ç½®äº†åªæ˜¾ç¤ºå·¦è¾¹æˆ–å³è¾¹çš„<code>gravity</code></li>
</ul>
<figure  style="flex: 157.19844357976655" ><img width="1616" height="514" src="/archives/assets/76a10bc63cff42cdd20b5324358b5ce8.png" alt="image-20220515021047122"/></figure><blockquote>
<p>æˆ‘æœ¬ä»¥ä¸ºæ˜¯ä¸¤å¼ é¡µç èƒŒæ™¯å›¾æ˜¯<strong>é‡åˆ</strong>çš„ï¼Œæ ¹æ®æ»‘å—ä½ç½®æ¥â€œåˆ‡â€æ‰å¯¹åº”çš„å·¦ä¾§å›¾å’Œå³ä¾§å›¾ï¼Œä½†æ˜¯æ˜¾ç„¶è¿™ä¸ªæ–¹æ¡ˆæ˜¯å·¦å³ä¸¤ä¸ªèƒŒæ™¯å›¾æ˜¯<strong>å¹¶åˆ—</strong>çš„ï¼Œå®ƒåŒæ—¶æ”¹çš„ä¸¤ä¸ªå›¾çš„frame(å…¶å®å°±æ˜¯widthåŠ èµ·æ¥æ°¸è¿œæ˜¯100%)ï¼Œç„¶åè®¾ç½®resizeçš„æ–¹æ¡ˆæ˜¯è®©å·¦è¾¹çš„ä»å·¦æ˜¾ç¤ºèµ·ï¼Œå³è¾¹çš„ä»ä¸­æ˜¾ç¤ºèµ·å°±è¡Œäº†</p><p>ä½†ä»”ç»†ä¸€æƒ³ï¼Œä»ç„¶å¯ä»¥ç†è§£ä¸ºä¸¤å¼ å›¾æ˜¯é‡åˆçš„ï¼Œåˆ†åˆ«å¾€å·¦å³ä¸¤æ–¹å»resizeä½¿å¾—ä¸¤å¼ å›¾çš„frameå¹¶ä¸ç›¸äº¤è€Œå·²</p></blockquote>
<p>åœºæ™¯äºŒçš„å…¶å®ƒæ–¹æ¡ˆï¼š</p><ul>
<li>Because this method leverages the GPU, it is incredibly performant.</li>
<li>There are other ways you could have gone about doing this.<ul>
<li>For example, using a masking layer, or doing it in Core Graphics.</li>
<li>But, because both of them would have leveraged the CPU, it would have been slower.</li>
</ul>
</li>
</ul>
<p><strong>Bitmap Sampling in CALayer</strong></p><ul>
<li>Core Animation also <strong>exposes settings</strong> that lets you configure which resizing resampling algorithms the GPU uses.</li>
<li>Whenever you change the size of a layer and the size <strong>no longer matches the original size</strong> of the bitmap mapped to it, resampling needs to be done to make sure it does not look <em>jagged</em> or <em>distorted</em>.<ul>
<li>By default, the sampling mode that Core Animation uses is called <strong>bilinear filtering</strong> (<code>kCAFilterLinear</code>), a simple linear interpolation between two pixels. (çº¿æ€§æ’å€¼æœ€å¿«)</li>
<li>Sometimes, even bilinear filtering is too <code>slow</code>. If you are rapidly resizing a frame during animation, you might get stuttering.<ul>
<li>è¿™æ—¶å¯ä»¥ä½¿ç”¨ nearest (<code>kCAFilterNearest</code>). Nearest mode completely <strong>disables</strong> pixel resampling.</li>
</ul>
</li>
<li>trilinear filtering (<code>kCAFilterTrilinear</code>) åˆ™èƒ½æä¾›æœ€å¥½çš„resamplingè´¨é‡ï¼Œthe GPU will generate <strong>differently sized versions</strong> of the same bitmap, and <strong>blend them together</strong> to create resizing of the texture in question.<ul>
<li>æœ€æ…¢ï¼Œè€Œä¸”æŠŠCPUä¹Ÿæ‹‰è¿›æ¥äº†</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure  style="flex: 83.88030888030887" ><img width="1738" height="1036" src="/archives/assets/dd2c66a62f209303b9177f794efff8cc.png" alt="image-20220515023547309"/></figure><p>æœ€è¿‘é‚»æ’å€¼å›¾åƒè´¨é‡æœ€å·®ï¼Œä½†ä¹Ÿæœ€çœèµ„æºæœ€å¿«é€Ÿï¼Œç”¨åœ¨åŠ¨ç”»åˆ‡æ¢åœºæ™¯ï¼ˆè§†é¢‘é‡Œæ¼”ç¤ºäº†appé€€åˆ°æ¡Œé¢æ—¶ï¼Œappçš„iconç”±å½“å‰appç•Œé¢çš„æˆªå›¾é€æ¸å˜å›logoçš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæˆªå›¾æ˜¾ç„¶å°±ä¸éœ€è¦é«˜è´¨é‡çš„å›¾ç‰‡ï¼‰</p><ul>
<li>åŒæ—¶ä¹Ÿæš—ç¤ºäº†åœ¨å›¾ç‰‡å±•ç¤ºåŒºåŸŸæœ¬æ¥å°±å¾ˆå°æ—¶ï¼Œä¹Ÿæ²¡å¿…è¦åº”ç”¨é«˜è´¨é‡scale</li>
<li>æˆ–è€…åŠ¨ç”»ç›¸å½“å¿«æ—¶ï¼Œä¹Ÿå°½é‡ç”¨æœ€è¿‘é‚»æ’å€¼</li>
</ul>
<p><strong>Masking CALayer Objects</strong></p><ul>
<li><p>è®©ä¸€ä¸ªlayer(<strong>A</strong>)æˆä¸ºå¦ä¸€ä¸ªlayer(<strong>B</strong>)çš„<code>mask</code>å±æ€§</p></li>
<li><p>Aä¼šè¢«B(æ¶‚é»‘çš„åŒºåŸŸ)<code>clip</code>ï¼ŒåŒæ—¶ä»ç„¶å…·æœ‰åŠŸèƒ½æ€§ï¼Œäº¤äº’æ€§ï¼Œå’ŒåŠ¨ç”»æ€§</p><figure  style="flex: 164.367816091954" ><img width="1144" height="348" src="/archives/assets/f395601e92129519e7383fb4a3e4b514.png" alt="æ¶‚é»‘å°±æ˜¯ä¸æ˜¾ç¤º"/></figure></li>
</ul>
<figure  style="flex: 81.36574074074075" ><img width="1406" height="864" src="/archives/assets/37fbec26917db6079bb03b3ec2db28a3.png" alt="image-20220622143708966"/></figure><p><strong>Adding Shadows to CALayer</strong></p><p>The following code will <strong>indeed</strong> render a shadow. However, because the system has to do <strong>a per pixel</strong> comparison to work out the <strong>size</strong> of the shadow, it will be <strong>incredibly slow</strong> in terms of rendering and animation.</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">myLayer</span> <span class="p">=</span> <span class="n">view</span><span class="p">.</span><span class="n">layer</span>
 <span class="n">myLayer</span><span class="p">.</span><span class="n">shadowColor</span> <span class="p">=</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">blackColor</span><span class="p">().</span><span class="n">CGColor</span>
 <span class="n">myLayer</span><span class="p">.</span><span class="n">shadowOpacity</span> <span class="p">=</span> <span class="mf">0.75</span>
 <span class="n">myLayer</span><span class="p">.</span><span class="n">shadowOffset</span> <span class="p">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
 <span class="n">myLayer</span><span class="p">.</span><span class="n">shadowRadius</span> <span class="p">=</span> <span class="mi">10</span>

<span class="c1">// IMPORTANT FOR PERFORMANCE</span>
<span class="kd">let</span> <span class="nv">myShadowPath</span> <span class="p">=</span> <span class="bp">UIBezierPath</span><span class="p">(</span><span class="n">roundedRect</span><span class="p">:</span>
                     <span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cornerRadius</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">myLayer</span><span class="p">.</span><span class="n">shadowPath</span> <span class="p">=</span> <span class="n">myShadowPath</span><span class="p">.</span><span class="n">CGPath</span>
</pre></div>
<p>As a result, whenever you are working with <strong>shadows in Core Animation</strong>, you should always make sure to set the <code>.shadowPath</code> property. This property will tell Core Animation in advance what the shape of the shadow will be, reducing render time.</p><p><strong>Transforming a CALayer</strong></p><ul>
<li>Core Animation also provides a transform property on <code>CALayer</code>.</li>
<li>Unlike the transform property on UIView, which is purely <strong>2D</strong>, the one on <code>CALayer</code> provides <strong>3D</strong> transformations.</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">myLayer</span> <span class="p">=</span> <span class="bp">CALayer</span><span class="p">()</span>
<span class="n">myLayer</span><span class="p">.</span><span class="n">contents</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">makeTrySwiftLogoImage</span><span class="p">().</span><span class="n">CGImage</span>

<span class="kd">var</span> <span class="nv">transform</span> <span class="p">=</span> <span class="n">CATransform3DIdentity</span>
<span class="n">transform</span><span class="p">.</span><span class="n">m34</span> <span class="p">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="o">-</span><span class="mi">500</span>
<span class="n">transform</span> <span class="p">=</span> <span class="n">CATransform3DRotate</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="mf">45.0</span><span class="n">f</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">myLayer</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="n">transform</span>
</pre></div>
<p><strong>Blend Modes with CALayer</strong></p><p>çœ‹çœ‹å°±å¥½</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">myBlendLayer</span> <span class="p">=</span> <span class="bp">CALayer</span><span class="p">()</span>
<span class="n">myBlendLayer</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span> <span class="err">â€œ</span><span class="n">allowsGroupBlending</span><span class="err">â€</span><span class="p">)</span> <span class="c1">// PRIVATE</span>
<span class="n">myBlendLayer</span><span class="p">.</span><span class="n">compositingFilter</span> <span class="p">=</span> <span class="err">â€œ</span><span class="n">screenBlendMode</span><span class="s">&quot;</span>
<span class="s">myBlendLayer.allowsGroupOpacity = false</span>
<span class="s">myLayer.addSublayer(myBlendLayer)</span>
</pre></div>
<figure  style="flex: 189.568345323741" ><img width="1054" height="278" src="/archives/assets/333bf0036824a4c48a4badd2371474bd.png" alt="image-20220622145432815"/></figure><p>è‹¹æœçš„&quot;slide to unlick&quot;é‡åº¦åº”ç”¨äº†blend mode(æ³¨æ„é‚£é“å·¦å³è·‘åŠ¨çš„æµå…‰)</p><figure  style="flex: 95.98997493734336" ><img width="1532" height="798" src="/archives/assets/98de775b5e16920acd97bd71e0a154d9.png" alt="image-20220622145619139"/></figure><p><strong>Animating with Core Animation</strong></p><p>UIViewå®ç°æ–¹å¼ï¼š</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">trySwiftLayer</span> <span class="p">=</span> <span class="c1">//...</span>

<span class="kd">let</span> <span class="nv">myAnimation</span> <span class="p">=</span> <span class="bp">CABasicAnimation</span><span class="p">(</span><span class="n">keyPath</span><span class="p">:</span> <span class="err">â€œ</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="err">â€</span><span class="p">)</span>
<span class="n">myAnimation</span><span class="p">.</span><span class="n">duration</span> <span class="p">=</span> <span class="mi">2</span>
<span class="n">myAnimation</span><span class="p">.</span><span class="n">fromValue</span> <span class="p">=</span> <span class="n">trySwiftLayer</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span>
<span class="n">myAnimation</span><span class="p">.</span><span class="n">toValue</span> <span class="p">=</span> <span class="n">trySwiftLayer</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">500</span>
<span class="n">myAnimation</span><span class="p">.</span><span class="n">timingFunction</span> <span class="p">=</span> <span class="n">kCAMediaTimingFunctionEaseInEaseOut</span>
<span class="n">myAnimation</span><span class="p">.</span><span class="n">repeatCount</span> <span class="p">=</span> <span class="p">.</span><span class="n">infinity</span>

<span class="n">trySwiftLayer</span><span class="p">.</span><span class="n">addAnimation</span><span class="p">(</span><span class="n">myAnimation</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span> <span class="err">â€œ</span><span class="n">myAnimationKeyName</span><span class="err">â€</span><span class="p">)</span>
</pre></div>
<ul>
<li>You can access these animations from the <code>.animationsKeys</code> property of the layer.</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1">// timing function</span>
<span class="kd">let</span> <span class="nv">timingFunction</span> <span class="p">=</span> <span class="bp">CAMediaTimingFunction</span><span class="p">(</span><span class="n">controlPoints</span><span class="p">:</span> <span class="p">.</span><span class="mi">08</span><span class="p">,</span> <span class="p">.</span><span class="mi">04</span><span class="p">,</span> <span class="p">.</span><span class="mi">08</span><span class="p">,</span> <span class="p">.</span><span class="mi">99</span><span class="p">)</span>

<span class="kd">let</span> <span class="nv">myAnimation</span> <span class="p">=</span> <span class="bp">CABasicAnimation</span><span class="p">()</span>
<span class="n">myAnimation</span><span class="p">.</span><span class="n">timingFunction</span> <span class="p">=</span> <span class="n">timingFunction</span>
</pre></div>
<ul>
<li><p>èµ„æº: <a href="http://cubic-bezier.com/"><a href="http://cubic-bezier.com">http://cubic-bezier.com</a></a></p></li>
<li><p>å¦‚æœä½ è¦å®ç°ä¸€ä¸ª<code>cross fade</code>çš„æ•ˆæœï¼Œå¯èƒ½æƒ³çš„æ˜¯ä¸¤ä¸ªviewï¼ŒåŒæ—¶åˆ‡æ¢alphaç”±0åˆ°1ï¼ˆå’Œç›¸åï¼‰</p><ul>
<li>å½“åŒæ—¶è¾¾åˆ°0.5æ—¶ï¼Œäººçœ¼èƒ½æ•æ‰åˆ°è¿™ä¸€åˆ»ï¼Œä¸¤ä¸ªå›¾ç‰‡éƒ½éå¸¸æ˜æ˜¾</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1">// animating a calayer&#39;s contents</span>
<span class="kd">let</span> <span class="nv">imageView</span> <span class="p">=</span> <span class="bp">UIImageView</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">onImage</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">offImage</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">()</span>

<span class="kd">let</span> <span class="nv">myCrossfadeAnimation</span> <span class="p">=</span> <span class="bp">CABasicAnimation</span><span class="p">(</span><span class="n">keyPath</span><span class="p">:</span> <span class="err">â€œ</span><span class="n">contents</span><span class="err">â€</span><span class="p">)</span>
<span class="n">myCrossfadeAnimation</span><span class="p">.</span><span class="n">fromValue</span> <span class="p">=</span> <span class="n">offImage</span><span class="p">.</span><span class="n">CGImage</span>
<span class="n">myCrossfadeAnimation</span><span class="p">.</span><span class="n">toValue</span> <span class="p">=</span> <span class="n">onImage</span><span class="p">.</span><span class="n">CGImage</span>
<span class="n">myCrossfadeAnimation</span><span class="p">.</span><span class="n">duration</span> <span class="p">=</span> <span class="mf">0.15</span>

<span class="n">imageView</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">addAnimation</span><span class="p">(</span><span class="n">myCrossfadeAnimation</span><span class="p">,</span>
                               <span class="n">forKey</span><span class="p">:</span> <span class="err">â€œ</span><span class="n">myCrossfadeAnimationKeyName</span><span class="err">â€</span><span class="p">)</span>

<span class="n">imageView</span><span class="p">.</span><span class="n">image</span> <span class="p">=</span> <span class="n">onImage</span>
</pre></div>
<p><strong>CAKeyframeAnimation</strong></p><ul>
<li>you can chain up multiple animation points within one object(æœ¬æ–‡æœªé˜è¿°).</li>
<li>each keyframe point can have a <code>CG path object</code> assigned, which lets you create animations that are not just linear, point-to-point transitions, but curves.</li>
</ul>
<p>å°±æ˜¯ä½ è¦è®©viewæŒ‰ä¸€ä¸ªcgpathåšç§»åŠ¨åŠ¨ç”»ï¼Œä¹Ÿå¯ä»¥ç”¨<code>CAKeyframeAnimation</code></p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">rect</span> <span class="p">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">circlePath</span> <span class="p">=</span> <span class="bp">UIBezierPath</span><span class="p">(</span><span class="n">ovalInRect</span><span class="p">:</span><span class="n">rect</span><span class="p">)</span>

<span class="kd">let</span> <span class="nv">circleAnimation</span> <span class="p">=</span> <span class="bp">CAKeyframeAnimation</span><span class="p">()</span>
<span class="n">circleAnimation</span><span class="p">.</span><span class="n">keyPath</span> <span class="p">=</span> <span class="err">â€œ</span><span class="n">position</span><span class="err">â€</span>
<span class="n">circleAnimation</span><span class="p">.</span><span class="n">path</span> <span class="p">=</span> <span class="n">circlePath</span><span class="p">.</span><span class="n">CGPath</span>
<span class="n">circleAnimation</span><span class="p">.</span><span class="n">duration</span> <span class="p">=</span> <span class="mi">4</span>

<span class="c1">// Manually specify keyframe points</span>
<span class="c1">// circleAnimation.values = //...</span>
<span class="c1">// circleAnimation.keyTimes = //..</span>

<span class="kd">let</span> <span class="nv">trySwiftLayer</span> <span class="p">=</span> <span class="c1">//...</span>
<span class="n">trySwiftLayer</span><span class="p">.</span><span class="n">addAnimation</span><span class="p">(</span><span class="n">circleAnimation</span><span class="p">,</span>
                            <span class="n">forKey</span><span class="p">:</span> <span class="err">â€œ</span><span class="n">position</span><span class="err">â€</span><span class="p">)</span>
</pre></div>
<p><strong>CAAnimationGroup</strong></p><p>æ²¡å¤šè¯´ä»€ä¹ˆï¼Œä¸€ä¸ªç®€å•åº”ç”¨ï¼š</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">myPositionAnimation</span> <span class="p">=</span> <span class="bp">CABasicAnimation</span><span class="p">.</span><span class="n">animation</span><span class="p">(</span><span class="n">keyPath</span><span class="p">:</span> <span class="err">â€œ</span><span class="n">position</span><span class="err">â€</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">myAlphaAnimation</span> <span class="p">=</span> <span class="bp">CABasicAnimation</span><span class="p">.</span><span class="n">animation</span><span class="p">(</span><span class="n">keyPath</span><span class="p">:</span> <span class="err">â€œ</span><span class="n">opacity</span><span class="err">â€</span><span class="p">)</span>

<span class="kd">let</span> <span class="nv">animationGroup</span> <span class="p">=</span> <span class="bp">CAAnimationGroup</span><span class="p">()</span>
<span class="n">animationGroup</span><span class="p">.</span><span class="n">timingFunction</span> <span class="p">=</span> <span class="n">kCAMediaTimingFunctionEaseInEaseOut</span>
<span class="n">animationGroup</span><span class="p">.</span><span class="n">duration</span> <span class="p">=</span> <span class="mi">2</span>
<span class="n">animationGroup</span><span class="p">.</span><span class="n">animations</span> <span class="p">=</span> <span class="p">[</span><span class="n">myPositionAnimation</span><span class="p">,</span> <span class="n">myAlphaAnimation</span><span class="p">]</span>

<span class="kd">let</span> <span class="nv">trySwiftLayer</span> <span class="p">=</span> <span class="bp">CALayer</span><span class="p">()</span>
<span class="n">trySwiftLayer</span><span class="p">.</span><span class="n">addAnimation</span><span class="p">(</span><span class="n">animationGroup</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span> <span class="err">â€œ</span><span class="n">myAnimations</span><span class="err">â€</span><span class="p">)</span>
</pre></div>
<p><strong>Completion Handling</strong></p><div class="highlight"><pre><span></span><span class="c1">// Set a delegate object</span>
<span class="kd">let</span> <span class="nv">myAnimation</span> <span class="p">=</span> <span class="bp">CABasicAnimation</span><span class="p">()</span>
<span class="n">myAnimation</span><span class="p">.</span><span class="n">delegate</span> <span class="p">=</span> <span class="kc">self</span>

<span class="c1">// Animation completion sent to â€˜animationDidStop(anim: finished flag:)</span>

<span class="c1">// â€”â€”â€”</span>

<span class="c1">//Set a closure to be executed at the end of this transaction</span>
<span class="bp">CATransaction</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span>

<span class="bp">CATransaction</span><span class="p">.</span><span class="n">setCompletionBlock</span><span class="p">({</span>
   <span class="c1">// Logic to be performed, post animation</span>
<span class="p">})</span>

<span class="bp">CATransaction</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
<p><strong>Features of Core Animation Subclasses</strong></p><p>æœ¬èŠ‚å†…å®¹å¯çœ‹ä¸€ä¸ªæ›´å¥½çš„<a href="https://www.raywenderlich.com/10317653-calayer-tutorial-for-ios-getting-started">RayWenderlichæ•™ç¨‹</a></p><p>In iOS, Apple provides a variety of CLS subclasses, with many different features.</p><ul>
<li>Some of these subclasses rely on the CPU for the operations which they perform; it may be necessary to test these on certain devices to make sure they fill your specific needs.</li>
<li>To insert a CLS subclass into a UIView, all you need to do is subclass the UIView, and then override its layer class property.</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyGradientClass</span> <span class="p">:</span> <span class="bp">UIView</span> <span class="p">{</span>
  <span class="kr">override</span> <span class="kd">class</span> <span class="nc">func</span> <span class="n">layerClass</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">AnyClass</span> <span class="p">{</span>
    <span class="k">return</span> <span class="bp">CAGradientLayer</span><span class="p">.</span><span class="kc">self</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>CATileLayer, åŸºäºçŸ¢é‡ç»˜å›¾çš„å±‚ï¼Œå¯ä»¥æ— é™æ”¾å¤§</li>
<li>CAgradientLayer è¿è¡Œåœ¨GPUä¸Šï¼Œéå¸¸å¿«ï¼Œé€šå¸¸ç”¨åœ¨ç”¨äº†3Då˜å½¢çš„Layeråœºæ™¯ï¼Œæ·»åŠ æ™¯æ·±æŠ•å½±ç­‰æ•ˆæœ</li>
<li>CAReplicaterLayer ä¸€ä¸ªå¯ä»¥è¢«å¤åˆ¶å¤šæ¬¡çš„layerï¼ˆon the GPUï¼‰ï¼Œè€Œä¸”å¤åˆ¶äº§ç‰©è¿˜èƒ½æ›´æ”¹è‡ªå·±çš„é¢œè‰²ï¼Œä½ç½®ç­‰</li>
<li>CAShapeLayer æ‹¥æœ‰ä¸€ä¸ª<code>CGPath</code>å±æ€§å¾ˆå®¹æ˜“è¿›è¡Œfill, strokeç­‰ç»˜åˆ¶ï¼Œå‚è€ƒ<a href="https://github.com/UrbanApps/UAProgressView">UAProgressView</a>é¡¹ç›®åº”ç”¨</li>
<li>CAEmitterLayer å‚è€ƒä¸€ä¸ª<a href="https://itunes.apple.com/es/app/particle-playground/id600661093?l=en&amp;mt=12">Partical Playground</a>çš„Mac appï¼Œèƒ½å¤Ÿâ€œå‘å°„â€å‡ºå…¶å®ƒçš„layerï¼Œå¹¶animatå®ƒ</li>
<li>CATextLayer</li>
<li>CAScrollayer</li>
<li>CATransformLayer</li>
<li>CAEAGLayer, CAMetalLayer</li>
</ul>
<p><strong>èµ„æº</strong></p><ul>
<li><a href="http://www.paintcodeapp.com/">PaintCode</a>,ä¸ºä½ åˆ›å»ºçš„å›¾ç‰‡ç”ŸæˆCoreGraphicä»£ç </li>
<li><a href="http://www.coreanimator.com/">Core Animator</a>ï¼Œä¸ºä½ åˆ›å»ºçš„åŠ¨ç”»ç”ŸæˆCoreAnimatioinä»£ç </li>
<li><a href="(https://github.com/TimOliver/TOGlintyStringView)">slide to unlock ä»£ç å¤ç°å®ä¾‹</a></li>
<li><a href="http://revealapp.com/">Reveal</a>ï¼Œä¸€ä¸ªè§†å›¾çš„çº¿ä¸Šdebugå·¥å…·</li>
</ul>
</div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/advanced-graphics-with-core-animation/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/js-spread-syntax/" target="_self">js spread syntax</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/js-spread-syntax/" target="_self">
                <time class="text-uppercase">
                    April 23 2022
                </time>
            </a>
        </div>
        <div class="prism-content"><p>å‰æ®µä¸ºè¿™ä¸ªè§£æapiçš„domå…ƒç´ ç”Ÿæˆçš„<a href="https://github.com/walkerwzy/code_generator">å°å·¥å…·</a>ç»§confluence, swaggerä¹‹ååˆå¢åŠ äº†yapiçš„æ”¯æŒï¼Œç”¨åˆ°äº†ä¸å°‘å±•å¼€è¯­æ³•(<code>...</code>)ï¼Œç‰¹æ•´ç†è®°å½•ä¸€ä¸‹</p><h1>Dictionary</h1>
<div class="highlight"><pre><span></span><span class="c1">// å¾—åˆ°å­—å…¸æ‰€æœ‰keyçš„æ–¹æ³•ï¼š</span><span class="w"></span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">dict</span><span class="p">)</span><span class="w"></span>
<span class="c1">// å¾—åˆ°å­—å…¸æ‰€æœ‰key, valueçš„æ–¹æ³•ï¼š </span><span class="w"></span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">dict</span><span class="p">).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">],</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">k</span><span class="p">)</span><span class="w"></span>
<span class="c1">// æ ¹æ®å­—æ®µè¿‡æ»¤ï¼š</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">fromEntries</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">dict</span><span class="p">).</span><span class="nx">filter</span><span class="p">(([</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">v</span><span class="o">&gt;</span><span class="mf">1</span><span class="p">));</span><span class="w"></span>
<span class="c1">// æˆ–è€…ç”¨assignå’Œspread syntax:</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">dict</span><span class="p">).</span><span class="nx">filter</span><span class="p">(([</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">v</span><span class="o">&gt;</span><span class="mf">1</span><span class="p">).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({[</span><span class="nx">k</span><span class="p">]</span><span class="o">:</span><span class="nx">v</span><span class="p">}))</span><span class="w"></span>
</pre></div>
<h1>Array</h1>
<div class="highlight"><pre><span></span><span class="c1">// HTMLCollection to Array</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="w"> </span><span class="nx">htmlCollection</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">htmlCollection</span><span class="p">);</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">htmlCollection</span><span class="p">);</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nx">htmlCollection</span><span class="p">];</span><span class="w"></span>

<span class="c1">// remove duplicates (distinct)</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="nx">chars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">];</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="nx">uniqueChars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">(</span><span class="nx">chars</span><span class="p">)];</span><span class="w"></span>
</pre></div>
<h1>String</h1>
<div class="highlight"><pre><span></span><span class="c1">// éå†ä¸€ä¸ªæ•°å­—çš„æ¯ä¸€ä½</span><span class="w"></span>
<span class="p">[...</span><span class="mf">1e4</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">].</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>

<span class="c1">// é¦–å­—æ¯å¤§å†™</span><span class="w"></span>
<span class="kd">function</span><span class="w"> </span><span class="nx">capitalizeFirstLetter</span><span class="p">([</span><span class="nx">first</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">rest</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">first</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rest</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>å¾ˆæœ‰pythonçš„é£æ ¼å•Š</p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/js-spread-syntax/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/cocoapods_private_library/" target="_self">CocoaPodsåˆ›å»ºç§æœ‰åº“è¿‡ç¨‹æ‹¾é—</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/cocoapods_private_library/" target="_self">
                <time class="text-uppercase">
                    February 27 2022
                </time>
            </a>
        </div>
        <div class="prism-content"><h1>åˆ›å»ºç§æœ‰podspec</h1>
<p>å®Œæ•´æ•™ç¨‹ç½‘ä¸Šå¾ˆå¤šï¼Œæˆ‘è¿™é‡Œæ˜¯æ›²æ›²æŠ˜æŠ˜å¼„å¥½åçš„ä¸€äº›è¦ç‚¹è®°å½•ï¼Œé‡Œé¢çš„ä¸€äº›è·¯å¾„å’Œåº“å…±åŒè‡ª<a href="http://blog.wtlucky.com/blog/2015/02/26/create-private-podspec/">æŸç¯‡æ•™ç¨‹</a>ï¼Œå¯ä»¥ç›´æ¥çœ‹ä»–ä»¬çš„æ•™ç¨‹ã€‚</p><p>æƒ³çœ‹æç®€çš„éª¨æ¶è¿‡ç¨‹å¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢çš„ç¬”è®°ï¼Œå½“ç„¶è‚¯å®šç¼ºå°‘å¾ˆå¤šç»†èŠ‚ï¼Œä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹æ ¸å¿ƒæ€è·¯ï¼Œé‡Œé¢çš„ä¸€äº›åº“åœ°å€å‡ºäºéšç§æˆ‘å°±ä½¿ç”¨äº†ä»–ä»¬å…¬å¸ƒåœ¨ç½‘ä¸Šçš„è€Œä¸æ˜¯è‡ªå·±çš„çœŸå®åœ°å€ã€‚</p><p>é¦–å…ˆï¼Œæ¶‰åŠä¸¤ä¸ªä»“åº“ï¼Œä¸€ä¸ªæ”¾ä»£ç ï¼Œä¸€ä¸ªæ”¾specï¼Œæ”¾specçš„å°±æ˜¯ç§æœ‰åº“</p><div class="highlight"><pre><span></span><span class="c1"># åˆ›å»ºç§æœ‰åº“ ï¼ˆå°±æ˜¯host podspecæ–‡ä»¶çš„å®¹å™¨ï¼‰</span>
pod repo add WTSpecs https://coding.net/wtlucky/WTSpecs.git  <span class="c1">#ï¼ˆè¿™æ˜¯specä»“åº“ï¼‰</span>

<span class="c1">## å¦‚æœä¸æ˜¯æ–°å»ºï¼Œåˆ é™¤å’Œæ·»åŠ å·²æœ‰çš„è¯­æ³•ï¼š</span>
pod repo remove WTSpecs
pod repo add WTSpecs git@coding.net:wtlucky/WTSpecs.git

<span class="c1"># åˆ›å»ºpod libï¼ˆå°±æ˜¯æ™®é€šé¡¹ç›®æ–‡ä»¶ï¼‰</span>
pod lib create podTestLibrary
<span class="c1">### å¯ä»¥é€‰æ‹©å°è¯•ç¼–è¾‘ä¸€ä¸ªç»„ä»¶æ”¾å…¥Pod/Classesä¸­ï¼Œç„¶åè¿›å…¥Exampleæ–‡ä»¶å¤¹æ‰§è¡Œpod updateå‘½ä»¤ï¼Œå†æ‰“å¼€é¡¹ç›®å·¥ç¨‹å¯ä»¥çœ‹åˆ°ï¼Œåˆšåˆšæ·»åŠ çš„ç»„ä»¶å·²ç»åœ¨Podså­å·¥ç¨‹ä¸‹</span>

<span class="c1"># æ¨é€libåˆ°remote</span>
git add .
git commit -s -m <span class="s2">&quot;Initial Commit of Library&quot;</span>
git remote add origin git@coding.net:wtlucky/podTestLibrary.git  <span class="c1"># æ·»åŠ è¿œç«¯ä»“åº“ï¼ˆè¿™æ˜¯ä»£ç ä»“åº“ï¼‰</span>
git push origin master     <span class="c1"># æäº¤åˆ°è¿œç«¯ä»“åº“</span>

<span class="c1"># æ‰“ragï¼Œæ¨tag</span>
git tag -m <span class="s2">&quot;first release&quot;</span> <span class="m">0</span>.1.0
git push --tags     <span class="c1">#æ¨é€tagåˆ°è¿œç«¯ä»“åº“</span>

<span class="c1"># ç¼–è¾‘podspec</span>
<span class="c1">### è¯·æŸ¥é˜…ç›¸å…³å­—æ®µæ–‡æ¡£ï¼Œæ³¨æ„ç¼–è¾‘tagå·ä¸ä½ æ¨çš„tagå·ä¸€è‡´</span>
<span class="c1">### ç‰¹åˆ«æ³¨æ„</span>
<span class="c1">### source_files(æºç è·¯å¾„ï¼Œä¸€èˆ¬åœ¨åœ¨libNmae/Classes/**/*), </span>
<span class="c1">### resource_bundles(æ¯”å¦‚.bundle, .xcassetsç­‰)ï¼Œ </span>
<span class="c1">### public_header_files(å¯ä»¥ç†è§£ä¸ºUmbrella Header), </span>
<span class="c1">### prefix_header_file(å°±æ˜¯.pchæ–‡ä»¶)</span>

<span class="c1"># lint podspecï¼ˆæ³¨æ„allow-warnings)</span>
pod lib lint  --allow-warnings 
<span class="c1">## å¦‚æœæœ‰ç§æœ‰æºï¼š</span>
pod lib lint --sources<span class="o">=</span><span class="s1">&#39;YourSource,https://mirrors.tuna.tsinghua.edu.cn/git/CocoaPods/Specs.git&#39;</span>
<span class="c1">### å‰é¢æ˜¯ç§æœ‰æºï¼Œé€—å·åæ˜¯å®˜æ–¹æºï¼Œå› ä¸ºæˆ‘ç”µè„‘ç”¨çš„æ˜¯æ¸…åæºï¼Œè¿™é‡Œå¹²è„†ä¹Ÿäº†è®¾æˆä¸€è‡´äº†ï¼ˆä¸æ˜¯å¿…è¦ï¼‰</span>

<span class="c1"># å¦‚æœä¸æ˜¯ç”¨podåˆ›å»ºçš„é¡¹ç›®ï¼Œè‡ªè¡Œåˆ›å»ºpodspecæ–‡ä»¶ï¼š</span>
 pod spec create PodTestLibrary git@coding.net:wtlucky/podTestLibrary.git  <span class="c1"># æ³¨æ„ä»“åº“åå’Œä»“åº“åœ°å€</span>
</pre></div>
<p>æœ¬åœ°æµ‹è¯•podspec, in podfile:</p><div class="highlight"><pre><span></span><span class="n">platform</span> <span class="ss">:ios</span><span class="p">,</span> <span class="s1">&#39;9.0&#39;</span>

<span class="c1"># å‡ ç§æ–¹å¼</span>
<span class="n">pod</span> <span class="s1">&#39;PodTestLibrary&#39;</span><span class="p">,</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;~/code/Cocoapods/podTest/PodTestLibrary&#39;</span>      <span class="c1"># æŒ‡å®šè·¯å¾„</span>
<span class="n">pod</span> <span class="s1">&#39;PodTestLibrary&#39;</span><span class="p">,</span> <span class="ss">:podspec</span> <span class="o">=&gt;</span> <span class="s1">&#39;~/code/Cocoapods/podTest/PodTestLibrary/PodTestLibrary.podspec&#39;</span>  <span class="c1"># æŒ‡å®špodspecæ–‡ä»¶</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1"># å‘Spec Repoæäº¤podspec(åé¢çš„å‚æ•°æ˜¯åœ¨æ¶ˆè­¦å‘Šå’Œé”™è¯¯çš„è¿‡ç¨‹ä¸­åŠ çš„ï¼Œä½ å¯ä»¥å°è¯•æ— å‚æ•°å…ˆè·‘ï¼Œç¢°åˆ°é—®é¢˜å†é€ä¸ªè§£å†³)</span>
pod repo push WTSpecs PodTestLibrary.podspec --allow-warnings --use-libraries --skip-import-validation --verbose
<span class="c1">### å®Œäº†åæœ¬åœ°~/.cocoapods/reposå’Œè¿œç«¯specä»“åº“éƒ½åº”è¯¥å‡ºç°PodTextLibrary/0.1.0è¿™ä¸ªæ–‡ä»¶å¤¹(å¯¹åº”ä½ åˆšæ‰“çš„tagï¼‰ï¼Œé‡Œé¢æœ‰ï¼ˆä¸”åªæœ‰ï¼‰åˆšæ‰åˆ›å»ºçš„podspecæ–‡ä»¶</span>
</pre></div>
<p>ä½¿ç”¨</p><div class="highlight"><pre><span></span><span class="n">pod</span> <span class="s1">&#39;PodTestLibrary&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 0.1.0&#39;</span>
</pre></div>
<p><code>lib lint</code>å’Œ<code>repo push</code>è¿‡ç¨‹ä¸­ç¢°åˆ°ä¸€äº›é—®é¢˜å¯¼è‡´validationå¤±è´¥çš„è§£å†³ï¼š</p><ul>
<li><p><code>--allow-warnings</code>, <code>--use-libraries</code>, <code>--skip-import-validation</code> ç­‰å‚æ•°çµæ´»ä½¿ç”¨ï¼Œç›®æ ‡å°±æ˜¯ä¸ºäº†é€šè¿‡éªŒè¯</p></li>
<li><p><code>--no-clean</code> å¯ä»¥åœ¨å‡ºé”™æ—¶æ‰“å°æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ˆæˆ‘åŠ äº†<code>--verbose</code>ååœ¨buildå¤±è´¥æ—¶ä¼šæç¤ºä½ åŠ è¿™ä¸ª)</p></li>
<li><p>ç¢°åˆ°æœ‰æ¨¡å—ä¸æ”¯æŒi386ä»€ä¹ˆçš„æ¶æ„æ—¶ï¼Œæ·»åŠ è¿™ä¸ª(<a href="https://blog.nowcoder.net/n/68dac16078184973ac061027817a2d9a?from=nowcoder_improve">æ›´å¤šçœ‹è¿™ç¯‡æ–‡ç« </a>)ï¼š</p></li>
<li>
<pre><code>s.xcconfig = {
    'VALID_ARCHS' =&gt;  'x86_64 armv7 arm64',
  }
  s.pod_target_xcconfig = { 'ARCHS[sdk=iphonesimulator*]' =&gt; '$(ARCHS_STANDARD_64_BIT)' }
</code></pre>
</li>
<li><p><code>pod lint implicit declaration of function 'XXXX' is invalid in C99 [-Werror,-Wimplicit-function-declaration]</code> <a href="https://blog.csdn.net/cnwyt/article/details/105073749">çœ‹è¿™é‡Œ</a></p><ul>
<li>å¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œæˆ‘å‰é¢çš„ä¾èµ–ç¡®å®æ·»åŠ äº†è¯¥å®å®šä¹‰çš„æ¨¡å—`s.dependency 'xxxx' æˆ‘ç›®å‰æ˜¯åœ¨é—®é¢˜æ–‡ä»¶é‡Œé‡æ–°defineä¸€æ¬¡è¿™ä¸ªå®è§£å†³çš„ï¼Œ</li>
</ul>
</li>
</ul>
<h1>podspec è¿›é˜¶</h1>
<div class="highlight"><pre><span></span><span class="c1"># [å¦‚æœ]æ¯ä¸ªå­æ¨¡å—æœ‰è‡ªå·±çš„dependency, public headerfile, pchfileç­‰</span>
<span class="n">s</span><span class="o">.</span><span class="n">subspec</span> <span class="s1">&#39;NetWorkEngine&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">networkEngine</span><span class="o">|</span>
    <span class="n">networkEngine</span><span class="o">.</span><span class="n">source_files</span> <span class="o">=</span> <span class="s1">&#39;Pod/Classes/NetworkEngine/**/*&#39;</span>
    <span class="n">networkEngine</span><span class="o">.</span><span class="n">public_header_files</span> <span class="o">=</span> <span class="s1">&#39;Pod/Classes/NetworkEngine/**/*.h&#39;</span>
    <span class="n">networkEngine</span><span class="o">.</span><span class="n">dependency</span> <span class="s1">&#39;AFNetworking&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 2.3&#39;</span>
<span class="k">end</span>

<span class="n">s</span><span class="o">.</span><span class="n">subspec</span> <span class="s1">&#39;DataModel&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">dataModel</span><span class="o">|</span>
    <span class="n">dataModel</span><span class="o">.</span><span class="n">source_files</span> <span class="o">=</span> <span class="s1">&#39;Pod/Classes/DataModel/**/*&#39;</span>
    <span class="n">dataModel</span><span class="o">.</span><span class="n">public_header_files</span> <span class="o">=</span> <span class="s1">&#39;Pod/Classes/DataModel/**/*.h&#39;</span>
<span class="k">end</span>

<span class="n">s</span><span class="o">.</span><span class="n">subspec</span> <span class="s1">&#39;CommonTools&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">commonTools</span><span class="o">|</span>
    <span class="n">commonTools</span><span class="o">.</span><span class="n">source_files</span> <span class="o">=</span> <span class="s1">&#39;Pod/Classes/CommonTools/**/*&#39;</span>
    <span class="n">commonTools</span><span class="o">.</span><span class="n">public_header_files</span> <span class="o">=</span> <span class="s1">&#39;Pod/Classes/CommonTools/**/*.h&#39;</span>
    <span class="n">commonTools</span><span class="o">.</span><span class="n">dependency</span> <span class="s1">&#39;OpenUDID&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 1.0.0&#39;</span>
<span class="k">end</span>

<span class="n">s</span><span class="o">.</span><span class="n">subspec</span> <span class="s1">&#39;UIKitAddition&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">ui</span><span class="o">|</span>
    <span class="n">ui</span><span class="o">.</span><span class="n">source_files</span> <span class="o">=</span> <span class="s1">&#39;Pod/Classes/UIKitAddition/**/*&#39;</span>
    <span class="n">ui</span><span class="o">.</span><span class="n">public_header_files</span> <span class="o">=</span> <span class="s1">&#39;Pod/Classes/UIKitAddition/**/*.h&#39;</span>
    <span class="n">ui</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="s2">&quot;Pod/Assets/MLSUIKitResource.bundle&quot;</span>
    <span class="n">ui</span><span class="o">.</span><span class="n">dependency</span> <span class="s1">&#39;PodTestLibrary/CommonTools&#39;</span>
<span class="k">end</span>
</pre></div>
<p>ä½“ç°ä¸ºï¼š</p><div class="highlight"><pre><span></span>$ pod search PodTestLibrary

-&gt; PodTestLibrary <span class="o">(</span><span class="m">1</span>.0.0<span class="o">)</span>
   Just Testing.
   pod <span class="s1">&#39;PodTestLibrary&#39;</span>, <span class="s1">&#39;~&gt; 1.0.0&#39;</span>
   - Homepage: https://coding.net/u/wtlucky/p/podTestLibrary
   - Source:   https://coding.net/wtlucky/podTestLibrary.git
   - Versions: <span class="m">1</span>.0.0, <span class="m">0</span>.1.0 <span class="o">[</span>WTSpecs repo<span class="o">]</span>
   - Sub specs:
     - PodTestLibrary/NetWorkEngine <span class="o">(</span><span class="m">1</span>.0.0<span class="o">)</span>
     - PodTestLibrary/DataModel <span class="o">(</span><span class="m">1</span>.0.0<span class="o">)</span>
     - PodTestLibrary/CommonTools <span class="o">(</span><span class="m">1</span>.0.0<span class="o">)</span>
     - PodTestLibrary/UIKitAddition <span class="o">(</span><span class="m">1</span>.0.0<span class="o">)</span>
</pre></div>
<p>ä½¿ç”¨ï¼š</p><div class="highlight"><pre><span></span><span class="n">source</span> <span class="s1">&#39;https://github.com/CocoaPods/Specs.git&#39;</span>  <span class="c1"># å®˜æ–¹åº“</span>
<span class="n">source</span> <span class="s1">&#39;https://git.coding.net/wtlucky/WTSpecs.git&#39;</span>   <span class="c1"># ç§æœ‰åº“</span>
<span class="n">platform</span> <span class="ss">:ios</span><span class="p">,</span> <span class="s1">&#39;9.0&#39;</span>

<span class="n">pod</span> <span class="s1">&#39;PodTestLibrary/NetWorkEngine&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0.0&#39;</span>  <span class="c1">#ä½¿ç”¨æŸä¸€ä¸ªéƒ¨åˆ†</span>
<span class="n">pod</span> <span class="s1">&#39;PodTestLibrary/UIKitAddition&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0.0&#39;</span>

<span class="n">pod</span> <span class="s1">&#39;PodTestLibrary&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0.0&#39;</span>   <span class="c1">#ä½¿ç”¨æ•´ä¸ªåº“</span>
</pre></div>
</div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/cocoapods_private_library/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/hittest/" target="_self">hitTestç¤ºä¾‹</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/hittest/" target="_self">
                <time class="text-uppercase">
                    February 19 2022
                </time>
            </a>
        </div>
        <div class="prism-content"><p>å¾€çª—å£é‡Œæ·»åŠ ä¸¤ä¸ªè‡ªå®šä¹‰çš„viewï¼Œè¿™æ ·æ¯ä¸ªviewçš„<code>hitTest</code>æ–¹æ³•è¢«è®¿é—®çš„æ—¶å€™æˆ‘ä»¬å°±èƒ½logä¸€ä¸‹ï¼š</p><div class="highlight"><pre><span></span><span class="kd">import</span> <span class="nc">UIKit</span>

<span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>

    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>

        <span class="kd">let</span> <span class="nv">view1</span> <span class="p">=</span> <span class="n">View1</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">110</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">110</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">150</span><span class="p">))</span>
        <span class="kd">let</span> <span class="nv">view2</span> <span class="p">=</span> <span class="n">View2</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">170</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">170</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">150</span><span class="p">))</span>
        <span class="n">view1</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="p">.</span><span class="n">yellow</span>
        <span class="n">view2</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="p">.</span><span class="n">red</span>

        <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">view1</span><span class="p">)</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">view2</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">View1</span> <span class="p">:</span> <span class="bp">UIView</span> <span class="p">{</span>
    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">hitTest</span><span class="p">(</span><span class="kc">_</span> <span class="n">point</span><span class="p">:</span> <span class="n">CGPoint</span><span class="p">,</span> <span class="n">with</span> <span class="n">event</span><span class="p">:</span> <span class="bp">UIEvent</span><span class="p">?)</span> <span class="p">-&gt;</span> <span class="bp">UIView</span><span class="p">?</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;enter v1 </span><span class="si">\(</span><span class="n">point</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">super</span><span class="p">.</span><span class="n">hitTest</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">with</span><span class="p">:</span> <span class="n">event</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">View2</span> <span class="p">:</span> <span class="bp">UIView</span> <span class="p">{</span>
    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">hitTest</span><span class="p">(</span><span class="kc">_</span> <span class="n">point</span><span class="p">:</span> <span class="n">CGPoint</span><span class="p">,</span> <span class="n">with</span> <span class="n">event</span><span class="p">:</span> <span class="bp">UIEvent</span><span class="p">?)</span> <span class="p">-&gt;</span> <span class="bp">UIView</span><span class="p">?</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;enter v2, </span><span class="si">\(</span><span class="n">point</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">super</span><span class="p">.</span><span class="n">hitTest</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">with</span><span class="p">:</span> <span class="n">event</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>è¿è¡Œï¼š</p><figure class="vertical-figure" style="flex: 46.42857142857143" ><img width="650" height="700" src="/archives/assets/5b4c2daa70dc2e8941de89fdb19c2bfa.png" alt="image-20220219014246803"/></figure><p>åœ¨ç©ºç™½å¤„(<strong>bottom view</strong>)ç‚¹äº†ä¸€ä¸‹ï¼Œè¾“å‡ºï¼š</p><div class="highlight"><pre><span></span>enter v2, <span class="o">(</span>-48.66007995605469, <span class="m">306</span>.0133361816406<span class="o">)</span>
enter v1, <span class="o">(</span><span class="m">11</span>.339920043945312, <span class="m">366</span>.0133361816406<span class="o">)</span>
enter v2, <span class="o">(</span>-48.66007995605469, <span class="m">306</span>.0133361816406<span class="o">)</span>
enter v1, <span class="o">(</span><span class="m">11</span>.339920043945312, <span class="m">366</span>.0133361816406<span class="o">)</span>
enter v2, <span class="o">(</span>-43.33333333333334, <span class="m">325</span>.3333333333333<span class="o">)</span>
enter v1, <span class="o">(</span><span class="m">16</span>.666666666666657, <span class="m">385</span>.3333333333333<span class="o">)</span>
enter v2, <span class="o">(</span>-43.33333333333334, <span class="m">325</span>.3333333333333<span class="o">)</span>
enter v1, <span class="o">(</span><span class="m">16</span>.666666666666657, <span class="m">385</span>.3333333333333<span class="o">)</span>
</pre></div>
<p>åœ¨çº¢æ¡†ä¸Š(<strong>top view</strong>)ç‚¹ä¸€ä¸‹ï¼Œè¾“å‡ºï¼š</p><div class="highlight"><pre><span></span>enter v2, <span class="o">(</span><span class="m">38</span>.66666666666666, <span class="m">48</span>.66666666666666<span class="o">)</span>
enter v2, <span class="o">(</span><span class="m">38</span>.66666666666666, <span class="m">48</span>.66666666666666<span class="o">)</span>
</pre></div>
<p>åœ¨é»„æ¡†(<strong>middle view</strong>)ç‚¹ä¸€ä¸‹ï¼Œè¾“å‡ºï¼š</p><div class="highlight"><pre><span></span>enter v2, <span class="o">(</span>-31.210678100585938, -27.8685302734375<span class="o">)</span>
enter v2, <span class="o">(</span>-31.210678100585938, -27.8685302734375<span class="o">)</span>
enter v2, <span class="o">(</span>-25.0, -22.333333333333343<span class="o">)</span>
enter v1, <span class="o">(</span><span class="m">35</span>.0, <span class="m">37</span>.66666666666666<span class="o">)</span>
enter v2, <span class="o">(</span>-25.0, -22.333333333333343<span class="o">)</span>
enter v1, <span class="o">(</span><span class="m">35</span>.0, <span class="m">37</span>.66666666666666<span class="o">)</span>
</pre></div>
<ul>
<li>æˆ‘ä»¬çŸ¥é“<code>hitTest</code>æœºåˆ¶æ˜¯äº‹ä»¶ä¼ é€’é“¾ç”±åº•å‘ä¸Šï¼Œå“åº”é“¾ç”±ä¸Šåˆ°ä¸‹ï¼Œ</li>
<li>æ‰€ä»¥æœ€åº•å±‚çš„<strong>bottom view</strong>æœ€å…ˆæ¥åˆ°äº‹ä»¶å°±å¼€å§‹æ‰¾å“åº”è€…</li>
<li>å®ƒå¼€å§‹ä»å®ƒçš„æœ€é¡¶å±‚subviewå¼€å§‹æ‰¾å“åº”è€…(<code>v2</code>)ï¼Œç„¶åå†å¾€ä¸‹(<code>v1</code>)ï¼Œå‡æ²¡æ‰¾åˆ°ï¼Œæ‰€ä»¥å°±æ˜¯è‡ªå·±äº†</li>
<li>ä¸ºä½•è°ƒäº†å››æ¬¡å‘¢ï¼Ÿï¼ˆæœªæ·±ç©¶ï¼‰<blockquote>
Yes, itâ€™s normal. The system may tweak the point being hit tested between the calls. Since hitTest should be a pure function with no side-effects, this should be fine.</blockquote>
</li>
<li>ç¬¬äºŒæ¬¡æµ‹è¯•ï¼Œç›´æ¥åœ¨æœ€é¡¶å±‚viewå°±æ‰¾åˆ°äº†ï¼ˆæ‰€è°“çš„æ‰¾åˆ°ï¼Œå°±æ˜¯ç‚¹å‡»çš„ä½ç½®åœ¨è¿™ä¸ªviewçš„boundså†…ï¼Œåé¢è¯´ï¼‰</li>
<li>è‡³äºä¸ºä»€ä¹ˆåæ ‡ä¼šå˜ï¼Ÿï¼ˆæœªæ·±ç©¶ï¼‰</li>
<li>ç¬¬ä¸‰æ¬¡æµ‹è¯•ï¼Œç‚¹äº†v1ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—ï¼Œåœ¨v2é‚£é‡Œè·‘äº†3æ¬¡ï¼Œå†è·‘äº†v1ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿˜æ˜¯æ²¡è¿”å›ï¼Œè¿˜è·‘äº†ä¸€æ¬¡v2åæ‰è®¤å®šv1</li>
</ul>
<p>å¤§ä½“å¯ä»¥çŸ¥é“hitTestçš„æœºåˆ¶äº†å§ï¼Ÿä»¥ä¼ é€’é“¾çš„ç»ˆç‚¹é‚£ä¸ªviewä¸ºåŸºç¡€ï¼Œåœ¨subviewsé€†å‘éå†ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰ï¼Œä¸€ç›´åˆ°è‡ªå·±ã€‚</p><h2>åº”ç”¨1</h2>
<p>æ¥ä¸ªç®€å•åœºæ™¯ï¼Œå¦‚æœé»„è‰²çš„viewæ˜¯æœ‰è§¦æ‘¸äº‹ä»¶çš„ï¼Œå¹¶ä¸”è¦æ±‚è¢«è¦†ç›–çš„åŒºåŸŸä¹Ÿèƒ½å“åº”ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>æ€è€ƒï¼š</p><ul>
<li>æˆ‘ä»¬çŸ¥é“ç‚¹å‡»çš„ä½ç½®ï¼Œè‚¯å®šæ˜¯åœ¨é»„æ¡†èŒƒå›´å†…çš„ï¼Œæ‰€ä»¥è¦çš„å°±æ˜¯ä¸€ä¸ªå…¥å£ï¼Œç”¨æ¥åˆ¤æ–­è¿™ä¸ªç‚¹ä¸é»„æ¡†çš„å…³ç³»ï¼Œä¸€æ—¦ç¡®è®¤ç‚¹çš„èŒƒå›´æ˜¯åœ¨é»„æ¡†é‡Œï¼Œå°±æŠŠè®¤ä¸ºé»„æ¡†æ˜¯äº‹ä»¶å“åº”è€…ã€‚</li>
<li>å› æ­¤æ”¹ä¸‹demoï¼ŒåŠ äº†äº‹ä»¶ï¼Œè¿˜åŠ äº†ä¸€ä¸ªparent viewï¼ˆè¿™æ ·æ‰èƒ½åœ¨ç”¨å±æ€§çš„æ–¹å¼æŠŠé»„æ¡†å¼•ç”¨å‡ºæ¥ï¼‰</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>

    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>


        <span class="kd">let</span> <span class="nv">view1</span> <span class="p">=</span> <span class="bp">UIView</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">110</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">110</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">150</span><span class="p">))</span>
        <span class="kd">let</span> <span class="nv">view2</span> <span class="p">=</span> <span class="bp">UIView</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">170</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">170</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">150</span><span class="p">))</span>
        <span class="n">view1</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="p">.</span><span class="n">yellow</span>
        <span class="n">view2</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="p">.</span><span class="n">red</span>

        <span class="kd">let</span> <span class="nv">tap</span> <span class="p">=</span> <span class="bp">UITapGestureRecognizer</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="kc">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">tap</span><span class="p">(</span><span class="kc">_</span><span class="p">:)))</span>
        <span class="n">view1</span><span class="p">.</span><span class="n">addGestureRecognizer</span><span class="p">(</span><span class="n">tap</span><span class="p">)</span>
        <span class="n">view1</span><span class="p">.</span><span class="n">isUserInteractionEnabled</span> <span class="p">=</span> <span class="kc">true</span>

        <span class="kd">let</span> <span class="nv">view</span> <span class="p">=</span> <span class="n">View</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">view1</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">view2</span><span class="p">)</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kr">@objc</span> <span class="kd">func</span> <span class="nf">tap</span><span class="p">(</span><span class="kc">_</span> <span class="n">sender</span><span class="p">:</span> <span class="bp">UIGestureRecognizer</span><span class="p">)</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;view1 taped&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">View</span><span class="p">:</span> <span class="bp">UIView</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">view1</span><span class="p">:</span> <span class="bp">UIView</span>
    <span class="kd">var</span> <span class="nv">view2</span><span class="p">:</span> <span class="bp">UIView</span>
    <span class="kd">init</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="bp">UIView</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="bp">UIView</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">view1</span> <span class="p">=</span> <span class="n">a</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">view2</span> <span class="p">=</span> <span class="n">b</span>
        <span class="kc">super</span><span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="bp">UIScreen</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">bounds</span><span class="p">)</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kr">required</span> <span class="kd">init</span><span class="p">?(</span><span class="n">coder</span><span class="p">:</span> <span class="bp">NSCoder</span><span class="p">)</span> <span class="p">{</span>
        <span class="bp">fatalError</span><span class="p">(</span><span class="s">&quot;init(coder:) has not been implemented&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">hitTest</span><span class="p">(</span><span class="kc">_</span> <span class="n">point</span><span class="p">:</span> <span class="n">CGPoint</span><span class="p">,</span> <span class="n">with</span> <span class="n">event</span><span class="p">:</span> <span class="bp">UIEvent</span><span class="p">?)</span> <span class="p">-&gt;</span> <span class="bp">UIView</span><span class="p">?</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nv">loc_v1</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">convert</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">view1</span><span class="p">)</span>
          <span class="c1">// ä¸»è¦å°±æ˜¯è¿™ä¸€å¥</span>
        <span class="k">if</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">view1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">inside</span><span class="p">:</span> <span class="n">loc_v1</span><span class="p">,</span> <span class="n">with</span><span class="p">:</span> <span class="n">event</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">self</span><span class="p">.</span><span class="n">view1</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">super</span><span class="p">.</span><span class="n">hitTest</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">with</span><span class="p">:</span> <span class="n">event</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<ul>
<li><code>let loc_v1 = self.convert(point, to: self.view1)</code>æ„æ€æ˜¯è¿™ä¸ªç‚¹ä»¥view1ä¸ºåæ ‡ç³»çš„ä½ç½®</li>
<li><code>if(self.view1.point(inside: loc_v1, with: event))</code> è¿™å°±æ˜¯åˆ¤æ–­è¿™ä¸ªç‚¹åœ¨ä¸åœ¨view1çš„boundsé‡Œé¢äº†</li>
</ul>
<p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç®€å•ç²—æš´åœ°â€œé€®ä½æ¯ä¸€ä¸ªæœºä¼šâ€ï¼Œé—®æ˜¯ä¸æ˜¯ä½ ï¼Œæ˜¯ä¸æ˜¯ä½ ã€‚</p><h2>åº”ç”¨2</h2>
<p>å¦‚æœä¸€ä¸ªæŒ‰é’®å¾ˆå°ï¼Œä½ è¦æ‰©å¤§ä»–çš„ç‚¹å‡»åŒºåŸŸæ€ä¹ˆåšï¼Ÿç½‘ä¸Šæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå…³è”å±æ€§å•Šï¼Œäº¤æ¢æ–¹æ³•å•Šï¼Œå¯ä»¥å»æœæœï¼Œæˆ‘ä»¬è¿™é‡Œç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼ŒçŸ¥é“æœ‰ä¸€ä¸ª<code>point(inside:with)</code>æ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯è¿™ä¸ªç‚¹åœ¨ä¸åœ¨æˆ‘çš„è§†å›¾åŒºåŸŸå†…</p><p>å®ƒå½“ç„¶ä¹Ÿæ˜¯å¯ä»¥è¢«é‡å†™ï¼Œè‡ªå®šä¹‰åœ¨ä»€ä¹ˆæ ·çš„èŒƒå›´å†…ï¼Œéƒ½ç®—<code>inside</code>ï¼Œä¸‹é¢æ˜¯ç½‘ä¸ŠæŠ„çš„ä¸€æ®µä»£ç </p>
<pre><code>- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent*)event {
   //è·å–å½“å‰buttonçš„å®é™…å¤§å°
    CGRect bounds = self.bounds;
    //è‹¥åŸçƒ­åŒºå°äº44x44ï¼Œåˆ™æ”¾å¤§çƒ­åŒºï¼Œå¦åˆ™ä¿æŒåŸå¤§å°ä¸å˜
    CGFloat widthDelta = MAX(44.0 - bounds.size.width, 0);
    CGFloat heightDelta = MAX(44.0 - bounds.size.height, 0);
    //æ‰©å¤§bounds
    bounds = CGRectInset(bounds, -0.5 * widthDelta, -0.5 * heightDelta);
    //å¦‚æœç‚¹å‡»çš„ç‚¹ åœ¨ æ–°çš„boundsé‡Œï¼Œå°±è¿”å›YES
    return CGRectContainsPoint(bounds, point);
}
</code></pre>
<p>è¿™ä¸ªä¾‹å­ä¸»è¦å°±æ˜¯åˆ©ç”¨åº•å±‚çš„<code>CGRectContainsPoint</code>æ–¹æ³•ï¼Œä¼ å…¥äº†æ–°çš„<code>bounds</code>ï¼Œå¯ä»¥ç†è§£ä¸ºäººä¸ºä¿®æ”¹å…¥å‚å§ã€‚ä»£ç ä¹Ÿå¾ˆæ˜ç¡®äº†ï¼Œè‡ªå·±æ ¹æ®å½“å‰çš„boundsåˆç†åšä¸€ä¸ªå¤§ä¸€ç‚¹çš„boundsï¼Œäº¤ç»™ç³»ç»Ÿå»åšå°±è¡Œäº†ã€‚</p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/hittest/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/Layer/" target="_self">Programming iOS 14 - Layer</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/Layer/" target="_self">
                <time class="text-uppercase">
                    February 18 2022
                </time>
            </a>
        </div>
        <div class="prism-content"><p>ã€ŠProgramming iOS 14: Dive Deep into Views, View Controllers, and Frameworksã€‹ç¬¬3ç« </p><hr />
<h1>Layers</h1>
<ul>
<li>A UIView does not actually <strong>draw itself</strong> onto the screen; it draws itself <strong>into its layer</strong>, and it is the layer that is portrayed on the screen.</li>
<li>a view is not <strong>redrawn</strong> frequently;</li>
<li>instead, its drawing is cached, and the cached version of the drawing (<code>the bitmap backing store</code>) is used where possible.</li>
<li>The cached version is, in fact, the <code>layer</code>.</li>
<li>the viewâ€™s graphics context is <code>actually</code> the layerâ€™s graphics context.</li>
<li>a layer is the <code>recipient</code> and <code>presenter</code> of a viewâ€™s drawing</li>
<li>Layers are <code>made to be animated</code></li>
<li>ViewæŒæœ‰layerï¼Œæ˜¯layerçš„ä»£ç†ï¼ˆ<code>CALayerDeletgate</code>ï¼‰<ul>
<li>ä½†layerä¸èƒ½æ‰¾åˆ°View</li>
</ul>
</li>
<li>Viewçš„å¤§éƒ¨åˆ†å±æ€§éƒ½åªæ˜¯å…¶<code>underlying layer</code>çš„ä¾¿æ·æ–¹æ³•</li>
<li>layerèƒ½æ“æ§å’Œæ”¹å˜viewçš„è¡¨ç°ï¼Œè€Œæ— éœ€ask the view to redraw itself</li>
</ul>
<p>è‡ªå®šä¹‰underlaying layerçš„æ–¹æ³•</p><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">CompassView</span> <span class="p">:</span> <span class="bp">UIView</span> <span class="p">{</span>
    <span class="kr">override</span> <span class="kd">class</span> <span class="nc">var</span> <span class="n">layerClass</span> <span class="p">:</span> <span class="nb">AnyClass</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">CompassLayer</span><span class="p">.</span><span class="kc">self</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h2>Layers and Sublayers</h2>
<ul>
<li><p>layerçš„ç»§æ‰¿æ ‘è·Ÿviewçš„ç»§æ‰¿æ ‘å‡ ä¹ä¸€è‡´</p></li>
<li><p>layerçš„<code>masksToBounds</code>å±æ€§å†³å®šäº†èƒ½å¦æ˜¾ç¤ºsublayerè¶…å‡ºäº†å…¶boundsçš„éƒ¨åˆ†ï¼Œè¿™ä¹Ÿæ˜¯viewçš„<code>clipsToBounds</code>çš„å¹³è¡Œå±æ€§</p></li>
<li><p><code>sublayers</code>æ˜¯å¯å†™çš„ï¼Œè€Œ<code>subviews</code>ä¸æ˜¯</p><ul>
<li>æ‰€ä»¥è®¾ä¸ºnilå¯ä»¥ç§»é™¤æ‰€æœ‰å­å±‚ï¼Œä½†subviewå´éœ€è¦ä¸€ä¸ªä¸ª<code>removeFromSuperview</code></li>
</ul>
</li>
<li><p><code>zPostion</code>å†³å®šäº†å±‚çº§ï¼ˆorderï¼‰ï¼Œé»˜è®¤å€¼éƒ½æ˜¯0.0</p></li>
<li><p>a layer does not have a centeré <code>position</code>å’Œ<code>anchorPoint</code>å®šä½</p><ul>
<li>position: åœ¨superLayerä¸­çš„ä½ç½®</li>
<li>anchorPoint: ç”¨å°æ•°è¡¨ç¤ºçš„bound(å®½/é«˜)ä½ç½®ï¼Œå·¦ä¸Š(0, 0), å³ä¸‹(1, 1)ï¼Œ default:(0.5, 0.5)</li>
<li>æ‰€ä»¥(0.5, 0.5)çš„anchorPointï¼Œå¯¹åº”çš„<code>poosition</code>å°±ç­‰åŒäºcenteräº†ï¼Œç†è§£ä¸€ä¸‹<ul>
<li>å…¶å®å°±æ˜¯è¯´ä½ çš„â€œé”šç‚¹â€åœ¨superLayerçš„ä»€ä¹ˆä½ç½®çš„æ„æ€</li>
</ul>
</li>
<li>When you get the frame, it is calculated from the <code>bounds size</code> along with the <code>position</code> and <code>anchorPoint</code>.<ul>
<li>When you set the frame, you set the <code>bounds</code> size and <code>position</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1">// demo, æŠŠä¸€ä¸ª80x40çš„layerï¼Œå·¦ä¸Šè§’æ”¾åˆ°(130, 120çš„ä½ç½®ï¼‰</span>
<span class="n">let</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">CALayer</span><span class="p">()</span><span class="w"></span>
<span class="n">layer</span><span class="p">.</span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">:</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w"></span>
<span class="n">layer</span><span class="p">.</span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIColor</span><span class="p">.</span><span class="n">yellow</span><span class="p">.</span><span class="n">cgColor</span><span class="w"></span>
<span class="n">layer</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">120</span><span class="p">)</span><span class="w"></span>
<span class="n">layer</span><span class="p">.</span><span class="n">anchorPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</pre></div>
<blockquote>
<p>å¦‚æœä¸€ä¸ªlayerçš„positionæ˜¯(0, 0)ï¼Œé”šç‚¹æ˜¯(0,0)ï¼Œåˆšå¥½æ˜¾ç¤ºåœ¨å·¦ä¸Šè§’
è€Œï¼ˆ0.5ï¼Œ0.5)åˆ™åªèƒ½æ˜¾ç¤ºå³ä¸‹è§’çš„1/4äº†
å³(0.5, 0.5)åˆ°äº†åŸæ¥(0,0)çš„ä½ç½®ã€‚æ‰€ä»¥è¯´å…¶å®å°±æ˜¯æŠŠè‡ªèº«boundsåº¦é‡ä¸‹çš„å“ªä¸ªä½ç½®ç§»åˆ°(0,0)</p></blockquote>
<p>è¿™ä¹ˆè¯´æ¥ï¼Œå¯¹é”šç‚¹çš„æœ€æ­£ç¡®ç†è§£å…¶å®æ˜¯ï¼Œ</p><ul>
<li>æˆ‘æŠŠè‡ªèº«åæ ‡ç³»é‡Œçš„å“ªä¸ªç‚¹å®šä¹‰ä¸ºåŸç‚¹ï¼Œ</li>
<li>å¹¶ä¸”ï¼Œè¿™ä¸ªç‚¹ç§»åˆ°åŸæœ¬â€œå·¦ä¸Šè§’â€çš„ä½ç½®ï¼ˆæƒ³è±¡0.5,0.5)</li>
<li>å¹¶ä¸”ï¼Œæ‰€æœ‰çš„æ—‹è½¬ä¹‹ç±»çš„åŠ¨ç”»æœ¬æ¥æ˜¯å¯¹â€œå·¦ä¸Šè§’â€<strong>çš„ä½ç½®</strong>è¿›è¡Œçš„ï¼Œä¸ç®¡ç°åœ¨è¿™ä¸ªä½ç½®æ˜¯layerä¸Šçš„å“ªä¸ªéƒ¨åˆ†<ul>
<li>æˆ–è€…è¯´ï¼Œæ—‹è½¬æ°¸è¿œæ˜¯å‘ç”Ÿåœ¨<code>position</code>ä¸Šçš„ï¼Œä½ æŠŠå“ªä¸ªç‚¹æ”¾åˆ°positionä¸Šå®ƒä¸ç®¡</li>
</ul>
</li>
</ul>
<p>ç†è§£frameçš„å°ç»ƒä¹ </p><div class="highlight"><pre><span></span><span class="c1">// å¦‚æœæˆ‘è®¾äº†layerçš„frame:</span>
<span class="n">circle</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">:</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w"></span>

<span class="c1">// å®é™…ä¸Šæ˜¯é€šè¿‡size, position, anchorPointæ¥å®ç°çš„ï¼š</span>
<span class="n">circle</span><span class="p">.</span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">:</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w"></span>

<span class="c1">// ä»¥å·¦ä¸Šè§’ä¸ºanchorPoint</span>
<span class="n">circle</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="mi">50</span><span class="p">)</span><span class="w"></span>
<span class="n">circle</span><span class="p">.</span><span class="n">anchorPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="c1">// æˆ–è€…ï¼Œä»¥ä¸­å¿ƒä¸ºanchorPoint</span>
<span class="n">circle</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="mi">150</span><span class="p">)</span><span class="w"></span>
<span class="n">circle</span><span class="p">.</span><span class="n">anchorPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="mf">0.5</span><span class="p">)</span><span class="w"></span>
<span class="c1">// æˆ–è€…å…¶å®ƒä»»æ„anchorPointï¼Œå‰ææ˜¯è‡ªå·±æ¢ç®—</span>
<span class="c1">// è€Œä¸”ï¼Œè™½ç„¶ä½ç½®æ˜¯ä¸€æ ·çš„ï¼Œä½†ä¼šå½±å“transform</span>
</pre></div>
<p><strong>CAScrollLayer</strong></p><ul>
<li>ä½ æƒ³é€šè¿‡ç§»åŠ¨layerçš„boundsæ¥é‡å®šä½sublayersï¼Œå¯ä»¥ä½¿ç”¨<code>CAScrollLayer</code></li>
<li>ä½†æ˜¯å®ƒå¹¶ä¸èƒ½é€šè¿‡æ‹–æ‹½æ¥ç§»åŠ¨é‡Œé¢çš„å†…å®¹ï¼ˆè®°å¾—å®ƒæ²¡æœ‰å“åº”é“¾ï¼‰</li>
<li>è€Œæ˜¯ç†è§£ä¸ºä¸€ä¸ª<code>masksToBounds</code>çš„çª—å£ï¼Œä½ åªèƒ½çœ‹åˆ°å®ƒboundsé‡Œé¢çš„å†…å®¹</li>
<li>èƒ½é€šè¿‡æœ¬èº«çš„<code>scroll(to:)</code>æ–¹æ³•ï¼Œå’Œsublayersçš„<code>scroll(_:)</code>å’Œ<code>scrollRectToVisible(_:)</code>æ–¹æ³•æ¥æ”¹å˜scroll layerçš„boundsï¼Œè¾¾åˆ°æ˜¾ç¤ºsublayeræŒ‡å®šåŒºåŸŸçš„ç›®çš„</li>
</ul>
<p><strong>Layer and Delegate</strong></p><ul>
<li>å¯¹ä¸€ä¸ªä¸æ˜¯UIViewçš„undrelying layerçš„layerï¼Œè®©ï¼ˆä»»æ„ï¼‰ä¸€ä¸ªå¯¹è±¡æˆä¸ºå…¶delegateï¼Œå¯ä»¥ç”±å®ƒæ¥æ“æ§å®ƒçš„layoutå’Œdrawing</li>
<li>ä½†åƒä¸‡ä¸è¦è®©UIViewæˆä¸ºä¸æ˜¯å…¶underlyingçš„layerçš„ä»£ç†ï¼Œåä¹‹äº¦ç„¶</li>
</ul>
<p><strong>Layout of Lyaers</strong></p><ul>
<li>When a layer needs layout, either because its <em>bounds have changed</em> or because you called <code>setNeedsLayout</code></li>
</ul>
<h2>Drawing in a Layer</h2>
<ul>
<li>set <code>contents</code> is the simplest way to draw in a layer -&gt; <code>CGImage</code><ul>
<li>ä½†<code>contents</code>èƒ½æ¥å—ä»»ä½•ç±»å‹ï¼Œæ‰€ä»¥ä¸æ­£ç¡®çš„contentåªä¼š<strong>fail silently</strong></li>
</ul>
</li>
<li>layerä¹Ÿæœ‰ä¸€ä¸ª<code>draw(_:)æ–¹æ³•ï¼Œå®ƒè¢«(è‡ªåŠ¨)è°ƒç”¨çš„æ—¶å€™é€šå¸¸è¡¨ç¤ºè¦</code>redisplay itself`ï¼Œä»€ä¹ˆæ—¶å€™éœ€è¦redisplay itself?<ul>
<li>å¦‚æœ<code>needsDisplayOnBoundsChange</code>æ˜¯falseï¼Œé‚£ä¹ˆå°±åªæœ‰åœ¨<code>sefNeedDisplay</code>æ–¹æ³•ï¼ˆåŠå…¶<code>inRect</code>è¡ç”Ÿæ–¹æ³•ï¼‰é‡Œä¼šè§¦å‘<ul>
<li>å¦‚æœæ˜¯éå¸¸é‡è¦çš„é‡ç»˜ï¼Œé‚£ä¹ˆéœ€è¦å†æ˜¾å¼è°ƒç”¨ä¸€æ¬¡<code>displayIfNeeded</code></li>
</ul>
</li>
<li>æ˜¯trueçš„è¯å°±å¦‚å…¶åï¼Œåœ¨boundså˜åŒ–çš„æ—¶å€™ä¹Ÿä¼šé‡ç»˜</li>
</ul>
</li>
<li>æœ‰å››ä¸ªæ–¹æ³•èƒ½åœ¨redisplayçš„æ—¶å€™è°ƒç”¨:<ol>
<li>subclassçš„<code>display</code>é‡è½½ï¼Œå®ƒæ²¡æœ‰<code>graphics context</code>ï¼Œæ‰€ä»¥åªèƒ½æä¾›å›¾ç‰‡</li>
<li>delegateçš„<code>display(in:)</code>æ–¹æ³•ï¼ŒåŒæ ·ï¼Œåªèƒ½æä¾›å›¾ç‰‡</li>
<li>subclassçš„<code>draw(in:)</code>æ–¹æ³•ï¼Œæœ‰contextï¼Œæ‰€ä»¥èƒ½ç›´æ¥åœ¨é‡Œé¢ç»˜å›¾ï¼Œä½†ä¸ä¼š<code>make current context</code></li>
<li>delegateçš„<code>draw(_:in)</code>æ–¹æ³•ï¼Œé™åˆ¶ä¹ŸåŒä¸Š</li>
</ol>
</li>
<li>underlaying layerä¸åº”è°ƒç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œè€Œäº¤ç”±viewçš„<code>draw(_:)</code>æ–¹æ³•<ul>
<li>ä¸€å®šè¦è°ƒä¹Ÿå¯ä»¥ï¼Œä½†è¦æ˜¾å¼å®ç°viewçš„<code>draw(_:)</code>æ–¹æ³•ï¼Œæ–¹æ³•ä½“ä¸ºç©ºå°±è¡Œäº†</li>
</ul>
</li>
</ul>
<p><strong>Drawing-Related Layer Properties</strong></p><ul>
<li>contentsScale: åƒç´ å¯¹é«˜åˆ†å±çš„æ˜ å°„ï¼ŒCocoaç®¡ç†çš„layerä¼šè‡ªåŠ¨è®¾ç½®ï¼Œè‡ªå®šä¹‰çš„ç±»éœ€è¦æ³¨æ„è¿™ä¸ªscale</li>
<li>opacity: å°±æ˜¯viewçš„<code>alpha</code><ul>
<li>Changing the isOpaque property has no effect until the layer redisplays itself.</li>
</ul>
</li>
</ul>
<p><strong>Content Resizing and Positioning</strong></p><ul>
<li>A layerâ€™s content is stored (cached) as a bitmap which is then treated like an image:<ul>
<li>å¦‚æœcontentæ¥è‡ªä¸€å¼ å›¾ç‰‡ï¼Œé‚£ä¹ˆç¼“å­˜çš„å°±æ˜¯å›¾ç‰‡ï¼ˆCGImageï¼‰ï¼Œå¤§å°å°±æ˜¯å›¾ç‰‡çš„point size</li>
<li>å¦‚æœæ¥è‡ªç»˜å›¾ï¼Œé‚£ä¹ˆå­˜çš„æ˜¯graphics context</li>
</ul>
</li>
<li><code>ContentGravity</code>ï¼Œç±»ä¼¼UIViewâ€™s contentMode propertyï¼Œå³ç¼©æ”¾æ‹‰ä¼¸<ul>
<li>å› ä¸ºåæ ‡ç³»ä¸åŒçš„å†å²åŸå› ï¼Œtop, bottomæ˜¯ç›¸åçš„</li>
<li>å¦‚æœæ˜¯è‡ªå·±ç»˜åˆ¶ï¼Œåˆ™è¿™ä¸ªå±æ€§æ— æ„ä¹‰ï¼Œä½†ç»“åˆä¸‹é¢çš„rectå±æ€§åˆæœ‰ç”¨äº†ï¼Œå› ä¸ºæˆªå–äº†rectå¤§å°çš„ç»˜åˆ¶</li>
</ul>
</li>
<li><code>contentsRect</code>ï¼Œç»“åˆä¸Šä¸€ä¸ªå±æ€§ï¼Œåšè´­ç‰©ç½‘ç«™é‚£ç§æˆªå–ä¸€å°å—ï¼Œç»˜åˆ¶åˆ°ä¸€ä¸ªå¤§å›¾ä¸Šå»ã€‚è¿™é‡Œæ˜¯ç»˜åˆ¶åˆ°viewä¸Š<ul>
<li>é»˜è®¤æ˜¯å…¨å›¾(0,0,1,1)</li>
</ul>
</li>
<li><code>contentsCenter</code> ?? å¥½åƒæ˜¯å¯¹ä¸Šè¿°rectå±æ€§åˆ’æˆ9å®«æ ¼ï¼Œä¸åŒä½ç½®çš„æ ¼å­ç¼©æ”¾è§„åˆ™ä¸ä¸€æ ·ï¼Œæ¯”å¦‚å››ä¸ªè§’è½çš„æ ¼å­ï¼Œä¸ä¼šç¼©æ”¾<ul>
<li>æ‰€ä»¥ç»™äº†ä¸€ä¸ªcenter regionï¼ˆrect)ï¼ŒæŠŠå®ƒçš„å››æ¡è¾¹å»¶é•¿ï¼Œå°±æœ‰9ä¸ªæ ¼å­äº†</li>
</ul>
</li>
</ul>
<p><strong>Layers that Draw Themselves</strong></p><p>ç³»ç»Ÿå†…ç½®äº†ä¸€äº›èƒ½è‡ªæˆ‘ç»˜åˆ¶çš„layer:</p><ul>
<li>CATextLayerï¼Œè½»é‡ç‰ˆçš„UILabelã€‚é€šè¿‡<code>string</code>å±æ€§å­˜å–ï¼Œä¸<code>contenta</code>ä¼šå†²çªï¼Œä¸è¦åŒæ—¶è®¾ã€‚</li>
<li>CAShapeLayer, æœ‰pathå±æ€§ï¼Œå¯ä»¥ä¸<code>contents</code>å…±å­˜ï¼Œpathç»˜åˆ¶äºcontentä¹‹ä¸Šï¼Œå¹¶ä¸”ä¸èƒ½è®¾èåˆæ¨¡å¼</li>
<li>CAGradientLayerï¼Œé€šè¿‡èƒŒæ™¯è‰²åšçš„æ¸å˜ï¼Œå»äº†è§£ä¸‹clipå’Œmask</li>
</ul>
<h2>Transforms</h2>
<ul>
<li>viewçš„transformæ˜¯æ ¹æ®å…¶<strong>center</strong>æ¥åº”ç”¨çš„ï¼Œlayerçš„æ˜¯æ ¹æ®<code>anchorPoint</code><ul>
<li>æ‰€ä»¥<code>anchorPoint</code>å°±ä¸¤ä¸ªä½œç”¨ï¼ŒæŠŠå®ƒç§»åŠ¨åˆ°<code>position</code>çš„ä½ç½®ï¼Œå’Œä»¥å®ƒä¸ºä¸­å¿ƒè¿›è¡Œæ—‹è½¬</li>
</ul>
</li>
</ul>
<ol>
<li>ç”»åˆ»åº¦ï¼Œæ ¸å¿ƒæ˜¯æŠŠæ–‡å­—å…ˆå¾€ä¸ŠæŒªåˆ°åœ†åœˆçš„ä½ç½®ï¼Œæ‰€ä»¥anchorPointåªåŠ¨yä¸åŠ¨x (center, midY/textHeight)</li>
</ol>
<div class="highlight"><pre><span></span><span class="n">let</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ABCD&quot;</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">str</span><span class="p">.</span><span class="n">enumerated</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">CATextLayer</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">:</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">:</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">circle</span><span class="p">.</span><span class="n">center</span><span class="w"> </span><span class="c1">// è¿™æ‰æ˜¯æ ¸å¿ƒï¼Œä¸€åˆ‡å®šä½å’Œæ—‹è½¬çš„åŸºå‡†</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">vert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">circle</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">midY</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">height</span><span class="w"></span>
<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">anchorPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="n">vert</span><span class="p">)</span><span class="w"> </span><span class="c1">// åŠåœ†æ˜¯æ–‡å­—è°ƒè“„çš„å¤šå°‘å€ï¼Œå°±ä¸Šç§»å¤šå°‘ï¼Œä½†éšå½¢çš„è„šï¼ˆå³é«˜è··çš„æ”¯ç‚¹ï¼‰ä»åœ¨positionå¤„</span>
<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">foregroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIColor</span><span class="p">.</span><span class="n">red</span><span class="p">.</span><span class="n">cgColor</span><span class="w"></span>

<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">setAffineTransform</span><span class="p">(</span><span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">rotationAngle</span><span class="o">:</span><span class="w"> </span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CGFloat</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="n">circle</span><span class="p">.</span><span class="n">addSublayer</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>ç»“æœå¦‚å›¾ï¼š
<figure class="vertical-figure" style="flex: 49.51923076923077" ><img width="412" height="416" src="/archives/assets/031ad73f3f956d76b906cf986e36e22e.png" alt=""/></figure></p><ol start="2">
<li>ç”»ç®­å¤´ï¼Œæ¼”ç¤ºäº†å¤æ‚çš„ç»˜åˆ¶æ€ä¹ˆæŠŠå®ƒä»£ç†å‡ºå»ï¼Œå¹¶ä¸”ä»€ä¹ˆæ—¶æœºè®©å®ƒäº§ç”Ÿç»˜åˆ¶ï¼š</li>
</ol>
<div class="highlight"><pre><span></span><span class="c1">// the arrow</span>
<span class="n">let</span><span class="w"> </span><span class="n">arrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">CALayer</span><span class="p">()</span><span class="w"></span>
<span class="n">arrow</span><span class="p">.</span><span class="n">contentsScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIScreen</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">scale</span><span class="w"></span>
<span class="n">arrow</span><span class="p">.</span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"></span>
<span class="n">arrow</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">center</span><span class="w"></span>
<span class="n">arrow</span><span class="p">.</span><span class="n">anchorPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">)</span><span class="w"> </span><span class="c1">// ç®­å°¾å‡¹è¿›å»çš„ä½ç½®ï¼ˆæ‰€ä»¥ä¸å¯èƒ½æ˜¯1.0ï¼‰</span>
<span class="n">arrow</span><span class="p">.</span><span class="n">delegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">self</span><span class="w"> </span><span class="c1">// we will draw the arrow in the delegate method</span>
<span class="n">arrow</span><span class="p">.</span><span class="n">setAffineTransform</span><span class="p">(</span><span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">rotationAngle</span><span class="o">:</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">5.0</span><span class="p">))</span><span class="w"></span>
<span class="nb">self</span><span class="p">.</span><span class="n">addSublayer</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span><span class="w"></span>
<span class="n">arrow</span><span class="p">.</span><span class="n">setNeedsDisplay</span><span class="p">()</span><span class="w"> </span><span class="c1">// draw, please</span>
</pre></div>
<p>** 3D Transforms</p><ul>
<li>A layerâ€™s <code>affineTransform</code> is merely a faÃ§ade for accessing its <code>transform</code>.</li>
<li>A layerâ€™s <code>transform</code> is a three-dimensional transform, a <code>CATransform3D</code></li>
</ul>
<p>ç»•Yè½´é•œåƒçš„ç¤ºä¾‹ï¼š</p><div class="highlight"><pre><span></span><span class="n">someLayer</span><span class="p">.</span><span class="n">transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CATransform3DMakeRotation</span><span class="p">(.</span><span class="n">pi</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</pre></div>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œåœ¨Zè½´æ²¡æœ‰åˆ†é‡çš„å¹³é¢å›¾ï¼Œé‚£å°±åªå‰©æ—‹è½¬çš„æ•ˆæœäº†ï¼ˆæ²¡æœ‰ç¿»è½¬)
<figure  style="flex: 51.151315789473685" ><img width="622" height="608" src="/archives/assets/714bca8197bc1e5f9e71216b3ccd0745.png" alt=""/></figure></p><p>è¿™æ˜¯æŠŠanchorPointè®¾åœ¨äº†åœ†å¿ƒï¼Œå¦‚æœè®¾åœ¨(0,0):
<figure class="vertical-figure" style="flex: 45.258620689655174" ><img width="1260" height="1392" src="/archives/assets/8e747494f676181ffca14504623cb89b.png" alt=""/></figure></p><ul>
<li>layerä¸æ˜¯ä¸ºäº†3Då»ºæ¨¡è€Œè¯ç”Ÿçš„ï¼ˆè€ƒè™‘<code>Metal</code>ï¼‰ï¼Œå®ƒæ˜¯2Då¯¹è±¡ï¼Œä¸º<code>speed</code>å’Œ<code>simplicity</code>è€Œè®¾è®¡</li>
</ul>
<p><strong>depth</strong></p><p>ç°å®ä¸–ç•Œ<code>z-component</code>çš„åŠ å…¥ä¼šè¿‘å¤§è¿œå°ï¼Œlayerç»˜åˆ¶æ²¡æœ‰è¡¨ç°å‡ºè¿™ç§è·ç¦»ï¼Œè€Œæ˜¯å‹å¹³åˆ°ä¸€ä¸ªé¢ï¼š<code>orthographic projection</code>ï¼Œä½†æ˜¯ä½¿ç”¨äº†ä¸€äº›æŠ€å·§æ¥åˆ¶é€ è¿™ç§è§†è§‰æ•ˆæœã€‚</p><p>[waiting for demo]</p><h2>Futher Layer Features</h2>
<p><strong>shadows</strong></p><ul>
<li>The shadow is normally based on the shape of the layerâ€™s <code>nontransparent</code> region<ul>
<li>æ‰€ä»¥å®Œå…¨é€æ˜çš„è§†å›¾æ˜¯æ²¡æœ‰é˜´å½±çš„</li>
</ul>
</li>
<li>clipå’Œshadowæ˜¯ä¸å¯èƒ½åŒæ—¶å­˜åœ¨çš„ï¼ŒæŠ€å·§æ˜¯ç”¨å¦ä¸€ä¸ªviewå åˆ°åº•å±‚ï¼Œè®©å®ƒå®ç°é˜´å½±ã€‚</li>
</ul>
<p><strong>Borders and Rounded Corners</strong></p><ul>
<li>æƒ³è¦åœ†è§’ï¼Œå°±å¿…é¡»ç”¨<code>masksToBounds</code>æ¥å®ç°clipï¼ŒåŒæ—¶è¿˜è¦é˜´å½±çš„è¯ï¼Œåˆå¾—å€ŸåŠ©ä¸Šå›¾çš„æŠ€å·§äº†ã€‚</li>
<li>ä»iOS 11èµ·ï¼Œå¯ä»¥å•ç‹¬è®¾ç½®åœ†è§’äº†ï¼š<code>maskedCorners</code>ï¼Œå®ƒç”±minx, miny, maxx, maxyè¿™ç§é£æ ¼çš„æè¿°è¿›è¡Œç»„åˆï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„top-leftä¹‹ç±»çš„ã€‚</li>
</ul>
<p><strong>Masks</strong></p><ul>
<li>A CALayer can have a mask. This is itself a <strong>layer</strong>, whose content must be provided somehow.</li>
<li>åªæœ‰é€æ˜éƒ¨åˆ†æœ‰ä½œç”¨<ul>
<li>é€æ˜çš„ä½ç½®ï¼Œå¯¹åº”çš„layerä½ç½®ä¹Ÿæ˜¯é€æ˜çš„</li>
<li>åè¿‡æ¥æƒ³ä¸é€æ˜çš„éƒ¨åˆ†ï¼Œè¿˜æ˜¯è¢«åº”ç”¨maskçš„layerèƒ½æ˜¾ç¤ºçš„éƒ¨åˆ†</li>
<li>è¿™å°±æ˜¯photoshopé‡Œå›¾å±‚è’™æ¿â€æ¶‚é»‘å°±æ˜¯æ˜¾ç¤ºâ€œçš„æ„æ€</li>
</ul>
</li>
<li>there is no built-in mechanism for <strong>automatically resizing the mask</strong> as the layer is resized.</li>
<li>æŠŠä¸€ä¸ªviewå½“ä½œå¦ä¸€ä¸ªviewçš„maskå±æ€§ï¼Œåº•å±‚å°±æ˜¯ç›¸åº”çš„layer</li>
</ul>
<p>ä¸‹ä¾‹ç”¨maskæ¥åˆ¶ä½œè‡ªå·±çš„åœ†è§’çŸ©å½¢ï¼Œæ³¨æ„é‡Œé¢contextå’Œpathçš„å…³ç³»ã€‚åœ¨contexté‡Œé¢ï¼Œæ–°å»ºçš„pathéƒ½æ˜¯èƒ½ç›´æ¥ç»˜åˆ¶çš„ï¼Œè€Œä¸éœ€è¦è¿™ä¸ªpathè®¾ä¸ºè°çš„å±æ€§ï¼ˆdrawRect:æ–¹æ³•é‡Œä¹Ÿæ˜¯ä¸€æ ·ï¼Œåªè¦æ–°å»ºpathï¼Œå†è‡ªè¡Œå»stoke, filléƒ½è¡Œï¼Œ</p><p>è€Œcontextä¸Šä¹Ÿå¯ä»¥ç›´æ¥ç»˜åˆ¶</p><div class="highlight"><pre><span></span><span class="n">func</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="n">sz</span><span class="o">:</span><span class="n">CGSize</span><span class="p">,</span><span class="w"> </span><span class="n">roundingCorners</span><span class="w"> </span><span class="n">rad</span><span class="o">:</span><span class="n">CGFloat</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="bp">CALayer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">rect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">(</span><span class="n">origin</span><span class="o">:</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">:</span><span class="n">sz</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIGraphicsImageRenderer</span><span class="p">(</span><span class="n">bounds</span><span class="o">:</span><span class="n">rect</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">im</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">image</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="k">in</span><span class="w"></span>
<span class="w">        </span><span class="c1">// contextç»˜åˆ¶</span>
<span class="w">        </span><span class="n">let</span><span class="w"> </span><span class="n">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">cgContext</span><span class="w"></span>
<span class="w">        </span><span class="n">con</span><span class="p">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">(</span><span class="n">white</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">:</span><span class="mi">0</span><span class="p">).</span><span class="n">cgColor</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">con</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">con</span><span class="p">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">(</span><span class="n">white</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">:</span><span class="mi">1</span><span class="p">).</span><span class="n">cgColor</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="c1">// pathç»˜åˆ¶</span>
<span class="w">        </span><span class="n">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIBezierPath</span><span class="p">(</span><span class="n">roundedRect</span><span class="o">:</span><span class="n">rect</span><span class="p">,</span><span class="w"> </span><span class="n">cornerRadius</span><span class="o">:</span><span class="n">rad</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">fill</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">CALayer</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">mask</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rect</span><span class="w"></span>
<span class="w">    </span><span class="n">mask</span><span class="p">.</span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">im</span><span class="p">.</span><span class="n">cgImage</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">mask</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h2>Layer Efficiency</h2>
<p>ç”±äºç§»åŠ¨è®¾å¤‡ç®—åŠ›çš„å½±å“ï¼Œå¤§é‡å åŠ çš„åŠé€æ˜å›¾å±‚çš„æ¸²æŸ“æ˜¯ä¸€ä»¶å¾ˆæ¶ˆè€—ä¸”ä½æ•ˆçš„äº‹ï¼Œç‰¹åˆ«æ˜¯åŠ¨ç”»çš„æ—¶å€™ã€‚</p><p>debugï¼š</p><ol>
<li>Core Animation template in <strong>Instruments</strong></li>
<li>New in Xcode 12, animation â€œhitchesâ€ can be measured with <code>XCTMetrics</code> during performance testing.</li>
<li>the Simulatorâ€™s <code>Debug</code> menu lets you summon <code>colored overlays</code> that provide clues as to possible sources of <strong>inefficient drawing</strong><ul>
<li>çœŸæœºï¼šDebug â†’ View Debugging â†’ Rendering</li>
</ul>
</li>
<li>New in Xcode 12, the view debugger (â€œView Debuggerâ€ on page 75) can display layers â€” choose Editor â†’ Show Layers â€” and can offer suggestions for improving layer rendering efficiency.</li>
</ol>
<p>tips:</p><ol>
<li><strong>opaque drawing</strong> is most efficient.<ul>
<li>Nonopaque drawing is what the Simulator marks when you check Debug â†’ Color Blended Layers.</li>
</ul>
</li>
<li>â€œfreezingâ€ the entirety of the layerâ€™s drawing as a <strong>bitmap</strong>.<ul>
<li>ç›´æ¥ç»˜åˆ¶æ•ˆç‡ç¡®å®æ¯”ç¼“å­˜æ•ˆç‡é«˜</li>
<li>ä½†æ˜¯è¿‡æ·±è¿‡å¤æ‚çš„ç»§æ‰¿æ ‘ï¼Œæ²¡å¿…è¦æ¯æ¬¡éƒ½å®æ—¶è®¡ç®—æ¸²æŸ“</li>
<li>by <code>shouldRasterize = true</code> and <code>rasterizationScale = UIScreen.main.scale</code></li>
</ul>
</li>
<li><code>drawsAsynchronously = true</code></li>
</ol>
<h2>Layers and Key-Value Coding</h2>
<div class="highlight"><pre><span></span><span class="n">layer</span><span class="p">.</span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mask</span><span class="w"></span>
<span class="c1">// or:</span>
<span class="n">layer</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="n">forKey</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;mask&quot;</span><span class="p">)</span><span class="w"></span>

<span class="nb">self</span><span class="p">.</span><span class="n">rotationLayer</span><span class="p">.</span><span class="n">transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CATransform3DMakeRotation</span><span class="p">(.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="c1">// or:</span>
<span class="nb">self</span><span class="p">.</span><span class="n">rotationLayer</span><span class="p">.</span><span class="n">setValue</span><span class="p">(.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="n">forKeyPath</span><span class="o">:</span><span class="s">&quot;transform.rotation.y&quot;</span><span class="p">)</span><span class="w"></span>
</pre></div>
<ul>
<li><p>ä¸ä»£è¡¨<code>CATransform3D</code>æœ‰<code>rotation</code>å±æ€§</p><ul>
<li>å®ƒæ²¡æœ‰ä»»ä½•å±æ€§</li>
<li>å®ƒç”šè‡³ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡</li>
<li><code>self.rotationLayer.transform.rotation.y = //... no, sorry</code></li>
</ul>
</li>
<li><p>some transform key:</p></li>
</ul>
<p>â€¢ &quot;rotation.x&quot;,&quot;rotation.y&quot;,&quot;rotation.z&quot;
â€¢ &quot;rotation&quot; (same as &quot;rotation.z&quot;)
â€¢ &quot;scale.x&quot;,&quot;scale.y&quot;,&quot;scale.z&quot;
â€¢ &quot;translation.x&quot;,&quot;translation.y&quot;,&quot;translation.z&quot; â€¢ &quot;translation&quot; (two-dimensional, a CGSize)</p><ul>
<li>The<code>Quartz Core</code> framework also injects keyâ€“value coding compliance into <code>CGPoint</code>, <code>CGSize</code>, and <code>CGRect</code>, allowing you to use keys and key paths matching their <code>struct component names</code>.</li>
</ul>
<blockquote>
<p>see â€œCore Animation Extensions to Key-Value Codingâ€ in Appleâ€™s Core Animation Programming Guide</p></blockquote>
<ul>
<li>you can treat a <code>CALayer</code> as a kind of <code>dictionary</code>, and get and set the value for any key.<ul>
<li>viewæœ‰tagï¼Œlayerå°±æœ‰ä»»æ„key</li>
</ul>
</li>
</ul>
</div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/Layer/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/%E3%80%8AEffective-Objective-C-2.0%E3%80%8B%E7%AC%94%E8%AE%B0%E7%AC%AC1-2%E7%AB%A0/" target="_self">ã€ŠEffective Objective-C 2.0ã€‹ç¬”è®°ç¬¬1-2ç« </a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/%E3%80%8AEffective-Objective-C-2.0%E3%80%8B%E7%AC%94%E8%AE%B0%E7%AC%AC1-2%E7%AB%A0/" target="_self">
                <time class="text-uppercase">
                    January 14 2022
                </time>
            </a>
        </div>
        <div class="prism-content"><figure class="vertical-figure" style="flex: 38.0" ><img width="912" height="1200" src="/archives/assets/ac920d0dab7ba40befbff58ed826b587.png" alt=""/></figure><blockquote>
<p>è¿™ä¸ªä¹¦å½“ç„¶ä¸­æ–‡ç‰ˆçš„ï¼Œä¹Ÿå¾ˆç»å…¸ï¼Œæˆ‘ä¹Ÿè¯»è¿‡äº†ï¼Œä½†æ˜¯å˜›ï¼Œè€è§„çŸ©ï¼Œæœ‰åŸç‰ˆè¿˜æ˜¯è¯»ä¸€éåŸç‰ˆï¼Œå†åŠ ä¸Šè‹±æ–‡æ°´å¹³ä¹Ÿåªæœ‰é‚£ä¹ˆå¥½ï¼Œæœ‰æœºä¼šèƒ½å¤šè¯»è¯»åœ¨å°±å¤šè¯»è¯»å§ã€‚ä¸€å…±å°±7ç« ï¼Œ52èŠ‚ï¼Œ200å¤šé¡µï¼Œå¹¶ä¸å¤šã€‚
æ­¤å¤–ï¼Œå› ä¸ºå¾ˆå¤šåè¯å…¶å®æˆ‘ä»¬å¹³æ—¶ç›´æ¥å«çš„å°±æ˜¯è‹±æ–‡ï¼Œä¸­æ–‡ç‰ˆé‡Œç»Ÿç»Ÿéƒ½ç»™äº†ä¸€ä¸ªä¸­æ–‡ç¿»è¯‘ï¼Œåè€Œæ›´é™Œç”Ÿäº†ï¼Œæœ‰ç§â€œè®¿è¾¾â€çš„å³è§†æ„Ÿã€‚</p></blockquote>
<h1>Chapter 1: Accustoming Yourself to Objective-C</h1>
<h2>Item 1: Familiarize Yourself with Objective-Câ€™s Roots</h2>
<ol>
<li><code>messaging structure</code> v.s. <code>function callihng</code><ul>
<li>in messaging structure, the <strong>runtime</strong> decides which code gets executed, while in function, the  <strong>compiler</strong> decides.</li>
<li><code>dynamic binding</code> v.s. <code>virtual table</code>  &lt;= å¤šæ€</li>
</ul>
</li>
<li><code>runtime component</code> v.s. <code>compiler</code><ul>
<li>å«æœ‰æ‰€æœ‰è®©é¢å‘å¯¹è±¡çš„OCèƒ½å·¥ä½œçš„ <em>data structures</em> and <em>functions</em><ul>
<li>æ¯”å¦‚ï¼Œå«æœ‰æ‰€æœ‰çš„memory-management methods</li>
</ul>
</li>
<li>æ›´æ–°runtime componentå°±èƒ½æå‡æ€§èƒ½ï¼Œè€Œæ— éœ€é‡æ–°ç¼–è¯‘</li>
</ul>
</li>
<li>Objective-C is a superset of C<ul>
<li>æ‰€ä»¥è¯­æ³•åŸºæœ¬ç±»ä¼¼ï¼š<code>NSString *str = @&quot;The String</code></li>
<li>è¡¨ç¤ºå£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œç±»å‹æ˜¯<em>NSString *</em>ï¼Œæ˜¯ä¸€ä¸ªæŒ‡å‘NSStringçš„æŒ‡é’ˆ</li>
<li>æ‰€æœ‰OCå¯¹è±¡å¿…é¡»å¦‚æ­¤å£°æ˜ï¼Œå¯¹è±¡å†…å­˜ä¹Ÿæ€»æ˜¯åˆ†é…åœ¨heap spaceä¸Š<ul>
<li>è¿™æ˜¯åˆ†é…åˆ°stackä¸Šï¼š<code>NSString stackString</code> &lt;- æŠ¥é”™</li>
</ul>
</li>
<li>ä½†æŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„æŒ‡é’ˆï¼ˆ<strong>pointer</strong>ï¼‰æ˜¯åˆ†é…åœ¨<code>stack frame</code>é‡Œçš„ï¼Œå¤šä¸ªæŒ‡å‘åŒä¸€å¯¹è±¡çš„æŒ‡é’ˆå°±åˆ†é…äº†å¤šä¸ªå†…å­˜<ul>
<li>æ¯ä¸ªå†…å­˜å¤§å°å°±æ˜¯ä¸€æšæŒ‡é’ˆçš„å¤§å°</li>
<li>å€¼ä¹Ÿæ˜¯ä¸€æ ·</li>
</ul>
</li>
</ul>
</li>
<li>The memory allocated in the <code>heap</code> has to be <strong>managed directly</strong><ul>
<li>OCå°†å †å†…å­˜ç®¡ç†æŠ½è±¡äº†å‡ºæ¥ï¼Œ<code>runtime</code>è¿›ä¸€æ­¥æŠ½è±¡æˆä¸€å¥—å†…å­˜ç®¡ç†æ¶æ„ï¼š<code>reference counting</code></li>
</ul>
</li>
<li>æ•´ä¸ªç³»ç»Ÿæ¡†æ¶éƒ½è¦ä½¿ç”¨ç»“æ„ä½“ï¼Œç”¨å¯¹è±¡ä¼šæœ‰é¢å¤–çš„å¼€é”€</li>
</ol>
<h2>Item 2: Minimize Importing Headers in Headers</h2>
<p>Objective-C, just like C and C++, makes use of <code>header files</code> and implementation files.</p><ol>
<li><code>forward declaring</code> -&gt; <code>@class SomeClass</code><ul>
<li>å¤´æ–‡ä»¶é‡Œå¹¶ä¸çŸ¥é“çŸ¥é“ä¸€äº›ç±»çš„å®ç°ç»†èŠ‚ï¼Œåªéœ€è¦çŸ¥é“æœ‰è¿™ä¹ˆä¸€ä¸ªç±»å°±è¡Œäº†</li>
<li>ä½†æ˜¯<code>.m</code>æ–‡ä»¶é‡Œå°±è¦è‡ªè¡Œå»importä¸€æ¬¡è¿™ä¸ªclassäº†</li>
<li>åŸåˆ™å°±æ˜¯å°½é‡å»¶åå¼•å…¥å¤´æ–‡ä»¶çš„æ—¶æœºï¼Œå‡å°‘ç¼–è¯‘æ—¶é—´</li>
<li>è¿˜è§£å†³äº†äº’ç›¸å¼•ç”¨çš„é—®é¢˜</li>
<li>å¼•ç”¨<code>super class</code>, <code>protocol</code>ç­‰å¿…é¡»è¦çŸ¥é“ç»†èŠ‚ï¼Œä¸èƒ½åº”ç”¨<code>forward declaring</code><ul>
<li>æ‰€ä»¥æœ€å¥½æŠŠprotocolå•ç‹¬æ”¾åœ¨ä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œé¿å…æ— è°“åœ°å¼•ç”¨å¤§æ–‡ä»¶ï¼Œå¢åŠ ç¼–è¯‘æ—¶é—´</li>
<li>ä½†æ˜¯<code>delegate</code>æ”¾åˆ°<code>class-continuation category</code>é‡Œé¢å†™æ›´å¥½ï¼ˆå³åœ¨<strong>.m</strong>æ–‡ä»¶é‡Œå†™protocolå’Œimportï¼‰ï¼Œæ— éœ€æš´éœ²åˆ°å…¬å…±å¤´æ–‡ä»¶</li>
</ul>
</li>
<li>å…³é”®è¯ï¼š<code>å‡å°ä¾èµ–</code>ï¼Œ<code>ç¼©å‡ç¼–è¯‘æ—¶é—´</code></li>
</ul>
</li>
</ol>
<h2>Item 3: Prefer Literal Syntax over the Equivalent Methods</h2>
<ul>
<li>å°½é‡ä½¿ç”¨å­—é¢é‡è¯­æ³•ï¼ˆ<code>Literal Syntax</code>ï¼‰åˆ›å»ºå’Œä½¿ç”¨å¯¹è±¡</li>
<li>å­—é¢é‡è¯­æ³•åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼ˆ<code>syntactic sugar</code>ï¼‰ï¼Œæ¨èä½¿ç”¨å­—é¢é‡ï¼Œä¼šå‡å°‘ä»£ç é‡ï¼Œä½†æœ€å¥½çŸ¥é“å®ƒå¯¹åº”çš„åŸå§‹æ–¹æ³•ã€‚ï¼ˆä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰æ‰€åŒºåˆ«ï¼Œçœ‹ä¸‹ä¾‹ï¼‰</li>
<li>ç”¨å­—é¢é‡åˆå§‹æ•°ç»„ï¼Œå¦‚æœä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ æ˜¯nilï¼Œä¼šæŠ¥é”™ï¼Œè€ŒåŸå§‹çš„<code>arrayWithObjects:</code>æ–¹æ³•åˆ™ä¼šåœ¨ç¢°åˆ°ç¬¬ä¸€ä¸ªnilæ—¶å½“æˆæ˜¯ç»ˆæ­¢å‚æ•°è€Œæ­£å¸¸æ‰§è¡Œï¼ˆåªä¿ç•™nilå‰çš„å…ƒç´ åˆå§‹åŒ–æ•°ç»„ï¼‰<ul>
<li>ä½œè€…è¯´è¿™åè€Œæ˜¯å¥½äº‹ï¼Œæœªé¢„æ–™åˆ°çš„æƒ…å†µæˆåŠŸæ‰§è¡Œæ¯”æŠ¥é”™æ›´å¯æ€•ï¼ŒæŠ›å¼‚å¸¸èƒ½æ›´æ—©åœ°å‘ç°é”™è¯¯</li>
</ul>
</li>
<li>åªèƒ½åˆ›å»ºFoundationæ¡†æ¶çš„å¯¹è±¡ï¼Œè‡ªå®šä¹‰å¯¹è±¡ä¸è¡Œï¼ˆä¸€èˆ¬ä¹Ÿæ²¡å¿…è¦ï¼‰</li>
<li>ä½¿ç”¨å­—é¢é‡è¯­æ³•åˆ›å»ºå‡ºæ¥çš„String, Array, Dictç­‰éƒ½<code>immutable</code>çš„</li>
</ul>
<h2>Item 4: Prefer Typed Constants to Preprocessor #define</h2>
<ul>
<li><code>#define</code>æœ¬è´¨æ˜¯æ›¿æ¢</li>
<li><code>#define</code>å‡ºæ¥çš„æ˜¯æ²¡æœ‰ç±»å‹ä¿¡æ¯çš„</li>
<li>å¦‚æœæ˜¯å£°æ˜åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œå¼•ç”¨äº†æ­¤å¤´æ–‡ä»¶çš„ä»£ç éƒ½ä¼šåº”ç”¨æ­¤æ›¿æ¢<ul>
<li>å³ä½¿è¢«é‡å®šä¹‰äº†ï¼Œç¼–è¯‘å™¨ä¹Ÿä¸ä¼šäº§ç”Ÿè­¦å‘Š</li>
</ul>
</li>
<li>è€Œå¸¸é‡å°±å¸¦äº†ç±»å‹ä¿¡æ¯<ul>
<li><code>static NSString * const MyStringConstants = &quot;Hello world;</code></li>
<li>æ³¨æ„æ˜Ÿå·çš„ä½ç½®ï¼Œè¿™é‡Œè¡¨ç¤ºæŒ‡é’ˆæŒ‡å‘çš„æ˜¯æ•´ä¸ªå¸¸é‡</li>
<li>å¦‚æœæŠŠæ˜Ÿå·å†™åˆ°conståï¼Œé‚£è¡¨ç¤ºæŒ‡é’ˆå°±æ˜¯é‚£ä¸ªå¸¸é‡...</li>
</ul>
</li>
<li>å®šä¹‰å¸¸é‡çš„ä½ç½®å¾ˆé‡è¦ï¼ˆé¢„å¤„ç†æŒ‡ä»¤ä¹Ÿä¸€æ ·ï¼‰ï¼Œä¸æ‰“ç®—å…¬å¼€çš„è¯å°±åœ¨<code>.m</code>æ–‡ä»¶é‡Œå®šä¹‰</li>
<li>å‘½ä»¤ä¹Ÿå¾ˆé‡è¦</li>
<li>å¦åˆ™æˆäº†å…¨å±€å˜é‡ï¼Œå¾ˆå¯èƒ½â€ä¸ç»æ„â€œå¼•èµ·å˜é‡å†²çª/è¦†ç›–</li>
<li><code>static const</code>è¦ä¸€èµ·ä½¿ç”¨ï¼Œå•ç‹¬çš„<code>const</code>ä¼šæŠ¥é”™<ul>
<li><code>static</code>ä¸å†æ˜¯åˆ«çš„è¯­è¨€ä¸­çš„<strong>é™æ€å˜é‡</strong>ï¼Œè€Œä¿æ˜¯ä¸€ä¸ªä½œç”¨åŸŸå£°æ˜</li>
<li>ä¸€ä¸ªç¼–è¯‘å•å…ƒï¼ˆ<code>translation unit</code>ï¼‰ä¸ªè¾“å‡ºä¸€ä¸ªç›®æ ‡æ–‡ä»¶ï¼ˆ<code>object file</code>ï¼‰<ul>
<li>è€ƒè™‘ä½ ç¼–è¯‘ä¸€ä¸ªc++æ–‡ä»¶ï¼Œä¸€ä¸ªæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªç›®æ ‡ï¼ˆäºŒè¿›åˆ¶ï¼‰æ–‡ä»¶ï¼Œç„¶åå†é“¾æ¥ã€‚</li>
<li>æ‰€ä»¥ä¸€ä¸ªç¼–è¯‘å•å…ƒä¸€èˆ¬æ˜¯ä¸€ä¸ª<code>.m</code>æ–‡ä»¶</li>
</ul>
</li>
<li>ç»“åˆèµ·æ¥ï¼Œ<code>static</code>å°±æ˜¯åœ¨ä¸€ä¸ªç›®æ ‡æ–‡ä»¶å†…å¯è§</li>
<li>å¦‚æœä¸åŠ <code>static</code>ï¼Œç¼–è¯‘å™¨ä¼šæ·»åŠ ä¸€ä¸ª<code>external symbol</code>ï¼ˆåé¢æœ‰è¯¦è¿°ï¼‰ï¼Œè¿™æ ·å°±æœ‰é‡å®šä¹‰é£é™©äº†ï¼ˆ<code>duplicate symbol</code>ï¼‰</li>
</ul>
</li>
<li>æœ€åï¼Œäº‹å®ä¸Š<code>static const</code>ä¸€èµ·ç”¨ï¼Œç¼–è¯‘å™¨åšçš„ä»ç„¶æ˜¯<strong>æ›¿æ¢</strong>ï¼Œè€Œæ²¡æœ‰å»åˆ›å»ºç¬¦å·ï¼ˆä½†æ­¤æ—¶å·²ç»æœ‰ç±»å‹ä¿¡æ¯äº†ï¼‰</li>
</ul>
<p>*å¦‚æœéœ€è¦å…¬å¼€ï¼Œåˆ™æ·»åŠ åˆ°å…¨å±€ç¬¦å·è¡¨ï¼ˆ<code>global symbol table</code>ï¼‰ä¸­ï¼š</p><div class="highlight"><pre><span></span><span class="c1">// In the header file</span>
<span class="k">extern</span><span class="w"> </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">EOCStringConstant</span><span class="p">;</span><span class="w"></span>

<span class="c1">// In the implementation file</span>
<span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">EOCStringConstant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;VALUE&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
<ul>
<li>ä¸Šé¢è§£é‡Šäº†<code>static</code>ï¼Œç°åœ¨æ¥è§£é‡Š<code>extern</code><ul>
<li><code>extern</code>è¡¨ç¤ºå‘ç¼–è¯‘å™¨ä¿è¯å…¨å±€ç¬¦å·è¡¨ä¸­å°†ä¼šæœ‰è¿™ä¸ªç¬¦å·ï¼Œå…¶å®å°±æ˜¯è¦ç¼–è¯‘å™¨ä¸è¦ç»§ç»­æ£€æŸ¥</li>
<li>å®ƒçŸ¥é“é“¾æ¥æˆäºŒè¿›åˆ¶æ–‡ä»¶åï¼Œè‚¯å®šèƒ½æ‰¾åˆ°è¿™ä¸ªå¸¸é‡</li>
</ul>
</li>
<li>æ‰€ä»¥åœ¨<code>.m</code>æ–‡ä»¶é‡Œæ­£å¸¸å®šä¹‰å’Œèµ‹å€¼ï¼Œåœ¨<strong>ä»»æ„</strong><code>.h</code>æ–‡ä»¶æ—¶ç»™ç¼–è¯‘å™¨æ‰“ä¸ªæ‹›å‘¼å°±è¡Œäº†</li>
<li>å‘½åè§„èŒƒï¼š<ul>
<li>å¦‚æœæ˜¯é™å®šå¯è§åŸŸçš„ï¼Œç”¨<code>k</code>å¼€å¤´å°±è¡Œäº†</li>
<li>å¦‚æœä¼šå…¬å¼€çš„ï¼Œé‚£ä¹ˆå°±ç”¨å‡½æ•°åä½œå‰ç¼€ï¼ˆç³»ç»Ÿæ¡†æ¶éƒ½æ˜¯è¿™ä¹ˆåšçš„ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>external symbol</strong> V.S. <strong>global symbol</strong></p><blockquote>
<p>å‰æ–‡ä½ å·²ç»çŸ¥é“äº†ä¸¤ç§æå‡ä½œç”¨åŸŸçš„æ–¹å¼ï¼ŒåŒºåˆ«åœ¨</p><ul>
<li>ä¸€ä¸ªæ˜¯é€šè¿‡ä¸å¯¹conståŠ staticï¼ˆæ·»åŠ external symbolï¼‰ï¼Œ</li>
<li>ä¸€ä¸ªæ˜¯é¢å¤–å£°æ˜externï¼ˆæ·»åŠ åˆ°blobal symbol talbeï¼‰</li>
</ul>
</blockquote>
<h2>Item 5: Use Enumerations for States, Options, and Status Codes</h2>
<ul>
<li>æšä¸¾åªæ˜¯ä¸€ç§å¸¸é‡å‘½åæ–¹å¼</li>
<li>è¯­æ³•å¾ˆå¥‡è‘©ï¼š<code>enum EOCConnectionState</code> state = EOCConnectionStateDisconnected;<ul>
<li>çœ‹é«˜äº®çš„éƒ¨åˆ†ï¼Œåˆ«äººåªè¦å†™ä¸€ä¸ªtypeï¼Œå®ƒè¦è¿enumå¸¦åç§°å†™å…¨</li>
</ul>
</li>
<li>æ‰€ä»¥ä¸€èˆ¬ä¼š<code>typedef</code>ä¸€ä¸‹ï¼š<code>typedef enum EOCConnectionState EOCConnectionState;</code><ul>
<li>ç°åœ¨å°±å¯ä»¥ç”¨<code>EOCConnectionState</code>è¿™ä¸ªtypeæ¥å®šä¹‰å˜é‡äº†</li>
</ul>
</li>
<li>ç”¨enumæ¥åšé€‰é¡¹(options)çš„æ—¶å€™ï¼Œå› ä¸ºä¸æ˜¯äº’æ–¥çš„å…³ç³»ï¼Œé€‰æ‹©bitwise OR operatoræ¥ä¼šç›´è§‚å¾ˆå¤šï¼ˆå°±æ˜¯æ¯ä¸€ä¸ªäºŒè¿›åˆ¶ä½ä»£è¡¨ä¸€ä¸ªçŠ¶æ€ï¼‰</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">UIViewAutoresizing</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">UIViewAutoresizingNone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">UIViewAutoresizingFlexibleLeftMargin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">UIViewAutoresizingFlexibleWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">UIViewAutoresizingFlexibleRightMargin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">UIViewAutoresizingFlexibleTopMargin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">UIViewAutoresizingFlexibleHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">UIViewAutoresizingFlexibleBottomMargin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<figure  style="flex: 66.52173913043478" ><img width="918" height="690" src="/archives/assets/4a634eedbb41d909a0b262a8f2f437ee.png" alt=""/></figure><ul>
<li>Foundationæ¡†æ¶å®šä¹‰äº†ä¸€äº›è¾…åŠ©å®ï¼Œä»¥ä¾¿æ”¯æŒæ–°çš„C++æ ‡å‡†å¯¹å®å®šä¹‰çš„å¢å¼ºåŒæ—¶è¿˜èƒ½å…¼å®¹è€çš„æ ‡å‡†: <code>NS_ENUM</code>å’Œ<code>NS_OPTIONS</code><ul>
<li>ç‰¹åˆ«æ˜¯c++å¯¹æšä¸¾å€¼é‡Œçš„bitwiseæ“ä½œç»“æœéœ€è¦æ˜¾å¼è½¬æ¢</li>
<li>æ‰€ä»¥ç”¨åˆ°äº†<strong>å¯ç»„åˆ</strong>çš„optionç±»çš„æšä¸¾ï¼Œæœ€å¥½ç”¨<code>NS_OPTIONS</code>å®ï¼Œå¦åˆ™ç”¨<code>NS_ENUM</code>å°±å¤Ÿäº†</li>
</ul>
</li>
<li>å¯¹enumåº”ç”¨<code>switch</code>æœ€å¥½ä¸è¦åŠ <code>default</code>ï¼Œè¿™æ ·ä½ æ·»åŠ äº†æ–°çš„æšä¸¾å€¼è€Œå¿˜è®°äº†å¤„ç†ï¼Œèƒ½åŠæ—¶å¾—åˆ°é”™è¯¯åé¦ˆ</li>
</ul>
<h1>Chapter 2: Objects, Messaging, and the Runtime</h1>
<h2>Item 6: Understand Properties</h2>
<ul>
<li><code>Properties</code> are an Objective-C feature providing encapsulation of the data an object contains.<ul>
<li>stored by <code>instance variables</code></li>
<li>accessed through <code>accessor methods</code> (getter, setter)<ul>
<li>can be written by complier automatically &lt;= <code>autosynthesis</code></li>
<li>introduced a <code>dot syntax</code> to  accessing the data</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>çœ‹ä¸€ä¸‹C++å†™æ³•ï¼š</p><div class="highlight"><pre><span></span><span class="err">@</span><span class="n">interface</span><span class="w"> </span><span class="n">EOCPerson</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">NSObject</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="err">@</span><span class="k">public</span><span class="w"></span>
<span class="w">    </span><span class="n">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">_firstName</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">_lastName</span><span class="p">;</span><span class="w"> </span>
<span class="err">@</span><span class="k">private</span><span class="w"></span>
<span class="w">    </span><span class="n">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">_someInternalData</span><span class="p">;</span><span class="w"> </span>
<span class="p">}</span><span class="w"></span>
<span class="err">@</span><span class="n">end</span><span class="w"></span>
</pre></div>
<ul>
<li>å¯¹è±¡å¸ƒå±€åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†ï¼Œæ‰€ä»¥å°±ç¡¬ç¼–ç äº†æ¯ä¸ªå±æ€§åœ¨å¯¹è±¡å†…å­˜ä¸­çš„åç§»é‡</li>
<li>æ‰€ä»¥å¦‚æœå¯¹è±¡å¸ƒå±€å˜åŒ–äº†ï¼ˆæ¯”å¦‚å¢åŠ äº†å®ä¾‹å˜é‡ï¼‰ï¼Œè¿™äº›åç§»é‡å°±ä¼šå‡ºé”™ï¼Œå¿…é¡»è¦é‡æ–°ç¼–è¯‘ã€‚<ul>
<li>å¦‚æœé“¾æ¥ä»£ç æ—¶ä½¿ç”¨äº†ä¸åŒç‰ˆæœ¬çš„ç±»å®šä¹‰ï¼Œå°±ä¼šäº§ç”Ÿè¿™ç§â€œä¸å…¼å®¹â€çš„é—®é¢˜</li>
</ul>
</li>
<li>OCçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼ŒæŠŠåç§»é‡ä»ç”±â€œå®ä¾‹å˜é‡â€å­˜å‚¨<ul>
<li>ä½†æ˜¯äº¤ç”±â€œç±»å¯¹è±¡â€œ(class object)ä¿ç®¡</li>
<li>åç§»é‡åœ¨è¿è¡ŒæœŸæŸ¥æ‰¾ -&gt; ç±»çš„å®šä¹‰å˜äº†ï¼Œåç§»é‡ä¹Ÿå°±å˜äº†ï¼ˆå®æ—¶çš„ï¼‰<ul>
<li>ç”šè‡³å¯ä»¥åœ¨è¿è¡ŒæœŸå‘ç±»ä¸­æ–°å¢å®ä¾‹å˜é‡</li>
<li>nonfragile Application Binary Interface(ABI)</li>
<li>è¿™æ ·å°±å¯ä»¥ä¸æ­¢åœ¨å£°æ˜æ–‡ä»¶é‡Œå®šä¹‰å®ä¾‹å˜é‡ï¼Œè¿˜å¯ä»¥åœ¨class-continuationå’Œå®ç°æ–‡ä»¶é‡Œé¢å®šä¹‰äº†</li>
</ul>
</li>
<li>å°½é‡ä¸è¦ç›´æ¥è®¿é—®å®ä¾‹å˜é‡</li>
</ul>
</li>
<li>ä½¿ç”¨<code>ç‚¹è¯­æ³•</code>è®¿é—®å±æ€§<ul>
<li>ç¼–è¯‘å™¨ä¼šè½¬æ¢ä¸ºå¯¹å­˜å–æ–¹æ³•çš„è°ƒç”¨</li>
<li>ç¼–è¯‘å™¨ä¼šä¸ºå±æ€§ç”Ÿæˆç›¸åº”çš„å®ä¾‹å˜é‡ï¼Œå¹¶è‡ªåŠ¨åˆæˆï¼ˆç”Ÿæˆç›¸åº”çš„å­˜å–æ–¹æ³•ï¼‰<ul>
<li>ç¼–è¯‘æœŸè¿›è¡Œï¼Œæ‰€ä»¥ä½ çœ‹ä¸åˆ°å®é™…çš„ä»£ç </li>
<li>ä¹Ÿå¯ä»¥æ‰‹å†™åŒæ ·çš„ä»£ç ï¼ˆè¿™æ—¶ä½ å°±å¯ä»¥è‡ªå®šä¹‰å®ä¾‹æ–¹æ³•çš„ç­¾åäº†ï¼‰</li>
<li><code>@dynamic</code>èƒ½é˜»æ­¢åˆæˆ &lt;= ç›¸ä¿¡è¿è¡ŒæœŸèƒ½æ‰¾åˆ°</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Property Attributes</h3>
<ol>
<li>åŸå­æ€§(<code>Atomicity</code>)ï¼Œè¯»å†™çš„æ—¶å€™åŠ é”</li>
<li>è¯»/å†™æƒé™</li>
<li>å†…å­˜ç®¡ç†è¯­ä¹‰<ul>
<li>assign: on scalar type</li>
<li>strong: æ‹¥æœ‰å…³ç³»ï¼Œè®¾ç½®æ–°å€¼æµç¨‹ï¼šretain new -&gt; release old -&gt; set new</li>
<li>weak: éæ‹¥æœ‰å…³ç³»</li>
<li>unsafe_unretained: ç±»ä¼¼assignï¼Œä½†é€‚ç”¨äºå¯¹è±¡ç±»å‹ï¼ˆè€Œä¸åªæœ‰scalar type)<ul>
<li>ä¸weakçš„åŒºåˆ«åœ¨ç›®æ ‡å¯¹è±¡åœ¨é”€æ¯æ—¶ï¼Œè¯¥å±æ€§å€¼ä¸ä¼šè‡ªåŠ¨æ¸…ç©º</li>
</ul>
</li>
<li>copy: ç±»ä¼¼strongï¼Œä½†æ˜¯ç›¸æ¯”èµ·retainï¼Œå®ƒç›´æ¥æ˜¯å¤åˆ¶äº†ä¸€ä»½ï¼Œé€šå¸¸ç”¨äºæ‹¥æœ‰å¯å˜ç±»å‹çš„å˜é‡ï¼Œæ¯”å¦‚<code>NSString *</code>ï¼Œå¯å˜ç‰ˆçš„stringä¹Ÿèƒ½èµ‹å€¼ç»™NSStringï¼Œè¿™å°±ä¼šå¼•èµ·èµ‹å€¼åå€¼è¿˜è‡ªå·±å˜äº†çš„å¯èƒ½æ€§</li>
</ul>
</li>
<li>æ–¹æ³•å<ul>
<li>getter=<name>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æœ‰äº›boolç±»å‹çš„é€šå¸¸ä¼šè®¾ç½®ä¸º<code>isXXXX</code></li>
<li>setter=<name>ï¼Œä½†å¾ˆå°‘è¿™ä¹ˆåš</li>
</ul>
</li>
</ol>
<p>å¦‚æœè‡ªå·±æ¥å®ç°accessor methodsï¼Œé‚£ä¹ˆå°±è¦è‡ªå·±å»ä¿è¯è¿™äº›æ–¹æ³•ç¬¦åˆè¿™äº›attributesï¼Œæ¯”å¦‚å†…å­˜ç®¡ç†è¯­ä¹‰ä¸ºcopyï¼Œé‚£ä¹ˆåœ¨è®¾ç½®çš„æ—¶å€™å°±è¦æ‹·è´ä¼ å…¥çš„å€¼ï¼š</p><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="nc">EOCPerson</span> : <span class="bp">NSManagedObject</span><span class="w"> </span>
<span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">copy</span><span class="p">)</span><span class="w"> </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">firstName</span><span class="p">;</span><span class="w"></span>
<span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">copy</span><span class="p">)</span><span class="w"> </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">lastName</span><span class="p">;</span><span class="w"></span>
<span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithFirstName:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">firstName</span><span class="w"> </span><span class="nf">lastName:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">lastName</span><span class="p">;</span><span class="w"></span>
<span class="k">@end</span><span class="w"></span>

<span class="c1">// å®ç°æ–‡ä»¶ï¼š</span>
<span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">initWithFirstName</span><span class="o">:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">firstName</span><span class="w"> </span><span class="n">lastName</span><span class="o">:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">lastName</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nb">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">init</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">_firstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">firstName</span><span class="w"> </span><span class="k">copy</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="n">_lastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">lastName</span><span class="w"> </span><span class="k">copy</span><span class="p">];</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">self</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>
<blockquote>
<ul>
<li>è¯»å†™æ“ä½œçš„åŸå­æ€§å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨</li>
<li>iOSä¸­ä½¿ç”¨åŒæ­¥é”å¼€é”€è¾ƒå¤§</li>
<li>å®é™…iOSç¨‹åºç¢°åˆ°å¤šçº¿ç¨‹è¯»å†™å±æ€§çš„åœºæ™¯ä¹Ÿéå¸¸å°‘</li>
<li>æ‰€ä»¥åŸºæœ¬ä¸Šéƒ½æ˜¯å£°æ˜ä¸º<code>nonatomic</code></li>
</ul>
</blockquote>
<h2>Item 7: Access Instance Variables Primarily Directly When Accessing Them Internally</h2>
<p>åœ¨å¯¹è±¡å†…éƒ¨ä¼˜å…ˆè®¿é—®å®ä¾‹å˜é‡ã€‚</p><p>ç›´æ¥è®¿é—®è€Œä¸ç”¨ç‚¹è¯­æ³•çš„å½±å“ï¼š</p><ul>
<li>ä¸ç»è¿‡æ¶ˆæ¯æ´¾å‘ï¼Œé€Ÿåº¦å¿«ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ä¼šç›´æ¥è®¿é—®ç›¸åº”çš„å†…å­˜ï¼‰</li>
<li>ä¸ä¼šè°ƒç”¨setterï¼Œä¹Ÿç»•è¿‡äº†ç›¸åº”çš„å†…å­˜ç®¡ç†è¯­ä¹‰</li>
<li>ä¸ä¼šè§¦å‘KVO</li>
<li>æ²¡æœ‰æœºä¼šåœ¨getter, setterä¸­è®¾ç½®æ–­ç‚¹æ¥è°ƒè¯•</li>
<li>æ²¡æœ‰æœºä¼š<code>lazy intialization</code>ï¼Œè€Œgetteræœºåˆ¶èƒ½åœ¨é¦–æ¬¡è¢«è°ƒç”¨åˆ°çš„æ—¶å€™æ‰å»åˆå§‹åŒ–å®ä¾‹å˜é‡</li>
<li>åˆå§‹åŒ–å’Œdeallocçš„æ—¶å€™æ€»æ˜¯è¦ç›´æ¥ç”¨å®ä¾‹å˜é‡</li>
</ul>
<p>ä½œè€…å»ºè®®å°½é‡åœ¨è¯»å–å®ä¾‹å˜é‡çš„æ—¶å€™ç›´æ¥è®¿é—®ï¼Œè®¾ç½®çš„æ—¶å€™ç”¨å±æ€§ï¼ˆä¼šè‡ªåŠ¨è€ƒè™‘å†…å­˜ç®¡ç†è¯­ä¹‰ï¼‰</p><h2>Item 8: Understand Object Equality</h2>
<p>å…¶å®å°±æ˜¯ç†è§£NSObjectè‡ªå¸¦çš„<code>isEqual:</code>æ–¹æ³•ã€‚</p><ul>
<li><code>==</code>å°±æ˜¯æ¯”æŒ‡é’ˆ</li>
<li><code>isEqual:</code>æ¯”çš„æ˜¯<code>hash</code>ï¼Œæ‰€ä»¥è‡ªå®šä¹‰çš„ç±»è¦å®ç°equalityå°±è¦è‡ªè¡Œå®ç°è¿™ä¸¤ä¸ªæ–¹æ³•<ul>
<li>hashä¸åŒå¿…ç„¶å¯¹è±¡ä¸åŒï¼Œä½†ç”±äºæœ‰hash collisionsçš„å­˜åœ¨ï¼Œåè¿‡æ¥å¹¶ä¸æˆç«‹</li>
<li>å°½é‡ç”¨å¯¹è±¡çš„ä¸å¯å˜éƒ¨åˆ†æ¥åšhash</li>
</ul>
</li>
</ul>
<p>ä¸€ä¸ªåšhashçš„æ–¹æ³•ï¼š</p><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nf">hash</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">NSUInteger</span><span class="w"> </span><span class="n">firstNameHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_firstName</span><span class="w"> </span><span class="n">hash</span><span class="p">];</span><span class="w"> </span>
<span class="w">    </span><span class="n">NSUInteger</span><span class="w"> </span><span class="n">lastNameHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_lastName</span><span class="w"> </span><span class="n">hash</span><span class="p">];</span><span class="w"> </span>
<span class="w">    </span><span class="n">NSUInteger</span><span class="w"> </span><span class="n">ageHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_age</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">firstNameHash</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">lastNameHash</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">ageHash</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h2>Item 9: Use the Class Cluster Pattern to Hide Implementation Detail</h2>
<div class="highlight"><pre><span></span><span class="p">+</span> <span class="p">(</span><span class="bp">UIButton</span><span class="o">*</span><span class="p">)</span><span class="nf">buttonWithType:</span><span class="p">(</span><span class="n">UIButtonType</span><span class="p">)</span><span class="nv">type</span><span class="p">;</span><span class="w"></span>
</pre></div>
<ul>
<li>ä½œè€…å°†ä¸Šè¿°è¿™ç§è§£é‡Šä¸ºâ€œç±»æ—â€ï¼Œå³å®ƒçš„è¿”å›å€¼å¯èƒ½æ˜¯å„ç§buttonï¼Œä½†å½’æ ¹ç»“åº•ï¼Œéƒ½æ˜¯<code>UIButton</code>ï¼Œå°±æ˜¯é ç€switchå„ç§typeæ¥å®ä¾‹åŒ–å„ç§å­ç±»ã€‚</li>
<li>åŒæ—¶ï¼Œå› ä¸ºOCæ²¡æœ‰abstract classï¼Œä¸ºäº†é¿å…ç›´æ¥ä½¿ç”¨æŠ½è±¡åŸºç±»ï¼Œä¸€èˆ¬ä¸æä¾›initæ–¹æ³•ï¼Œå¹¶åœ¨åŸºç±»ç›¸å…³æ–¹æ³•é‡Œå¹²è„†æŠ›å¼‚å¸¸</li>
<li>è¿™é‡Œä½¿ç”¨<code>isMemberOfClass</code>å°±è¦å°å¿ƒï¼Œå®ƒæ˜¯kindï¼Œä½†ä¸ä¸€å®šæ˜¯member</li>
<li>ç³»ç»Ÿæ¡†æ¶é‡Œæœ‰å¾ˆå¤š<code>class cluster</code>ï¼Œç‰¹åˆ«æ˜¯<code>collection</code><ul>
<li>æ‰€ä»¥<code>if([anArray class] == [NSArray class])</code>æ˜¯falseï¼ˆåŸå› å°±æ˜¯å®ƒæ˜¯è¢«å½“ä½œâ€œ<strong>æŠ½è±¡åŸºç±»</strong>æ¥è®¾è®¡çš„ï¼Œå®é™…ä¸Šæ˜¯éšè—åœ¨å…¬å…±æ¥å£åé¢çš„æŸä¸ªå†…éƒ¨ç±»å‹ï¼‰</li>
<li>åŒæ ·ï¼Œç”¨<code>isKindOfClass:</code>è‡³å°‘èƒ½åˆ¤æ–­æ˜¯åœ¨è¿™ä¸ªç±»æ—é‡Œ</li>
</ul>
</li>
</ul>
<h2>Item 10: Use Associated Objects to Attach Custom Data to Existing Classes</h2>
<p>æ‰©å±•ç°æœ‰ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç»§æ‰¿ï¼Œä½†æœ‰æ—¶å€™ä¸€äº›ç‰¹æ®Šæœºåˆ¶åˆ›å»ºçš„ç±»å´æ— æ³•ç»§æ‰¿ï¼Œå¯ä»¥é€šè¿‡<code>Associated Object</code>æ¥æ·»åŠ è¿™äº›ä¿¡æ¯ã€‚</p><ul>
<li>ä»¥é”®å€¼å¯¹æ¥å­˜å‚¨ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥å­˜å‚¨å¤šä¸ªå…³è”æ•°æ®çš„</li>
<li>å¯ä»¥æŒ‡å®šstorage policyï¼Œå¯¹åº”å†…å­˜ç®¡ç†è¯­ä¹‰</li>
</ul>
<figure  style="flex: 140.1840490797546" ><img width="914" height="326" src="/archives/assets/820ae39c34d1147867f1dfb6f1d64de3.png" alt=""/></figure><p>æ–¹æ³•:</p><div class="highlight"><pre><span></span><span class="c1">// Sets up an association of object to value with the given key and policy.</span>
<span class="kt">void</span><span class="w"> </span><span class="n">objc_setAssociatedObject</span><span class="p">(</span><span class="kt">id</span><span class="w"> </span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">id</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">objc_AssociationPolicy</span><span class="w"> </span><span class="n">policy</span><span class="p">)</span><span class="w"></span>

<span class="c1">// Retrieves the value for the association on object with the given key.</span>
<span class="kt">id</span><span class="w"> </span><span class="n">objc_getAssociatedObject</span><span class="p">(</span><span class="kt">id</span><span class="w"> </span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">key</span><span class="p">)</span><span class="w"></span>

<span class="c1">// Removes all associations against object.</span>
<span class="kt">void</span><span class="w"> </span><span class="n">objc_removeAssociatedObjects</span><span class="p">(</span><span class="kt">id</span><span class="w"> </span><span class="n">object</span><span class="p">)</span><span class="w"></span>
</pre></div>
<p>ä¹¦ä¸­å†™äº†ä¸€ä¸ªä¾‹å­ï¼ŒalertViewçš„ä»£ç†æ–¹æ³•æ¥å¤„ç†æŒ‰äº†ä»€ä¹ˆé”®ï¼Œè€Œä¸€ä¸ªé¡µé¢ä¸­å¦‚æœæœ‰å¤šä¸ªalertViewï¼Œä¸”ç”¨åŒä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œé‚£ä¹ˆå¤„ç†éœ€è¦æ›´ç²¾ç»†ï¼ˆæ¯”å¦‚éœ€è¦çŸ¥é“æ˜¯å“ªä¸ªè­¦å‘Šæ¡†å¼¹çš„ï¼Œæˆ‘ä¸€èˆ¬ç”¨tagï¼‰ã€‚
è€Œå¦‚æœæŠŠå¤„ç†æ–¹æ³•å®šä¹‰ä¸ºä¸€ä¸ªblockï¼Œå¹¶æŠŠå®ƒå…³è”åˆ°UIAlertViewç±»ï¼Œé‚£ä¹ˆå¤„ç†é€»è¾‘å°±å¯ä»¥è·Ÿå®šä¹‰alertViewå†™åœ¨ä¸€èµ·äº†ã€‚</p><p>todo, item 11-14</p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/%E3%80%8AEffective-Objective-C-2.0%E3%80%8B%E7%AC%94%E8%AE%B0%E7%AC%AC1-2%E7%AB%A0/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/Drawing/" target="_self">Programming iOS 14 - Drawing</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/Drawing/" target="_self">
                <time class="text-uppercase">
                    December 25 2021
                </time>
            </a>
        </div>
        <div class="prism-content"><p>ã€ŠProgramming iOS 14: Dive Deep into Views, View Controllers, and Frameworksã€‹ç¬¬2ç« </p><hr />
<h1>Drawing</h1>
<p>Many UIView subclasses, such as a UIButton or a UILabel, know how to draw themselves.</p><p>A <em>pure UIView</em> is all about drawing, and it leaves that drawing largely up to you.</p><h2>Images and Image Views</h2>
<p>å›¾ç‰‡å¯ä»¥æ¥è‡ªæ–‡ä»¶ï¼Œä»£ç ï¼Œæˆ–ç½‘ç»œã€‚</p><h3>Image Files</h3>
<ul>
<li><code>init(named:)</code>ï¼Œä¼šä»<code>Asset catalog</code>å’Œ<code>App bundle</code>çš„é¡¶å±‚å»æŸ¥æ‰¾<ul>
<li>è¿”å›çš„æ˜¯ä¸€ä¸ªOptionalï¼Œå› ä¸ºä¸èƒ½ç¡®å®šè¿™ä¸ªè·¯å¾„å¯¹åº”ä¸€å¼ å›¾ç‰‡ï¼Œæˆ–èƒ½è§£ç æˆåŠŸ</li>
<li>å®ƒä¼šå°†å›¾ç‰‡ç¼“å­˜<ul>
<li><code>init(contentsOfFile:)</code>åˆ™ä¸ä¼šç¼“å­˜ï¼Œä½†ä¸ä»asset catalogåŠ è½½è€Œæ˜¯ç›¸å¯¹äº<code>Bundle.main</code>æ¥åšè·¯å¾„</li>
</ul>
</li>
</ul>
</li>
<li>ä»bundleé‡Œæ‰¾æ—¶ä¸åŠ æ‰©å±•åä¼šé»˜è®¤ä¸º<em>png</em></li>
<li>ç›´æ¥å°†å›¾ç‰‡æ‹–åˆ°ä»£ç ç”Ÿæˆçš„ä¸æ˜¯Optionalçš„imageï¼Œè°ƒç”¨çš„æ˜¯<code>init(imageLiteralResourceName:)</code>æ–¹æ³•</li>
<li>æ–‡ä»¶åé‡Œçš„@è¡¨ç¤º<code>High-resolution variants</code>ï¼Œå³ä¸åŒåˆ†è¾¨ç‡ä¸‹é‡‡ç”¨çš„å›¾ç‰‡ï¼Œæ¯”å¦‚<code>@2x</code></li>
<li>æ–‡ä»¶åé‡Œçš„~è¡¨ç¤º<code>Device type variants</code>ï¼Œå³ä¸åŒè®¾å¤‡ç±»å‹ä¸‹é‡‡ç”¨çš„å›¾ç‰‡ï¼Œæ¯”å¦‚<code>~ipad</code></li>
</ul>
<blockquote>
<p>å°½é‡æŠŠå›¾ç‰‡æ”¾åˆ°asset catalogé‡Œï¼Œå¯¹ä¸åŒçš„å¤„ç†å™¨ï¼Œæ›´å®½çš„è‰²åŸŸï¼Œç­‰ç­‰
ä¸å…‰å½±å“è¿è¡Œæ—¶ï¼Œåœ¨Apple Storeå¯¹ä½ çš„appå¯¹ç‰¹å®šè®¾å¤‡è¿›è¡Œ<em>thinning</em>éƒ½ä¼šç”¨åˆ°
ä¸åŒsize class, dark mode, ipadç­‰ç­‰trait collectionéƒ½å¯ä»¥è®¾ç½®å¯¹åº”çš„å›¾ç‰‡</p></blockquote>
<p><strong>Vector images</strong></p><ul>
<li>An image file in the asset catalog can be a vector-based PDF or (new in Xcode 12) an SVG.</li>
<li><code>init(systemName:)</code> -&gt; <a href="https://developer.apple.com/sf-symbols/">SF Symbols</a><ul>
<li><code>.withConfiguration(_:) or .applyingSymbolConfiguration(_:)</code> è¿›è¡Œè‡ªå®šä¹‰ï¼Œå‚æ•°æ˜¯ä¸€ä¸ª<em>UIImage.SymbolConfiguration</em></li>
<li>Configurations can involve one of nine <code>weights</code>, one of three <code>scales</code>, a font or text <code>style</code>, and a <code>point size</code>, in various combinations</li>
</ul>
</li>
</ul>
<p><strong>Asset catalogs and trait collections</strong></p><p>æŒ‡å®štrait collectionåˆå§‹åŒ–å›¾ç‰‡ï¼š<code>init(named:in:compatibleWith:)</code></p><ul>
<li>A built-in interface object that displays an image, such as a UIImageView, is <code>automatically trait collectionâ€“aware</code>;</li>
<li>it receives the <code>traitCollectionDidChange(_:)</code> message and responds accordingly.</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">tcreg</span> <span class="p">=</span> <span class="bp">UITraitCollection</span><span class="p">(</span><span class="n">verticalSizeClass</span><span class="p">:</span> <span class="p">.</span><span class="n">regular</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">tccom</span> <span class="p">=</span> <span class="bp">UITraitCollection</span><span class="p">(</span><span class="n">verticalSizeClass</span><span class="p">:</span> <span class="p">.</span><span class="n">compact</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">moods</span> <span class="p">=</span> <span class="bp">UIImageAsset</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">frowney</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">named</span><span class="p">:</span><span class="s">&quot;frowney&quot;</span><span class="p">)</span><span class="o">!</span>
<span class="kd">let</span> <span class="nv">smiley</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">named</span><span class="p">:</span><span class="s">&quot;smiley&quot;</span><span class="p">)</span><span class="o">!</span>
<span class="n">moods</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">frowney</span><span class="p">,</span> <span class="n">with</span><span class="p">:</span> <span class="n">tcreg</span><span class="p">)</span>
<span class="n">moods</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">smiley</span><span class="p">,</span> <span class="n">with</span><span class="p">:</span> <span class="n">tccom</span><span class="p">)</span>
</pre></div>
<p>ç”±æ­¤ä¹Ÿå¯è§ï¼Œä½ æ“ä½œçš„æ˜¯â€œä¸€å¼ å›¾ç‰‡â€ï¼Œå…¶å®å®ƒæ˜¯ä¸€<strong>ç»„</strong>å¸¦äº†æ¡ä»¶çš„å›¾ç‰‡ã€‚</p><blockquote>
<p>UIColorä¹Ÿæ˜¯ç›¸åŒçš„æœºåˆ¶ï¼Œä½ ç”¨<code>resolvedColor(with:)</code>ä¼ å…¥trait collectionæŠŠå¯¹åº”çš„é¢œè‰²å–å‡ºæ¥ä½¿ç”¨ã€‚</p></blockquote>
<p><strong>Namespacing image files</strong></p><ul>
<li>ç‰©ç†æ–‡ä»¶å¤¹ï¼Œè™šæ‹Ÿæ–‡ä»¶å¤¹å†…çš„å›¾ç‰‡è®¿é—®æ—¶ï¼Œéƒ½éœ€è¦åŠ ä¸Šæ–‡ä»¶å¤¹åï¼ˆnamespaing)</li>
<li><code>init(named:)</code>çš„å®Œå…¨å½¢æ€å…¶å®æ˜¯<code>init(named:in:)</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯bundleï¼Œæ¯”å¦‚æ¥è‡ªæŸä¸ªframework.</li>
</ul>
<h3>Image Views</h3>
<p>A UIImageView can actually have two images, one assigned to its <code>image</code> property and the other assigned to its <code>highlightedImage</code> property
A UIImageView without an image and without a background color is <em>invisible</em></p><p><strong>Resizable Images</strong></p><p>ç”¨insetæ¥è®¾ç½®<strong>ä¸</strong>æ‹‰ä¼¸çš„åŒºåŸŸï¼Œæ¯”å¦‚ä¸€èˆ¬æˆ‘ä»¬ç¢°åˆ°çš„å¤šä¸ºå·¦å³éšä¾¿æ‹‰ä¼¸çš„èƒ¶å›ŠæŒ‰é’®ï¼Œéœ€è¦è®¾è®¡å¸ˆåšçš„å°±æ˜¯å·¦å³ä¸¤ä¸ªåŠåœ†ï¼ˆä¸æ‹‰ä¼¸ï¼‰å’Œä¸­é—´1åƒç´ çš„å¯æ‹‰ä¼¸éƒ¨åˆ†</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">marsTiled</span> <span class="p">=</span> <span class="n">mars</span><span class="p">.</span><span class="n">resizableImage</span><span class="p">(</span><span class="n">withCapInsets</span><span class="p">:</span>
<span class="n">UIEdgeInsets</span><span class="p">(</span>
    <span class="n">top</span><span class="p">:</span> <span class="n">mars</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
    <span class="kr">left</span><span class="p">:</span> <span class="n">mars</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">bottom</span><span class="p">:</span> <span class="n">mars</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
    <span class="kr">right</span><span class="p">:</span> <span class="n">mars</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="mi">1</span>
<span class="p">),</span> <span class="n">resizingMode</span><span class="p">:</span> <span class="p">.</span><span class="n">stretch</span><span class="p">)</span>
</pre></div>
<p>æ‰€ä»¥å¦‚æœåªæ˜¯æ¨ªå‘æ‹‰ä¼¸ï¼Œä¸Šé¢çš„ä»£ç ä¸­ï¼Œtop, bottoméƒ½å¯ä»¥è®¾ä¸º0ï¼Œæˆ–éƒ½è®¾ä¸ºå›¾ç‰‡é«˜åº¦ï¼ˆè€Œä¸å»é™¤2ä»€ä¹ˆçš„ï¼‰ï¼Œåªéœ€è¦ä¿è¯æŠŠUIæ§ä»¶çš„é«˜åº¦ä¿æŒè·Ÿå›¾ç‰‡ä¸€è‡´å³å¯ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœä¸å°å¿ƒé«˜åº¦å¤§äºå›¾ç‰‡é«˜åº¦äº†å‘¢ï¼Ÿåˆ†ä¸¤ç§æƒ…å†µï¼Œå¦‚æœè®¾äº†0ï¼Œè¡¨ç¤ºæ²¡æœ‰ä¿ç•™åŒºåŸŸï¼Œç›´æ¥ç«–å‘æ‹‰ä¼¸ï¼Œè€Œå¦‚æœè®¾æˆäº†å›¾ç‰‡é«˜åº¦ï¼Œé‚£ä¹ˆè¡¨ç¤ºæ•´ä¸ªYæ–¹å‘æ²¡æœ‰å¯ä¾›æ‹‰ä¼¸çš„åƒç´ ï¼Œå¿…ç„¶é€ æˆæ‹‰ä¼¸å¤±è´¥ï¼š</p><figure  style="flex: 123.51598173515981" ><img width="1082" height="438" src="/archives/assets/be32f2993735b82ac7da004327cf4bad.png" alt=""/></figure><p><strong>Transparency Masks</strong></p><p>The image shown on the screen is formed by combining the imageâ€™s <code>transparency</code> values with a single <code>tint color</code>.</p><p>å¿½ç•¥å›¾ç‰‡å„åƒç´ ä¸Šé¢œè‰²çš„æ•°å€¼ï¼Œåªä¿ç•™é€æ˜åº¦ï¼Œå°±æˆäº†ä¸€ä¸ªmask. (renderingMode: <code>alwaysTemplate</code>)</p><ul>
<li>iOS gives every UIView a <code>tintColor</code>, which will be used to <code>tint any template images</code>ã€‚æ‰€ä»¥æˆ‘ä»¬ç»å¸¸ç”¨çš„tintColorå…¶å®å°±æ˜¯ç»™æ¨¡æ¿å›¾ç‰‡æŸ“è‰²çš„æ„æ€ã€‚</li>
<li>tintColoræ˜¯å‘ä¸‹ç»§æ‰¿çš„</li>
<li>The symbol images are always template images</li>
<li>iOS 13èµ·ï¼Œå¯ä»¥å¯¹UIImageç›´æ¥åº”ç”¨tint color</li>
</ul>
<p><strong>Reversible Images</strong></p><ul>
<li>ç”¨<code>imageFlippedForRightToLeftLayoutDirection</code>æ¥åˆ›å»ºä¸€ä¸ªåœ¨ä»å³å‘å·¦çš„ä¹¦å†™ç³»ç»Ÿé‡Œä¼šè‡ªåŠ¨ç¿»è½¬çš„å›¾ç‰‡ã€‚<ul>
<li>ä½†ä½ åˆå¯ä»¥è®¾ç½®<code>semanticContentAttribute</code>æ¥é˜»æ­¢è¿™ä¸ªé•œåƒè¡Œä¸º</li>
</ul>
</li>
<li>å¦‚æœä¸è€ƒè™‘ä¹¦å†™ç³»ç»Ÿï¼Œå¯ä»¥ç”¨<code>withHorizontallyFlippedOrientation</code>å¼ºè¡Œé•œåƒ</li>
</ul>
<h2>Graphics Contexts</h2>
<p>Graphics Contextsæ˜¯ç»˜å›¾çš„èµ·ç‚¹ï¼Œä½ èƒ½ä»å¦‚ä¸‹æ–¹å¼å¾—åˆ°Graphics Contextsï¼š</p><ol>
<li>è¿›å…¥UIViewçš„ <code>draw(_:)</code>æ–¹æ³•æ—¶ï¼Œç³»ç»Ÿä¼šç»™ä½ æä¾›ä¸€ä¸ªGraphics Contexts</li>
<li>CALayerçš„<code>draw(in:)</code>,æˆ–å…¶ä»£ç†çš„<code>draw(_:in:)</code>æ–¹æ³•ï¼Œ<em>in</em>å‚æ•°å°±æ˜¯Graphics Contexts<ul>
<li>ä½†å®ƒä¸æ˜¯<code>currnet context</code></li>
</ul>
</li>
<li>æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª</li>
</ol>
<p>UIKit å’Œ Core Graphicsæ˜¯ä¸¤å¥—ç»˜åˆ¶å·¥å…·ã€‚</p><ul>
<li>UIKitæ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹ä½ çš„é€‰æ‹©ï¼Œå¤§éƒ¨åˆ†Cocoa classçŸ¥é“å¦‚ä½•ç»˜åˆ¶è‡ªå·±</li>
<li>åªèƒ½åœ¨current contextä¸Šç»˜åˆ¶</li>
<li>Core Graphics is the full drawing APIï¼Œ often referred to as <code>Quartz (2D)</code></li>
<li>UIKit drawing is built on top of it.</li>
</ul>
<p>ä¸¤å¥—ä½“ç³»ï¼Œä¸‰ç§contextæ¥æºï¼Œå…±è®¡6ç§æ®Šé€”åŒå½’çš„æ–¹å¼ã€‚</p><h3>Drawing on Demand</h3>
<p>ç›´æ¥ä¸Šä»£ç ï¼š</p><div class="highlight"><pre><span></span><span class="c1">// UIView</span>

<span class="c1">// UIKit</span>
<span class="kr">override</span> <span class="kd">func</span> <span class="nf">draw</span><span class="p">(</span><span class="kc">_</span> <span class="n">rect</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ç›´æ¥ç»˜åˆ¶</span>
    <span class="kd">let</span> <span class="nv">p</span> <span class="p">=</span> <span class="bp">UIBezierPath</span><span class="p">(</span><span class="n">ovalIn</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    <span class="bp">UIColor</span><span class="p">.</span><span class="n">blue</span><span class="p">.</span><span class="n">setFill</span><span class="p">()</span>
    <span class="n">p</span><span class="p">.</span><span class="n">fill</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// CG</span>
<span class="kr">override</span> <span class="kd">func</span> <span class="nf">draw</span><span class="p">(</span><span class="kc">_</span> <span class="n">rect</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// å–åˆ°context</span>
    <span class="kd">let</span> <span class="nv">con</span> <span class="p">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">()</span><span class="o">!</span>
    <span class="n">con</span><span class="p">.</span><span class="n">addEllipse</span><span class="p">(</span><span class="k">in</span><span class="p">:</span><span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    <span class="n">con</span><span class="p">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">.</span><span class="n">blue</span><span class="p">.</span><span class="n">cgColor</span><span class="p">)</span>
    <span class="n">con</span><span class="p">.</span><span class="n">fillPath</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// CALayer</span>

<span class="c1">// UIKit</span>
 <span class="kr">override</span> <span class="kd">func</span> <span class="nf">draw</span><span class="p">(</span><span class="kc">_</span> <span class="n">layer</span><span class="p">:</span> <span class="bp">CALayer</span><span class="p">,</span> <span class="k">in</span> <span class="n">con</span><span class="p">:</span> <span class="n">CGContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UIGraphicsPushContext</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nv">p</span> <span class="p">=</span> <span class="bp">UIBezierPath</span><span class="p">(</span><span class="n">ovalIn</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    <span class="bp">UIColor</span><span class="p">.</span><span class="n">blue</span><span class="p">.</span><span class="n">setFill</span><span class="p">()</span>
<span class="n">p</span><span class="p">.</span><span class="n">fill</span><span class="p">()</span>
    <span class="n">UIGraphicsPopContext</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// CG</span>
<span class="kr">override</span> <span class="kd">func</span> <span class="nf">draw</span><span class="p">(</span><span class="kc">_</span> <span class="n">layer</span><span class="p">:</span> <span class="bp">CALayer</span><span class="p">,</span> <span class="k">in</span> <span class="n">con</span><span class="p">:</span> <span class="n">CGContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">con</span><span class="p">.</span><span class="n">addEllipse</span><span class="p">(</span><span class="k">in</span><span class="p">:</span><span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    <span class="n">con</span><span class="p">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">.</span><span class="n">blue</span><span class="p">.</span><span class="n">cgColor</span><span class="p">)</span>
    <span class="n">con</span><span class="p">.</span><span class="n">fillPath</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
<h3>Drawing a UIImage</h3>
<div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">r</span> <span class="p">=</span> <span class="bp">UIGraphicsImageRenderer</span><span class="p">(</span><span class="n">size</span><span class="p">:</span><span class="n">CGSize</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="kd">let</span> <span class="nv">im</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">image</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
    <span class="kd">let</span> <span class="nv">p</span> <span class="p">=</span> <span class="bp">UIBezierPath</span><span class="p">(</span><span class="n">ovalIn</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    <span class="bp">UIColor</span><span class="p">.</span><span class="n">blue</span><span class="p">.</span><span class="n">setFill</span><span class="p">()</span>
    <span class="n">p</span><span class="p">.</span><span class="n">fill</span><span class="p">()</span>
<span class="p">}</span>
<span class="c1">// im is the blue circle image, do something with it here ...</span>
<span class="n">And</span> <span class="n">here</span><span class="err">â€™</span><span class="n">s</span> <span class="n">the</span> <span class="n">same</span> <span class="n">thing</span> <span class="n">using</span> <span class="n">Core</span> <span class="n">Graphics</span><span class="p">:</span>
<span class="kd">let</span> <span class="nv">r</span> <span class="p">=</span> <span class="bp">UIGraphicsImageRenderer</span><span class="p">(</span><span class="n">size</span><span class="p">:</span><span class="n">CGSize</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="kd">let</span> <span class="nv">im</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">image</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
    <span class="kd">let</span> <span class="nv">con</span> <span class="p">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">()</span><span class="o">!</span>
    <span class="n">con</span><span class="p">.</span><span class="n">addEllipse</span><span class="p">(</span><span class="k">in</span><span class="p">:</span><span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    <span class="n">con</span><span class="p">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">.</span><span class="n">blue</span><span class="p">.</span><span class="n">cgColor</span><span class="p">)</span>
    <span class="n">con</span><span class="p">.</span><span class="n">fillPath</span><span class="p">()</span>
<span class="p">}</span>
<span class="c1">// im is the blue circle image, do something with it here ...</span>
</pre></div>
<h2>UIImage Drawing</h2>
<p>ç”¨å·²æœ‰çš„å›¾åƒè¿›è¡Œç»˜åˆ¶ï¼š</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">mars</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">named</span><span class="p">:</span><span class="s">&quot;Mars&quot;</span><span class="p">)</span><span class="o">!</span>
<span class="kd">let</span> <span class="nv">sz</span> <span class="p">=</span> <span class="n">mars</span><span class="p">.</span><span class="n">size</span>
<span class="kd">let</span> <span class="nv">r</span> <span class="p">=</span> <span class="bp">UIGraphicsImageRenderer</span><span class="p">(</span><span class="n">size</span><span class="p">:</span><span class="n">CGSize</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span>
    <span class="n">format</span><span class="p">:</span><span class="n">mars</span><span class="p">.</span><span class="n">imageRendererFormat</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">im</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">image</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
    <span class="n">mars</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">at</span><span class="p">:</span><span class="n">CGPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">mars</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">at</span><span class="p">:</span><span class="n">CGPoint</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
<p>è¿™é‡Œï¼Œç»˜åˆ¶äº†ä¸¤ä¸ªç«æ˜Ÿï¼Œæ³¨æ„<code>imageRendererFormat</code>çš„ä½¿ç”¨</p><h2>CGImage Drawing</h2>
<div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">mars</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">named</span><span class="p">:</span><span class="s">&quot;Mars&quot;</span><span class="p">)</span><span class="o">!</span>
<span class="c1">// extract each half as CGImage</span>
<span class="kd">let</span> <span class="nv">marsCG</span> <span class="p">=</span> <span class="n">mars</span><span class="p">.</span><span class="n">cgImage</span><span class="p">!</span>
<span class="kd">let</span> <span class="nv">sz</span> <span class="p">=</span> <span class="n">mars</span><span class="p">.</span><span class="n">size</span>
<span class="kd">let</span> <span class="nv">marsLeft</span> <span class="p">=</span> <span class="n">marsCG</span><span class="p">.</span><span class="n">cropping</span><span class="p">(</span><span class="n">to</span><span class="p">:</span>
    <span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">))</span><span class="o">!</span>
<span class="kd">let</span> <span class="nv">marsRight</span> <span class="p">=</span> <span class="n">marsCG</span><span class="p">.</span><span class="n">cropping</span><span class="p">(</span><span class="n">to</span><span class="p">:</span>
    <span class="n">CGRect</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">))</span><span class="o">!</span>
<span class="kd">let</span> <span class="nv">r</span> <span class="p">=</span> <span class="bp">UIGraphicsImageRenderer</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="n">CGSize</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span>
    <span class="n">format</span><span class="p">:</span><span class="n">mars</span><span class="p">.</span><span class="n">imageRendererFormat</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">im</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">image</span> <span class="p">{</span> <span class="n">ctx</span> <span class="k">in</span>
    <span class="kd">let</span> <span class="nv">con</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">cgContext</span>
    <span class="n">con</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">marsLeft</span><span class="p">,</span> <span class="k">in</span><span class="p">:</span>
        <span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">))</span>
    <span class="n">con</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">marsRight</span><span class="p">,</span> <span class="k">in</span><span class="p">:</span>
        <span class="n">CGRect</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
<p>å½“ç„¶, <code>con.draw</code>å¯ä»¥ç”±UIImageæ¥å®Œæˆï¼š</p><div class="highlight"><pre><span></span><span class="bp">UIImage</span><span class="p">(</span><span class="n">cgImage</span><span class="p">:</span> <span class="n">marsLeft</span><span class="p">!,</span>
<span class="n">scale</span><span class="p">:</span> <span class="n">mars</span><span class="p">.</span><span class="n">scale</span><span class="p">,</span>
<span class="n">orientation</span><span class="p">:</span> <span class="n">mars</span><span class="p">.</span><span class="n">imageOrientation</span><span class="p">).</span><span class="n">draw</span><span class="p">(</span><span class="n">at</span><span class="p">:</span><span class="n">CGPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
<h2>Snapshots</h2>
<ul>
<li><code>drawHierarchy(in:afterScreenUpdates:)</code>å°†æ•´ä¸ªè§†å›¾å­˜æˆä¸€å¼ å›¾ç‰‡ã€‚</li>
<li>æ›´å¿«ï¼Œè¯­ä¹‰æ›´å¥½çš„æ–¹æ³•ï¼š<code>.snapshotView(afterScreenUpdates:)</code> -&gt; è¾“å‡ºæ˜¯UIViewï¼Œä¸æ˜¯UIImage</li>
<li><code>resizableSnapshotView(from:after- ScreenUpdates:withCapInsets:)</code>ç”Ÿæˆå¯ç¼©æ”¾çš„</li>
</ul>
<h2>Core Image</h2>
<p>The â€œCIâ€ in <code>CIFilter</code> and <code>CIImage</code> stands for <code>Core Image</code>, a technology for transforming images through <em>mathematical</em> filters. (iOS 5èµ·ï¼Œä»macOSå¼•å…¥)</p><p>ç”¨é€”ï¼š</p><ul>
<li>patterns and gradients (å¯ä»¥è¢«åˆ«çš„filterä¸€èµ·ä½¿ç”¨)</li>
<li>compositing (ä½¿ç”¨composting blend modes)</li>
<li>color (é¢œè‰²è°ƒæ•´ï¼Œäº®åº¦é”åº¦è‰²æ¸©ç­‰ç­‰)</li>
<li>geometric (å‡ ä½•ç›¸å…³çš„å°±æ˜¯ç”¨æ¥å˜å½¢)</li>
<li>transformation (distort, blur, stylize an image)</li>
<li>transition (ä¸€èˆ¬ç”¨äºåŠ¨ç”»ï¼Œé€šè¿‡è®¾ç½®frameåºåˆ—)</li>
</ul>
<p>There are more than 200 available <code>CIFilters</code>ï¼Œ A CIFilter is a set of <strong>instructions</strong> for <code>generating</code> a CIImage</p><ul>
<li>åŸºæœ¬ä¸Šï¼Œå¤„ç†çš„éƒ½æ˜¯<code>CIImage</code>(input)</li>
<li>è¾“å‡ºä¹Ÿæ˜¯<code>CIImage</code>ï¼Œæˆ–è€…å¦ä¸€ä¸ª<code>filter</code> -&gt; é“¾å¼è°ƒç”¨<ul>
<li>æœ€åä¸€å±‚é“¾å¯ä»¥è‡ªè¡Œè½¬æ¢ä¸ºbitmap: cgæˆ–ui image(by <code>rendering</code>æ–¹æ³•)</li>
<li>renderingçš„æ—¶å€™ï¼Œæ‰€æœ‰çš„æ•°å­¦è®¡ç®—æ‰å¼€å§‹å‘ç”Ÿ</li>
<li>å› ä¸ºåªæ˜¯<strong>instructions</strong></li>
</ul>
</li>
<li><strong>å…³é”®è¯</strong>ï¼šfilteræ˜¯ç”¨æ¥æè¿°æ€ä¹ˆ<strong>ç”Ÿæˆ</strong>CIImageçš„</li>
<li><code>CGImage</code>å’Œ<code>UIImage</code>éƒ½èƒ½å¾—åˆ°CIImage</li>
</ul>
<blockquote>
<p>UIImageåªæœ‰åœ¨å·²ç»wrapsäº†ä¸€ä¸ª<code>CIImage</code>çš„æƒ…å†µä¸‹<code>.ciImage</code>æ‰æœ‰å€¼ï¼Œè€Œå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯æ²¡æœ‰çš„ã€‚</p></blockquote>
<p><a href="https://developer.apple.com/library/archive/documentation/GraphicsImaging/Reference/CoreImageFilterReference/index.html">Core Image Filter Reference</a>é‡Œæœ‰æ‰€æœ‰çš„filterçš„åå­—ï¼Œç”¨æ¥åˆå§‹åŒ–ä¸€ä¸ªfilter</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">filter</span> <span class="p">=</span> <span class="bp">CIFilter</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;CICheckerboardGenerator&quot;</span><span class="p">)</span><span class="o">!</span>
<span class="c1">// or:</span>
<span class="kd">let</span> <span class="nv">filter</span> <span class="p">=</span> <span class="bp">CIFilter</span><span class="p">.</span><span class="n">checkerboardGenerator</span><span class="p">()</span>

<span class="c1">// ç”¨key-valueæ¥å†³å®šè¡Œä¸ºï¼š</span>
<span class="bp">filter</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span> <span class="s">&quot;inputWidth&quot;</span><span class="p">)</span>
<span class="c1">// or:</span>
<span class="bp">filter</span><span class="p">.</span><span class="n">width</span> <span class="p">=</span> <span class="mi">30</span>
<span class="c1">// or init with params</span>
<span class="kd">init</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="n">parameters</span><span class="p">:)</span>

<span class="c1">// apply filter on CIImage(if exists one)</span>
<span class="n">ciimage</span><span class="p">.</span><span class="n">applyingFilter</span><span class="p">(</span><span class="kc">_</span><span class="p">:</span><span class="n">parameters</span><span class="p">:)</span>
<span class="c1">// or output a ciimage</span>
<span class="bp">filter</span><span class="p">.</span><span class="n">outputImage</span>
</pre></div>
<p><strong>Render a CIImage</strong>
CIImage ä¸æ˜¯ä¸€ä¸ª<code>displayaable image</code></p><ul>
<li><code>CIContext</code>.init(options:).createCGImage(_:from)<ul>
<li>å‚æ•°1æ˜¯CIImageï¼Œ</li>
<li>å‚æ•°2æ˜¯ç»˜åˆ¶åŒºåŸŸï¼ˆæ‰€ä»¥æ²¡æœ‰frame/bounds)ï¼Œå«<code>extent</code></li>
<li>è¿™æ˜¯å¾ˆæ˜‚è´µçš„æ“ä½œï¼Œå»ºè®®åœ¨å…¨appç”Ÿå‘½å‘¨æœŸä¿ç•™è¿™ä¸ªcontextå¤ç”¨</li>
</ul>
</li>
<li><code>UIImage</code>.init(ciImage:)</li>
<li>æŠŠä¸Šä¸€æ¬¡çš„uiimageè®¾ç½®æˆ<code>UIImageView</code>çš„imageï¼Œä¹Ÿèƒ½é€ æˆCIImageçš„æ¸²æŸ“ã€‚</li>
</ul>
<p>ä»¥ä¸Šè¯´çš„éƒ½æ˜¯&quot;render&quot; CIImageçš„æ—¶æœºï¼Œæ‰€ä»¥ä¼ å…¥çš„</p><blockquote>
<p><code>Metal</code>èƒ½å¿«é€Ÿæ¸²æŸ“CIImage</p></blockquote>
<p>ä¸²èµ·ä¸€ä¸ªdemo:</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">moi</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">named</span><span class="p">:</span><span class="s">&quot;Moi&quot;</span><span class="p">)</span><span class="o">!</span>
<span class="kd">let</span> <span class="nv">moici</span> <span class="p">=</span> <span class="bp">CIImage</span><span class="p">(</span><span class="n">image</span><span class="p">:</span><span class="n">moi</span><span class="p">)</span><span class="o">!</span>
<span class="kd">let</span> <span class="nv">moiextent</span> <span class="p">=</span> <span class="n">moici</span><span class="p">.</span><span class="n">extent</span>
<span class="kd">let</span> <span class="nv">smaller</span> <span class="p">=</span> <span class="bp">min</span><span class="p">(</span><span class="n">moiextent</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">moiextent</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">larger</span> <span class="p">=</span> <span class="bp">max</span><span class="p">(</span><span class="n">moiextent</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">moiextent</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
<span class="c1">// first filter</span>
<span class="kd">let</span> <span class="nv">grad</span> <span class="p">=</span> <span class="bp">CIFilter</span><span class="p">.</span><span class="n">radialGradient</span><span class="p">()</span>
<span class="n">grad</span><span class="p">.</span><span class="n">center</span> <span class="p">=</span> <span class="n">moiextent</span><span class="p">.</span><span class="n">center</span>
<span class="n">grad</span><span class="p">.</span><span class="n">radius0</span> <span class="p">=</span> <span class="nb">Float</span><span class="p">(</span><span class="n">smaller</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">*</span> <span class="mf">0.7</span>
<span class="n">grad</span><span class="p">.</span><span class="n">radius1</span> <span class="p">=</span> <span class="nb">Float</span><span class="p">(</span><span class="n">larger</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
<span class="kd">let</span> <span class="nv">gradimage</span> <span class="p">=</span> <span class="n">grad</span><span class="p">.</span><span class="n">outputImage</span><span class="p">!</span>
<span class="c1">// åˆ°æ­¤æ­¥ä¸ºæ­¢ï¼Œå¹¶æ²¡æœ‰moiè¿™ä¸ªå›¾ç‰‡å‚ä¸ï¼Œç­‰äºæ˜¯ä¸€ä¸ªçº¯filter</span>

<span class="c1">// second filter</span>
<span class="kd">let</span> <span class="nv">blend</span> <span class="p">=</span> <span class="bp">CIFilter</span><span class="p">.</span><span class="n">blendWithMask</span><span class="p">()</span>
<span class="n">blend</span><span class="p">.</span><span class="n">inputImage</span> <span class="p">=</span> <span class="n">moici</span>  <span class="c1">// è®¾ç½®äº†image</span>
<span class="n">blend</span><span class="p">.</span><span class="n">maskImage</span> <span class="p">=</span> <span class="n">gradimage</span> <span class="c1">// è¿™é‡Œæ¼”ç¤ºçš„æ˜¯mask filterï¼ŒæŒ‰æˆ‘ç†è§£å¹¶ä¸æ˜¯é“¾å¼çš„ï¼Œè€Œä¸”è¯­æ³•ä¸Šä¹Ÿä¸æ˜¯é“¾å¼çš„ï¼Œè€Œæ˜¯èµ‹å€¼ç»™äº†maskImageï¼Œä½†ä¹¦é‡Œç›´æ¥è¯´æ˜¯é“¾å¼çš„</span>
<span class="kd">let</span> <span class="nv">blendimage</span> <span class="p">=</span> <span class="n">blend</span><span class="p">.</span><span class="n">outputImage</span><span class="p">!</span>

<span class="c1">// ä¸¤ç§renderæ–¹æ³•</span>
<span class="c1">// content</span>
<span class="kd">let</span> <span class="nv">moicg</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">createCGImage</span><span class="p">(</span><span class="n">blendimage</span><span class="p">,</span> <span class="n">from</span><span class="p">:</span> <span class="n">moiextent</span><span class="p">)</span><span class="o">!</span> <span class="c1">// *</span>
<span class="kc">self</span><span class="p">.</span><span class="n">iv</span><span class="p">.</span><span class="n">image</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">cgImage</span><span class="p">:</span> <span class="n">moicg</span><span class="p">)</span>

<span class="c1">// UIImage</span>
<span class="kd">let</span> <span class="nv">r</span> <span class="p">=</span> <span class="bp">UIGraphicsImageRenderer</span><span class="p">(</span><span class="n">size</span><span class="p">:</span><span class="n">moiextent</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
<span class="kc">self</span><span class="p">.</span><span class="n">iv</span><span class="p">.</span><span class="n">image</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">image</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
    <span class="bp">UIImage</span><span class="p">(</span><span class="n">ciImage</span><span class="p">:</span> <span class="n">blendimage</span><span class="p">).</span><span class="n">draw</span><span class="p">(</span><span class="k">in</span><span class="p">:</span><span class="n">moiextent</span><span class="p">)</span> <span class="c1">// *</span>
<span class="p">}</span>
</pre></div>
<blockquote>
<p>å…³äºä¸Šè¿°ä»£ç é‡Œæˆ‘çš„ç–‘æƒ‘ï¼Œç¬¬ä¸€ä¸ªfilterå¹¶ä¸æ˜¯chainåˆ°ç¬¬äºŒä¸ªfilteré‡Œçš„ï¼Œä½†ä¹¦é‡Œè¯´æ˜¯<code>obtain the final CIImage in the chain (blendimage)ï¼Œçœ‹æ¥æ‰€è°“çš„chainï¼Œå¹¶ä¸æ˜¯fitlerçš„chainï¼Œè€Œæ˜¯</code>outputImage`çš„chain?
é—®é¢˜æ˜¯ï¼Œè¿™æ˜¯å”¯ä¸€ä¸”æ ‡å‡†çš„filteråµŒå¥—ç”¨æ³•ä¹ˆï¼Ÿ-&gt; mask</p></blockquote>
<p>ä¸æ˜¯çš„</p><ol>
<li>å¯¹filterçš„outputImageç»§ç»­åº”ç”¨<code>aplyingFilter(_:parameters)</code>æ¥é“¾å¼åº”ç”¨ä¸€ä¸ªæ–°çš„filter<ul>
<li>è¿”å›å€¼æ˜¯CIImageï¼Œä¸å†æ˜¯filter</li>
<li>æ‰€ä»¥å¦‚æœç»§ç»­chainï¼Œç›´æ¥ç”¨è¿”å›å€¼è°ƒapply...æ–¹æ³•å³å¯</li>
</ul>
</li>
<li>æŠŠä¸Šä¸€ä¸ªfilterçš„outputImageè®¾ä¸ºä¸‹ä¸€ä¸ªfilterçš„inputImage:</li>
</ol>
<div class="highlight"><pre><span></span><span class="bp">CIFilter</span><span class="w"> </span><span class="o">*</span><span class="n">gloom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">CIFilter</span><span class="w"> </span><span class="n">filterWithName</span><span class="o">:</span><span class="s">@&quot;CIGloom&quot;</span><span class="p">];</span><span class="w"></span>
<span class="p">[</span><span class="n">gloom</span><span class="w"> </span><span class="n">setDefaults</span><span class="p">];</span><span class="w">                                        </span>
<span class="p">[</span><span class="n">gloom</span><span class="w"> </span><span class="n">setValue</span><span class="o">:</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">forKey</span><span class="o">:</span><span class="w"> </span><span class="n">kCIInputImageKey</span><span class="p">];</span><span class="w"></span>
<span class="p">[</span><span class="n">gloom</span><span class="w"> </span><span class="n">setValue</span><span class="o">:</span><span class="w"> </span><span class="mf">@25.0f</span><span class="w"> </span><span class="n">forKey</span><span class="o">:</span><span class="w"> </span><span class="n">kCIInputRadiusKey</span><span class="p">];</span><span class="w">         </span>
<span class="p">[</span><span class="n">gloom</span><span class="w"> </span><span class="n">setValue</span><span class="o">:</span><span class="w"> </span><span class="mf">@0.75f</span><span class="w"> </span><span class="n">forKey</span><span class="o">:</span><span class="w"> </span><span class="n">kCIInputIntensityKey</span><span class="p">];</span><span class="w">      </span>
<span class="c1">// å³outputImage</span>
<span class="bp">CIImage</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">gloom</span><span class="w"> </span><span class="n">valueForKey</span><span class="o">:</span><span class="w"> </span><span class="n">kCIOutputImageKey</span><span class="p">];</span><span class="w">   </span>

<span class="bp">CIFilter</span><span class="w"> </span><span class="o">*</span><span class="n">bumpDistortion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">CIFilter</span><span class="w"> </span><span class="n">filterWithName</span><span class="o">:</span><span class="s">@&quot;CIBumpDistortion&quot;</span><span class="p">];</span><span class="w"></span>
<span class="p">[</span><span class="n">bumpDistortion</span><span class="w"> </span><span class="n">setDefaults</span><span class="p">];</span><span class="w">                                              </span>
<span class="c1">// è®¾ç½®inputImage (with first filter&#39;s output image) </span>
<span class="p">[</span><span class="n">bumpDistortion</span><span class="w"> </span><span class="n">setValue</span><span class="o">:</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">forKey</span><span class="o">:</span><span class="w"> </span><span class="n">kCIInputImageKey</span><span class="p">];</span><span class="w"></span>
<span class="p">[</span><span class="n">bumpDistortion</span><span class="w"> </span><span class="n">setValue</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="bp">CIVector</span><span class="w"> </span><span class="n">vectorWithX</span><span class="o">:</span><span class="mi">200</span><span class="w"> </span><span class="n">Y</span><span class="o">:</span><span class="mi">150</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="nl">forKey</span><span class="p">:</span><span class="w"> </span><span class="n">kCIInputCenterKey</span><span class="p">];</span><span class="w">                              </span>
<span class="p">[</span><span class="n">bumpDistortion</span><span class="w"> </span><span class="n">setValue</span><span class="o">:</span><span class="w"> </span><span class="mf">@100.0f</span><span class="w"> </span><span class="n">forKey</span><span class="o">:</span><span class="w"> </span><span class="n">kCIInputRadiusKey</span><span class="p">];</span><span class="w">                </span>
<span class="p">[</span><span class="n">bumpDistortion</span><span class="w"> </span><span class="n">setValue</span><span class="o">:</span><span class="w"> </span><span class="mf">@3.0f</span><span class="w"> </span><span class="n">forKey</span><span class="o">:</span><span class="w"> </span><span class="n">kCIInputScaleKey</span><span class="p">];</span><span class="w">                   </span>
<span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">bumpDistortion</span><span class="w"> </span><span class="n">valueForKey</span><span class="o">:</span><span class="w"> </span><span class="n">kCIOutputImageKey</span><span class="p">];</span><span class="w"></span>
</pre></div>
<blockquote>
<p>CIImageèƒ½è®¤å‡ºEXIFé‡Œå…³äºæ—‹è½¬æ–¹å‘çš„å‚æ•°ï¼Œå¹¶ä»¥æ­£ç¡®çš„æ–¹å‘å±•ç¤º</p></blockquote>
<h2>Blur and Vibrancy Views</h2>
<p>æ¯›ç»ç’ƒæ•ˆæœï¼Œç”¨<code>UIVisualEffectView</code>ï¼Œè¿™æ˜¯ä¸ªæŠ½åƒç±»ï¼Œå®é™…ç”¨è¿™ä¸¤ä¸ªï¼š<code>UIVisualEffectView</code>å’Œ<code>UIVibrancyEffect</code>ã€‚</p><p>ä»€ä¹ˆæ˜¯<code>UIVibrancyEffect</code>?</p><blockquote>
<p>An object that amplifies and adjusts the color of the content layered <code>behind</code> a visual effect view.</p></blockquote>
<p>å…³é”®è¯æ˜¯<code>behind</code>ï¼Œå³å®ƒæ˜¯é…åˆåˆ«çš„è§†æ•ˆä¸€èµ·ç”¨çš„ï¼ˆæ¯”å¦‚æ¯›ç»ç’ƒï¼‰ã€‚æ–‡å­—è¢«æ¯›ç»ç’ƒè¦†ç›–åçš„æ•ˆæœï¼Œå¹¶ä¸æ˜¯ç”±æ¯›ç»ç’ƒå±‚æ¥ç¡®å®šçš„ï¼Œè€Œæ˜¯ç”±vibrancy effectè‡ªå®šä¹‰çš„ã€‚</p><p>æ€»çš„æ¥è¯´</p><ul>
<li>ç”¨effectåˆå§‹åŒ–effect view, effectå°±æ˜¯äº”ç§<code>material</code></li>
<li>è¿™ä¸ªviewå¯ä»¥å½“æˆå¸¸è§„viewæ¥å®šä½ï¼Œå¸ƒå±€ï¼Œæ·»åŠ åˆ°subviewé‡Œï¼Œç­‰ç­‰</li>
<li>ç”¨ä¸Šä¸€ä¸ªeffectåˆå§‹åŒ–ä¸€ä¸ªvibrancy effectï¼ˆwith style)</li>
<li>ç”¨vibrance effectåˆå§‹åŒ–ä¸€ä¸ªview</li>
<li>åˆ›å»ºUIæ§ä»¶</li>
<li>è®©vibViewçš„boundsç­‰äºå†…å®¹çš„boundsï¼ˆç­‰äºåªå¯¹å†…å®¹æ‰€æœ‰çš„èŒƒå›´å†…åº”ç”¨ç‰¹æ•ˆï¼‰ï¼Œå¹¶å®šä½</li>
<li>vibViewæ·»åŠ åˆ°effectViewçš„contentViewçš„subViewé‡Œå»</li>
<li>éœ€è¦è¢«vibrancyçš„å†…å®¹ï¼ˆæ¯”å¦‚ä¸€ä¸ªlabel)ï¼Œåˆ™æ·»åŠ åˆ°vibView.contentView.addSubview(label)</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">blurEffect</span> <span class="p">=</span> <span class="bp">UIBlurEffect</span><span class="p">(</span><span class="n">style</span><span class="p">:</span> <span class="p">.</span><span class="n">systemThinMaterial</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">blurView</span> <span class="p">=</span> <span class="bp">UIVisualEffectView</span><span class="p">(</span><span class="n">effect</span><span class="p">:</span> <span class="n">blurEffect</span><span class="p">)</span>
<span class="n">blurView</span><span class="p">.</span><span class="n">frame</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span>
<span class="n">blurView</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="p">=</span> <span class="p">[.</span><span class="n">flexibleWidth</span><span class="p">,</span> <span class="p">.</span><span class="n">flexibleHeight</span><span class="p">]</span>
<span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">blurView</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">vibEffect</span> <span class="p">=</span> <span class="bp">UIVibrancyEffect</span><span class="p">(</span>
    <span class="n">blurEffect</span><span class="p">:</span> <span class="n">blurEffect</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="p">.</span><span class="n">label</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">vibView</span> <span class="p">=</span> <span class="bp">UIVisualEffectView</span><span class="p">(</span><span class="n">effect</span><span class="p">:</span><span class="n">vibEffect</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">lab</span> <span class="p">=</span> <span class="bp">UILabel</span><span class="p">()</span>
<span class="n">lab</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&quot;Hello, world&quot;</span>
<span class="n">lab</span><span class="p">.</span><span class="n">sizeToFit</span><span class="p">()</span>
<span class="n">vibView</span><span class="p">.</span><span class="n">bounds</span> <span class="p">=</span> <span class="n">lab</span><span class="p">.</span><span class="n">bounds</span>
<span class="n">vibView</span><span class="p">.</span><span class="n">center</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">center</span>
<span class="n">vibView</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="p">=</span>
    <span class="p">[.</span><span class="n">flexibleTopMargin</span><span class="p">,</span> <span class="p">.</span><span class="n">flexibleBottomMargin</span><span class="p">,</span>
    <span class="p">.</span><span class="n">flexibleLeftMargin</span><span class="p">,</span> <span class="p">.</span><span class="n">flexibleRightMargin</span><span class="p">]</span>
<span class="n">blurView</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">vibView</span><span class="p">)</span>
<span class="n">vibView</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
</pre></div>
<h2>Drawing a UIView</h2>
<p>UIViewæœ¬èº«å°±æä¾›äº†ä¸€ä¸ª<code>graphics context</code>ï¼Œåœ¨è¿™ä¸ªcontexté‡Œè¿›è¡Œçš„ç»˜åˆ¶ä¼šç›´æ¥æ˜¾ç¤ºåœ¨viewé‡Œã€‚</p><ul>
<li>subclass UIView's <code>.draw(_:)</code>method<ul>
<li>ç›´åˆ°éœ€è¦æ—¶æ‰ä¼šè¢«è°ƒç”¨</li>
<li>æˆ–<code>setNeedsDisplay</code>ä¼šè°ƒç”¨</li>
<li>ä¸€é‡è¢«drawï¼Œå°±ç¼“å­˜èµ·æ¥äº† (<code>bitmap backing store</code>)</li>
</ul>
</li>
<li>å®æ—¶ç»˜åˆ¶ä¼šå“åˆ°ä¸€äº›åˆå­¦è€…ï¼Œç»˜åˆ¶æ˜¯<code>time-comsuming operation</code></li>
</ul>
<p>æ¨èåœ¨<code>draw</code>æ–¹æ³•é‡Œå®æ—¶ç»˜åˆ¶</p><blockquote>
<p>In fact, moving code to draw(_: ) is commonly a way to increase efficiency. This is because it is more efficient for the drawing engine to <em>render directly onto the screen</em> than for it to <em>render offscreen</em> and then copy those pixels onto the screen.</p></blockquote>
<p>å‡ ä¸ªæ³¨æ„ç‚¹ï¼š</p><ol>
<li>ä¸è¦æ‰‹åŠ¨è°ƒç”¨drawæ–¹æ³•ï¼Œ<code>setNeedsDisplay</code>ä¼šè®©ç³»ç»Ÿå†³å®šä¸‹ä¸€ä¸ªåˆé€‚çš„æ—¶æœºæ¥draw</li>
<li>ä¸è¦é‡è½½drawæ–¹æ³•ï¼Œæ¯”å¦‚ä½ æ— æ³•åˆå¹¶UIImageViewçš„drawing</li>
<li>ä¸è¦åœ¨drawé‡Œåšä»»ä½•ä¸ç»˜åˆ¶æ— å…³çš„äº‹ï¼Œé…ç½®ï¼ˆå¦‚èƒŒæ™¯è‰²ï¼Œæ·»åŠ å­view/layerï¼‰é¡¹åº”è¯¥åœ¨åˆ«çš„åœ°æ–¹åšï¼Œæ¯”å¦‚<code>layoutSubviews</code></li>
<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªrectï¼Œé»˜è®¤æ˜¯viewçš„bounds<ul>
<li>å¦‚æœä½ ç”¨<code>setNeesDisplay(_:)</code>é€å…¥äº†è‡ªå®šä¹‰çš„CGRectï¼Œdrawé‡Œé¢çš„rectä¹Ÿå°±æˆäº†è¿™ä¸ªï¼Œå¦‚æœä½ ä¸åœ¨è¿™ä¸ªrecté‡Œç”»ï¼ˆè€Œæ˜¯åœ¨æ•´ä¸ªviewçš„recté‡Œï¼‰ï¼Œè¶…å‡ºéƒ¨åˆ†ä¼šè¢«clipæ‰</li>
<li>è¿™ä¹Ÿæ˜¯ä¸ºäº†æ•ˆç‡ï¼Œæ˜¾ç¤ºæä¾›ç»˜åˆ¶çš„åŒºåŸŸ</li>
</ul>
</li>
<li>æ‰‹å†™drawç»˜åˆ¶å‡ºæ¥çš„viewä¼šæœ‰é»‘è‰²çš„åº•è‰²ï¼Œå¦‚æœä½ æ²¡æœ‰è®¾è®¡èƒŒæ™¯è‰²ï¼Œä»¥åŠ<code>isOpaque == true</code>æ—¶ï¼ˆ<code>UIView.init(frame:)</code>å‡ºæ¥çš„viewæ°å¥½æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œ nibé‡Œæ‹–å‡ºæ¥çš„åˆ™æ˜¯nilçš„èƒŒæ™¯ï¼Œåè€Œæ²¡è¿™é—®é¢˜ï¼‰<ul>
<li>è§£å†³ï¼šå®ç°<code>init(frame:)</code>ï¼Œå»è®¾ç½®*isOpaque`ä¸ºfalse</li>
</ul>
</li>
</ol>
<h2>Graphics Context Commands</h2>
<blockquote>
<p>Under the hood, Core Graphics commands to a <code>graphics context</code> are global C functions with names like CGContextSetFillColorï¼Œä½†æ˜¯swiftçš„å°è£…è®©è°ƒç”¨æ›´ç®€å•ï¼ˆè¯­æ³•ç³–ï¼‰</p></blockquote>
<p>å½“ä½ åœ¨graphics contexté‡Œç»˜åˆ¶æ—¶ï¼Œå–çš„å°±æ˜¯å½“å‰çš„è®¾ç½®ï¼Œå› æ­¤åœ¨ä»»ä½•ç»˜åˆ¶å‰ï¼Œç¬¬ä¸€æ­¥éƒ½æ˜¯å…ˆé…ç½®context's settingï¼Œæ¯”å¦‚ä½ è¦ç”»ä¸€æ ¹çº¢çº¿ï¼Œå†ç”»ä¸€æ ¹è“çº¿</p><ol>
<li>è®¾ç½®context line color red, then draw a line</li>
<li>è®¾ç½®context line color blue, then draw a line</li>
</ol>
<p>ç›´è§‰è®¤ä¸ºçº¢å’Œè“åªæ˜¯ä¸¤æ¡çº¿å„è‡ªçš„å±æ€§ï¼Œå…¶å®æ˜¯ä½ ç»˜åˆ¶<strong>å½“æ—¶</strong>ï¼Œæ•´ä¸ªgraphics contextçš„è®¾ç½®</p><ul>
<li>è¿™äº›é…ç½®é€šé€šå­˜æˆä¸€ä¸ªstate</li>
<li>è¿™äº›stateåˆä¼šstackèµ·æ¥<ul>
<li>saveGStateå°†å½“å‰stateæ¨åˆ°æ ˆé¡¶</li>
<li>restoreGstateåˆ™å°†stateä»æ ˆé¡¶å–å‡ºï¼Œè¦†ç›–å½“å‰è®¾ç½®</li>
</ul>
</li>
<li>åªè¦å…ˆåé…ç½®æ²¡æœ‰å†²çªçš„é¡¹ï¼Œå°±æ²¡å¿…è¦é¢‘ç¹save-restore</li>
</ul>
<h3>Paths and Shapes</h3>
<ul>
<li><p>é€šè¿‡ä¸€ç³»åˆ—çš„æè¿°å»ç§»åŠ¨ä¸€å»æƒ³è±¡ä¸­çš„ç¬”ï¼Œå°±æ˜¯æ„å»º<code>path</code>çš„è¿‡ç¨‹ã€‚ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯æ„å»º<code>CGPath</code>è¿™ä¸ªå°è£…çš„è¿‡ç¨‹ï¼‰</p><ul>
<li>å³åªè¦ä½ åœ¨contextå†…ï¼Œå°±å¯ä»¥ç”¨ç¬”ç”»ä¸œè¥¿äº†</li>
</ul>
</li>
<li><p>åªè¦ä½ æ­£ç¡®åœ°ä½¿ç”¨<code>move(to:)</code>æ–¹æ³•ï¼Œå°±ä¸éœ€è¦åƒappleæ–‡æ¡£é‡ŒåŠ¨ä¸åŠ¨å°±ç”¨<code>beginPath</code>æ¥è®¾ç½®æ–°çš„pathçš„èµ·ç‚¹</p></li>
<li><p><code>fillPath</code>ä¼šè‡ªåŠ¨<code>closePaht</code></p></li>
<li><p>å…ˆæä¾›pathï¼Œå†drawï¼Œdrawçš„æ„æ€è¦ä¹ˆæ˜¯strokeï¼Œè¦ä¹ˆæ˜¯fillï¼Œè¦ä¹ˆæ˜¯bothï¼ˆ<code>drawPath</code>æ–¹æ³•ï¼‰ï¼Œä½†ä¸èƒ½ä¸€æ­¥æ­¥æ¥ï¼Œå› ä¸ºdrawå®Œä½ çš„pathå°±ç©ºäº†</p><ul>
<li>è¡”æ¥ç¬¬ä¸€æ¡ï¼Œå¦‚æœä½ æƒ³å¤ç”¨è¿™ä¸ªpathï¼Œæ‰éœ€è¦ç”¨<code>CGPath</code>å°è£…èµ·æ¥</li>
</ul>
</li>
<li><p>å¦‚æœæ˜¯ä½¿ç”¨UIKitå°è£…çš„è¯­æ³•ï¼Œé‚£ä¹ˆèµ·ç‚¹å°±æ˜¯ä¸€ä¸ªpath <code>let path = UIBezierPath()</code></p></li>
<li><p>é‚£ä¹ˆæ¯æ¬¡drawå®Œï¼Œè¦åœ¨åˆ«çš„ä½ç½®â€œè½ç¬”â€çš„è¯ï¼Œè¦å…ˆæ¸…ä¸€ä¸‹é å‰çš„path: <code>path.removeAllPoints()</code></p></li>
</ul>
<h3>Clipping</h3>
<ul>
<li>clippingæ‰çš„åŒºåŸŸå°±ä¸èƒ½è¢«ç»˜åˆ¶äº†</li>
<li>é€šå¸¸ä½ æ— æ³•å¾—çŸ¥ä¸€ä¸ªgraphics contextçš„å¤§å°ï¼Œä½†æ˜¯é€šè¿‡<code>boundingBoxOfClipPath</code>å´èƒ½æ‹¿åˆ°æ•´ä¸ªbounding</li>
</ul>
<p>è¿™ä¸€èŠ‚åšäº†å‡ ä¸ªå®éªŒï¼Œå•ç‹¬å†™åˆ°äº†<a href="https://www.jianshu.com/p/ade133568ac0">å¦ä¸€ç¯‡åšæ–‡</a></p><blockquote>
<p>å‰é¢è¯´è¿‡ï¼Œæ²¡æœ‰èƒŒæ™¯è‰²+isOpaqueä¼šå¯¼è‡´èƒŒæ™¯å˜é»‘ï¼Œåœ¨drawé‡Œé¢ï¼Œé»˜è®¤çš„é¢œè‰²ä¹Ÿæ˜¯é»‘è‰²ï¼Œæ‰€ä»¥ä½ ä¸å¸¦ä»»ä½•è®¾ç½®çš„ç»˜åˆ¶ä½ æ˜¯çœ‹ä¸åˆ°ä»»ä½•ä¸œè¥¿çš„ï¼ˆå°±æ˜¯é»‘ç¬”åœ¨é»‘çº¸ä¸Šç”»ï¼‰</p></blockquote>
<h3>Gradients</h3>
<p>gradientä¸èƒ½ç”¨ä½œpathçš„fillï¼Œä½†å¯ä»¥åè¿‡æ¥è®©gradientæ²¿ç€pathåˆ†å¸ƒï¼Œä»¥åŠè¢«clipç­‰ã€‚</p><p>åœ¨ä¸Šé¢åº”ç”¨clipç»˜åˆ¶ç®­å°¾çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬æŠŠç®­æŸ„å˜æˆä»å·¦åˆ°å³æ˜¯ç°-é»‘-ç°çš„æ¸å˜ï¼Œåªéœ€è¦åœ¨<code>addLine</code>å¹¶è®¾ç½®äº†lineçš„å®½åº¦å(ä¸è¦è®¾é¢œè‰²äº†ï¼‰ï¼Œä¸æ˜¯å»<code>strokePath()</code>ï¼Œè€Œæ˜¯ï¼š</p><div class="highlight"><pre><span></span><span class="n">con</span><span class="p">.</span><span class="n">replacePathWithStrokedPath</span><span class="p">()</span>  <span class="c1">// ä¸å†strokePath</span>
<span class="n">con</span><span class="p">.</span><span class="n">clip</span><span class="p">()</span>                        <span class="c1">// å†clipä¸€æ¬¡ï¼Œå¥‡å¶åè½¬</span>
<span class="c1">// draw the gradient</span>
<span class="kd">let</span> <span class="nv">locs</span> <span class="p">:</span> <span class="p">[</span><span class="n">CGFloat</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">]</span>
<span class="kd">let</span> <span class="nv">colors</span> <span class="p">:</span> <span class="p">[</span><span class="n">CGFloat</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span>
        <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="c1">// starting color, transparent light gray</span>
        <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="c1">// intermediate color, darker less transparent gray</span>
        <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="c1">// ending color, transparent light gray</span>
    <span class="p">]</span>
<span class="kd">let</span> <span class="nv">sp</span> <span class="p">=</span> <span class="n">CGColorSpaceCreateDeviceGray</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">grad</span> <span class="p">=</span> <span class="n">CGGradient</span><span class="p">(</span>
    <span class="n">colorSpace</span><span class="p">:</span><span class="n">sp</span><span class="p">,</span> <span class="n">colorComponents</span><span class="p">:</span> <span class="n">colors</span><span class="p">,</span> <span class="n">locations</span><span class="p">:</span> <span class="n">locs</span><span class="p">,</span> <span class="bp">count</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span><span class="o">!</span>
<span class="n">con</span><span class="p">.</span><span class="n">drawLinearGradient</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">CGPoint</span><span class="p">(</span><span class="mi">89</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">end</span><span class="p">:</span> <span class="n">CGPoint</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">options</span><span class="p">:[])</span>
<span class="n">con</span><span class="p">.</span><span class="n">resetClip</span><span class="p">()</span> <span class="c1">// done clipping</span>
</pre></div>
<p>å°æŠ€å·§å°±æ˜¯ç”¨<code>replacePathWithStrokedPath</code>å‡è£…è¿›è¡Œäº†æè¾¹ï¼ˆæ‰€ä»¥åªéœ€è¦çº¿å®½å¹¶ä¸éœ€è¦çº¿çš„é¢œè‰²ï¼‰ï¼Œè¿”å›äº†ä¸€ä¸ªæ–°çš„pathï¼Œä¸€æ¡ç²—çº¿å˜æˆäº†ä¸€ä¸ªçŸ©å½¢æ¡†ã€‚<br />
è€Œä¸€æ—¦æ·»åŠ äº†è¿™ä¸ªæ¡†ï¼Œå‰é¢çš„å¥‡å¶å…³ç³»å°±å…¨åè¿‡æ¥äº†ï¼Œäºæ˜¯æˆ‘ä»¬å†<code>clip</code>ä¸€æ¬¡ï¼Œè¿™å°±æ˜¯å¤´ä¸¤è¡Œä»£ç é‡Œåšçš„äº‹ã€‚</p><h3>Colors and Patterns</h3>
<p>å½“ä½ çš„suer interface sytle changes(æ¯”å¦‚é»‘æš—æ¨¡å¼åˆ‡æ¢), <code>draw(_:)</code>æ–¹æ³•ä¼šè¢«ç«‹åˆ»è°ƒç”¨ï¼Œè¢«è®¾ç½®<code>UITraitCollection.current</code>ï¼Œä»»ä½•æ”¯æŒåŠ¨æ€é¢œè‰²çš„<code>UIColor</code>èƒ½å˜æˆç›¸åº”çš„é¢œè‰²ï¼Œä½†æ˜¯<code>CGColor</code>ä¸èƒ½ï¼Œä½ éœ€è¦æ‰‹åŠ¨è§¦å‘é‡ç»˜ã€‚</p><p>UIKitä½¿ç”¨patternéå¸¸ç®€å•ï¼ŒæŠŠçº¹ç†ç»˜åˆ¶åˆ°å›¾ç‰‡ä¸Šï¼Œç„¶åä»çº¹ç†å›¾ç‰‡æå–å‡ºé¢œè‰²ä¿¡æ¯ï¼Œå°±èƒ½åƒåˆ«çš„é¢œè‰²ä¸€æ ·<code>setFill</code>äº†ï¼š</p><div class="highlight"><pre><span></span><span class="c1">// create the pattern image tile</span>
<span class="kd">let</span> <span class="nv">r</span> <span class="p">=</span> <span class="bp">UIGraphicsImageRenderer</span><span class="p">(</span><span class="n">size</span><span class="p">:</span><span class="n">CGSize</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="kd">let</span> <span class="nv">stripes</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">image</span> <span class="p">{</span> <span class="n">ctx</span> <span class="k">in</span>
    <span class="kd">let</span> <span class="nv">imcon</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">cgContext</span>
    <span class="n">imcon</span><span class="p">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">.</span><span class="n">red</span><span class="p">.</span><span class="n">cgColor</span><span class="p">)</span>
    <span class="n">imcon</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">imcon</span><span class="p">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">.</span><span class="n">blue</span><span class="p">.</span><span class="n">cgColor</span><span class="p">)</span>
    <span class="n">imcon</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="p">}</span>
<span class="c1">// paint the point of the arrow with it</span>
<span class="kd">let</span> <span class="nv">stripesPattern</span> <span class="p">=</span> <span class="bp">UIColor</span><span class="p">(</span><span class="n">patternImage</span><span class="p">:</span><span class="n">stripes</span><span class="p">)</span>
<span class="n">stripesPattern</span><span class="p">.</span><span class="n">setFill</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">p</span> <span class="p">=</span> <span class="bp">UIBezierPath</span><span class="p">()</span>
<span class="n">p</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">to</span><span class="p">:</span><span class="n">CGPoint</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
<span class="n">p</span><span class="p">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">to</span><span class="p">:</span><span class="n">CGPoint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">p</span><span class="p">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">to</span><span class="p">:</span><span class="n">CGPoint</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
<span class="n">p</span><span class="p">.</span><span class="n">fill</span><span class="p">()</span>
</pre></div>
<p>è€ŒCore Graphicsåˆ™è¦å¤æ‚ï¼ˆä¹Ÿæ›´åº•å±‚ï¼‰å¾—å¤šï¼Œç»“åˆæ³¨é‡Šçœ‹ä»£ç ï¼š</p><div class="highlight"><pre><span></span><span class="n">con</span><span class="p">.</span><span class="n">saveGState</span><span class="p">()</span>
<span class="c1">// éå¸¸é‡è¦ï¼Œè®¾ç½®é¢œè‰²ç©ºé—´</span>
<span class="kd">let</span> <span class="nv">sp2</span> <span class="p">=</span> <span class="n">CGColorSpace</span><span class="p">(</span><span class="n">patternBaseSpace</span><span class="p">:</span><span class="kc">nil</span><span class="p">)</span><span class="o">!</span>
<span class="n">con</span><span class="p">.</span><span class="n">setFillColorSpace</span><span class="p">(</span><span class="n">sp2</span><span class="p">)</span>
<span class="c1">// çº¹ç†ç»˜åˆ¶çœŸæ­£å‘ç”Ÿçš„åœ°æ–¹</span>
<span class="kd">let</span> <span class="nv">drawStripes</span> <span class="p">:</span> <span class="n">CGPatternDrawPatternCallback</span> <span class="p">=</span> <span class="p">{</span> <span class="kc">_</span><span class="p">,</span> <span class="n">con</span> <span class="k">in</span>
    <span class="n">con</span><span class="p">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">.</span><span class="n">red</span><span class="p">.</span><span class="n">cgColor</span><span class="p">)</span>
    <span class="n">con</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">con</span><span class="p">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">.</span><span class="n">blue</span><span class="p">.</span><span class="n">cgColor</span><span class="p">)</span>
    <span class="n">con</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="p">}</span>
<span class="c1">// åŒ…è£…æˆä¸€ä¸ªcallbackç»™CGPatternä½¿ç”¨</span>
<span class="kd">var</span> <span class="nv">callbacks</span> <span class="p">=</span> <span class="bp">CGPatternCallbacks</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">drawPattern</span><span class="p">:</span> <span class="n">drawStripes</span><span class="p">,</span> <span class="n">releaseInfo</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span> <span class="c1">// ä¸€ä¸ªstruct</span>

<span class="c1">// æ ¸å¿ƒå°±æ˜¯æ„é€ è¿™ä¸ªCGPattern</span>
<span class="kd">let</span> <span class="nv">patt</span> <span class="p">=</span> <span class="n">CGPattern</span><span class="p">(</span><span class="n">info</span><span class="p">:</span><span class="kc">nil</span><span class="p">,</span> <span class="n">bounds</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>  <span class="c1">// cellå¤§å°</span>
    <span class="n">matrix</span><span class="p">:</span> <span class="p">.</span><span class="n">identity</span><span class="p">,</span>    <span class="c1">// cellå˜æ¢ï¼Œè¿™é‡Œæ²¡æœ‰ï¼Œå°±ç”¨.identity</span>
    <span class="n">xStep</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">yStep</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>   <span class="c1">// æ¨ªå‘çºµå‘å¤åˆ¶cellæ—¶çš„æ­¥é•¿</span>
    <span class="n">tiling</span><span class="p">:</span> <span class="p">.</span><span class="n">constantSpacingMinimalDistortion</span><span class="p">,</span>  <span class="c1">// æ’åˆ—æ–¹å¼</span>
    <span class="n">isColored</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>      <span class="c1">// æ˜¯é¢œè‰²è¿˜æ˜¯ç”»ç¬”æ¨¡å¼ï¼Œé€‰é¢œè‰²true</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">callbacks</span><span class="p">)</span><span class="o">!</span>  <span class="c1">// çº¹ç†ç»˜åˆ¶çš„æ–¹æ³•åŒ…åœ¨callbacké‡Œé¢ï¼Œä¼ æŒ‡é’ˆ</span>
<span class="kd">var</span> <span class="nv">alph</span> <span class="p">:</span> <span class="n">CGFloat</span> <span class="p">=</span> <span class="mf">1.0</span>
<span class="n">con</span><span class="p">.</span><span class="n">setFillPattern</span><span class="p">(</span><span class="n">patt</span><span class="p">,</span> <span class="n">colorComponents</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">alph</span><span class="p">)</span>
<span class="n">con</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">to</span><span class="p">:</span><span class="n">CGPoint</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
<span class="n">con</span><span class="p">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">to</span><span class="p">:</span><span class="n">CGPoint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">con</span><span class="p">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">to</span><span class="p">:</span><span class="n">CGPoint</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
<span class="n">con</span><span class="p">.</span><span class="n">fillPath</span><span class="p">()</span>
<span class="n">con</span><span class="p">.</span><span class="n">restoreGState</span><span class="p">()</span>
</pre></div>
<h3>Graphics Context Transforms</h3>
<p>è·Ÿå‰é¢çš„çŸ¥è¯†ç‚¹ä¸€æ ·ï¼Œåº”ç”¨<em>Graphics Context Transforms</em>åï¼Œä¹Ÿä¸ä¼šå½±å“å½“å‰å·²ç»ç»˜åˆ¶çš„ä¸œè¥¿ã€‚ =&gt; <code>CTM</code>å³ï¼ˆ<code>current transform matrix</code>)ã€‚</p><p>æ—‹è½¬çš„ä¸­å¿ƒç‚¹æ˜¯åŸç‚¹ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œè®°å¾—å…ˆtranslateä¸€ä¸‹ã€‚</p><div class="highlight"><pre><span></span><span class="kr">override</span> <span class="kd">func</span> <span class="nf">draw</span><span class="p">(</span><span class="kc">_</span> <span class="n">rect</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">con</span> <span class="p">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">()</span><span class="o">!</span>
    <span class="n">con</span><span class="p">.</span><span class="n">setShadow</span><span class="p">(</span><span class="n">offset</span><span class="p">:</span> <span class="n">CGSize</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">blur</span><span class="p">:</span> <span class="mi">12</span><span class="p">)</span> <span class="c1">// é¡ºä¾¿æ¼”ç¤ºä¸‹sahdow</span>
    <span class="n">con</span><span class="p">.</span><span class="n">beginTransparencyLayer</span><span class="p">(</span><span class="n">auxiliaryInfo</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>  <span class="c1">// è¿™æ ·é‡å çš„é˜´å½±ä¸ä¼šå æˆé»‘è‰²</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">arrow</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">at</span><span class="p">:</span><span class="n">CGPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="kc">_</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.&lt;</span><span class="mi">3</span> <span class="p">{</span>
        <span class="n">con</span><span class="p">.</span><span class="n">translateBy</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">con</span><span class="p">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">by</span><span class="p">:</span> <span class="mi">30</span> <span class="o">*</span> <span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
        <span class="n">con</span><span class="p">.</span><span class="n">translateBy</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">arrow</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">at</span><span class="p">:</span><span class="n">CGPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1">// æ³¨æ„è¿™é‡Œæ˜¯ç”¨å‰é¢æ–¹æ³•ç”Ÿæˆçš„ç®­å¤´å›¾ç‰‡æ¥drawåˆ°æŒ‡å®šä½ç½®</span>
    <span class="p">}</span> 
<span class="p">}</span>
</pre></div>
<figure  style="flex: 77.47747747747748" ><img width="688" height="444" src="/archives/assets/0059ea4156dffb9df15e77df8a87f971.png" alt=""/></figure><p>æ³¨æ„ï¼Œè¯­æ³•è™½ç„¶æ˜¯å…ˆå¤„ç†contextï¼Œå†ç»˜åˆ¶ï¼Œå…¶å®åªæ˜¯å‘ŠçŸ¥åæ ‡ç³»çš„å˜åŒ–ï¼Œç»˜åˆ¶çš„æ—¶å€™è‡ªåŠ¨åº”ç”¨è¿™äº›å˜æ¢ã€‚</p><h3>Erasing</h3>
<p><code>clear(_:)</code>æ“¦é™¤è¡Œä¸ºå–å†³äºcontextæ˜¯é€æ˜è¿˜æ˜¯å®å¿ƒçš„ï¼ˆé€æ˜æ“¦æˆé€æ˜ï¼Œå®å¿ƒæ“¦æˆé»‘è‰²ï¼‰ï¼Œåªè¦ä¸æ˜¯opaqueï¼Œé€šé€šç†è§£ä¸ºé€æ˜ï¼Œæ¯”å¦‚background coloræ˜¯nil, æˆ–0.9999çš„é€æ˜åº¦ã€‚</p><h2>Points and Pixels</h2>
<p><code>con.fill(CGRect(100,0,1.0/self.contentScaleFactor,100))</code>åº”ç”¨contentScaleFactorç”»ä¸€æ¡åœ¨ä»»ä½•å±å¹•ä¸Šéƒ½é”åˆ©çš„1åƒç´ ç›´çº¿ã€‚</p><h2>Content Mode</h2>
<p>the drawing system will <code>avoid</code> asking a view to <code>redraw</code> itself from scratch if possible; instead, it will use the <code>cached</code> result of the previous drawing operation (the <strong>bitmap backing store</strong>).</p><p>If the view is resized, the system may simply stretch or shrink or reposition the cached drawing, if your contentMode setting instructs it to do so.</p><p><code>draw(_:)</code>ä»åŸç‚¹å¼€å§‹ç»˜åˆ¶ï¼Œæ‰€ä»¥ä½ çš„<code>contentMode</code>ä¹Ÿè¦ç›¸åº”è®¾ç½®ä¸º<code>topLeft</code>ã€‚è€Œå¦‚æœè®¾ç½®ä¸º<code>.redraw</code>ï¼Œåˆ™ä¸ä¼šä½¿ç”¨cached contentï¼Œæ¯å½“viewè¢«resizeçš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨<code>setNeedsDisplay</code>æ–¹æ³•ï¼Œæœ€ç»ˆè§¦å‘<code>draw(_:)</code>è¿›è¡Œé‡ç»˜ã€‚</p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/Drawing/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
    <article class="yue prism-post-item col-md-8 offset-md-2">
        <h1 class="prism-post-title"><a class="no-link" href="/archives/View/" target="_self">Programming iOS 14 - View</a></h1>
        <div class="prism-post-time">
            <a class="no-link" href="/archives/View/" target="_self">
                <time class="text-uppercase">
                    December 22 2021
                </time>
            </a>
        </div>
        <div class="prism-content"><p>ã€ŠProgramming iOS 14: Dive Deep into Views, View Controllers, and Frameworksã€‹ç¬¬1ç« </p><hr />
<h1>View</h1>
<ul>
<li>A view knows how to draw itself into a rectangular area of the interface.</li>
<li>A view is also a responder</li>
<li>init:<ul>
<li><code>init(frame:)</code>: init from code</li>
<li><code>init(coder:)</code>: init from nib</li>
</ul>
</li>
</ul>
<h2>Window and Root View</h2>
<ul>
<li>Window = top view, ultimate superview<ul>
<li>iPad with iOS 13+ can have multiple window</li>
</ul>
</li>
<li>only one subview: rootViewController's <code>main view</code> -&gt; occupy the entirety of the window</li>
</ul>
<h2>How an App Launches</h2>
<ul>
<li>Swifté¡¹ç›®è‡ªåŠ¨è°ƒç”¨äº†<code>UIApplicationMain</code>æ–¹æ³•ï¼Œå”¯ä¸€æ–¹æ³•ï¼Œåˆå§‹åŒ–äº†å¿…è¦èµ„æº</li>
<li>åˆå§‹åŒ–<code>UIApplicationMain</code>ï¼ˆä½ <code>UIApplication.shared</code>çš„æ¥æºï¼‰ï¼ŒåŠå…¶degate class(<code>@UIApplicationMain</code>)ï¼Œå¹¶æŒæœ‰ï¼Œè´¯ç©¿appæ•´ä¸ªç”Ÿå‘½å‘¨æœŸ</li>
<li>UIApplicationMain calls the app delegateâ€™s <code>application(_:didFinish- LaunchingWithOptions:)</code>, giving your code an opportunity run.</li>
<li>UIApplicationMain creates a <code>UISceneSession</code>, a <code>UIWindowScene</code>, and an instance that will serve as the window sceneâ€™s <code>delegate</code>.<ul>
<li>delegateç”±<em>plist.info / Application Scene Manifest / Delegate Class Name</em> å†³å®š (<code>$(PRODUCT_MODULE_NAME).SceneDelegate</code>)</li>
</ul>
</li>
<li>åˆå§‹åŒ–root view<ul>
<li>UIApplicationMainæ ¹æ®pliståˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†storyboard<ul>
<li>åˆå§‹åŒ–UIWindowï¼Œå¹¶èµ‹ç»™scene delegate's <code>window</code> property</li>
<li>åˆå§‹åŒ–initial view controller å¹¶èµ‹ç»™windowçš„<code>rootViewController</code>å±æ€§</li>
<li>UIAplicationMain call window's <code>makeKeyAndVisible</code>å‘ˆç°Interface</li>
</ul>
</li>
<li>call scene delegate's <code>scene(_:willConnectTo:options:)</code><ul>
<li>è¿™é‡Œä¹Ÿæ˜¯æ²¡ç”¨storyboardçš„è¯ï¼Œæ‰‹åŠ¨å»å®ç°ä¸Šé¢å‡ æ­¥çš„åœ°æ–¹</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Referring to the Windows</strong></p><ul>
<li><code>view.window</code>, if it's nil means it can't be visible to the user</li>
<li>scene delegate's <code>window</code> property</li>
<li><code>UIApplication.shared.windows.first!</code></li>
</ul>
<blockquote>
<p>Do not expect that the window you know about is the appâ€™s only window. The runtime can create <code>additional mysterious windows</code>, such as the <code>UITextEffectsWindow</code> and the <code>UIRemoteKeyboardWindow</code>.</p></blockquote>
<h2>Subview and Superview</h2>
<p><strong>æ›¾ç»</strong>ï¼Œä¸€ä¸ªviewæ‹¥æœ‰å®ƒå¯¹åº”çš„ä¸€ä¸ªçŸ©å½¢åŒºåŸŸï¼Œä¸å±äºå®ƒçš„subviewçš„å…¶å®ƒviewåœ¨è¿™ä¸ªçŸ©å½¢å†…æ˜¯çœ‹ä¸è§çš„ï¼Œå› ä¸ºé‡ç»˜çŸ©å½¢çš„æ—¶å€™æ˜¯ä¸ä¼šè€ƒè™‘åˆ°å…¶å®ƒviewçš„ã€‚åŒæ ·ï¼Œä¹Ÿä¸èƒ½drawåˆ°çŸ©å½¢åŒºåŸŸå¤–å»ã€‚</p><p>OS X10.5èµ·ï¼Œè‹¹æœæ›´æ–°äº†å…³äºViewçš„æ¶æ„ï¼ŒiOSä¹Ÿè·Ÿç€æ”¹å˜äº†ï¼Œsubviewèƒ½å‡ºç°åœ¨superviewä¹‹å¤–ï¼ˆæ‰€ä»¥åè€Œéœ€è¦<code>clipping</code>äº†ï¼‰ï¼Œä¸€ä¸ªviewä¹Ÿèƒ½overlapåˆ°å¦ä¸€ä¸ªviewä¸Šè€Œæ— éœ€æˆä¸ºå…¶subviewï¼ˆåæ¥å±…ä¸Šï¼‰ã€‚</p><p>ç»“æœå°±æ˜¯ï¼Œä½ ç°åœ¨çœ‹åˆ°å‡ ä¸ªäº’ç›¸é‡å çš„æˆ‘è‰²å—ï¼Œä½ å†ä¹Ÿåˆ†è¾¨ä¸å‡ºviewä¹‹é—´çš„å±‚æ¬¡å…³ç³»äº†ã€‚ï¼ˆ<code>isDescendant(of:)</code>å¯ä»¥æ£€æŸ¥å±‚æ¬¡å…³ç³»ï¼‰</p><p>æ²¡æœ‰æ¸…ç©ºsubviewçš„æ–¹æ³•ï¼Œæ‰€ä»¥ï¼š<code>myView.subviews.forEach {$0.removeFromSuperview()}</code></p><h2>Color</h2>
<ul>
<li>background colorä¸è®¾ç½®è¡¨ç¤ºè¿™ä¸ªviewæ˜¯é€æ˜çš„</li>
<li>å¦‚æœå†æ²¡æœ‰è¿›è¡Œä»»ä½•å­viewçš„ç»˜åˆ¶ï¼Œé‚£ä¹ˆè¿™ä¸ªviewå°±çœ‹ä¸è§äº†</li>
<li>è¿™ç§viewå¯ä»¥ä½œä¸ºå®¹å™¨æ¥ä½¿ç”¨</li>
</ul>
<p>iOS 13èµ·ï¼Œå¼•å…¥é»‘æš—æ¨¡å¼åï¼Œç¡¬ç¼–ç çš„é¢œè‰²å°±è¿æ¥äº†å¾ˆå¤§çš„é—®é¢˜ã€‚</p><ul>
<li>çº ç»“çš„è§£å†³æ–¹æ³•ï¼š</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">v</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="bp">UIColor</span> <span class="p">{</span> <span class="n">tc</span> <span class="k">in</span>
        <span class="k">switch</span> <span class="n">tc</span><span class="p">.</span><span class="n">userInterfaceStyle</span> <span class="p">{</span>
        <span class="k">case</span> <span class="p">.</span><span class="n">dark</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">UIColor</span><span class="p">(</span><span class="n">red</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">UIColor</span><span class="p">(</span><span class="n">red</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>å…¶ä¸­, tcæ˜¯<code>trait collection</code>ï¼Œä¸€ç³»åˆ—ç‰¹å¾çš„é›†åˆã€‚</p><ul>
<li>è€ŒiOS 13èµ·å¤šäº†å¾ˆå¤š<code>.system</code>å¼€å¤´çš„colorï¼Œå¯ä»¥è‡ªé€‚åº”</li>
<li><em>asset catalog</em>ä¸­å¯ä»¥è‡ªå®šä¹‰é¢œè‰²ï¼Œå¹¶è®¾ç½®ä¸åŒæ¨¡å¼ä¸‹çš„é¢œè‰²</li>
</ul>
<h2>Visibility and Opacity</h2>
<p>éšè—ä¸€ä¸ªview:</p><ul>
<li><code>isHidden</code>: viewè¿˜åœ¨ï¼Œä½†ä¸ä¼šæ¥å—è§¦æ‘¸äº‹ä»¶<ul>
<li><code>alpha = 0</code>ä¹Ÿä¼šä½¿å¾—<code>isHidden == true</code></li>
</ul>
</li>
<li><code>isOpaque</code>: å®ƒä¸å½±å“å¯è§æ€§ï¼Œä½†å½±å“<strong>drawing system</strong><ul>
<li><code>opaque == true</code>çš„viewä¸å…·æœ‰é€æ˜åº¦ï¼Œå°†æ‹¥æœ‰æœ€é«˜çš„æ¸²æŸ“æ•ˆç‡</li>
</ul>
</li>
<li><code>frame = CGRect.zero</code>çš„viewä¹Ÿæ˜¯ä¸å¯è§çš„</li>
</ul>
<h2>Frame, Bounds and Center</h2>
<ul>
<li>å°±æ˜¯è§†å›¾åœ¨çˆ¶è§†å›¾ï¼ˆåæ ‡ç³»ï¼‰ä¸­çš„ä½ç½®å’Œå¤§å°ã€‚</li>
<li><code>sizeTofit</code>æ–¹æ³•æ¥é€‚åº”å†…å®¹çš„å¤§å°ã€‚</li>
<li><code>bound</code>åŸç‚¹è®¾ä¸º(10, 10)æ„æ€æ˜¯åæ ‡ç³»å¾€å·¦ä¸Šè§’ç§»äº†(10,10)çš„åƒç´ ï¼Œå³åŸæ¥çš„(10,10)ç°åœ¨åˆ°äº†åŸç‚¹ã€‚<ul>
<li><code>bounds.insetBy(dx:dy)</code>æ˜¯ä¿æŒä¸­å¿ƒä¸å˜ï¼ˆå³åŒæ—¶æ”¹å˜äº†åŸç‚¹å’Œå®½é«˜ï¼‰</li>
</ul>
</li>
<li><code>center</code>è¡¨ç¤ºçš„æ˜¯è§†å›¾åœ¨çˆ¶çº§ä¸­çš„ä½ç½®ï¼Œæ‰€ä»¥æ”¹å˜è‡ªå·±çš„boundså¹¶ä¸æ”¹å˜å®ƒçš„center<ul>
<li>æœ¬è´¨ä¸Š<code>frame</code>æ˜¯center+å®½åº¦çš„ä¾¿æ·æ–¹æ³•</li>
<li>å¦‚æœv2æ˜¯v1çš„å­è§†å›¾ï¼Œ<code>v2.center = v1.center</code> é€šå¸¸ä¸èƒ½ç”Ÿæ•ˆï¼Œå› ä¸ºå®ƒä»¬çš„åæ ‡ç³»ä¸åŒï¼ˆå„è‡ªçš„çˆ¶çº§ï¼‰</li>
</ul>
</li>
</ul>
<h2>Transform and Transform3D</h2>
<ul>
<li>Transformæ”¹å˜Viewçš„ç»˜åˆ¶ï¼Œä½†ä¸æ”¹å˜å®ƒçš„boundså’Œcenter.</li>
<li>value is a <code>CGAffineTransform</code>ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå˜æ¢çŸ©é˜µ</li>
<li>CGPoint, CGSize, and CGRect all have an <code>applying(_:)</code> method ç”¨æ¥è®¡ç®—åº”ç”¨Transformåçš„åæ ‡</li>
<li>3Dç‰ˆçš„å°±æ˜¯å¤šäº†ä¸€ä¸ªå‚ç›´äºå±å¹•çš„Zè½´</li>
</ul>
<h2>Window Coordinates and Screen Coordinates</h2>
<ul>
<li>The device screen has <code>no frame</code>, but it has bounds.</li>
<li>The window has <code>no superview</code>, but its frame is set automatically to match the screenâ€™s bounds.<ul>
<li>continues to fill the screen</li>
</ul>
</li>
</ul>
<p>iOS 7åŠä¹‹å‰ï¼Œå±å¹•çš„åæ ‡ç³»æ˜¯ä¸å˜çš„ï¼Œå¦‚æœæœ‰æ—‹è½¬ï¼Œåˆ™æ˜¯å¯¹root viewè¿›è¡Œäº†ä¸€æ¬¡rotationçš„transfromã€‚
ä½†åœ¨iOS 8ä¸å†ç”¨transformè€Œæ˜¯åˆ¶å®šäº†ä¸¤å¥—åæ ‡ç³»ï¼Œé€šè¿‡<code>UICoordinateSpace</code>åè®®è¡¨ç¤º
    * UIScreen's <code>coordinateSpace</code>: ä¼šæ—‹è½¬çš„bounds
    * UIScreen's <code>fixedCoordinateSpace</code>: ä¸å˜</p><p>è¯»å–è§†å›¾våœ¨è®¾å¤‡çš„å›ºå®šåæ ‡ç³»ä¸‹çš„ä½ç½®ï¼š</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">screen</span> <span class="p">=</span> <span class="bp">UIScreen</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">fixedCoordinateSpace</span>
<span class="kd">let</span> <span class="nv">r</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">superview</span><span class="p">!.</span><span class="n">convert</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="n">screen</span><span class="p">)</span>
</pre></div>
<h2>Trait Collections</h2>
<p>å°†viewçš„ä¸€ç³»åˆ—ç¯å¢ƒç‰¹å¾é€šè¿‡view hierarchyå±‚çº§ä¸‹ä¼ ï¼Œé€šè¿‡æœä»<code>UITraitEnvironment</code>åè®®ï¼ˆæä¾›<code>traitCollection</code>å±æ€§å’Œ<code>traitCollectionDidChange</code>æ–¹æ³•ï¼‰</p><p><strong>traitCollection</strong></p><ul>
<li><em>displayScale</em>: screen's resolution</li>
<li><em>userInterfaceIdiom</em>: general device type, iPhone, or ipad</li>
<li><em>interfaceStyle</em>: is in light/dark mode</li>
<li><em>userInterfaceLevel</em>: .base / .elevated -&gt; affects dynamic background colors</li>
</ul>
<blockquote>
<p>If you implement traitCollectionDidChange(_: ), <code>always call super in the first line</code>. Forgetting to do this is a common beginner mistake.</p></blockquote>
<p>è‡ªå®šä¹‰trait collectionåªèƒ½ç”¨ä¸‹é¢è¿™ç§â€œç»„åˆâ€çš„æ–¹å¼</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">tcdisp</span> <span class="p">=</span> <span class="bp">UITraitCollection</span><span class="p">(</span><span class="n">displayScale</span><span class="p">:</span> <span class="bp">UIScreen</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">scale</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">tcphone</span> <span class="p">=</span> <span class="bp">UITraitCollection</span><span class="p">(</span><span class="n">userInterfaceIdiom</span><span class="p">:</span> <span class="p">.</span><span class="n">phone</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">tc1</span> <span class="p">=</span> <span class="bp">UITraitCollection</span><span class="p">(</span><span class="n">traitsFrom</span><span class="p">:</span> <span class="p">[</span><span class="n">tcdisp</span><span class="p">,</span> <span class="n">tcphone</span><span class="p">])</span>  <span class="c1">// å–äº¤é›†</span>
</pre></div>
<p>è‡ªåŠ¨é¢œè‰²çš„åº•å±‚é€»è¾‘ï¼š</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">yellow</span> <span class="p">=</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">systemYellow</span>
<span class="kd">let</span> <span class="nv">light</span> <span class="p">=</span> <span class="bp">UITraitCollection</span><span class="p">(</span><span class="n">userInterfaceStyle</span><span class="p">:</span> <span class="p">.</span><span class="n">light</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">dark</span> <span class="p">=</span> <span class="bp">UITraitCollection</span><span class="p">(</span><span class="n">userInterfaceStyle</span><span class="p">:</span> <span class="p">.</span><span class="n">dark</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">yellowLight</span> <span class="p">=</span> <span class="n">yellow</span><span class="p">.</span><span class="n">resolvedColor</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">light</span><span class="p">)</span>
<span class="c1">// 1 0.8 0 1</span>
<span class="kd">let</span> <span class="nv">yellowDark</span> <span class="p">=</span> <span class="n">yellow</span><span class="p">.</span><span class="n">resolvedColor</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">dark</span><span class="p">)</span>
<span class="c1">// 1 0.839216 0.0392157 1</span>
</pre></div>
<h3>Size Classes</h3>
<p>æŠŠå±å¹•é’ˆå¯¹å®½é«˜å’Œæ¯”ä¾‹åšå‡ ä¸ªåˆ†ç±»ï¼š</p><ul>
<li>.regular(h, v) -&gt; iPad</li>
<li>.compact(h) + .regular(v) -&gt; ç«–å±iPhone</li>
<li>.regular(h) + .compact(v) -&gt; æ¨ªå±å¤§iPhone</li>
<li>.compact(h, v) -&gt; æ¨ªå±å°iPhoneï¼ˆ5Sä»¥å‰çš„ï¼‰</li>
</ul>
<p>æ‰€ä»¥, size class:</p><ul>
<li>å¹¶ä¸èƒ½ä»<code>traitCollectionDidChange</code>è·å¾—ï¼Œå› ä¸ºiPadæ°¸è¿œæ˜¯<code>.regular</code></li>
<li>åªå…³å¿ƒæ¨ªç«–å‘çªç„¶é—´.regularå’Œ.compactçš„åˆ‡æ¢</li>
</ul>
<p><strong>Overriding Trait Collections</strong></p><p>You cannot <code>insert</code> a trait collection directly into the inheritance hierarchy simply by setting a viewâ€™s trait collection;</p><p>For the user interface style, there is a simpler facility available both for a UIViewController and for a UIView: the <code>overrideUserInterfaceStyle</code> property. 
    * default <code>.unspecified</code>ï¼Œæ„å‘³ç€interface styleä¼šå¾€ä¸‹ä¼ 
    * ä¸€æ—¦è®¾ä¸º.darkæˆ–.light, å°±æ‹¦æˆªäº†<code>userInterfaceStyle</code>çš„ç»§æ‰¿</p><h2>Layout</h2>
<ul>
<li>Manual layout: <code>layoutSubviews</code>é‡Œæ‰‹åŠ¨æ‘†æ”¾æ¯ä¸ªè§†å›¾ï¼Œå¯å®šåˆ¶æœ€å¼º</li>
<li>Autoresizing: å­è§†å›¾æ ¹æ®<code>autoresizingMask</code>æ¥è°ƒæ•´</li>
<li>Autolayout: ä¾èµ–å¯¹â€œçº¦æŸâ€çš„æè¿°æ¥å¸ƒå±€ï¼ŒèƒŒåä»ç„¶æ˜¯<code>layoutSubviews</code><ul>
<li>éœ€è¦ç¦æ­¢autoresizing</li>
</ul>
</li>
</ul>
<h3>Autoresizing</h3>
<p>Autoresizing is a matter of conceptually assigning a subview â€œ<strong>springs and struts</strong>.â€ A spring can expand and contract; a strut canâ€™t. Springs and struts can be assigned internally or externally, horizontally or vertically.</p><p>å¯å˜çš„å°±å«Spring(æœ‰å¼¹æ€§)ï¼Œä¸å˜çš„å°±å«Strutï¼ˆä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘ï¼‰ã€‚</p><ul>
<li>ä¸€ä¸ªå±…ä¸­çš„å­è§†å›¾ï¼Œæœ¬èº«ä¹Ÿä¼šéšç€çˆ¶è§†å›¾è€Œæ”¹å˜å¤§å°:<ul>
<li>æ„å‘³ç€å®ƒä¸çˆ¶è§†å›¾çš„å››ä¸ªè¾¹è·æ˜¯ä¸å˜çš„ -&gt; 4ä¸ªå¤–éƒ¨å†³å®šçš„struts</li>
<li>å®½é«˜åˆ™æ˜¯å¯å˜çš„ -&gt; 2ä¸ªå†…éƒ¨å†³å®šçš„spring</li>
</ul>
</li>
<li>è€Œå¦‚æœå­è§†å›¾ä¸éšç¯å¢ƒæ”¹å˜å¤§å°ï¼š<ul>
<li>æ„æ€ç€å®½é«˜æ˜¯å›ºå®šçš„ -&gt; 2ä¸ªå†…éƒ¨å†³å®šçš„struts</li>
<li>è€Œå››ä¸ªè¾¹è·é€šé€šå¯å˜ -&gt; 4ä¸ªå¤–éƒ¨å†³å®šçš„spring</li>
</ul>
</li>
<li>ä¸€ä¸ªå³ä¸‹è§’æ‘†æ”¾çš„OK button<ul>
<li>æ˜¾ç„¶ï¼ŒæŒ‰é’®å¤§å°ä¸æ”¹å˜ -&gt; 2ä¸ªå†…éƒ¨struts</li>
<li>ä¸å³è¾¹å’Œåº•éƒ¨è·ç¦»ä¸å˜ -&gt; 2ä¸ªå¤–éƒ¨struts</li>
<li>ä¸é¡¶éƒ¨å’Œå·¦è¾¹è·ç¦»å¯å˜ -&gt; 2ä¸ªå¤–éƒ¨spring</li>
</ul>
</li>
<li>ä¸€ä¸ªé¡¶éƒ¨å æ»¡çš„text field<ul>
<li>é«˜åº¦ä¸å˜ -&gt; 1ä¸ªvertical strutsï¼ˆå†…éƒ¨ï¼‰</li>
<li>å®½åº¦å¯å˜ -&gt; 1ä¸ªhorizontal spring(å†…éƒ¨)</li>
<li>é¡¶ï¼Œå·¦ï¼Œå³ä¸‰è¾¹è·ç¦»ä¸å˜ -&gt; 3ä¸ªå¤–éƒ¨struts</li>
<li>åº•éƒ¨è·ç¦»å¯å˜ -&gt; 1ä¸ªå¤–éƒ¨spring</li>
</ul>
</li>
</ul>
<p>æ‰€è°“çš„â€œå†…éƒ¨â€ï¼Œæ˜¯å› ä¸ºæ•™æé‡Œç”¨çš„æ˜¯internallyï¼Œå°±ä¾‹å­æ¥çœ‹ï¼Œå…¶å®å°±æ˜¯è¯´è¡¡é‡çš„å¯¹è±¡åªæ˜¯è‡ªå·±ï¼Œè€Œâ€œè·ç¦»â€æ˜æ˜¾éœ€è¦æœ‰ä¸€ä¸ªå‚ç…§ç‰©ï¼Œé‚£å°±å«externallyäº†ã€‚</p><p>é€šè¿‡<code>autoresizingMask</code>æ¥æè¿°ä¸Šè¿°ä¾‹å­ä¸­çš„è§„åˆ™ï¼Œé€šè¿‡bitmaskæ¥è¿›è¡Œç»„åˆï¼Œé»˜è®¤ä¸ºå…¨ç©ºï¼ˆä½†æ˜¯ç­‰åŒäº<code>flexibleRightMargin</code>)ï¼Œå³æ™®é€šçš„æµå¼å¸ƒå±€ï¼Œé å·¦ä¸Šå¯¹é½ï¼Œå³è¾¹è·å’Œåº•è¾¹è·æ˜¯åŠ¨æ€çš„ã€‚</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">v1</span> <span class="p">=</span> <span class="bp">UIView</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span><span class="n">CGRect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">194</span><span class="p">))</span>
<span class="n">v1</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="bp">UIColor</span><span class="p">(</span><span class="n">red</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">v2</span> <span class="p">=</span> <span class="bp">UIView</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span><span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">v2</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="bp">UIColor</span><span class="p">(</span><span class="n">red</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">v1b</span> <span class="p">=</span> <span class="n">v1</span><span class="p">.</span><span class="n">bounds</span>
<span class="kd">let</span> <span class="nv">v3</span> <span class="p">=</span> <span class="bp">UIView</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span><span class="n">CGRect</span><span class="p">(</span><span class="n">v1b</span><span class="p">.</span><span class="n">width</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">v1b</span><span class="p">.</span><span class="n">height</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">v3</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="bp">UIColor</span><span class="p">(</span><span class="n">red</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
<span class="n">v1</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
<span class="n">v1</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
</pre></div>
<p>æ¼”ç¤ºäº†ä¸Šä¾‹ä¸­çš„&quot;text fiels&quot;å’Œâ€œok button&quot;ï¼Œä¸€ä¸ªç½®é¡¶ï¼Œä¸€ä¸ªé ä¸­ä¸‹ã€‚å¹¶ä¸”éƒ½è®¾ç½®äº†ç»å¯¹å¤§å°çš„å®½é«˜ï¼Œé‚£ä¹ˆå½“ä½ æ”¹å˜v1çš„frameçš„æ—¶å€™ï¼Œæ¯”å¦‚å˜å®½å˜é«˜ï¼Œv2,v3ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å› ä¸ºä½ æ²¡æœ‰è®¾ç½®autoresizingMaskï¼Œé‚£ä¹ˆå°±ä¼šé»˜è®¤ä¿æŒå·¦ä¸Šçš„è¾¹è·ï¼Œè¿™æ ·v2ä¸å†é“ºæ»¡é¡¶éƒ¨ï¼Œv3ä¹Ÿä¸å†ç´§è´´å³ä¸‹è§’ï¼Œæƒ³è¦å®ƒä»¬è·Ÿç€v1å˜åŒ–ï¼š</p><div class="highlight"><pre><span></span><span class="n">v2</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="p">=</span> <span class="p">.</span><span class="n">flexibleWidth</span>  <span class="c1">// å®½åº¦å¯å˜</span>
<span class="n">v3</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="p">=</span> <span class="p">[.</span><span class="n">flexibleTopMargin</span><span class="p">,</span> <span class="p">.</span><span class="n">flexibleLeftMargin</span><span class="p">]</span> <span class="c1">// å·¦ï¼Œé¡¶å¯å˜ï¼ˆè¿™æ ·å°±èƒ½å°½æƒ…å¾€å³ä¸‹è´´äº†ï¼‰</span>
</pre></div>
<blockquote>
<p>AutoResizingåœ¨<code>layoutSubviews</code>è¢«è°ƒç”¨ä¹‹å‰å‘ç”Ÿã€‚</p></blockquote>
<h3>Autolayout and Constraints</h3>
<p>autolayoutçš„å­viewå¯ä»¥ä¸ç”¨autolayoutï¼Œä½†æ˜¯çˆ¶viewå¿…é¡»æ˜¯autolayoutï¼Œå±‚å±‚å‘ä¸Šåˆ°<code>main view</code> of it's view controller, which <em>receives autolayout-related events</em></p><p>autolayoutæè¿°ä¸åŒviewçš„å±æ€§ä¹‹é—´çš„ä½ç½®å…³ç³»ï¼Œè¿™äº›viewä¸å¿…æ˜¯å…„å¼Ÿï¼Œä¹Ÿä¸éå¾—æ˜¯çˆ¶å­ï¼Œåªéœ€è¦ä¿è¯æ‹¥æœ‰ä¸€ä¸ªå…±åŒçš„ç¥–å…ˆã€‚</p><p>è°æŒæœ‰è¿™äº›çº¦æŸï¼Ÿ</p><ul>
<li>å¦‚æœæ˜¯çº¦æŸè‡ªèº«çš„å®½åº¦ï¼ˆç»å¯¹å€¼ï¼‰ -&gt; å±äºè‡ªèº«</li>
<li>å¦‚æœæ˜¯çº¦æŸäº†å®ƒå¯¹superviewçš„é¡¶éƒ¨çš„è·ç¦» -&gt; å±äºsuperview</li>
<li>å¦‚æœçº¦æŸäº†å‡ ä¸ªsibling viewçš„é¡¶éƒ¨å¯¹é½ -&gt; å±äºè¿™äº›viewçš„superview</li>
</ul>
<p>äº‹å®ä¸Šï¼ŒiOSä¸éœ€è¦ä½ å…³å¿ƒè¿™ä¸ªï¼Œ<code>.activate</code>è®©ä½ åªç®¡æè¿°çº¦æŸå’Œå…³ç³»ï¼Œç„¶åæŠŠå®ƒåŠ åˆ°æ­£ç¡®çš„viewä¸Šã€‚</p><p>çº¦æŸåŸºæœ¬ä¸Šæ˜¯å¯è¯»çš„ï¼Œé™¤äº†<code>priority</code>, <code>constant</code>, å’Œ <code>isActive</code>ï¼Œå…¶å®ƒæƒ…å†µä½ åªèƒ½ç§»é™¤å¹¶é‡å»ºäº†ã€‚ï¼ˆè¿˜æœ‰ä¸€ä¸ªè·Ÿçº¦æŸæ— å…³çš„<code>identifier</code>ï¼Œ debugæœ‰ç”¨ï¼‰</p><blockquote>
<p>autolayoutå‘ç”Ÿåœ¨<code>layoutSubviews</code>ï¼Œæ‰€ä»¥å¦‚æœä½ æå‰è®¾ç½®äº†frameï¼Œå›¾åƒå°†ä¼šå‘ç”Ÿè·³åŠ¨ã€‚å¦‚æœä½ æ˜¯åœ¨layoutSubviewsé‡Œé¢è®¾ç½®çš„å°±ä¸ä¼šã€‚å½“ç„¶ä½ æœ€å¥½çº¿ç”¨çº¦æŸã€‚</p></blockquote>
<p>å¦‚æœä½ çš„çº¦æŸæ¶‰åŠåˆ°äº†åˆ«çš„ä¹‹å‰å¹¶æ²¡ç”¨ä½¿ç”¨autolayoutçš„viewï¼Œ The autolayout engine takes care of this for you:</p><ul>
<li>it <code>reads</code> the viewâ€™s <em>frame</em></li>
<li>and <em>autoresizingMask</em> settings and <code>translates</code> them into implicit constraints</li>
</ul>
<p>æ¯”å¦‚ï¼š</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">lab1</span> <span class="p">=</span> <span class="bp">UILabel</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span><span class="n">CGRect</span><span class="p">(</span><span class="mi">270</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">22</span><span class="p">))</span>
<span class="n">lab1</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="p">=</span> <span class="p">[.</span><span class="n">flexibleLeftMargin</span><span class="p">,</span> <span class="p">.</span><span class="n">flexibleBottomMargin</span><span class="p">]</span>
<span class="n">lab1</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&quot;Hello&quot;</span>
<span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">lab1</span><span class="p">)</span>
</pre></div>
<p>ä¸€ä¸ªå³ä¸Šçš„labelï¼Œå¦‚æœä½ çš„å¦ä¸€ä¸ªviewç›¸å¯¹<em>lab1</em>æ¥è®¾ç½®autolayoutçš„çº¦æŸï¼Œé‚£ä¹ˆlab1å°†ä¼šè‡ªåŠ¨äº§ç”Ÿå¦‚ä¸‹å››ä¸ªçº¦æŸï¼š</p>
<pre><code>1. &lt;NSAutoresizingMaskLayoutConstraint H:[UILabel:'Hello']-(63)-|&gt;
2. &lt;NSAutoresizingMaskLayoutConstraint UILabel:'Hello'.minY == 20&gt;
3. &lt;NSAutoresizingMaskLayoutConstraint UILabel:'Hello'.width == 42&gt;
4. &lt;NSAutoresizingMaskLayoutConstraint UILabel:'Hello'.height == 22&gt;
</code></pre>
<p>è€Œä¸”çº¦æŸçš„å…·ä½“æ•°å€¼ä»¥å½“å‰è¿è¡Œè®¾å¤‡æ¥å®šçš„ï¼Œæ¯”å¦‚ä¸Šä¾‹æ˜¯iPhone8ï¼Œå±å¹•å®½åº¦æ˜¯375ï¼Œé‚£ä¹ˆï¼š</p><ul>
<li>origin(270, 28) èƒ½å¾—åˆ°minY = 20 -&gt; çº¦æŸ2</li>
<li>size(42, 22)èƒ½å¾—åˆ°height = 22, width = 42 -&gt; çº¦æŸ3ï¼Œ4</li>
<li>ç»“åˆå±å¹•å®½åº¦ï¼Œorigin, sizeï¼Œ å¾—åˆ°å³è¾¹è·ç¦»ï¼š(375 - 270 - 42 = 63) -&gt; çº¦æŸ1</li>
</ul>
<p>ä½†æ˜¯å¦‚æœåé¢è¿˜æœ‰åˆ«çš„çº¦æŸçš„è¯ï¼Œå¾ˆå®¹æ˜“åƒä¸‡å†²çªï¼Œæ¯•ç«Ÿéƒ½è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œç”¨æˆ·å†™ä»£ç çš„æ—¶å€™å¹¶ä¸ä¼šåœ¨æ„å½“æ—¶è‡ªåŠ¨ç”Ÿæˆçš„çº¦æŸåœ¨å…¶å®ƒåœºæ™¯æ˜¯å¦ä¹Ÿä¼šæœ‰åˆ«çš„çº¦æŸè‡ªåŠ¨ç”Ÿæˆ</p><p><code>translatesAutoresizingMaskIntoConstraints</code>å¹²çš„å°±æ˜¯è¿™ä¸ªï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æŠŠå®ƒå…³æ‰çš„ã€‚</p><p>è¯­æ³•ï¼š</p><div class="highlight"><pre><span></span><span class="n">v1</span><span class="p">.</span><span class="n">addConstraint</span><span class="p">(</span>
    <span class="bp">NSLayoutConstraint</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">v2</span><span class="p">,</span>
        <span class="n">attribute</span><span class="p">:</span> <span class="p">.</span><span class="n">leading</span><span class="p">,</span>
        <span class="n">relatedBy</span><span class="p">:</span> <span class="p">.</span><span class="bp">equal</span><span class="p">,</span>
        <span class="n">toItem</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span>
        <span class="n">attribute</span><span class="p">:</span> <span class="p">.</span><span class="n">leading</span><span class="p">,</span>
        <span class="n">multiplier</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>


<span class="c1">// compact notation</span>
<span class="bp">NSLayoutConstraint</span><span class="p">.</span><span class="n">activate</span><span class="p">([</span>
        <span class="n">lab2</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span>
            <span class="n">equalTo</span><span class="p">:</span> <span class="n">lab1</span><span class="p">.</span><span class="n">bottomAnchor</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">lab2</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span>
            <span class="n">equalTo</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="o">-</span><span class="mi">20</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>
<h3>VFL (Visual format notation)</h3>
<p><code>&quot;V:|-10-[v2(20)]&quot;</code>è¿™ä»£è¡¨v2çš„é¡¶éƒ¨è·ç¦»superview 10ä¸ªpoint,é«˜åº¦æ˜¯20ã€‚å¦‚æœæè¿°çš„æ˜¯æ°´å¹³æ–¹å‘çš„ï¼Œåˆ™æ˜¯<strong>H</strong>ï¼Œä½†Hæ˜¯é»˜è®¤çš„ï¼Œå¯ä»¥çœç•¥ã€‚åŒæ ·ï¼ŒHå¯¹åº”çš„æ‹¬å·é‡Œçš„æ•°å€¼ä¼šè¢«ç†è§£ä¸ºwidth.</p><p>v2æ˜¯viewçš„åå­—ï¼Œé€šå¸¸ä½ éœ€è¦å‡†å¤‡ä¸€ä¸ªå­—å…¸ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨<code>VFL</code>ä¸­ç”¨ç®€å•çš„æ–‡å­—å¯¹åº”ä»»ä½•viewäº†</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">d</span> <span class="p">=</span> <span class="p">[</span><span class="s">&quot;v2&quot;</span><span class="p">:</span><span class="n">v2</span><span class="p">,</span><span class="s">&quot;v3&quot;</span><span class="p">:</span><span class="n">v3</span><span class="p">]</span>
<span class="bp">NSLayoutConstraint</span><span class="p">.</span><span class="n">activate</span><span class="p">([</span>
    <span class="bp">NSLayoutConstraint</span><span class="p">.</span><span class="n">constraints</span><span class="p">(</span><span class="n">withVisualFormat</span><span class="p">:</span>
        <span class="s">&quot;H:|[v2]|&quot;</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">views</span><span class="p">:</span> <span class="n">d</span><span class="p">),</span>
    <span class="bp">NSLayoutConstraint</span><span class="p">.</span><span class="n">constraints</span><span class="p">(</span><span class="n">withVisualFormat</span><span class="p">:</span>
        <span class="s">&quot;V:|[v2(10)]&quot;</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">views</span><span class="p">:</span> <span class="n">d</span><span class="p">),</span>
    <span class="bp">NSLayoutConstraint</span><span class="p">.</span><span class="n">constraints</span><span class="p">(</span><span class="n">withVisualFormat</span><span class="p">:</span>
        <span class="s">&quot;H:[v3(20)]|&quot;</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">views</span><span class="p">:</span> <span class="n">d</span><span class="p">),</span>
    <span class="bp">NSLayoutConstraint</span><span class="p">.</span><span class="n">constraints</span><span class="p">(</span><span class="n">withVisualFormat</span><span class="p">:</span>
        <span class="s">&quot;V:[v3(20)]|&quot;</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">views</span><span class="p">:</span> <span class="n">d</span><span class="p">)</span>
<span class="p">].</span><span class="n">flatMap</span> <span class="p">{</span><span class="nv">$0</span><span class="p">})</span>
</pre></div>
<p>æ³¨æ„è¿™é‡Œçš„flatMapï¼Œå› ä¸º<code>constraints(withVisualFormat:)</code> è¿”çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€ŒæœŸæœ›æ˜¯ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥ç”¨mapæŠŠ$0å–äº†å‡ºæ¥ã€‚</p><p><code>&quot;[v1(&gt;=20@400,&lt;=30)]&quot;</code>ï¼Œ@åé¢æ¥çš„æ˜¯ä¼˜å…ˆçº§</p><h3>new features</h3>
<p>iOS 10å¼•å…¥çš„<code>anchorWithOffset(to:)</code>ï¼Œæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</p><p>å®ƒä¹Ÿæ˜¯åˆ›å»ºçš„ä¸€ä¸ªanchorï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åº”ç”¨<code>constrain(equalto:)</code>ä¹‹ç±»çš„æ–¹æ³•ï¼Œè€Œå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªdimensionï¼Œæ‰€ä»¥dimensionå½“ç„¶æ˜¯å¯ä»¥ç”¨æ¥æ¯”è¾ƒçš„ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘æœ‰ä¸€ä¸ªview(v1)ï¼Œæ‘†åœ¨å±å¹•ä¸Šé¢æŸä½ç½®ï¼Œç°åœ¨è¦æ‘†ä¸€ä¸ªview(v2)ï¼Œå¸Œæœ›å®ƒå‡ºç°åœ¨v1å’Œå±å¹•åº•éƒ¨ï¼ˆæˆ–v1çš„superviewï¼Œè®¾ä¸ºv0ï¼‰çš„ä¸­é—´ï¼ˆå³å‚ç›´å±…ä¸­ï¼‰ï¼Œæ˜¾ç„¶ï¼Œå¦‚æœè¦ç”¨dimensionæè¿°å‡ºæ¥çš„è¯ï¼Œé‚£å°±æ˜¯ï¼š</p><ul>
<li>v1åº•éƒ¨åˆ°v2ä¸­é—´çš„è·ç¦»</li>
<li>ç­‰äº</li>
<li>v2ä¸­éƒ¨åˆ°å±å¹•åº•éƒ¨v0åº•éƒ¨çš„è·ç¦»</li>
</ul>
<div class="highlight"><pre><span></span><span class="bp">NSLayoutConstraint</span><span class="p">.</span><span class="n">activate</span><span class="p">([</span>
    <span class="n">v1</span><span class="p">.</span><span class="n">bottomAnchor</span><span class="p">.</span><span class="n">anchorWithOffset</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="n">v2</span><span class="p">.</span><span class="n">centerYAnchor</span><span class="p">)</span>
        <span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> 
    <span class="n">v2</span><span class="p">.</span><span class="n">centerYAnchor</span><span class="p">.</span><span class="n">anchorWithOffset</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="n">view</span><span class="p">.</span><span class="n">bottomAnchor</span><span class="p">))</span>
<span class="p">])</span>
</pre></div>
<p>åˆ»æ„å†™æˆäº†ä¸‰è¡Œï¼Œä¸æˆ‘ä¸Šæ–‡çš„ä¸‰æ®µæ–‡å­—æè¿°å¯¹åº”</p><p>iOS 11å¼•å…¥äº†è¿è¡Œæ—¶å†³å®šçš„spacingï¼š</p>
<pre><code>constraint(equalToSystemSpacingAfter:multiplier:)
constraint(greaterThanOrEqualToSystemSpacingAfter:multiplier:)
constraint(lessThanOrEqualToSystemSpacingAfter:multiplier:)
constraint(equalToSystemSpacingBelow:multiplier:)
constraint(greaterThanOrEqualToSystemSpacingBelow:multiplier:)
constraint(lessThanOrEqualToSystemSpacingBelow:multiplier:)
</code></pre>
<h3>Margins and Guides</h3>
<ul>
<li>UIEdgeInsetsæ˜¯å¯¹å¸ƒå±€çš„è¡¥å……ï¼Œå¢åŠ â€œç¬¬äºŒæ¡è¾¹â€</li>
<li>Layout guides -&gt; æ²¡çœ‹æ˜ç™½</li>
<li>safe areaå¯ä»¥è¡¨ç¤ºä¸ºinsetï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºguides<ul>
<li><code>additionalSafeAreaInsets</code>è¿˜èƒ½å¢åŠ safe area</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">c</span> <span class="p">=</span> <span class="n">v1</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">v</span><span class="p">.</span><span class="n">safeAreaLayoutGuide</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">)</span>
</pre></div>
<p>subview might be positioned with respect to its superviewâ€™s <code>margins</code>, especially through an autolayout constraint. By <strong>default</strong>, a view has a margin of 8 on all four edges.
è¿™æ›´åƒæ˜¯superviewçš„paddingï¼Œè€ŒiOSå¹¶æ²¡æœ‰paddingçš„æ¦‚å¿µï¼ˆå› ä¸ºå®ƒå¹¶ä¸æ˜¯CSSçš„ç›’å­æ¨¡å‹ï¼‰</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">c</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">leadingAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">layoutMarginsGuide</span><span class="p">.</span><span class="n">leadingAnchor</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">arr</span> <span class="p">=</span> <span class="bp">NSLayoutConstraint</span><span class="p">.</span><span class="n">constraints</span><span class="p">(</span><span class="n">withVisualFormat</span><span class="p">:</span>
        <span class="s">&quot;H:|-[v]&quot;</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">views</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;v&quot;</span><span class="p">:</span><span class="n">v</span><span class="p">])</span>
</pre></div>
<ul>
<li><code>layoutMarginsGuide</code>æ˜¯åªè¯»çš„ï¼Œä½†UIViewæä¾›äº†<code>layoutMargins</code>å±æ€§ï¼ˆä¸€ä¸ªUIEdgeInsetsï¼‰<ul>
<li>from iOS11: <code>directionalLayoutMargins</code>(å…¶å®å°±æ˜¯ç”¨äº†trail, leadingç­‰)</li>
</ul>
</li>
<li>VFLä¸­ç”¨çŸ­æ¨ªçº¿æ¥ä»£è¡¨å¯¹é½çš„æ˜¯margin</li>
<li>marginä¼šå¾€ä¸‹ä¼ ï¼Œç”¨<code>preservesSuperviewLayoutMargins</code>æ§åˆ¶</li>
<li>marginä¸safeareaä¸å†²çªï¼Œä¼šè‡ªåŠ¨ç›¸åŠ ï¼Œç”¨<code>insetsLayoutMarginsFromSafeArea</code>å…³é—­</li>
<li>viewControlleræœ‰<code>systemMinimumLayoutMargins</code>å¯ä»¥å¢åŠ main viewçš„margin(å‡å°çš„è¯ä¼šé™é»˜å¤±è´¥ï¼Œå³æ— æ•ˆ)<ul>
<li>è€Œ<code>viewRespectsSystemMinimumLayoutMargins</code>è®¾ä¸ºfalseï¼Œå°±èƒ½çªç ´è¿™ä¸ªé™åˆ¶ï¼šï¼ˆä¸Šä¸‹ä¸º0ï¼Œå·¦å³ä¸º16ï¼Œå¤§å±è®¾å¤‡å·¦å³ä¸º20ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>Custom layout guides</strong></p><p>ä¹¦ä¸­çš„ä¾‹å­æ˜¯å‚ç›´å¹³å‡åˆ†é…å‡ ä¸ªviewï¼Œç„¶åå‘ç°æ˜¯æŠŠlayout guideå½“æˆä¸€ä¸ªviewæ¥åšçš„</p><ul>
<li>æ¯ä¸ªviewï¼ˆé™¤å»æœ€åä¸€ä¸ªï¼‰ addä¸€ä¸ªguide</li>
<li>ABABABAæ’åˆ—ï¼ŒAæ˜¯view,Bæ˜¯guide</li>
<li>Açš„åº•éƒ¨=Bçš„é¡¶éƒ¨ï¼ˆé™¤å»æœ€åä¸€ä¸ªAï¼‰</li>
<li>Açš„é¡¶éƒ¨=Bçš„åº•éƒ¨ï¼ˆé™¤å»ç¬¬ä¸€ä¸ªAï¼‰</li>
<li>ä»¤Bçš„é«˜åº¦ç›¸ç­‰</li>
</ul>
<p>å°±æŠŠ4ä¸ªAç»™å‚ç›´å¹³å‡åˆ†é…äº†ï¼Œç†è§£çš„éš¾ç‚¹å°±æ˜¯guideä¹Ÿå½“ä½œä¸€ä¸ªviewæ¥ç”¨ï¼Œè€Œè¯­æ³•ä¸Šåˆæ˜¯åŠ åˆ°viewçš„å±æ€§é‡Œçš„ã€‚åŒæ—¶ï¼Œåªè¦è®¾ç½®guideçš„é«˜åº¦ç›¸ç­‰ï¼Œå°±ä¼šè‡ªåŠ¨å ç”¨4ä¸ªViewä¹‹å¤–çš„æ‰€æœ‰ç©ºé—´å¹³å‡åˆ†é…ã€‚
<figure  style="flex: 78.66449511400651" ><img width="966" height="614" src="/archives/assets/2629afe5515d8fa7df75f83b138083fa.png" alt=""/></figure></p><p>è¿™ä¹ˆåšåªæ˜¯ä¸ºäº†æ¼”ç¤ºlayout guideï¼Œä½†æ˜¯è™½ç„¶ç†è§£äº†ï¼Œä¹Ÿä¸çŸ¥é“èƒ½ç”¨å®ƒæ¥å¹²å˜›ï¼Ÿå½“æˆä¸€ä¸ªéšå½¢çš„viewå»åšå¸ƒå±€ï¼Ÿ</p><p><strong>Constraint alignment</strong></p><p>é€šè¿‡è®¾ç½®viewçš„<code>alignmentRectInsets</code>ï¼Œå¯ä»¥æ”¹å˜constrainsè®¡ç®—çš„èµ·ç‚¹ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œåˆæ˜¯ä¸€ç§padding?</p><p>åŒæ ·çš„è¿˜æœ‰è‡ªå®šä¹‰baselineçš„<code>forFirstBaselineLayout and forLastBaselineLayout.</code></p><h3>Intrinsic Content Size</h3>
<p>button, label, imageç­‰ä¼šæ ¹æ®å†…å®¹å’Œé¢„è®¾æœ‰ä¸€ä¸ªinstrinsic content sizeï¼Œè€Œä¸”å¯ä»¥ç”¨æ¥<strong>éšå¼åœ°</strong>äº§ç”Ÿçº¦æŸï¼ˆ<code>NSContentSizeLayoutConstraint</code>ï¼‰</p><ul>
<li><code>contentHuggingPriority(for:)</code> æŸæ–¹å‘ä¸Šé˜»æ­¢æ‰©å¤§åˆ°æ¯”intrinsic sizeæ›´å¤§çš„ä¼˜å…ˆçº§ï¼Œé»˜è®¤250</li>
<li><code>contentCompressionResistancePriority(for:)</code>ï¼Œé˜»æ­¢ç¼©å°çš„ä¼˜å…ˆçº§ï¼Œé»˜è®¤750</li>
<li><code>invalidateIntrinsicContentSize</code>å°±åƒinvalidate a viewï¼Œä¼šè§¦å‘é‡æ–°è®¡ç®—size</li>
</ul>
<p><code>&quot;H:[lab1(&gt;=100)]-(&gt;=20)-[lab2(&gt;=100)]&quot;</code> è¿™ä¸¤ä¸ªlabelï¼Œåœ¨å±å¹•å˜å°æ—¶ï¼Œè°æœ€å…ˆç¼©åˆ°100ï¼Ÿ</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">p</span> <span class="p">=</span> <span class="n">lab2</span><span class="p">.</span><span class="n">contentCompressionResistancePriority</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">horizontal</span><span class="p">)</span>
<span class="n">lab1</span><span class="p">.</span><span class="n">setContentCompressionResistancePriority</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">horizontal</span><span class="p">)</span>
</pre></div>
<p>è¿™é‡ŒæŠŠlab1é˜»æ­¢ç¼©å°çš„ä¼˜å…ˆçº§è°ƒå¾—æ›´é«˜ï¼Œé‚£ä¹ˆå°±æ˜¯lab2ä¼šå…ˆç¼©å°</p><h3>Self-Sizing Views</h3>
<p>å‰é¢è®²çš„éƒ½æ˜¯superviewå¯¹subviewçš„å½±å“ï¼Œè¿™ä¸€èŠ‚åè¿‡æ¥ï¼Œsubviewçš„å¤§å°å½±å“superviewã€‚</p><p>å‡å®šä¸€ä¸ªæ²¡æœ‰è®¾ç½®å®½é«˜çš„viewï¼ŒåŒ…å«äº†ä¸€ä¸ªbuttonï¼Œæˆ‘ä»¬çŸ¥é“buttonæ˜¯æœ‰å…¶intrinsic sizeçš„ï¼ˆå›ºå®šçš„é«˜ï¼Œå®½åº¦ç”±æŒ‰é’®æ–‡å­—å†³å®šï¼‰ï¼Œ</p><ul>
<li>æ‰€ä»¥è¿™ä¸ªviewä¹Ÿå°±æœ‰äº†å®½é«˜ã€‚</li>
<li>ä½†è¿™ä¸ªå®½é«˜æ‹¥æœ‰ä½ä¼˜å…ˆçº§ï¼Œä¸ä¼šä¸æ˜¾å¼è®¾å®šçš„å®½é«˜ç›¸å†²çªã€‚</li>
<li>è¿è¡Œæ—¶è°ƒç”¨<code>systemLayoutSizeFitting(_:)</code>å¯ä»¥è®©ç³»ç»Ÿä¼˜ä¼˜å…ˆçº§åœ°å»æŒ‰è¿™ä¸ªsizeå»layoutã€‚è¿™ä¸ªæ“ä½œæ˜¯æ˜‚è´µå’Œä½æ•ˆçš„ã€‚</li>
</ul>
<h3>Stack Views</h3>
<p>UIStackViewä»ç„¶æ˜¯è‡ªåŠ¨å¸ƒå±€ä½“ç³»é‡Œçš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼ˆä¸ºå…¶<code>arrangedSubviews</code>ï¼‰ç”Ÿæˆä¸€ç³»åˆ—çº¦æŸï¼Œå¯ä»¥ç†è§£ä¸ºè¯­æ³•ç³–ã€‚</p><ul>
<li><code>arrangedSubviews</code>æ˜¯<strong>subViews</strong>çš„ä¸€ä¸ªå­é›†</li>
<li>stackViewä¹Ÿå¯ä»¥æ·»åŠ é¢å¤–çš„subView</li>
<li><em>setCustomSpacing(_:after:)</em>è®¾ç½®é¢å¤–çš„space</li>
<li>ä¸è¦å†å¯¹arrangedSubviewsæ‰‹åŠ¨æ·»åŠ çº¦æŸï¼ŒåŸºæœ¬ä¼šä¸ä½ çœ‹ä¸è§çš„è®¡ç®—å‡ºæ¥çš„çº¦æŸå†²çª<ul>
<li>ä½†stackviewæœ¬èº«æ˜¯å¯ä»¥ç”¨autolayoutæ¥å¸ƒå±€çš„</li>
</ul>
</li>
</ul>
<p>æ­¤æ—¶å†æ¥çœ‹çœ‹å‰é¢çš„ç«–å‘æ’åˆ—å…ƒç´ ï¼Œå¹¶ä¸”é—´éš”ç›¸ç­‰çš„ä¾‹å­çš„å†™æ³•ï¼š</p><div class="highlight"><pre><span></span><span class="c1">// give the stack view arranged subviews</span>
<span class="kd">let</span> <span class="nv">sv</span> <span class="p">=</span> <span class="bp">UIStackView</span><span class="p">(</span><span class="n">arrangedSubviews</span><span class="p">:</span> <span class="n">views</span><span class="p">)</span>
<span class="c1">// configure the stack view</span>
<span class="n">sv</span><span class="p">.</span><span class="n">axis</span> <span class="p">=</span> <span class="p">.</span><span class="n">vertical</span>
<span class="n">sv</span><span class="p">.</span><span class="n">alignment</span> <span class="p">=</span> <span class="p">.</span><span class="n">fill</span>
<span class="n">sv</span><span class="p">.</span><span class="n">distribution</span> <span class="p">=</span> <span class="p">.</span><span class="n">equalSpacing</span>
<span class="c1">// constrain the stack view</span>
<span class="n">sv</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="p">=</span> <span class="kc">false</span>
<span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">sv</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">marg</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">layoutMarginsGuide</span>
<span class="kd">let</span> <span class="nv">safe</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">safeAreaLayoutGuide</span>
<span class="bp">NSLayoutConstraint</span><span class="p">.</span><span class="n">activate</span><span class="p">([</span>
    <span class="n">sv</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span><span class="n">safe</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">),</span>
    <span class="n">sv</span><span class="p">.</span><span class="n">leadingAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span><span class="n">marg</span><span class="p">.</span><span class="n">leadingAnchor</span><span class="p">),</span>
    <span class="n">sv</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span><span class="n">marg</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="p">),</span>
    <span class="n">sv</span><span class="p">.</span><span class="n">bottomAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span><span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bottomAnchor</span><span class="p">),</span>
<span class="p">])</span>
</pre></div>
<p>é¡ºä¾¿æ³¨æ„ä»¥ä¸‹é‡Œå¯¹layoutMarginå’Œsafeareaçš„å¼•ç”¨ï¼Œéƒ½æ˜¯é€šè¿‡layout guideçš„ã€‚</p><blockquote>
<p>debugä¼šå‘ç°stack viewå…¶å®å¸®ä½ åšäº†ä½ ä¹‹å‰åšçš„äº‹ï¼š<code>generating UILayoutGuide objects and using them as spacers</code></p></blockquote>
<p>stack viewè¿˜æœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯èƒ½è‡ªé€‚åº”<code>arrangedSubviews</code>çš„å˜åŒ–ã€‚å¦‚æœä½ æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªè®¡ç®—å¼•æ“ï¼Œå¯èƒ½å°±å¥½ç†è§£äº†ã€‚</p><h3>Internationalization</h3>
<p>ä½¿ç”¨.leading, .trailingç­‰æ˜¯ä¸ºäº†é€‚åº”ä¸åŒè¯­è¨€çš„å·¦å³é¡ºåºï¼Œå¼•å…¥åˆ°å¸ƒå±€é‡Œå´ä¼šå‡ºç°é—®é¢˜ï¼Œå¹¶ä¸æ˜¯ä»å³åˆ°å·¦çš„è¯­è¨€çš„æ¨ªå‘å¸ƒå±€å°±ä¹Ÿè¦ç›¸åº”åè½¬ã€‚UIView.semanticContentAttributeå¯ä»¥äººä¸ºæ§åˆ¶ï¼Œ</p><ul>
<li>é»˜è®¤å€¼æ˜¯.unspecifiedï¼Œ</li>
<li>.playback or .spatialå°†ä¼šä¸åº”ç”¨ç¿»è½¬ã€‚</li>
<li>.forceLeftToRight or .forceRightToLeftåˆ™æ˜¯æ‰‹åŠ¨æŒ‡å®šä¸€ä¸ªæ–¹å‘</li>
</ul>
<p>UIView<code>.effectiveUserInterfaceLayoutDirection</code>èƒ½reportå‡ºè¿™ä¸ªtrait</p><blockquote>
<p>You can test your appâ€™s right-to-left behavior easily by changing the schemeâ€™s Run option Application Language to â€œRight to Left Pseudolanguage.â€</p></blockquote>
<h3>Debug autolayout</h3>

<pre><code>(lldb) e -l objc -- [[UIApplication sharedApplication] windows][0]
(UIWindow *) $1 = ...
(lldb) e -l objc -O -- [$1 _autolayoutTrace]
</code></pre>
<p>To get a full list of the constraints responsible for positioning a particular view within its superview, log the results of calling the UIView instance method <code>constraintsAffectingLayout(for:)</code>.</p><h2>Configuring Layout in Nib</h2>
<p>è¿™ä¸€éƒ¨åˆ†å†…å®¹å»ºè®®æ‰“å¼€Xcodeå¯¹ç€åŸæ–‡æ“ä½œï¼Œå¤šä¸ºç•Œé¢æ“ä½œ</p><h3>Conditional Interface Design</h3>
<p>wC, HRç­‰ç”¨æ¥è¡¨ç¤ºå®½é«˜åœ¨æ­£å¸¸å’Œå‹ç¼©ç©ºé—´é‡Œçš„ä¸åŒç»„åˆã€‚</p><p>æ€è·¯ï¼šå…ˆæ¶æ„é€šç”¨çš„è§†å›¾å’Œçº¦æŸï¼Œç„¶åç”¨ä¸¤ç§æ–¹æ³•ä¹‹ä¸€æ¥æè¿°ä¸åŒsize classä¸‹çš„ç‰¹æ®Šå¸ƒå±€ï¼š</p><ul>
<li>in the Attributes or Size inspector</li>
<li>design that difference in the canvas:</li>
</ul>
<h2>Xcode View Features</h2>
<h3>Designable Views and Inspectable Properties</h3>
<p>æœ‰å…³Xcodeçš„é¢„è§ˆè¿™ä¸€èŠ‚å¯ä»¥çœ‹çœ‹ï¼Œä»¥åŠ<code>@IBDesignable</code>æ–¹æ³•èƒ½åœ¨xibé‡Œé¢å‘ˆç°ï¼ˆæ•™ç¨‹é‡Œæ˜¯åœ¨<code>willMove(toSuperview)</code>æ–¹æ³•é‡Œè°ƒç”¨ï¼‰</p><h2>Layout Events</h2>
<p><strong>updateConstraints</strong></p><ul>
<li>ï¼ˆå‘ä¸Šå†’æ³¡ï¼‰<code>propagated up</code> the hierarchy, starting at the deepest subview</li>
<li>called at launch timeï¼Œç„¶åå‡ ä¹ä¸ä¼šè°ƒç”¨ï¼Œé™¤éæ‰‹åŠ¨</li>
<li>ä¹Ÿä»ä¸ç›´æ¥è°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡<ul>
<li><code>updateConstraintsIfNeeded</code>æ–¹æ³•</li>
<li>æˆ–æ˜¯<code>setNeedsUpdateConstraints</code></li>
</ul>
</li>
</ul>
<p><strong>traitCollectionDidChange(_:)</strong></p><ul>
<li>(å‘ä¸‹ä¼ æ’­)<code>propagated down</code> the hierarchy of UITraitEnvironments.</li>
</ul>
<p><strong>layoutSubviews</strong></p><ul>
<li>The layoutSubviews message is the moment when <code>layout actually takes place</code>.</li>
<li>ï¼ˆå‘ä¸‹ä¼ æ’­ï¼‰ <code>propagated down</code> the hierarchy, starting at the top (typically the root view) and working down to the deepest subview.</li>
<li>If youâ€™re not using autolayout, layoutSubviews does <strong>nothing</strong> by default</li>
<li>layoutSubviews is your opportunity to perform manual layout <strong>after</strong> autoresizing has taken place.</li>
<li>If you are using autolayout, you <strong>must</strong> call super or the app will crash (with a helpful error message).</li>
<li>ä»ä¸ç›´æ¥è°ƒç”¨ï¼š<ul>
<li><code>layoutIfNeeded</code></li>
<li><code>setNeedsLayout</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>When youâ€™re using autolayout, <code>what happens in layoutSubviews</code>?</p><ol>
<li>The runtime, having examined and resolved all the constraints affecting this viewâ€™s subviews,</li>
<li>and having worked out values for their center and bounds,</li>
<li>now simply assigns <code>center</code> and <code>bounds</code> values to them.</li>
</ol>
<p>In other words, layoutSubviews performs <strong>manual layout</strong>!</p></blockquote>
<p>æ‰€ä»¥å¦‚æœä½ éœ€è¦åœ¨auto layoutä¹‹åå¾®è°ƒï¼Œ<code>layoutSubviews</code>æ˜¯æ³•å®šçš„å…¥å£ï¼š</p><ol>
<li>call <code>super</code>, causing all the subviews to adopt their new frames</li>
<li>examine those frames, å¦‚æœä¸æ»¡æ„ï¼Œåˆ™å¯¹<code>frame</code>è¿›è¡Œå¾®è°ƒï¼ˆæˆ–è€…<code>bounds</code>å’Œ<code>center</code>ï¼‰</li>
</ol>
<p>è¿™ä¹Ÿæ˜¯autolayout engineè‡ªå·±çš„æ­¥éª¤ï¼Œè¦æ³¨æ„çš„æ˜¯ä½ å¿…é¡»è¦å’Œautolayout engineæ¥åä½œï¼Œå¹¶ä¸”<strong>ä¸è¦</strong>è°ƒç”¨<code>setNeedsUpdateConstraints</code>(æ—¶æœºå·²è¿‡)</p></div>
        
        <div class="prism-action-bar">
            <div class="comment-action action-item"><a class="no-link text-uppercase" href="/archives/View/#prism__comment" target="_self"><i class="fa fa-comment"></i>Comment</a></div>
        </div>
        
    </article>
    
</section>

<div class="container">
    <section id="prism__page__pagination" class="prism-pagination" class="col-md-8 offset-md-2">
        <ul>
            
            <li class="next text-muted">
                <span title="Viewing the first page."><i class="fa fa-chevron-left" aria-hidden="true"></i>Newer</span>
            </li>
            
            
            <li class="prev">
                <a class="no-link" href="/page/2/" target="_self">Older<i class="fa fa-chevron-right" aria-hidden="true"></i></a>
            </li>
            
        </ul>
    </section>
</div>


</main>

            <footer id="prism__footer">
                <section>
                    <div>
                        <nav class="social-links">
                            <ul><li><a class="no-link" title="Twitter" href="https://twitter.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-twitter"></i></a></li><li><a class="no-link" title="GitHub" href="https://github.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-github"></i></a></li><li><a class="no-link" title="Weibo" href="https://weibo.com/1071696872" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-weibo"></i></a></li></ul>
                        </nav>
                    </div>

                    <section id="prism__external_links">
                        <ul>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://github.com/AlanDecode/Maverick" rel="noopener noreferrer nofollow">Maverick</a>ï¼šğŸ„â€ Go My Own Way.
                                <span>|</span>
                            </li>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://www.imalan.cn" rel="noopener noreferrer nofollow">Triple NULL</a>ï¼šHome page for AlanDecode.
                                <span>|</span>
                            </li>
                            
                        </ul>
                    </section>

                    <div class="copyright">
                        <p class="copyright-text">
                            <span class="brand">walker's code blog</span>
                            <span>Copyright Â© 2022 walker</span>
                        </p>
                        <p class="copyright-text powered-by">
                            | Powered by <a href="https://github.com/AlanDecode/Maverick" class="no-link" target="_blank" rel="noopener noreferrer nofollow">Maverick</a> | Theme <a href="https://github.com/Reedo0910/Maverick-Theme-Prism" target="_blank" class="no-link" rel="noopener noreferrer nofollow">Prism</a>
                        </p>
                    </div>
                    <div class="footer-addon">
                        
                    </div>
                </section>
                <script>
                    var site_build_date = "2019-12-06T12:00+08:00"

                </script>
                <script src="/assets/prism-efa8685153.js"></script>
            </footer>
        </div>
    </div>
    </div>

    <script src="/assets/ExSearch/jquery.min.js"></script>
    <script src="/assets/ExSearch/ExSearch-493cb9cd89.js"></script>

    <!--katex-->
    <link rel="stylesheet" href="/assets/katex.min.css">
    <script defer src="/assets/katex.min.js"></script>
    <script>
        mathOpts = {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false }
            ]
        };

    </script>
    <script defer src="/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
</body>

</html>