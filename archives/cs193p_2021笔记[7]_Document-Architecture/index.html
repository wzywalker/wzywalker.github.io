<!DOCTYPE HTML>
<html lang="english">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,AlanDecode,Galileo,blog" />
    <meta name="generator" content="Maverick 1.2.1" />
    <meta name="template" content="Prism" />
    <link rel="alternate" type="application/rss+xml" title="walker's code blog &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="walker's code blog &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-b9d78ff38a.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-182e5a8869.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/e83a979bdfe76b3eb88998ea61cf43ad.json"
        }

    </script>
    
<title>cs193p_2021ç¬”è®°[7]_Document-Architecture - walker's code blog</title>
<meta name="author" content="walker" />
<meta name="description" content="cs193p_2021_ç¬”è®°_1" />
<meta property="og:title" content="cs193p_2021ç¬”è®°[7]_Document-Architecture - walker's code blog" />
<meta property="og:description" content="cs193p_2021_ç¬”è®°_1" />
<meta property="og:site_name" content="walker's code blog" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/cs193p_2021%E7%AC%94%E8%AE%B0%5B7%5D_Document-Architecture/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2021-10-24T06:00:00-00.00" />
<meta name="twitter:title" content="cs193p_2021ç¬”è®°[7]_Document-Architecture - walker's code blog" />
<meta name="twitter:description" content="cs193p_2021_ç¬”è®°_1" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
</head>

<body>
    <div class="container prism-container">
        <header class="prism-header" id="prism__header">
            <h1 class="text-uppercase brand"><a class="no-link" href="/" target="_self">walker's code blog</a></h1>
            <p>coder, reader</p>
            <nav class="prism-nav"><ul><li><a class="no-link text-uppercase " href="/" target="_self">Home</a></li><li><a class="no-link text-uppercase " href="/archives/" target="_self">Archives</a></li><li><a class="no-link text-uppercase " href="/about/" target="_self">About</a></li><li><a href="#" target="_self" class="search-form-input no-link text-uppercase">Search</a></li></ul></nav>
        </header>
        <div class="prism-wrapper" id="prism__wrapper">
            
<main>
    <section class="prism-section row" id="prism__content">
        <article class="yue col-md-8 offset-md-2">
            <h1 class="prism-post-title">cs193p_2021ç¬”è®°[7]_Document-Architecture</h1>
            <div class="prism-post-time">
                <time class="text-uppercase">
                    October 24 2021
                </time>
            </div>
            <div class="prism-content-body">
                <p><a href="https://www.jianshu.com/p/998b0ef4a2cd">cs193p_2021_ç¬”è®°_1</a>
<a href="https://www.jianshu.com/p/af0ad1bead34">cs193p_2021_ç¬”è®°_2</a>
<a href="https://www.jianshu.com/p/d103f8d12052">cs193p_2021_ç¬”è®°_3_Animation_Transition</a>
<a href="https://www.jianshu.com/p/41e7309c7f55">cs193p_2021_ç¬”è®°_4_Color_Image_Gesture</a>
<a href="https://www.jianshu.com/p/e3c2ee1628c6">cs193p_2021_ç¬”è®°_5_Property Wrapper</a>
<a href="https://www.jianshu.com/p/a315274a4fd2">cs193p_2021_ç¬”è®°_6_Persistence</a>
cs193p_2021_ç¬”è®°_7_Document Architecture
<a href="https://www.jianshu.com/p/2136bdc2c6f6">cs193p_2021_ç¬”è®°_8</a></p><h1>Document Architecture</h1>
<p>æ‰€è°“çš„Dopcument Architectureï¼Œå…¶å®å°±æ˜¯æ”¯æŒæŠŠç”¨appäº§ç”Ÿçš„ä½œå“ä¿å­˜èµ·æ¥ï¼Œæ¯”å¦‚ä½ åˆ›ä½œçš„ä¸€å¹…å›¾ç‰‡ï¼Œå¯ä»¥ä¿å­˜ä¸º<code>.jpg</code>ï¼Œä½ ç”¨photoshopåšçš„æ–‡ä»¶æ˜¯<code>.psd</code>ï¼Œä¸‹æ¬¡ç”¨è‡ªå·±çš„appåŠ è½½è¿™ä¸ªæ–‡ä»¶ï¼Œèƒ½è®¤å‡ºæ‰€æœ‰ç»„ä»¶å’Œæ¨¡å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³ä¸ºdocumentå–ä¸ªåå­—å«<code>.emojiart</code>ã€‚</p><h2>App Architecture</h2>
<h3>App protocol</h3>
<ul>
<li>ä¸€ä¸ªappé‡Œåªèƒ½æœ‰ä¸€ä¸ªstructæœä»<code>App Protocol</code></li>
<li>mark it with <code>@main</code></li>
<li>it's <code>var body</code> is <code>some Scene</code></li>
</ul>
<h3>Scene protocol</h3>
<ul>
<li>A <code>Scene</code> is a container fo a <code>top-lever</code> View that you want to show in your UI</li>
<li><code>@Environment(\.scenePhase)</code></li>
<li>three main types of Scenes:</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">WindowGroup</span> <span class="p">{</span><span class="k">return</span> <span class="n">aTopLevelView</span><span class="p">}</span>
<span class="n">DocumentGroup</span><span class="p">(</span><span class="n">newDocument</span><span class="p">:)</span> <span class="p">{</span> <span class="n">config</span> <span class="k">in</span> <span class="p">...</span> <span class="k">return</span> <span class="n">aTopLevelView</span><span class="p">}</span>
<span class="n">DocumentGroup</span><span class="p">(</span><span class="n">viewing</span><span class="p">:</span> <span class="n">viewer</span><span class="p">:)</span> <span class="p">{</span> <span class="n">config</span> <span class="k">in</span> <span class="p">...</span> <span class="k">return</span> <span class="n">aTopLevelView</span><span class="p">}</span>  <span class="c1">// åªè¯»</span>
</pre></div>
<ul>
<li>åä¸¤ä¸ªç±»ä¼¼viewé‡Œé¢çš„<code>ForEach</code>ä½†ä¸å®Œå…¨ç›¸åŒï¼š<ul>
<li>è€Œæ˜¯ï¼š&quot;<strong>new window</strong>&quot; on Mac, &quot;<strong>splitting the screen</strong>&quot; on iPad -&gt; for create new Scene</li>
</ul>
</li>
<li><code>content</code>å‚æ•°æ˜¯ä¸€ä¸ªè¿”å›some Viewçš„æ–¹æ³•<ul>
<li>è¿”å›çš„æ˜¯top-level view</li>
<li>æ¯å½“æ–°å»ºä¸€ä¸ªçª—å£æˆ–çª—å£è¢«åˆ†å‰²æ—¶éƒ½ä¼šè¢«è°ƒç”¨</li>
</ul>
</li>
</ul>
<p>å½“ä½ åœ¨iPadä¸Šåˆ†å±ï¼Œä¸”ä¸¤ä¸ªæ‰“å¼€åŒä¸€åº”ç”¨ï¼Œå°±æ˜¯<code>WindowGroup</code>åœ¨ç®¡ç†ï¼Œä¸ºæ¯ä¸€ä¸ªwindowsç”Ÿæˆä¸€ä¸ªScene(share the same parameter e.g. view model, å› ä¸ºä»£ç æ˜¯åŒä¸€ä»½ï¼Œé™¤éé¢å¤–ä¸ºæ¯ä¸ªsceneè®¾ç½®è‡ªå·±çš„viewmodelä¹‹ç±»çš„).</p><p><code>config</code>é‡Œä¿å­˜äº†document(å³viewModel)ï¼Œä¹Ÿä¿å­˜äº†æ–‡ä»¶ä½ç½®ã€‚</p><h3>SceneStorage</h3>
<ul>
<li>èƒ½æŒä¹…åŒ–æ•°æ®</li>
<li>ä»¥çª—å£/åˆ†å±ä¸ºå•ä½ -&gt; per-Scene basis</li>
<li>ä¹Ÿä¼šinvalidate view</li>
<li>æ•°æ®ç±»å‹æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œæœ€é€šç”¨çš„æ˜¯<code>RawRepresentable</code></li>
</ul>
<p>[å›¾ç‰‡ä¸Šä¼ å¤±è´¥...(image-66d359-1636448439942)]</p><p>ä¸€ä¸ªViewé‡Œçš„<code>@State</code>æ”¹ä¸º<code>@SceneStorage(uniq_id)</code>åï¼Œappé€€å‡ºæˆ–crashäº†ï¼Œä»ç„¶èƒ½æ‰¾å›åŸæ¥çš„å€¼ã€‚</p><p>è¿™ä¸ªæ—¶å€™æ¯ä¸ªSceneé‡Œçš„å€¼å°±å·²ç»ä¸ä¸€æ ·äº†ã€‚</p><h3>AppStorage</h3>
<ul>
<li>application-wide basis</li>
<li>å­˜åœ¨UserDefaultsé‡Œ</li>
<li>æœä»<code>@SceneStorage</code>çš„æ•°æ®æ‰èƒ½è¢«å­˜å‚¨</li>
<li>invalidate view</li>
</ul>
<h2>DocumentGroup</h2>
<p><code>DocumentGroup</code> is the document-oriented Scene-building Scene.</p><div class="highlight"><pre><span></span><span class="p">@</span><span class="n">main</span>
<span class="kd">struct</span> <span class="nc">MyDemoApp</span><span class="p">:</span> <span class="n">App</span> <span class="p">{</span>
    <span class="p">@</span><span class="n">StateObject</span> <span class="kd">var</span> <span class="nv">paletteStore</span> <span class="p">=</span> <span class="n">PaletteStore</span><span class="p">(</span><span class="n">named</span><span class="p">:</span> <span class="s">&quot;Default&quot;</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">Scene</span> <span class="p">{</span>
        <span class="n">WindowGroup</span> <span class="p">{</span>
            <span class="n">MyDemoView</span><span class="p">()</span>
            <span class="p">.</span><span class="n">environmentObject</span><span class="p">(</span><span class="n">paletteStore</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// V.S.</span>

<span class="kd">struct</span> <span class="nc">MyDemoApp</span><span class="p">:</span> <span class="n">App</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">Scene</span> <span class="p">{</span>
        <span class="n">DocumentGroup</span><span class="p">(</span><span class="n">newDocument</span><span class="p">:</span> <span class="p">{</span><span class="n">myDocument</span><span class="p">()})</span> <span class="p">{</span> <span class="n">config</span> <span class="k">in</span>
            <span class="n">MyDemoView</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">config</span><span class="p">.</span><span class="n">document</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>ä¸å†ç”¨<code>@StateObject</code>ä¼ é€’ViewModelï¼Œæ¯æ–°å»ºä¸€ä¸ªDocumentéƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ViewModel<ul>
<li>å¿…é¡»è¦æœä»<code>ReferenceFileDocument</code>(è¿™æ ·èƒ½å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿä»¥åŠä»æ–‡ä»¶ç³»ç»Ÿè¯»å–äº†)</li>
<li><code>config</code>å‚æ•°åŒ…å«äº†è¿™ä¸ªViewModelï¼ˆå°±æ˜¯document)ï¼Œä»¥åŠdocumentçš„url</li>
<li>å¾ˆå¥½ç†è§£ï¼Œæ¯ä¸€ä¸ªdocumentè‚¯å®šæœ‰è‡ªå·±çš„æ•°æ®ï¼ˆæƒ³è±¡ä¸€ä¸ªâ€œæœ€è¿‘æ‰“å¼€â€çš„åŠŸèƒ½ï¼Œæ¯ä¸€ä¸ªæ–‡æ¡£éƒ½æ˜¯ç‹¬ç«‹çš„ï¼‰</li>
</ul>
</li>
<li><code>newDocument</code>é‡Œè‡ªè¡Œæä¾›ä¸€ä¸ªæ–°å»ºdocumentçš„æ–¹æ³•</li>
<li>å°è£…äº†å…³è”çš„ï¼ˆé€‰æ‹©documentçš„ï¼‰UIå’Œè¡Œä¸º</li>
<li>you <strong>MUST</strong> implement <code>Undo</code> in your application</li>
</ul>
<p>å¦‚æœä¸å»å®ç°<code>Undo</code>ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŠŠmodelå­˜åˆ°documentæ–‡ä»¶é‡Œï¼š</p><ol>
<li>ä½ çš„ViewModelè¦èƒ½init itself from a <code>Binding&lt;Type&gt;</code><ul>
<li>å¦‚<code>config.$document</code></li>
</ul>
</li>
<li>ViewModelç”±ä¸€ä¸ª<code>ObservedObject</code>å˜æˆä¸€ä¸ª<code>StateObject</code><ul>
<li>è¿™æ¬¡å¿…é¡»æœä»<code>FileDocument</code></li>
</ul>
</li>
</ol>
<div class="highlight"><pre><span></span><span class="kd">struct</span> <span class="nc">MyDemoApp</span><span class="p">:</span> <span class="n">App</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">Scene</span> <span class="p">{</span>
        <span class="n">DocumentGroup</span><span class="p">(</span><span class="n">newDocument</span><span class="p">:</span> <span class="p">{</span><span class="n">myDocument</span><span class="p">()})</span> <span class="p">{</span> <span class="n">config</span> <span class="k">in</span>
            <span class="c1">// MyDemoView(document: config.document) // ä¹‹å‰çš„</span>
            <span class="n">MyDemoView</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">viewModel</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">config</span><span class="p">.</span><span class="err">$</span><span class="n">document</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>æŠŠ<code>newDocument: {myDocument()}</code>æ”¹ä¸º<code>viewer: myDocument.self</code>ï¼Œå°±æˆäº†ä¸€ä¸ªåªè¯»çš„modelï¼Œï¼ˆä½ ç”šè‡³ä¸éœ€è¦ä¼ å…¥å®ä¾‹ï¼‰ï¼Œå¦‚æœä½ è¦å¼€å‘çš„æ˜¯ä¸€ä¸ªæŸ¥çœ‹åˆ«äººæ–‡æ¡£çš„åº”ç”¨ï¼Œè¿™ä¸ªç‰¹æ€§å°±æ¯”è¾ƒæœ‰ç”¨äº†ã€‚</p><h3>FileDocument protocol</h3>
<p>This protocol gets/puts the contents of a document from/to a file. å³æä¾›ä½ çš„documentè¯»åˆ°æ–‡ä»¶ç³»ç»Ÿçš„èƒ½åŠ›ã€‚</p><div class="highlight"><pre><span></span><span class="c1">// create from a file</span>
<span class="kd">init</span><span class="p">(</span><span class="n">configuration</span><span class="p">:</span> <span class="n">ReadConfiguration</span><span class="p">)</span> <span class="kr">throws</span> <span class="p">{</span>
    <span class="k">if</span> <span class="kd">let</span> <span class="nv">data</span> <span class="p">=</span> <span class="n">configuration</span><span class="p">.</span><span class="n">file</span><span class="p">.</span><span class="n">regularFileContents</span> <span class="p">{</span>
        <span class="c1">// init yourself from data</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">CocoaError</span><span class="p">(.</span><span class="n">fileReadCorruptFile</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// write</span>
<span class="kd">func</span> <span class="nf">fileWrapper</span><span class="p">(</span><span class="n">configuration</span><span class="p">:</span> <span class="n">WriteConfiguration</span><span class="p">)</span> <span class="kr">throws</span> <span class="p">-&gt;</span> <span class="n">FileWrapper</span> <span class="p">{</span>
    <span class="n">FileWrapper</span><span class="p">(</span><span class="n">regularFileWithContents</span><span class="p">:</span> <span class="cm">/*my data*/</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<h3>ReferenceFileDocument</h3>
<ul>
<li>å‡ ä¹å’Œ<code>FileDocument</code>ä¸€è‡´</li>
<li>ç»§æ‰¿è‡ª<code>ObservableObject</code> -&gt; ViewModel only</li>
<li>å”¯ä¸€çš„åŒºåˆ«æ˜¯é€šè¿‡åå°çº¿ç¨‹çš„ä¸€ä¸ª<code>snapshot</code>æ¥å†™å…¥</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1">// å…ˆsnapshot</span>
<span class="kd">func</span> <span class="nf">snapshot</span><span class="p">(</span><span class="n">contentType</span><span class="p">:</span> <span class="bp">UTType</span><span class="p">)</span> <span class="kr">throws</span> <span class="p">-&gt;</span> <span class="n">Snapshot</span> <span class="p">{</span>
    <span class="k">return</span> <span class="c1">// my data or something</span>
<span class="p">}</span>
<span class="c1">// then write</span>
<span class="kd">func</span> <span class="nf">fileWrapper</span><span class="p">(</span><span class="n">snapshot</span><span class="p">:</span> <span class="n">Snapshot</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">WriteConfiguration</span><span class="p">)</span> <span class="kr">throws</span> <span class="p">-&gt;</span> <span class="n">FileWrapper</span> <span class="p">{</span>
    <span class="n">FileWrapper</span><span class="p">(</span><span class="n">regularFileWithContents</span><span class="p">:</span> <span class="cm">/* snapshpt converted to a Data */</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>æµç¨‹å¤§æ¦‚æ˜¯ï¼Œä½ çš„modelæœ‰å˜åŒ–ä¹‹åï¼Œä¼šå…ˆæ‰¾<code>snapshot</code>æ–¹æ³•åˆ›å»ºä¸€ä»½é•œåƒï¼Œç„¶åå†è¦æ±‚ä½ ç»™å‡ºä¸€ä¸ª<code>fileWrapper</code>æ¥å†™æ–‡ä»¶ã€‚</p><h3>è‡ªå®šä¹‰æ–‡ä»¶ç±»å‹</h3>
<p>å£°æ˜èƒ½æ‰“å¼€ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶ï¼Œé€šè¿‡ï¼šUTType(<code>Uniform Type Identifier</code>)</p><p>å¯ä»¥ç†è§£ä¸ºæ€ä¹ˆå®šä¹‰å¹¶æ³¨å†Œï¼ˆå…³è”ï¼‰è‡ªå·±çš„æ‰©å±•åï¼Œå°±åƒphotoshopå…³è”.psdä¸€æ ·ã€‚</p><ol>
<li>å£°æ˜(Info tab)ï¼Œè®¾ç½®<code>Exported/Imported Type Identifier</code>ï¼Œæ‰€ä»¥è¡¨é¢ä¸Šçš„æ‰©å±•åï¼Œå†…é‡Œè¿˜å¯¹åº”äº†ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä¸€èˆ¬ç”¨ååŸŸåçš„æ ¼å¼</li>
</ol>
<figure  style="flex: 322.98850574712645" ><img width="1124" height="174" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/6b64ff3f0d28f9e054f79ae65e4eada0.png" alt=""/></figure><ol start="2">
<li>å£°æ˜æ‹¥æœ‰æƒï¼Œç”¨çš„å°±æ˜¯ä¸Šä¸€æ­¥æ ‡è¯†ç¬¦ï¼Œè€Œä¸æ˜¯æ‰©å±•å</li>
</ol>
<figure  style="flex: 400.0" ><img width="1136" height="142" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/86264dc076782270e53b2ea22b2eb60f.png" alt=""/></figure><ol start="3">
<li>å‘ŠçŸ¥ç³»ç»Ÿèƒ½åœ¨<code>Files</code> appé‡Œæ‰“å¼€è¿™ç§æ–‡æ¡£<ul>
<li>info.plist &gt; Supports Document Browser &gt; YES</li>
</ul>
</li>
<li>ä»£ç é‡Œæ·»åŠ æšä¸¾ï¼š</li>
</ol>
<div class="highlight"><pre><span></span><span class="kd">extension</span> <span class="bp">UTType</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">let</span> <span class="nv">emojiart</span> <span class="p">=</span> <span class="bp">UTType</span><span class="p">(</span><span class="n">exportedAs</span><span class="p">:</span> <span class="s">&quot;edu.bla.bla.emojimart&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">static</span> <span class="kd">let</span> <span class="nv">readableContentTypes</span> <span class="p">=</span> <span class="p">[</span><span class="bp">UTType</span><span class="p">.</span><span class="n">emojiart</span><span class="p">]</span>
</pre></div>
<h2>Undo</h2>
<ul>
<li>use <code>ReferenceFileDocument</code> must implement Undo</li>
<li>è¿™ä¹Ÿæ˜¯SwiftUIèƒ½è‡ªåŠ¨ä¿å­˜çš„æ—¶é—´èŠ‚ç‚¹</li>
<li>by <code>UndoManager</code> -&gt; <code>@Environment(\.undoManager) var undoManager</code></li>
<li>and by register an <code>Undo</code> for it: <code>func registerUndo(withTarget: self, howToUndo: (target) -&gt; Void)</code></li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nf">undoablePerform</span><span class="p">(</span><span class="n">operation</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">with</span> <span class="n">undoManager</span><span class="p">:</span> <span class="n">UndoManager</span><span class="p">?,</span> <span class="n">doit</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">){</span>
    <span class="kd">let</span> <span class="nv">oldModel</span> <span class="p">=</span> <span class="n">model</span>
    <span class="n">doit</span><span class="p">()</span>
    <span class="n">undoManager</span><span class="p">?.</span><span class="n">registerUndo</span><span class="p">(</span><span class="n">withTarget</span><span class="p">:</span> <span class="kc">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">myself</span> <span class="k">in</span>
        <span class="n">myself</span><span class="p">.</span><span class="n">model</span> <span class="p">=</span> <span class="n">model</span>
    <span class="p">}</span>
    <span class="n">undoManager</span><span class="p">?.</span><span class="n">setActionName</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span> <span class="c1">// ç»™æ“ä½œä¸€ä¸ªåå­—ï¼Œå¦‚&quot;undo paste&quot;ï¼Œ éå¿…éœ€</span>
<span class="p">}</span>
</pre></div>
<p>ç”¨`undoablyPerform(with:){} åŒ…ä½çš„ä»»ä½•æ”¹å˜modelçš„æ“ä½œå°±éƒ½æ”¯æŒäº†undo</p><h2>Review</h2>
<p>å›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬æŠŠåº”ç”¨æ”¹é€ ä¸º<code>Document Architechture</code>çš„æ­¥éª¤ï¼š</p><ol>
<li>åº”ç”¨å…¥å£ï¼Œå°†<code>WindowGroup</code>æ”¹ä¸ºäº†<code>DocumentGroup</code>ï¼Œå¹¶ä¿®æ”¹äº†ç›¸åº”çš„ä¼ é€’documentçš„æ–¹å¼</li>
<li>å®ç°document(å³view model) comform to <code>ReferenceFileDocument</code><ul>
<li>å®ç°snapshot, write to file (<code>FileWrapper</code>), and read from file</li>
</ul>
</li>
<li>è‡ªå®šä¹‰ä¸€ä¸ªæ–‡ä»¶ç±»åˆ«ï¼ˆæ‰©å±•åï¼Œæ ‡è¯†ç¬¦ï¼Œå£°æ˜æ‹¥æœ‰è€…ç­‰ï¼‰</li>
<li>æ­¤æ—¶å¯åŠ¨åº”ç”¨ï¼Œå…¥å£UIå·²ç»æ˜¯æ–‡æ¡£é€‰æ‹©ç•Œé¢äº†ï¼Œæ‰€ä»¥æˆ‘è¯´å®ƒå°è£…äº†UIå’Œè¡Œä¸º<ul>
<li>ä½†æ­¤æ—¶ä¸å…·å¤‡ä¿å­˜çš„åŠŸèƒ½ï¼Œéœ€è¦è¿›ä¸€æ­¥å®ç°<code>Undo</code>'</li>
</ul>
</li>
<li>é€šè¿‡<code>undoManager</code>æŠŠæ”¹åŠ¨modelçš„è¡Œä¸ºéƒ½åŒ…è¿›å»å®ç°undo/redo<ul>
<li>æ­¤æ—¶documentå·²èƒ½è‡ªåŠ¨ä¿å­˜</li>
</ul>
</li>
<li>å¢åŠ toolbar, å®ç°æ‰‹åŠ¨undo/redo</li>
<li>é¡ºä¾¿æ³¨å†Œæ–‡æ¡£ç±»å‹ï¼Œä»¥ä¾¿åœ¨Filesåº”ç”¨å†…èƒ½ç”¨æœ¬appæ‰“å¼€<ul>
<li><code>Info.plist</code> &gt; <code>Supports Document Browser</code> &gt; YES</li>
</ul>
</li>
</ol>

            </div>
        </article>
        <div class="prism-post-meta col-md-8 offset-md-2">
    <span>walker</span>
    
    <span>/</span>
    <span>
        <a class="category no-link" href="/category/posts/" target="_self">
        posts
        </a>
    </span>
    
    
    <span>/</span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/cs193p/" target="_self">#cs193p</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/document/" target="_self">#document</a>
    </span>
    
    
    
    <span>/</span>
    <span class="leancloud_visitors" id="/archives/cs193p_2021%E7%AC%94%E8%AE%B0%5B7%5D_Document-Architecture/" data-flag-title="cs193p_2021ç¬”è®°[7]_Document-Architecture"><span class="leancloud-visitors-count"></span> Views</span>
    
</div>
    </section>

    
<section id="prism__pagination" class="prism-pagination" class="col-md-8 offset-md-2">
    <ul>
        
        <li class="next">
            <a class="no-link" href="/archives/cs193p_2021_%E7%AC%94%E8%AE%B0_%5B%E5%AE%8C%E7%BB%93%5D_pdf%E4%B8%8B%E8%BD%BD/" target="_self" title="cs193p_2021_ç¬”è®°_[å®Œç»“]_pdfä¸‹è½½"><i class="fa fa-chevron-left" aria-hidden="true"></i>Newer</a>
        </li>
        
        
        <li class="prev">
            <a class="no-link" href="/archives/cs193p_2021%E7%AC%94%E8%AE%B0%5B6%5D_Persistence/" target="_self" title="cs193p_2021ç¬”è®°[6]_Persistence">Older<i class="fa fa-chevron-right" aria-hidden="true"></i></a>
        </li>
        
    </ul>
</section>


    
    <script>
        var initValine = function() {
            new Valine({"enable": true, "el": "#vcomments", "appId": "7tP92LoqK2cggW61DvJmWBo0-gzGzoHsz", "appKey": "iQCtrtlr8eKrQllM03GMESMJ", "visitor": true, "recordIP": true});
        }

    </script>
    <script defer src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js' onload="initValine()"></script>
    <div class="prism-comment-section container" id="prism__comment">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <div id="vcomments"></div>
            </div>
        </div>
    </div>
    

</main>

            <footer id="prism__footer">
                <section>
                    <div>
                        <nav class="social-links">
                            <ul><li><a class="no-link" title="Twitter" href="https://twitter.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-twitter"></i></a></li><li><a class="no-link" title="GitHub" href="https://github.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-github"></i></a></li><li><a class="no-link" title="Weibo" href="https://weibo.com/1071696872" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-weibo"></i></a></li></ul>
                        </nav>
                    </div>

                    <section id="prism__external_links">
                        <ul>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://github.com/AlanDecode/Maverick" rel="noopener noreferrer nofollow">Maverick</a>ï¼šğŸ„â€ Go My Own Way.
                                <span>|</span>
                            </li>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://www.imalan.cn" rel="noopener noreferrer nofollow">Triple NULL</a>ï¼šHome page for AlanDecode.
                                <span>|</span>
                            </li>
                            
                        </ul>
                    </section>

                    <div class="copyright">
                        <p class="copyright-text">
                            <span class="brand">walker's code blog</span>
                            <span>Copyright Â© 2022 AlanDecode</span>
                        </p>
                        <p class="copyright-text powered-by">
                            | Powered by <a href="https://github.com/AlanDecode/Maverick" class="no-link" target="_blank" rel="noopener noreferrer nofollow">Maverick</a> | Theme <a href="https://github.com/Reedo0910/Maverick-Theme-Prism" target="_blank" class="no-link" rel="noopener noreferrer nofollow">Prism</a>
                        </p>
                    </div>
                    <div class="footer-addon">
                        
                    </div>
                </section>
                <script>
                    var site_build_date = "2019-12-06T12:00+08:00"

                </script>
                <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-efa8685153.js"></script>
            </footer>
        </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-493cb9cd89.js"></script>

    <!--katex-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.js"></script>
    <script>
        mathOpts = {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false }
            ]
        };

    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
</body>

</html>