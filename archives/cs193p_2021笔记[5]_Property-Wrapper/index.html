<!DOCTYPE HTML>
<html lang="english">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,AlanDecode,Galileo,blog" />
    <meta name="generator" content="Maverick 1.2.1" />
    <meta name="template" content="Prism" />
    <link rel="alternate" type="application/rss+xml" title="walker's code blog &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="walker's code blog &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-b9d78ff38a.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-182e5a8869.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/441335f7e7e8b1a57347c22777194ad1.json"
        }

    </script>
    
<title>cs193p_2021ç¬”è®°[5]_Property-Wrapper - walker's code blog</title>
<meta name="author" content="walker" />
<meta name="description" content="Property Wrappers" />
<meta property="og:title" content="cs193p_2021ç¬”è®°[5]_Property-Wrapper - walker's code blog" />
<meta property="og:description" content="Property Wrappers" />
<meta property="og:site_name" content="walker's code blog" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/cs193p_2021%E7%AC%94%E8%AE%B0%5B5%5D_Property-Wrapper/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2021-10-24T04:00:00-00.00" />
<meta name="twitter:title" content="cs193p_2021ç¬”è®°[5]_Property-Wrapper - walker's code blog" />
<meta name="twitter:description" content="Property Wrappers" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
</head>

<body>
    <div class="container prism-container">
        <header class="prism-header" id="prism__header">
            <h1 class="text-uppercase brand"><a class="no-link" href="/" target="_self">walker's code blog</a></h1>
            <p>coder, reader</p>
            <nav class="prism-nav"><ul><li><a class="no-link text-uppercase " href="/" target="_self">Home</a></li><li><a class="no-link text-uppercase " href="/archives/" target="_self">Archives</a></li><li><a class="no-link text-uppercase " href="/about/" target="_self">About</a></li><li><a href="#" target="_self" class="search-form-input no-link text-uppercase">Search</a></li></ul></nav>
        </header>
        <div class="prism-wrapper" id="prism__wrapper">
            
<main>
    <section class="prism-section row" id="prism__content">
        <article class="yue col-md-8 offset-md-2">
            <h1 class="prism-post-title">cs193p_2021ç¬”è®°[5]_Property-Wrapper</h1>
            <div class="prism-post-time">
                <time class="text-uppercase">
                    October 24 2021
                </time>
            </div>
            <div class="prism-content-body">
                <h1>Property Wrappers</h1>
<p>C#ä¸­çš„<code>Attributes</code>ï¼Œpythonä¸­çš„<code>Decorators</code>, Javaçš„<code>Annonations</code>ï¼Œç±»ä¼¼çš„è®¾è®¡æ¨¡å¼ã€‚</p><ul>
<li>A property wrapper is actually a <code>struct</code>.</li>
<li>è¿™ä¸ªç‰¹æ®Šçš„<code>struct</code>å°è£…äº†ä¸€äº›æ¨¡æ¿è¡Œä¸ºåº”ç”¨åˆ°å®ƒä»¬wrapçš„varsä¸Šï¼š<ol>
<li>Making a var live in the heap (<code>@State</code>)</li>
<li>Making a var publish its changes (<code>@Published</code>)</li>
<li>Causing a View to redraw when a published change is detected (<code>@ObservedObject</code>)</li>
</ol>
</li>
</ul>
<p>å³èƒ½å¤Ÿåˆ†é…åˆ°å †ä¸Šï¼Œèƒ½å¤Ÿé€šçŸ¥çŠ¶æ€å˜åŒ–å’Œèƒ½é‡ç»˜ç­‰ï¼Œå¯ä»¥ç†è§£ä¸º<code>è¯­æ³•ç³–</code>ã€‚</p><div class="highlight"><pre><span></span><span class="p">@</span><span class="n">Published</span> <span class="kd">var</span> <span class="nv">emojiArt</span><span class="p">:</span> <span class="n">EmojiArt</span> <span class="p">=</span> <span class="n">EmojiArt</span><span class="p">()</span>

<span class="c1">// ... is really just this struct ...</span>
<span class="kd">struct</span> <span class="nc">Published</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">wrappedValue</span><span class="p">:</span> <span class="n">EmojiArt</span>
    <span class="kd">var</span> <span class="nv">projectedValue</span><span class="p">:</span> <span class="n">Publisher</span><span class="p">&lt;</span><span class="n">EmojiArt</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;</span>  <span class="c1">// i.e. $</span>
<span class="p">}</span>

<span class="c1">// `projected value`çš„ç±»å‹å–å†³äºwrapperè‡ªå·±ï¼Œæ¯”å¦‚æœ¬ä¾‹å°±æ˜¯ä¸€ä¸ª`Publisher`</span>

<span class="c1">// æˆ‘ç†è§£ä¸ºä¸€ä¸ªå±æ€§å’Œä¸€ä¸ªå¹¿æ’­å™¨</span>

<span class="c1">// ... and Swift (approximately) makes these vars available to you ...</span>
<span class="kd">var</span> <span class="nv">_emojiArt</span><span class="p">:</span> <span class="n">Published</span> <span class="p">=</span> <span class="n">Published</span><span class="p">(</span><span class="n">wrappedValue</span><span class="p">:</span> <span class="n">EmojiArt</span><span class="p">())</span> 
<span class="kd">var</span> <span class="nv">emojiArt</span><span class="p">:</span> <span class="n">EmojiArt</span> <span class="p">{</span>
     <span class="kr">get</span> <span class="p">{</span> <span class="n">_emojiArt</span><span class="p">.</span><span class="n">wrappedValue</span> <span class="p">}</span>
     <span class="kr">set</span> <span class="p">{</span> <span class="n">_emojiArt</span><span class="p">.</span><span class="n">wrappedValue</span> <span class="p">=</span> <span class="n">newValue</span> <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
<p>æŠŠget,setç›´æ¥é€šè¿‡<code>$emojiArt</code>(å³projectedValue)æ¥ä½¿ç”¨</p><p>å½“ä¸€ä¸ª<code>Published</code>å€¼å‘ç”Ÿå˜åŒ–ï¼š</p><ul>
<li>It publishes the change through its <em>projectedValue</em> (<code>$emojiArt</code>) which is a <code>Publisher</code>.</li>
<li>It also invokes <code>objectWillChange.send()</code> in its enclosing <code>ObservableObject</code>.</li>
</ul>
<p>ä¸‹é¢åˆ—çš„å‡ ç§<code>Property wrapper</code>ï¼Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒæœ€æ ¸å¿ƒçš„ä¸¤ä¸ªæ¦‚å¿µï¼Œ<code>wrappedValue</code>å’Œ<code>projectedValue</code>æ˜¯ä»€ä¹ˆå°±è¡Œäº†:</p><h2>@State</h2>
<p>è¿™æ˜¯ç¬¬äºŒæ¬¡æåˆ°äº†ï¼Œåœ¨<code>Property Observers</code>ä¸€èŠ‚é‡Œé¢„å‘Šè¿‡ï¼ŒåŸºæœ¬ä¸Šç‚¹<code>@</code>çš„ï¼Œå¤§éƒ½ä¸º<code>Property Wrapper</code>çš„å†…å®¹ã€‚</p><ul>
<li>The wrappedValue is: <code>anything</code> (but almost certainly a value type).</li>
<li>What it does:<ul>
<li>stores the wrappedValue in the heap;</li>
<li>when it changes, <code>invalidates</code> the <code>View</code>.</li>
</ul>
</li>
<li>Projected value (i.e. $): a <code>Binding</code> (to that <em>value in the heap</em>).</li>
</ul>
<div class="highlight"><pre><span></span><span class="p">@</span><span class="n">State</span> <span class="kd">private</span> <span class="kd">var</span> <span class="nv">foo</span><span class="p">:</span> <span class="nb">Int</span>
<span class="kd">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">_foo</span> <span class="p">=</span> <span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="n">initiaValue</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>æ³¨æ„<code>_</code>å’Œ<code>$</code>çš„åŒºåˆ«ã€‚</p><h2>@StateObject &amp; @ObservedObject</h2>
<ul>
<li>The wrappedValue is: <code>anything</code> that implements the <code>ObservableObject</code> protocol (ViewModels).</li>
<li>What it does:<ul>
<li><code>invalidates</code> the <code>View</code> when wrappedValue does <em>objectWillChange.send()</em>.</li>
</ul>
</li>
<li>Projected value (i.e. $): a <code>Binding</code> (to the vars of the wrappedValue (a <em>ViewModel</em>)).</li>
</ul>
<blockquote>
<p><strong>@StateObject V.S. @State</strong></p></blockquote>
<ul>
<li>ä¸€ä¸ªç±»å‹æ˜¯<code>ObservableObject</code>sï¼Œ ä¸€ä¸ªæ˜¯value type</li>
</ul>
<blockquote>
<p><strong>@StateObject V.S. @ObservedObject</strong></p></blockquote>
<ul>
<li>@StateObject is a &quot;source of truth&quot;ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç›´æ¥èµ‹å€¼ï¼š<code>@StateObject var foo = SomeObservableObject()</code></li>
<li>èƒ½ç”¨åœ¨<em>View, APP, Scene</em>ç­‰åœºæ™¯</li>
<li>å¦‚æœç”¨åœ¨Viewé‡Œï¼Œç”Ÿå‘½å‘¨æœŸä¸Viewä¸€è‡´</li>
</ul>
<div class="highlight"><pre><span></span><span class="p">@</span><span class="n">main</span>
<span class="kd">struct</span> <span class="nc">EmojiArtApp</span><span class="p">:</span> <span class="n">App</span> <span class="p">{</span>
    <span class="c1">// stateObject, source of truth</span>
    <span class="c1">// defined in the app</span>
    <span class="p">@</span><span class="n">StateObject</span> <span class="kd">var</span> <span class="nv">paletteStore</span> <span class="p">=</span> <span class="n">PaletteStore</span><span class="p">(</span><span class="n">named</span><span class="p">:</span> <span class="s">&quot;default&quot;</span><span class="p">)</span>

    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">Scene</span> <span class="p">{</span>
    <span class="n">DocumentGroup</span><span class="p">(</span><span class="n">newDocument</span><span class="p">:</span> <span class="p">{</span> <span class="n">EmojiArtDocument</span><span class="p">()</span> <span class="p">})</span> <span class="p">{</span> <span class="n">config</span> <span class="k">in</span>
        <span class="n">EmojiArtDocumentView</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">config</span><span class="p">.</span><span class="n">document</span><span class="p">)</span>
            <span class="p">.</span><span class="n">environmentObject</span><span class="p">(</span><span class="n">paletteStore</span><span class="p">)</span>  <span class="c1">// passed by environment</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h2>@Binding</h2>
<ul>
<li>The wrappedValue is: <code>a value</code> that is bound to something else.</li>
<li>What it does:<ul>
<li>gets/sets the value of the wrappedValue from <code>some other source</code>.</li>
<li>when the bound-to value changes, it <code>invalidates</code> the <code>View</code>.</li>
<li>Formè¡¨å•å…¸å‹åº”ç”¨åœºæ™¯ï¼Œæœ‰UIå˜åŒ–çš„æ§ä»¶</li>
<li>æ‰‹åŠ¿è¿‡ç¨‹ä¸­çš„State, æˆ–dragæ—¶æ˜¯å¦targted</li>
<li>æ¨¡æ€çª—å£çš„çŠ¶æ€</li>
<li>åˆ†å‰²viewåå…±äº«çŠ¶æ€</li>
<li>æ€»ä¹‹ï¼Œæ•°æ®æºåªæœ‰ä¸€ä¸ª(source of the truth)çš„åœºæ™¯ï¼Œå°±ä¸éœ€è¦ç”¨ä¸¤ä¸ª@Stateè€Œç”¨@Binding,</li>
</ul>
</li>
<li>Projected value (i.e. $): a Binding (self; i.e. the Binding itself)</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">struct</span> <span class="nc">MyView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
      <span class="p">@</span><span class="n">State</span> <span class="kd">var</span> <span class="nv">myString</span> <span class="p">=</span> <span class="err">â€œ</span><span class="n">Hello</span><span class="err">â€</span>               <span class="c1">// 1</span>
      <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
          <span class="n">OtherView</span><span class="p">(</span><span class="n">sharedText</span><span class="p">:</span> <span class="err">$</span><span class="n">myString</span><span class="p">)</span>        <span class="c1">// 2</span>
      <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">struct</span> <span class="nc">OtherView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
      <span class="p">@</span><span class="n">Binding</span> <span class="kd">var</span> <span class="nv">sharedText</span><span class="p">:</span> <span class="n">string</span>             <span class="c1">// 3</span>
      <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
          <span class="n">Text</span><span class="p">(</span><span class="n">sharedText</span><span class="p">)</span>                        <span class="c1">// 4</span>
          <span class="n">TextField</span><span class="p">(</span><span class="s">&quot;shared&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="err">$</span><span class="n">sharedText</span><span class="p">)</span>  <span class="c1">// 5 _myString.projectValue.projectValue</span>
      <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<ol>
<li><code>_myString</code>æ˜¯å®é™…å˜é‡ï¼ŒåŒ…å«ä¸€ä¸ª<code>wrappedValue</code>ï¼Œä¸€ä¸ª<code>projectedValue</code></li>
<li><code>myString</code>å°±æ˜¯<code>_myString.wrappedValue</code></li>
<li><code>$myString</code>æ˜¯<code>_myString.projectedValue</code>ï¼Œ<ul>
<li>æ˜¯ä¸€ä¸ª<code>Binding&lt;String&gt;</code>ï¼Œä¼ å€¼å’Œæ¥å€¼ç”¨çš„å°±æ˜¯å®ƒ</li>
<li>æ‰€ä»¥ä¼ <code>$myString</code>çš„åœ°æ–¹ä¹Ÿå¯ä»¥ç”¨<code>_myString.projectedValue</code>ä»£æ›¿ï¼Œå­¦ä¹ é˜¶æ®µçš„è¯</li>
</ul>
</li>
<li>è¦æŠŠ<code>projectedValue</code>å±‚å±‚ä¼ é€’ä¸‹å»ï¼Œå¹¶ä¸æ˜¯ç”¨åŒä¸€ä¸ª<code>projectedValue</code>ï¼Œè€Œæ˜¯è®¾è®¡æˆäº†<code>Binding&lt;T&gt;</code><ul>
<li>å‚è€ƒä¸Šé¢ä»£ç å—çš„ç¬¬5æ¡</li>
</ul>
</li>
</ol>
<p>å…¶å®ƒ</p><ul>
<li>ä¹Ÿå¯ä»¥ç»‘å®šä¸€ä¸ªå¸¸é‡ï¼š<code>OtherView(sharedText: .constant(â€œHowdyâ€))</code></li>
<li>computed binding: <code>Binding(get:, set:).</code></li>
</ul>
<p>æ¯”å¦‚ä½ çš„viewæ˜¯ä¸€ä¸ªå°ç»„ä»¶ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª<code>Binding var user: User</code>ï¼Œé‚£ä¹ˆåœ¨previewé‡Œé¢æ€ä¹ˆä¼ å…¥è¿™ä¸ªUserå‘¢ï¼Ÿç”¨å¸¸é‡ï¼š</p><div class="highlight"><pre><span></span><span class="kd">static</span> <span class="kd">var</span> <span class="nv">preview</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
    <span class="n">myView</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="n">User</span><span class="p">(...)))</span>
<span class="p">}</span>
</pre></div>
<h2>@EnvironmenetObject</h2>
<ul>
<li>The wrappedValue is: <code>ObservableObject</code> obtained via .environmentObject() sent to the View.</li>
<li>What it does: <code>invalidates</code> the View when wrappedValue does objectWillChange.send().</li>
<li>Projected value (i.e. $): a <code>Binding</code> (to the vars of the wrappedValue (a ViewModel)).</li>
</ul>
<p>ä¸<code>@ObservedObject</code>ç”¨æ³•ç¨æœ‰ç‚¹ä¸åŒï¼Œæœ‰å•ç‹¬çš„èµ‹å€¼æ¥å£ï¼š</p><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">myView</span> <span class="p">=</span> <span class="n">MyView</span><span class="p">().</span><span class="n">environmentObject</span><span class="p">(</span><span class="n">theViewModel</span><span class="p">)</span>
<span class="c1">// è€Œ@ObservedObjectæ˜¯ä¸€ä¸ªæ™®é€šçš„å±æ€§</span>
<span class="kd">let</span> <span class="nv">myView</span> <span class="p">=</span> <span class="n">MyView</span><span class="p">(</span><span class="n">viewModel</span><span class="p">:</span> <span class="n">theViewModel</span><span class="p">)</span>

<span class="c1">// Inside the View ...</span>
<span class="p">@</span><span class="n">EnvironmentObject</span> <span class="kd">var</span> <span class="nv">viewModel</span><span class="p">:</span> <span class="n">ViewModelClass</span> 
<span class="c1">// ... vs ...</span>
<span class="p">@</span><span class="n">ObservedObject</span> <span class="kd">var</span> <span class="nv">viewModel</span><span class="p">:</span> <span class="n">ViewModelClass</span>
</pre></div>
<ul>
<li>visible to all views in your body (except modallay presented ones)</li>
<li>å¤šç”¨äºå¤šä¸ªviewå…±äº«ViewModelçš„æ—¶å€™</li>
</ul>
<h2>@Environment</h2>
<ul>
<li>ä¸<code>@EnvironmentObject</code>å®Œå…¨ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿</li>
<li>è¿™æ˜¯<code>Property Wrapper</code>ä¸åªæœ‰ä¸¤ä¸ªå˜é‡ï¼ˆwarped..., projected...ï¼‰çš„çš„ä¸€ä¸ªåº”ç”¨</li>
<li>é€šè¿‡<code>keyPath</code>æ¥ä½¿ç”¨ï¼š<code>@Environment(\.colorScheme) var colorScheme</code></li>
<li>wrappedValueçš„ç±»å‹æ˜¯é€šè¿‡<code>keyPath</code>å£°æ˜æ—¶è®¾ç½®çš„</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">view</span><span class="p">.</span><span class="n">environment</span><span class="p">(</span><span class="err">\</span><span class="p">.</span><span class="n">colorScheme</span><span class="p">,</span> <span class="p">.</span><span class="n">dark</span><span class="p">)</span>
</pre></div>
<p>so:</p><ul>
<li>The wrappedValue is: the value of some var in <code>EnvironmentValues</code>.</li>
<li>What it does: gets/sets a value of some var in <code>EnvironmentValues</code>.</li>
<li>Projected value (i.e. $): none.</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1">// someView pop ä¸€ä¸ª modal çš„ myView,ä¼ é€’ environment</span>
<span class="n">someView</span><span class="p">.</span><span class="n">sheet</span><span class="p">(</span><span class="n">isPresented</span><span class="p">:</span> <span class="n">myCondition</span><span class="p">){</span>
    <span class="n">myView</span><span class="p">(...</span><span class="kd">init</span><span class="p">...)</span>
    <span class="p">.</span><span class="n">enviroment</span><span class="p">(</span><span class="err">\</span><span class="p">.</span><span class="n">colorScheme</span><span class="p">,</span> <span class="n">colorScheme</span><span class="p">)</span> 
<span class="p">}</span>
</pre></div>
<p>é™¤äº†æ·±è‰²æ¨¡å¼ï¼Œè¿˜æœ‰ä¸€ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯å°±æ˜¯ç¼–è¾‘æ¨¡å¼<code>\.editMode</code>ï¼Œæ¯”å¦‚ç‚¹äº†ç¼–è¾‘æŒ‰é’®åã€‚</p><blockquote>
<p><code>EditButton</code>æ˜¯ä¸€ä¸ªå°è£…äº†UIå’Œè¡Œä¸ºçš„æ§ä»¶ï¼Œå®ƒåªåšä¸€ä»¶äº‹ï¼Œå°±æ˜¯æ›´æ”¹<code>\.editmode</code>è¿™ä¸ªç¯å¢ƒå˜é‡(çš„<code>isEditing</code>)</p></blockquote>
<h2>@Publisher</h2>
<p>It is an object that <code>emits values</code> and possibly a <code>failure object</code> if it fails while doing so.</p><div class="highlight"><pre><span></span><span class="n">Publisher</span><span class="p">&lt;</span><span class="n">Output</span><span class="p">,</span> <span class="n">Failure</span><span class="p">&gt;</span>
</pre></div>
<ul>
<li>Failureéœ€è¦å®ç°<code>Error</code>ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥ä¼ <code>Never</code></li>
</ul>
<h3>è®¢é˜…</h3>
<p>ä¸€ç§ç®€å•ç”¨æ³•ï¼Œ<code>sink</code>:</p><div class="highlight"><pre><span></span><span class="n">cancellable</span> <span class="p">=</span> <span class="n">myPublisher</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span>
    <span class="n">receiveCompletion</span><span class="p">:{</span><span class="n">resultin</span><span class="p">...},</span> <span class="c1">//result is a Completion&lt;Failure&gt; enum</span>
        <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">thingThePublisherPublishes</span> <span class="k">in</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="p">}</span>
  <span class="p">)</span>
</pre></div>
<p>è¿”å›ä¸€ä¸ª<code>Cancellable</code>ï¼Œå¯ä»¥éšæ—¶<code>.cancel()</code>ï¼Œåªè¦ä½ æŒæœ‰è¿™ä¸ª<code>cancellable</code>ï¼Œå°±èƒ½éšæ—¶ç”¨è¿™ä¸ªsink</p><p>Viewæœ‰è‡ªå·±çš„è®¢é˜…æ–¹å¼ï¼š</p><div class="highlight"><pre><span></span><span class="p">.</span><span class="n">onReceive</span><span class="p">(</span><span class="n">publisher</span><span class="p">)</span> <span class="p">{</span> <span class="n">thingThePublisherPublishes</span> <span class="k">in</span>
    <span class="c1">// do whatever you want with thingThePublisherPublishes </span>
<span class="p">}</span>
</pre></div>
<ol>
<li><code>.onReceive</code> will automatically <code>invalidate</code> your View (causing a redraw).</li>
<li>æ—¢ç„¶å‚æ•°æ˜¯publisherï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªbindingçš„å˜é‡ï¼Œå³å¸¦<code>$</code>ä½¿ç”¨ï¼š</li>
</ol>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="n">onReceive</span><span class="p">(</span><span class="err">$</span><span class="n">aBindData</span><span class="p">)</span> <span class="p">{</span> <span class="n">bind_data</span> <span class="k">in</span> 
    <span class="c1">// my code</span>
<span class="p">}</span>
</pre></div>
<p>publisheræ¥æºï¼š</p><ol>
<li><code>$</code> in front of vars marked <code>@Published</code><ul>
<li>è¿˜è®°å¾—$å°±æ˜¯å–çš„projectedValueå—ï¼Ÿ</li>
<li>ä¸€èˆ¬çš„projectedValueæ˜¯ä¸€ä¸ª<em>Binding</em>ï¼ŒPublishedçš„æ˜¯æ˜¯ä¸ª<em>Publisher</em></li>
</ul>
</li>
<li>URLSessionâ€™s <code>dataTaskPublisher</code> (publishes the Data obtained from a URL)</li>
<li><code>Timer</code>â€™s publish(every:) (periodically publishes the current date and time as a Date)</li>
<li><code>NotificationCenter</code>â€™s publisher(for:) (publishes notifications when system events happen)</li>
</ol>
<blockquote>
<p>å¦‚æœä½ æœ‰ä¸€ä¸ª<code>ObservedObject</code>(Document)ï¼Œå®ƒé‡Œé¢æœ‰ä¸€ä¸ª<code>@Publisher</code>(background)ï¼Œé‚£ä¹ˆæ³¨æ„ä»¥ä¸‹ä¸¤è€…çš„åŒºåˆ«ï¼š</p></blockquote>
<ul>
<li>document.<code>$</code>background: æ˜¯ä¸€ä¸ªpublisher</li>
<li><code>$</code>document.background: æ˜¯ä¸€ä¸ªbinding</li>
</ul>
<blockquote>
<p><code>.onReceive</code>åªèƒ½æ¥æ”¶<code>Publisher</code>çš„æ¨é€ï¼Œè€Œäº‹å®ä¸Šï¼Œ<code>onChange</code>ï¼ˆä¸€èˆ¬ç”¨äºæ¥æ”¶ObservedObjectæˆ–State)åŒæ ·ä¹Ÿèƒ½æ¥æ”¶Publisherã€‚</p></blockquote>

            </div>
        </article>
        <div class="prism-post-meta col-md-8 offset-md-2">
    <span>walker</span>
    
    <span>/</span>
    <span>
        <a class="category no-link" href="/category/posts/" target="_self">
        posts
        </a>
    </span>
    
    
    <span>/</span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/cs193p/" target="_self">#cs193p</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/property%20wrapper/" target="_self">#property wrapper</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/binding/" target="_self">#binding</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/publisher/" target="_self">#publisher</a>
    </span>
    
    
    
    <span>/</span>
    <span class="leancloud_visitors" id="/archives/cs193p_2021%E7%AC%94%E8%AE%B0%5B5%5D_Property-Wrapper/" data-flag-title="cs193p_2021ç¬”è®°[5]_Property-Wrapper"><span class="leancloud-visitors-count"></span> Views</span>
    
</div>
    </section>

    
<section id="prism__pagination" class="prism-pagination" class="col-md-8 offset-md-2">
    <ul>
        
        <li class="next">
            <a class="no-link" href="/archives/cs193p_2021%E7%AC%94%E8%AE%B0%5B6%5D_Persistence/" target="_self" title="cs193p_2021ç¬”è®°[6]_Persistence"><i class="fa fa-chevron-left" aria-hidden="true"></i>Newer</a>
        </li>
        
        
        <li class="prev">
            <a class="no-link" href="/archives/cs193p_2021%E7%AC%94%E8%AE%B0%5B4%5D_Color_Image_Gesture/" target="_self" title="cs193p_2021ç¬”è®°[4]_Color_Image_Gesture">Older<i class="fa fa-chevron-right" aria-hidden="true"></i></a>
        </li>
        
    </ul>
</section>


    
    <script>
        var initValine = function() {
            new Valine({"enable": true, "el": "#vcomments", "appId": "7tP92LoqK2cggW61DvJmWBo0-gzGzoHsz", "appKey": "iQCtrtlr8eKrQllM03GMESMJ", "visitor": true, "recordIP": true});
        }

    </script>
    <script defer src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js' onload="initValine()"></script>
    <div class="prism-comment-section container" id="prism__comment">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <div id="vcomments"></div>
            </div>
        </div>
    </div>
    

</main>

            <footer id="prism__footer">
                <section>
                    <div>
                        <nav class="social-links">
                            <ul><li><a class="no-link" title="Twitter" href="https://twitter.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-twitter"></i></a></li><li><a class="no-link" title="GitHub" href="https://github.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-github"></i></a></li><li><a class="no-link" title="Weibo" href="https://weibo.com/1071696872" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-weibo"></i></a></li></ul>
                        </nav>
                    </div>

                    <section id="prism__external_links">
                        <ul>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://github.com/AlanDecode/Maverick" rel="noopener noreferrer nofollow">Maverick</a>ï¼šğŸ„â€ Go My Own Way.
                                <span>|</span>
                            </li>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://www.imalan.cn" rel="noopener noreferrer nofollow">Triple NULL</a>ï¼šHome page for AlanDecode.
                                <span>|</span>
                            </li>
                            
                        </ul>
                    </section>

                    <div class="copyright">
                        <p class="copyright-text">
                            <span class="brand">walker's code blog</span>
                            <span>Copyright Â© 2022 AlanDecode</span>
                        </p>
                        <p class="copyright-text powered-by">
                            | Powered by <a href="https://github.com/AlanDecode/Maverick" class="no-link" target="_blank" rel="noopener noreferrer nofollow">Maverick</a> | Theme <a href="https://github.com/Reedo0910/Maverick-Theme-Prism" target="_blank" class="no-link" rel="noopener noreferrer nofollow">Prism</a>
                        </p>
                    </div>
                    <div class="footer-addon">
                        
                    </div>
                </section>
                <script>
                    var site_build_date = "2019-12-06T12:00+08:00"

                </script>
                <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-efa8685153.js"></script>
            </footer>
        </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-493cb9cd89.js"></script>

    <!--katex-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.js"></script>
    <script>
        mathOpts = {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false }
            ]
        };

    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
</body>

</html>