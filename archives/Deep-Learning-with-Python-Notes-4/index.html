<!DOCTYPE HTML>
<html lang="english">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,AlanDecode,Galileo,blog" />
    <meta name="generator" content="Maverick 1.2.1" />
    <meta name="template" content="Prism" />
    <link rel="alternate" type="application/rss+xml" title="walker's code blog &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="walker's code blog &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-b9d78ff38a.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-182e5a8869.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/6b7f0246dda0561db2c2d159344cad05.json"
        }

    </script>
    
<title>ã€ŠDeep Learning with Pythonã€‹ç¬”è®°[4] - walker's code blog</title>
<meta name="author" content="walker" />
<meta name="description" content="Deep learning for computer vision" />
<meta property="og:title" content="ã€ŠDeep Learning with Pythonã€‹ç¬”è®°[4] - walker's code blog" />
<meta property="og:description" content="Deep learning for computer vision" />
<meta property="og:site_name" content="walker's code blog" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/Deep-Learning-with-Python-Notes-4/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2021-09-22T10:03:00-00.00" />
<meta name="twitter:title" content="ã€ŠDeep Learning with Pythonã€‹ç¬”è®°[4] - walker's code blog" />
<meta name="twitter:description" content="Deep learning for computer vision" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
</head>

<body>
    <div class="container prism-container">
        <header class="prism-header" id="prism__header">
            <h1 class="text-uppercase brand"><a class="no-link" href="/" target="_self">walker's code blog</a></h1>
            <p>coder, reader</p>
            <nav class="prism-nav"><ul><li><a class="no-link text-uppercase " href="/" target="_self">Home</a></li><li><a class="no-link text-uppercase " href="/archives/" target="_self">Archives</a></li><li><a class="no-link text-uppercase " href="/about/" target="_self">About</a></li><li><a href="#" target="_self" class="search-form-input no-link text-uppercase">Search</a></li></ul></nav>
        </header>
        <div class="prism-wrapper" id="prism__wrapper">
            
<main>
    <section class="prism-section row" id="prism__content">
        <article class="yue col-md-8 offset-md-2">
            <h1 class="prism-post-title">ã€ŠDeep Learning with Pythonã€‹ç¬”è®°[4]</h1>
            <div class="prism-post-time">
                <time class="text-uppercase">
                    September 22 2021
                </time>
            </div>
            <div class="prism-content-body">
                <h1>Deep learning for computer vision</h1>
<h2>Convolution Network</h2>
<p>The convolution operation extracts patches from its input feature map and applies the same transformation to all of these patches, producing an output feature map.</p><ul>
<li>convolution layers learn local patterns(å±€éƒ¨ç‰¹å¾)<ul>
<li>The patterns they learn are translation invariant.ï¼ˆå±€éƒ¨ç‰¹å¾å¯åœ¨å›¾ç‰‡åˆ«çš„åœ°æ–¹é‡å¤ï¼‰</li>
<li>æœ‰çš„æ•™æé‡Œä¼šè¯´æ¯ä¸ªæ»‘çª—ä¸€ä¸ªç‰¹å¾ï¼Œç„¶åå¼•å…¥<strong>å‚æ•°å…±äº«</strong>æ‰è®²åˆ°ä¸€ä¸ªç‰¹å¾å…¶å®å¯ä»¥ç”¨åœ¨æ‰€æœ‰æ»‘çª—</li>
</ul>
</li>
<li>They can learn spatial hierarchies of patterns(ä½çº§ç‰¹å¾å †å æˆé«˜çº§ç‰¹å¾)</li>
<li>depth axis no longer stand for specific colors as in RGB input; rather, they stand for filters(è¡¨ç¤ºå›¾ç‰‡æ—¶ï¼Œ3ä¸ªé€šé“æœ‰åŸå§‹å«ä¹‰ï¼Œå·ç§¯å¼€å§‹åé€šé“åªè¡¨ç¤ºfilteräº†)</li>
<li><code>valid</code> and <code>same</code> convolutionï¼ˆåŠ ä¸åŠ paddingè®©filteråœ¨æœ€åä¸€ä¸ªåƒç´ æ—¶ä¹Ÿèƒ½è®¡ç®—ï¼‰</li>
<li><code>stride</code>ï¼Œæ»‘çª—æ­¥é•¿</li>
<li><code>max-pooling</code> or <code>average-pooling</code><ul>
<li>usually 2x2 windows by stride 2 -&gt; ä¸‹é‡‡æ ·(downsample)</li>
<li>æ›´å¤§çš„æ„Ÿå—é‡</li>
<li>æ›´å°çš„è¾“å‡º</li>
<li>ä¸æ˜¯å”¯ä¸€çš„ä¸‹é‡‡æ ·æ–¹å¼ï¼ˆæ¯”å¦‚åœ¨å·ç§¯ä¸­ä½¿ç”¨strideä¹Ÿå¯ä»¥ï¼‰</li>
<li>ä¸€èˆ¬ç”¨maxè€Œä¸æ˜¯average(å¯»æ‰¾æœ€å¼ºçš„è¡¨ç°)</li>
</ul>
</li>
<li>å°æ•°æ®é›†<ul>
<li>data augmenetation(æ—‹è½¬å¹³è¡¡ç¼©æ”¾shearç¿»è½¬ç­‰)<ul>
<li>ä¸èƒ½äº§ç”Ÿå½“å‰æ•°æ®é›†ä¸å­˜åœ¨çš„ä¿¡æ¯</li>
<li>æ‰€ä»¥ä»éœ€è¦dropout</li>
</ul>
</li>
<li>pretrained network(é€‚ç”¨é€šç”¨ç‰©ä½“)<ul>
<li>feature extraction</li>
<li>fine-tuneing</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Using a pretrained convnet</h3>
<p>A pretrained network is a saved network that was previously trained <strong>on a large dataset</strong> typically on a large-scale image-classification task.</p><h3>Feature extraction</h3>
<p>Feature extraction consists of using the representations learned by a previous network to extract interesting features from new samples. These features are then run through a <em>new classifier</em>, which is trained from scratch.</p><ol>
<li>å³åªä½¿ç”¨åˆ«çš„å¤§å‹æ¨¡å‹æå–çš„representationsï¼ˆç‰¹å¾ï¼‰ï¼Œæ¥æ„å»ºè‡ªå·±çš„åˆ†ç±»å™¨ã€‚</li>
<li>åŸæœ¬æ¨¡å‹çš„åˆ†ç±»å™¨ä¸ä½†æ˜¯ä¸ºç‰¹å®šä»»åŠ¡å†™çš„ï¼Œè€Œä¸”åŸºæœ¬ä¸Šä¸§å¤±äº†ä½ç½®å’Œç©ºé—´ä¿¡æ¯ï¼Œåªä¿ç•™äº†å¯¹è¯¥ä»»åŠ¡ä¸Šçš„presence probability.</li>
<li>æœ€åˆçš„å±‚ä¸€èˆ¬åªèƒ½æå–åˆ°çº¿ï¼Œè¾¹ç¼˜ï¼Œé¢œè‰²ç­‰ä½çº§ç‰¹å¾ï¼Œå†å¾€åä¼šèšåˆå‡ºä¸€äº›çº¹ç†ï¼Œæ›´é«˜çš„å±‚å°±å¯èƒ½ä¼šå åŠ å‡ºä¸€äº›çœ¼ï¼Œè€³ç­‰æŠ½è±¡çš„ç‰¹å¾ï¼Œæ‰€ä»¥ä½ çš„è¯†åˆ«å¯¹è±¡ä¸pretrainedæ•°æ®æºå·®åˆ«å¾ˆå¤§çš„æ—¶å€™ï¼Œå°±éœ€è¦è€ƒè™‘æŠŠæœ€å°¾å·´çš„å‡ å±‚layerä¹Ÿèˆå¼ƒæ‰ã€‚ï¼ˆe.g. VGG16æœ€åä¸€å±‚æå–äº†512ä¸ªfeature mapï¼‰</li>
<li>ä¸¤ç§ç”¨æ³•ï¼š<ul>
<li>è·‘ä¸€æ¬¡é¢„è®­ç»ƒæ¨¡å‹ä½ é€‰ä¸­çš„éƒ¨åˆ†ï¼ŒæŠŠå‚æ•°å­˜èµ·æ¥ï¼ˆ$\leftarrow$é”™ï¼‰ï¼ŒæŠŠè¾“å‡ºå½“ä½œdatasetä½œä¸ºè‡ªå·±æ„å»ºçš„åˆ†ç±»å™¨çš„inputã€‚<ul>
<li>å¿«ï¼Œçœèµ„æºï¼Œä½†æ˜¯éœ€è¦æŠŠæ•°æ®é›†å›ºå®šä½ï¼Œç­‰äºæ²¡æ³•åšdata augmentation</li>
<li>è·‘é¢„è®­ç»ƒæ¨¡å‹æ—¶ä¸éœ€è¦è®¡ç®—æ¢¯åº¦(freeze)</li>
<li>å…¶å®åº”ç”¨é¢„è®­ç»ƒæ¨¡å‹å°±ç­‰äºåˆ«äººçš„é¢„å¤„ç†æ•°æ®é›†ï¼Œè€ŒçœŸå®çš„æ¨¡å‹åªæœ‰ä¸€ä¸ªå°åˆ†ç±»å™¨</li>
</ul>
</li>
<li>åˆå¹¶åˆ°è‡ªå®šä¹‰çš„ç½‘ç»œä¸­å½“æˆæ™®é€šç½‘ç»œè®­ç»ƒ<ul>
<li>æ…¢ï¼Œä½†æ˜¯èƒ½åšæ•°æ®å¢å¹¿äº†</li>
<li>éœ€æ‰‹åŠ¨è®¾ç½®æ¥è‡ªé¢„è®­ç»ƒæ¨¡å‹çš„æ¢¯åº¦ä¸éœ€è¦è®¡ç®—æ¢¯åº¦</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>æ³¨ï¼šè¿™é‡Œä¸ºä»€ä¹ˆå•ç‹¬è·‘é¢„è®­ç»ƒæ¨¡å‹ä¸èƒ½æ•°æ®å¢å¹¿å‘¢ï¼Ÿ</p></blockquote>
<blockquote>
<p>æ•™æç”¨çš„æ˜¯keras, å®ƒå¤„ç†æ•°æ®çš„æ–¹å¼æ˜¯åšä¸€ä¸ªgeneraotrï¼Œåªè¦ä½ ç»™å®šæ•°æ®å¢å¹¿çš„è§„åˆ™ï¼ˆå‚æ•°ï¼‰ï¼Œå“ªæ€•åªæœ‰ä¸€å¼ å›¾ï¼Œå®ƒä¹Ÿæ˜¯å¯ä»¥æ— ç©·æ— å°½åœ°ç»™ä½ ç”Ÿæˆä¸‹ä¸€å¼ çš„ã€‚æ‰€ä»¥æ¯ä¸€æ¬¡è®­ç»ƒéƒ½èƒ½æœ‰æ–°çš„æ•°æ®å–‚åˆ°ç½‘ç»œé‡Œã€‚è¿™æ˜¯å‡ºäºå†…å­˜è€ƒè™‘ï¼Œä¸éœ€è¦çœŸçš„æŠŠæ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜é‡Œã€‚</p></blockquote>
<blockquote>
<p>è€Œå¦‚æœä½ æ˜¯ä¸€ä¸ªå›ºå®šçš„æ•°æ®é›†ï¼Œæ¯”å¦‚å‡ ä¸‡æ¡ï¼Œé‚£ä¹ˆä½ æŠŠæ‰€æœ‰çš„æ•°æ®è·‘ä¸€éæŠŠè¿™ä¸ªç»“æœå½“æˆæ•°æ®é›†ï¼ˆå…¨æ”¾åœ¨å†…å­˜é‡Œï¼‰ï¼Œé‚£ä¹Ÿä¸æ˜¯ä¸å¯ä»¥åœ¨è¿™ä¸€æ­¥ç”¨æ•°æ®å¢å¹¿ã€‚</p></blockquote>
<h3>Fine-tuning</h3>
<p>Fine-tuning consists of unfreezing a few of the top layers of a frozen model base used for feature extraction, and jointly training both the newly added part of the model (in this case, the fully connected classifier) and these top layers. This is called fine-tuning because it slightly adjusts the more abstract representations of the model being reused, in order to make them more relevant for the problem at hand.</p><p>å‰é¢çš„feature extractionæ–¹å¼ï¼Œä¼šæŠŠé¢„è®­ç»ƒçš„æ¨¡å‹ä½ é€‰ä¸­çš„layersç»™freezeæ‰ï¼Œå³ä¸è®¡ç®—æ¢¯åº¦ã€‚è¿™é‡Œä¹‹æ‰€ä»¥å«fine-tuningï¼Œæ„æ€å°±æ˜¯ä¼šæŠŠæœ€åå‡ å±‚(top-layers)ç»™<code>unfreezing</code>æ‰ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ä¿ç•™ä½çº§ç‰¹å¾ï¼Œé‡æ–°è®­ç»ƒé«˜çº§ç‰¹å¾ï¼Œè¿˜ä¿ç•™äº†åŸæ¥å¤§å‹æ¨¡å‹çš„ç»“æ„ï¼Œä¸éœ€è¦è‡ªè¡Œæ„å»ºã€‚</p><figure class="vertical-figure" style="flex: 15.321375186846039" ><img width="410" height="1338" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/705011af7667b591af29afe03230ecc5.png" alt=""/></figure><blockquote>
<p>ä½†æ˜¯ï¼š itâ€™s only possible to fine-tune the top layers of the convolutional base once the classifier on <code>top has already been trained</code>. é¢„è®­ç»ƒæ¨¡å‹æ²¡æœ‰frezzeä½çš„è¯losså°†ä¼šå¾ˆå¤§ï¼Œæ‰€ä»¥å˜æˆäº†å…ˆtrainä¸€ä¸ªå¤§ä½“å·®ä¸å¤šçš„classifierï¼Œå†è”åˆèµ·æ¥trainä¸€éé«˜çº§ç‰¹å¾å’Œclassifier:</p></blockquote>
<ol>
<li>Add your custom network on top of an already-trained base network.</li>
<li>Freeze the base network.</li>
<li>Train the part you added. (ç¬¬ä¸€æ¬¡train)</li>
<li>Unfreeze some layers in the base network.</li>
<li>Jointly train both these layers and the part you added.ï¼ˆç¬¬äºŒæ¬¡trainï¼‰</li>
</ol>
<p>ä½†åƒä¸‡åˆ«æŠŠæ‰€æœ‰å±‚éƒ½unfrezzeæ¥è®­ç»ƒäº†</p><ol>
<li>ä½çº§ç‰¹å¾éƒ½ä¸ºè¾¹ç¼˜å’Œé¢œè‰²ï¼Œæ— éœ€é‡æ–°è®­ç»ƒ</li>
<li>å°æ•°æ®é‡è®­ç»ƒå¤§å‹æ¨¡å‹ï¼Œmodel capacityç›¸å½“å¤§ï¼Œéå¸¸å®¹æ˜“è¿‡æ‹Ÿåˆ</li>
</ol>
<h3>Visualizing what convents learn</h3>
<p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ·±åº¦å­¦ä¹ éƒ½æ˜¯é»‘ç›’å­ï¼Œè‡³å°‘å¯¹å›¾åƒçš„å·ç§¯ç½‘ç»œä¸æ˜¯ -&gt; <code>representations of visual concepts</code>, ä¸‹é¢ä»‹ç»<strong>ä¸‰ç§</strong>è§†è§‰åŒ–å’Œå¯è§£é‡Šæ€§çš„representationsçš„æ–¹æ³•ã€‚</p><h4>Visualizing intermediate activations</h4>
<p>å°±æ˜¯æŠŠæ¯ä¸ªä¸­é—´å±‚(åŸºæœ¬ä¸Šæ˜¯&quot;å·ç§¯+æ± åŒ–+æ¿€æ´»â€œ)å¯è§†åŒ–å‡ºæ¥ï¼ŒThis gives a view into how an input is <code>decomposed</code> into the different filters learned by the network.</p><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">models</span>
<span class="n">layer_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">output</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[:</span><span class="mi">8</span><span class="p">]]</span> <span class="n">activation_model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">layer_outputs</span><span class="p">)</span>

<span class="n">activations</span> <span class="o">=</span> <span class="n">activation_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">first_layer_activation</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>

<span class="c1"># æ³¨æ„ä½¿ç”¨çš„æ˜¯matshowè€Œä¸æ˜¯show</span>
</pre></div>
<figure  style="flex: 101.9047619047619" ><img width="856" height="420" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/e5088f559521b7cc9c7b0cb129d275fe.png" alt=""/></figure><p>ä»¥ä¸Šä»£ç æ˜¯åˆ©ç”¨äº†kerasçš„Modelç‰¹æ€§ï¼Œå°†æ‰€æœ‰layersçš„è¾“å‡º<strong>æ‘Šå¹³</strong>ï¼ˆå°±æ˜¯åšäº†ä¸€ä¸ªå¤šå¤´çš„æ¨¡å‹ï¼‰ï¼Œç„¶åå†é¡ºä¾¿å–äº†ç¬¬4å’Œç¬¬7ä¸ªfeature mapç”»å‡ºæ¥ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå›¾ä¸€æ„Ÿå…´è¶£çš„æ˜¯<code>å¯¹è§’çº¿</code>ï¼Œå›¾äºŒæå–çš„æ˜¯<code>è“è‰²çš„äº®ç‚¹</code>ã€‚</p><p>ç»“æ„åŒ–è¿™äº›è¾“å‡ºï¼Œå¯ä»¥ç¡®ä¿¡åˆå§‹layerç¡®å®æå–çš„æ˜¯ç®€å•ç‰¹å¾ï¼Œè¶Šå¾€åè¶Šé«˜çº§ï¼ˆæŠ½è±¡ï¼‰ã€‚</p><p>A deep neural network effectively acts as an <code>information distillation</code>(ä¿¡æ¯è’¸é¦) pipeline, with raw data going in (in this case, RGB pictures) and being repeatedly transformed so that irrelevant information is filtered out (for example, the specific visual appearance of the image), and useful information is <code>magnified and refined</code> (for example, the class of the image).</p><blockquote>
<p>å…³é”®è¯ï¼šæœ‰ç”¨çš„ä¿¡æ¯è¢«ä¸æ–­<strong>æ”¾å¤§å’Œå¼ºåŒ–</strong></p></blockquote>
<p>ä¹¦é‡Œä¸¾äº†ä¸ªæœ‰è¶£çš„ä¾‹å­ï¼Œè¦ä½ ç”»ä¸€è¾†è‡ªè¡Œè½¦ã€‚ä½ ç”»å‡ºæ¥çš„å¹¶ä¸æ˜¯ä¸€è¾†å……æ»¡ç»†èŠ‚çš„å•è½¦ï¼Œè€Œå¾€å¾€æ˜¯ä½ æŠ½è±¡å‡ºæ¥çš„å•è½¦ï¼Œä½ ä¼šç”¨åŸºæœ¬çš„çº¿æ¡å‹¾å‹’å‡ºä½ å¯¹å•è½¦ç‰¹å¾çš„ç†è§£ï¼Œæ¯”å¦‚é¾™å¤´ï¼Œè½®å­ç­‰å…³é”®éƒ¨ä»¶ï¼Œä»¥åŠç›¸å¯¹ä½ç½®ã€‚ç”»å®¶ä¸ºä»€ä¹ˆèƒ½ç”»å¾—åˆçœŸå®åˆå¥½çœ‹ï¼Ÿé‚£å°±æ˜¯ä»–ä»¬çœŸçš„ä»”ç»†è§‚å¯Ÿäº†å•è½¦ï¼Œä»–ä»¬ç»˜ç”»çš„æ—¶å€™ç”¨çš„å¹¶ä¸æ˜¯ç‰¹å¾ï¼Œè€Œæ˜¯ä¸€åˆ‡ç»†èŠ‚ï¼Œç„¶è€Œå¯¹äºæ²¡æœ‰å—è¿‡è®­ç»ƒçš„æ™®é€šäººæ¥è¯´ï¼Œå¾€å¾€åªèƒ½ç”¨ç®€å•å‡ ç¬”å‹¾å‹’å‡ºè„‘æµ·ä¸­çš„å•è½¦çš„æ ·å­ï¼ˆå…¶å®å¹¶ä¸æ˜¯æ ·å­ï¼Œè€Œæ˜¯ç‰¹å¾çš„ç»„åˆï¼‰</p><h4>Visualizing convnet filters</h4>
<p>é€šè¿‡å¼ºåŒ–filterå¯¹è¾“å‡ºçš„ååº”å¹¶ç»˜åˆ¶å‡ºæ¥ï¼Œè¿™æ˜¯ä»æ•°å­¦æ–¹æ³•ä¸Šç›´æ¥è§‚å¯Ÿfilterï¼Œçœ‹ä»€ä¹ˆæœ€èƒ½â€œåˆºæ¿€â€ä¸€ä¸ªfilterï¼Œç”¨â€æ¢¯åº¦ä¸Šå‡â€œæœ€èƒ½ä½“ç°è¿™ç§æ€è·¯ï¼š</p><p>æŠŠoutputå½“æˆlossï¼Œç”¨æ¢¯åº¦ä¸Šå‡ï¼ˆæ¯æ¬¡ä¿®æ”¹input_imageï¼‰è®­ç»ƒå‡ºæ¥çš„outputå°±æ˜¯è¿™ä¸ªfilterçš„æç«¯æƒ…å†µï¼Œå¯ä»¥è®¤ä¸ºè¿™ä¸ªfilterå…¶å®æ˜¯åœ¨æå–ä»€ä¹ˆï¼ˆresponsive toï¼‰ï¼š</p><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">keras.applications</span> <span class="kn">import</span> <span class="n">VGG16</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">backend</span> <span class="k">as</span> <span class="n">K</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VGG16</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="s1">&#39;imagenet&#39;</span><span class="p">,</span> <span class="n">include_top</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">layer_name</span> <span class="o">=</span> <span class="s1">&#39;block3_conv1&#39;</span>
<span class="n">filter_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">layer_output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="n">layer_name</span><span class="p">)</span><span class="o">.</span><span class="n">output</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">layer_output</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">filter_index</span><span class="p">])</span>  <span class="c1"># outputå°±æ˜¯loss</span>

<span class="n">grads</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">gradients</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">input</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># å¯¹inputæ±‚å¾®åˆ†</span>
<span class="n">grads</span> <span class="o">/=</span> <span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">grads</span><span class="p">)))</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>

<span class="n">iterate</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">function</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">input</span><span class="p">],</span> <span class="p">[</span><span class="n">loss</span><span class="p">,</span> <span class="n">grads</span><span class="p">])</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># ç†è§£é™æ€å›¾çš„ç”¨æ³•</span>
<span class="n">loss_value</span><span class="p">,</span> <span class="n">grads_value</span> <span class="o">=</span> <span class="n">iterate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">3</span><span class="p">))])</span>

<span class="n">input_img_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="mf">128.</span>
<span class="n">step</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">):</span>
    <span class="n">loss_value</span><span class="p">,</span> <span class="n">grads_value</span> <span class="o">=</span> <span class="n">iterate</span><span class="p">([</span><span class="n">input_img_data</span><span class="p">])</span>
    <span class="n">input_img_data</span> <span class="o">+=</span> <span class="n">grads_value</span> <span class="o">*</span> <span class="n">step</span>  <span class="c1"># æ¢¯åº¦ä¸Šå‡</span>
</pre></div>
<p>æŒ‰ä¸Šè¿°ä»£ç çš„æ€è·¯ç»“æ„åŒ–è¾“å‡ºå¹¶ç»˜å›¾ï¼š</p><figure class="vertical-figure" style="flex: 47.148288973384034" ><img width="1240" height="1315" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/d3df8099cd6c93450e84a4cd01b67d19.png" alt=""/></figure><p>ä»çº¿æ¡åˆ°çº¹ç†åˆ°ç‰©ä»¶ï¼ˆçœ¼ç›ï¼Œæ¯›çš®ï¼Œå¶å­ï¼‰</p><blockquote>
<p>each layer in a convnet learns a collection of filters such that their inputs can be expressed as a <code>combination of the filters</code>.</p></blockquote>
<blockquote>
<p>This is similar to how the Fourier transform decomposes signals onto a bank of cosine functions.</p></blockquote>
<p>ç”¨å‚…é‡Œå¶å˜æ¢æ¥ç±»æ¯”å·ç§¯ç½‘ç»œæ¯ä¸€å±‚å°±æ˜¯æŠŠinputè¡¨ç¤ºæˆä¸€ç³»åˆ—ç‰¹å¾çš„ç»„åˆã€‚</p><h4>Visualizing heatmaps of class activation</h4>
<p>which parts of a given image led a convnet to its final classification decision. å³å›¾åƒæœ‰å“ªä¸€éƒ¨åˆ†å¯¹æœ€ç»ˆçš„å†³ç­–èµ·äº†ä½œç”¨ã€‚</p><ul>
<li><code>class activation map</code> (CAM) visualization,</li>
<li><code>Grad-CAM</code>: Visual Explanations from Deep Networks via Gradient-based Localization.â€</li>
</ul>
<blockquote>
<p>youâ€™re weighting a spatial map of â€œhow intensely the input image activates different channelsâ€ by â€œhow important each channel is with regard to the class,â€ resulting in a spatial map of â€œhow intensely the input image activates the class.</p></blockquote>
<p>è§£è¯»ä¸Šé¢è¿™å¥è¯ï¼š</p><p>ä¸åŒchannelsï¼ˆç‰¹å¾ï¼‰å¯¹å›¾åƒçš„æ¿€æ´»çš„å¼ºåº¦<br />
+<br />
æ¯ä¸ªç‰¹å¾å¯¹(é‰´å®šä¸ºï¼‰è¯¥ç±»åˆ«çš„é‡è¦ç¨‹åº¦<br />
=<br />
è¯¥â€œç±»åˆ«â€å¯¹å›¾åƒçš„æ¿€æ´»çš„å¼ºåº¦</p><p>ä¸€å¼ ä¸¤åªäºšæ´²è±¡çš„ä¾‹å›¾ï¼Œä½¿ç”¨VGG16æ¥åšåˆ†ç±»ï¼Œå¾—åˆ°92.5%çš„ç½®ä¿¡åº¦çš„äºšæ´²è±¡çš„åˆ¤æ–­ï¼Œä¸ºäº†visualizeå“ªä¸ªéƒ¨åˆ†æ‰æ˜¯â€œæœ€åƒäºšæ´²è±¡â€çš„ï¼Œä½¿ç”¨<code>Grad-CAM</code>å¤„ç†ï¼š</p><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">keras.applications.vgg16</span> <span class="kn">import</span> <span class="n">VGG16</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VGG16</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="s1">&#39;imagenet&#39;</span><span class="p">)</span>
<span class="n">african_e66lephant_output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="p">[:,</span> <span class="mi">386</span><span class="p">]</span>  <span class="c1"># äºšæ´²è±¡åœ¨IMGNETçš„ç±»åˆ«æ˜¯386</span>
<span class="n">last_conv_layer</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;block5_conv3&#39;</span><span class="p">)</span> <span class="c1"># top conv layer</span>

<span class="n">grads</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">gradients</span><span class="p">(</span><span class="n">african_elephant_output</span><span class="p">,</span> <span class="n">last_conv_layer</span><span class="o">.</span><span class="n">output</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> 
<span class="n">pooled_grads</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">grads</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">iterate</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">function</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">input</span><span class="p">],</span>
                     <span class="p">[</span><span class="n">pooled_grads</span><span class="p">,</span> <span class="n">last_conv_layer</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">pooled_grads_value</span><span class="p">,</span> <span class="n">conv_layer_output_value</span> <span class="o">=</span> <span class="n">iterate</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">512</span><span class="p">):</span>
    <span class="n">conv_layer_output_value</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">pooled_grads_value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">heatmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">conv_layer_output_value</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
<figure  style="flex: 77.77777777777777" ><img width="1036" height="666" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/9020d228898abcf96e2855b7e028374b.png" alt=""/></figure><p>å åŠ åˆ°åŸå›¾ä¸Šå»ï¼ˆç”¨cv2èåˆä¸¤å¼ å›¾ç‰‡ï¼Œå³ç›¸åŒç»´åº¦çš„æ•°ç»„ä»¥ä¸åŒæƒé‡é€åƒç´ ç›¸åŠ ï¼‰ï¼š</p><figure  style="flex: 75.97402597402598" ><img width="702" height="462" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/9261ae2a67e61c26e078db210f218d11.png" alt=""/></figure>
            </div>
        </article>
        <div class="prism-post-meta col-md-8 offset-md-2">
    <span>walker</span>
    
    <span>/</span>
    <span>
        <a class="category no-link" href="/category/posts/" target="_self">
        posts
        </a>
    </span>
    
    
    <span>/</span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/deep%20learning/" target="_self">#deep learning</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" target="_self">#æ·±åº¦å­¦ä¹ </a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/keras/" target="_self">#keras</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/cv/" target="_self">#cv</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/nlp/" target="_self">#nlp</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/tensorflow/" target="_self">#tensorflow</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/gan/" target="_self">#gan</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/lstm/" target="_self">#lstm</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/language%20mode/" target="_self">#language mode</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/rnn/" target="_self">#rnn</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/heatmap/" target="_self">#heatmap</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/dropout/" target="_self">#dropout</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/machine%20learning/" target="_self">#machine learning</a>
    </span>
    
    
    
    <span>/</span>
    <span class="leancloud_visitors" id="/archives/Deep-Learning-with-Python-Notes-4/" data-flag-title="ã€ŠDeep Learning with Pythonã€‹ç¬”è®°[4]"><span class="leancloud-visitors-count"></span> Views</span>
    
</div>
    </section>

    
<section id="prism__pagination" class="prism-pagination" class="col-md-8 offset-md-2">
    <ul>
        
        <li class="next">
            <a class="no-link" href="/archives/Deep-Learning-with-Python-Notes-5/" target="_self" title="ã€ŠDeep Learning with Pythonã€‹ç¬”è®°[5]"><i class="fa fa-chevron-left" aria-hidden="true"></i>Newer</a>
        </li>
        
        
        <li class="prev">
            <a class="no-link" href="/archives/Deep-Learning-with-Python-Notes-3/" target="_self" title="ã€ŠDeep Learning with Pythonã€‹ç¬”è®°[3]">Older<i class="fa fa-chevron-right" aria-hidden="true"></i></a>
        </li>
        
    </ul>
</section>


    
    <script>
        var initValine = function() {
            new Valine({"enable": true, "el": "#vcomments", "appId": "7tP92LoqK2cggW61DvJmWBo0-gzGzoHsz", "appKey": "iQCtrtlr8eKrQllM03GMESMJ", "visitor": true, "recordIP": true});
        }

    </script>
    <script defer src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js' onload="initValine()"></script>
    <div class="prism-comment-section container" id="prism__comment">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <div id="vcomments"></div>
            </div>
        </div>
    </div>
    

</main>

            <footer id="prism__footer">
                <section>
                    <div>
                        <nav class="social-links">
                            <ul><li><a class="no-link" title="Twitter" href="https://twitter.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-twitter"></i></a></li><li><a class="no-link" title="GitHub" href="https://github.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-github"></i></a></li><li><a class="no-link" title="Weibo" href="https://weibo.com/1071696872" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-weibo"></i></a></li></ul>
                        </nav>
                    </div>

                    <section id="prism__external_links">
                        <ul>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://github.com/AlanDecode/Maverick" rel="noopener noreferrer nofollow">Maverick</a>ï¼šğŸ„â€ Go My Own Way.
                                <span>|</span>
                            </li>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://www.imalan.cn" rel="noopener noreferrer nofollow">Triple NULL</a>ï¼šHome page for AlanDecode.
                                <span>|</span>
                            </li>
                            
                        </ul>
                    </section>

                    <div class="copyright">
                        <p class="copyright-text">
                            <span class="brand">walker's code blog</span>
                            <span>Copyright Â© 2022 walker</span>
                        </p>
                        <p class="copyright-text powered-by">
                            | Powered by <a href="https://github.com/AlanDecode/Maverick" class="no-link" target="_blank" rel="noopener noreferrer nofollow">Maverick</a> | Theme <a href="https://github.com/Reedo0910/Maverick-Theme-Prism" target="_blank" class="no-link" rel="noopener noreferrer nofollow">Prism</a>
                        </p>
                    </div>
                    <div class="footer-addon">
                        
                    </div>
                </section>
                <script>
                    var site_build_date = "2019-12-06T12:00+08:00"

                </script>
                <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-efa8685153.js"></script>
            </footer>
        </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-493cb9cd89.js"></script>

    <!--katex-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.js"></script>
    <script>
        mathOpts = {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false }
            ]
        };

    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
</body>

</html>