<!DOCTYPE HTML>
<html lang="english">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,AlanDecode,Galileo,blog" />
    <meta name="generator" content="Maverick 1.2.1" />
    <meta name="template" content="Prism" />
    <link rel="alternate" type="application/rss+xml" title="walker's code blog &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="walker's code blog &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-b9d78ff38a.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-182e5a8869.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/0792c859af00d57f17774077bdd3dbf1.json"
        }

    </script>
    
<title>Programming iOS 14 - Layer - walker's code blog</title>
<meta name="author" content="walker" />
<meta name="description" content="ã€ŠProgramming iOS 14: Dive Deep into Views, View Controllers, and Frameworksã€‹ç¬¬3ç« " />
<meta property="og:title" content="Programming iOS 14 - Layer - walker's code blog" />
<meta property="og:description" content="ã€ŠProgramming iOS 14: Dive Deep into Views, View Controllers, and Frameworksã€‹ç¬¬3ç« " />
<meta property="og:site_name" content="walker's code blog" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/Layer/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2022-02-18T00:00:00-00.00" />
<meta name="twitter:title" content="Programming iOS 14 - Layer - walker's code blog" />
<meta name="twitter:description" content="ã€ŠProgramming iOS 14: Dive Deep into Views, View Controllers, and Frameworksã€‹ç¬¬3ç« " />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
</head>

<body>
    <div class="container prism-container">
        <header class="prism-header" id="prism__header">
            <h1 class="text-uppercase brand"><a class="no-link" href="/" target="_self">walker's code blog</a></h1>
            <p>coder, reader</p>
            <nav class="prism-nav"><ul><li><a class="no-link text-uppercase " href="/" target="_self">Home</a></li><li><a class="no-link text-uppercase " href="/archives/" target="_self">Archives</a></li><li><a class="no-link text-uppercase " href="/about/" target="_self">About</a></li><li><a href="#" target="_self" class="search-form-input no-link text-uppercase">Search</a></li></ul></nav>
        </header>
        <div class="prism-wrapper" id="prism__wrapper">
            
<main>
    <section class="prism-section row" id="prism__content">
        <article class="yue col-md-8 offset-md-2">
            <h1 class="prism-post-title">Programming iOS 14 - Layer</h1>
            <div class="prism-post-time">
                <time class="text-uppercase">
                    February 18 2022
                </time>
            </div>
            <div class="prism-content-body">
                <p>ã€ŠProgramming iOS 14: Dive Deep into Views, View Controllers, and Frameworksã€‹ç¬¬3ç« </p><hr />
<h1>Layers</h1>
<ul>
<li>A UIView does not actually <strong>draw itself</strong> onto the screen; it draws itself <strong>into its layer</strong>, and it is the layer that is portrayed on the screen.</li>
<li>a view is not <strong>redrawn</strong> frequently;</li>
<li>instead, its drawing is cached, and the cached version of the drawing (<code>the bitmap backing store</code>) is used where possible.</li>
<li>The cached version is, in fact, the <code>layer</code>.</li>
<li>the viewâ€™s graphics context is <code>actually</code> the layerâ€™s graphics context.</li>
<li>a layer is the <code>recipient</code> and <code>presenter</code> of a viewâ€™s drawing</li>
<li>Layers are <code>made to be animated</code></li>
<li>ViewæŒæœ‰layerï¼Œæ˜¯layerçš„ä»£ç†ï¼ˆ<code>CALayerDeletgate</code>ï¼‰<ul>
<li>ä½†layerä¸èƒ½æ‰¾åˆ°View</li>
</ul>
</li>
<li>Viewçš„å¤§éƒ¨åˆ†å±æ€§éƒ½åªæ˜¯å…¶<code>underlying layer</code>çš„ä¾¿æ·æ–¹æ³•</li>
<li>layerèƒ½æ“æ§å’Œæ”¹å˜viewçš„è¡¨ç°ï¼Œè€Œæ— éœ€ask the view to redraw itself</li>
</ul>
<p>è‡ªå®šä¹‰underlaying layerçš„æ–¹æ³•</p><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">CompassView</span> <span class="p">:</span> <span class="bp">UIView</span> <span class="p">{</span>
    <span class="kr">override</span> <span class="kd">class</span> <span class="nc">var</span> <span class="n">layerClass</span> <span class="p">:</span> <span class="nb">AnyClass</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">CompassLayer</span><span class="p">.</span><span class="kc">self</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h2>Layers and Sublayers</h2>
<ul>
<li><p>layerçš„ç»§æ‰¿æ ‘è·Ÿviewçš„ç»§æ‰¿æ ‘å‡ ä¹ä¸€è‡´</p></li>
<li><p>layerçš„<code>masksToBounds</code>å±æ€§å†³å®šäº†èƒ½å¦æ˜¾ç¤ºsublayerè¶…å‡ºäº†å…¶boundsçš„éƒ¨åˆ†ï¼Œè¿™ä¹Ÿæ˜¯viewçš„<code>clipsToBounds</code>çš„å¹³è¡Œå±æ€§</p></li>
<li><p><code>sublayers</code>æ˜¯å¯å†™çš„ï¼Œè€Œ<code>subviews</code>ä¸æ˜¯</p><ul>
<li>æ‰€ä»¥è®¾ä¸ºnilå¯ä»¥ç§»é™¤æ‰€æœ‰å­å±‚ï¼Œä½†subviewå´éœ€è¦ä¸€ä¸ªä¸ª<code>removeFromSuperview</code></li>
</ul>
</li>
<li><p><code>zPostion</code>å†³å®šäº†å±‚çº§ï¼ˆorderï¼‰ï¼Œé»˜è®¤å€¼éƒ½æ˜¯0.0</p></li>
<li><p>a layer does not have a centeré <code>position</code>å’Œ<code>anchorPoint</code>å®šä½</p><ul>
<li>position: åœ¨superLayerä¸­çš„ä½ç½®</li>
<li>anchorPoint: ç”¨å°æ•°è¡¨ç¤ºçš„bound(å®½/é«˜)ä½ç½®ï¼Œå·¦ä¸Š(0, 0), å³ä¸‹(1, 1)ï¼Œ default:(0.5, 0.5)</li>
<li>æ‰€ä»¥(0.5, 0.5)çš„anchorPointï¼Œå¯¹åº”çš„<code>poosition</code>å°±ç­‰åŒäºcenteräº†ï¼Œç†è§£ä¸€ä¸‹<ul>
<li>å…¶å®å°±æ˜¯è¯´ä½ çš„â€œé”šç‚¹â€åœ¨superLayerçš„ä»€ä¹ˆä½ç½®çš„æ„æ€</li>
</ul>
</li>
<li>When you get the frame, it is calculated from the <code>bounds size</code> along with the <code>position</code> and <code>anchorPoint</code>.<ul>
<li>When you set the frame, you set the <code>bounds</code> size and <code>position</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1">// demo, æŠŠä¸€ä¸ª80x40çš„layerï¼Œå·¦ä¸Šè§’æ”¾åˆ°(130, 120çš„ä½ç½®ï¼‰</span>
<span class="n">let</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">CALayer</span><span class="p">()</span><span class="w"></span>
<span class="n">layer</span><span class="p">.</span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">:</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w"></span>
<span class="n">layer</span><span class="p">.</span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIColor</span><span class="p">.</span><span class="n">yellow</span><span class="p">.</span><span class="n">cgColor</span><span class="w"></span>
<span class="n">layer</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">120</span><span class="p">)</span><span class="w"></span>
<span class="n">layer</span><span class="p">.</span><span class="n">anchorPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</pre></div>
<blockquote>
<p>å¦‚æœä¸€ä¸ªlayerçš„positionæ˜¯(0, 0)ï¼Œé”šç‚¹æ˜¯(0,0)ï¼Œåˆšå¥½æ˜¾ç¤ºåœ¨å·¦ä¸Šè§’
è€Œï¼ˆ0.5ï¼Œ0.5)åˆ™åªèƒ½æ˜¾ç¤ºå³ä¸‹è§’çš„1/4äº†
å³(0.5, 0.5)åˆ°äº†åŸæ¥(0,0)çš„ä½ç½®ã€‚æ‰€ä»¥è¯´å…¶å®å°±æ˜¯æŠŠè‡ªèº«boundsåº¦é‡ä¸‹çš„å“ªä¸ªä½ç½®ç§»åˆ°(0,0)</p></blockquote>
<p>è¿™ä¹ˆè¯´æ¥ï¼Œå¯¹é”šç‚¹çš„æœ€æ­£ç¡®ç†è§£å…¶å®æ˜¯ï¼Œ</p><ul>
<li>æˆ‘æŠŠè‡ªèº«åæ ‡ç³»é‡Œçš„å“ªä¸ªç‚¹å®šä¹‰ä¸ºåŸç‚¹ï¼Œ</li>
<li>å¹¶ä¸”ï¼Œè¿™ä¸ªç‚¹ç§»åˆ°åŸæœ¬â€œå·¦ä¸Šè§’â€çš„ä½ç½®ï¼ˆæƒ³è±¡0.5,0.5)</li>
<li>å¹¶ä¸”ï¼Œæ‰€æœ‰çš„æ—‹è½¬ä¹‹ç±»çš„åŠ¨ç”»æœ¬æ¥æ˜¯å¯¹â€œå·¦ä¸Šè§’â€<strong>çš„ä½ç½®</strong>è¿›è¡Œçš„ï¼Œä¸ç®¡ç°åœ¨è¿™ä¸ªä½ç½®æ˜¯layerä¸Šçš„å“ªä¸ªéƒ¨åˆ†<ul>
<li>æˆ–è€…è¯´ï¼Œæ—‹è½¬æ°¸è¿œæ˜¯å‘ç”Ÿåœ¨<code>position</code>ä¸Šçš„ï¼Œä½ æŠŠå“ªä¸ªç‚¹æ”¾åˆ°positionä¸Šå®ƒä¸ç®¡</li>
</ul>
</li>
</ul>
<p>ç†è§£frameçš„å°ç»ƒä¹ </p><div class="highlight"><pre><span></span><span class="c1">// å¦‚æœæˆ‘è®¾äº†layerçš„frame:</span>
<span class="n">circle</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">:</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w"></span>

<span class="c1">// å®é™…ä¸Šæ˜¯é€šè¿‡size, position, anchorPointæ¥å®ç°çš„ï¼š</span>
<span class="n">circle</span><span class="p">.</span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">:</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w"></span>

<span class="c1">// ä»¥å·¦ä¸Šè§’ä¸ºanchorPoint</span>
<span class="n">circle</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="mi">50</span><span class="p">)</span><span class="w"></span>
<span class="n">circle</span><span class="p">.</span><span class="n">anchorPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="c1">// æˆ–è€…ï¼Œä»¥ä¸­å¿ƒä¸ºanchorPoint</span>
<span class="n">circle</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="mi">150</span><span class="p">)</span><span class="w"></span>
<span class="n">circle</span><span class="p">.</span><span class="n">anchorPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="mf">0.5</span><span class="p">)</span><span class="w"></span>
<span class="c1">// æˆ–è€…å…¶å®ƒä»»æ„anchorPointï¼Œå‰ææ˜¯è‡ªå·±æ¢ç®—</span>
<span class="c1">// è€Œä¸”ï¼Œè™½ç„¶ä½ç½®æ˜¯ä¸€æ ·çš„ï¼Œä½†ä¼šå½±å“transform</span>
</pre></div>
<p><strong>CAScrollLayer</strong></p><ul>
<li>ä½ æƒ³é€šè¿‡ç§»åŠ¨layerçš„boundsæ¥é‡å®šä½sublayersï¼Œå¯ä»¥ä½¿ç”¨<code>CAScrollLayer</code></li>
<li>ä½†æ˜¯å®ƒå¹¶ä¸èƒ½é€šè¿‡æ‹–æ‹½æ¥ç§»åŠ¨é‡Œé¢çš„å†…å®¹ï¼ˆè®°å¾—å®ƒæ²¡æœ‰å“åº”é“¾ï¼‰</li>
<li>è€Œæ˜¯ç†è§£ä¸ºä¸€ä¸ª<code>masksToBounds</code>çš„çª—å£ï¼Œä½ åªèƒ½çœ‹åˆ°å®ƒboundsé‡Œé¢çš„å†…å®¹</li>
<li>èƒ½é€šè¿‡æœ¬èº«çš„<code>scroll(to:)</code>æ–¹æ³•ï¼Œå’Œsublayersçš„<code>scroll(_:)</code>å’Œ<code>scrollRectToVisible(_:)</code>æ–¹æ³•æ¥æ”¹å˜scroll layerçš„boundsï¼Œè¾¾åˆ°æ˜¾ç¤ºsublayeræŒ‡å®šåŒºåŸŸçš„ç›®çš„</li>
</ul>
<p><strong>Layer and Delegate</strong></p><ul>
<li>å¯¹ä¸€ä¸ªä¸æ˜¯UIViewçš„undrelying layerçš„layerï¼Œè®©ï¼ˆä»»æ„ï¼‰ä¸€ä¸ªå¯¹è±¡æˆä¸ºå…¶delegateï¼Œå¯ä»¥ç”±å®ƒæ¥æ“æ§å®ƒçš„layoutå’Œdrawing</li>
<li>ä½†åƒä¸‡ä¸è¦è®©UIViewæˆä¸ºä¸æ˜¯å…¶underlyingçš„layerçš„ä»£ç†ï¼Œåä¹‹äº¦ç„¶</li>
</ul>
<p><strong>Layout of Lyaers</strong></p><ul>
<li>When a layer needs layout, either because its <em>bounds have changed</em> or because you called <code>setNeedsLayout</code></li>
</ul>
<h2>Drawing in a Layer</h2>
<ul>
<li>set <code>contents</code> is the simplest way to draw in a layer -&gt; <code>CGImage</code><ul>
<li>ä½†<code>contents</code>èƒ½æ¥å—ä»»ä½•ç±»å‹ï¼Œæ‰€ä»¥ä¸æ­£ç¡®çš„contentåªä¼š<strong>fail silently</strong></li>
</ul>
</li>
<li>layerä¹Ÿæœ‰ä¸€ä¸ª<code>draw(_:)æ–¹æ³•ï¼Œå®ƒè¢«(è‡ªåŠ¨)è°ƒç”¨çš„æ—¶å€™é€šå¸¸è¡¨ç¤ºè¦</code>redisplay itself`ï¼Œä»€ä¹ˆæ—¶å€™éœ€è¦redisplay itself?<ul>
<li>å¦‚æœ<code>needsDisplayOnBoundsChange</code>æ˜¯falseï¼Œé‚£ä¹ˆå°±åªæœ‰åœ¨<code>sefNeedDisplay</code>æ–¹æ³•ï¼ˆåŠå…¶<code>inRect</code>è¡ç”Ÿæ–¹æ³•ï¼‰é‡Œä¼šè§¦å‘<ul>
<li>å¦‚æœæ˜¯éå¸¸é‡è¦çš„é‡ç»˜ï¼Œé‚£ä¹ˆéœ€è¦å†æ˜¾å¼è°ƒç”¨ä¸€æ¬¡<code>displayIfNeeded</code></li>
</ul>
</li>
<li>æ˜¯trueçš„è¯å°±å¦‚å…¶åï¼Œåœ¨boundså˜åŒ–çš„æ—¶å€™ä¹Ÿä¼šé‡ç»˜</li>
</ul>
</li>
<li>æœ‰å››ä¸ªæ–¹æ³•èƒ½åœ¨redisplayçš„æ—¶å€™è°ƒç”¨:<ol>
<li>subclassçš„<code>display</code>é‡è½½ï¼Œå®ƒæ²¡æœ‰<code>graphics context</code>ï¼Œæ‰€ä»¥åªèƒ½æä¾›å›¾ç‰‡</li>
<li>delegateçš„<code>display(in:)</code>æ–¹æ³•ï¼ŒåŒæ ·ï¼Œåªèƒ½æä¾›å›¾ç‰‡</li>
<li>subclassçš„<code>draw(in:)</code>æ–¹æ³•ï¼Œæœ‰contextï¼Œæ‰€ä»¥èƒ½ç›´æ¥åœ¨é‡Œé¢ç»˜å›¾ï¼Œä½†ä¸ä¼š<code>make current context</code></li>
<li>delegateçš„<code>draw(_:in)</code>æ–¹æ³•ï¼Œé™åˆ¶ä¹ŸåŒä¸Š</li>
</ol>
</li>
<li>underlaying layerä¸åº”è°ƒç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œè€Œäº¤ç”±viewçš„<code>draw(_:)</code>æ–¹æ³•<ul>
<li>ä¸€å®šè¦è°ƒä¹Ÿå¯ä»¥ï¼Œä½†è¦æ˜¾å¼å®ç°viewçš„<code>draw(_:)</code>æ–¹æ³•ï¼Œæ–¹æ³•ä½“ä¸ºç©ºå°±è¡Œäº†</li>
</ul>
</li>
</ul>
<p><strong>Drawing-Related Layer Properties</strong></p><ul>
<li>contentsScale: åƒç´ å¯¹é«˜åˆ†å±çš„æ˜ å°„ï¼ŒCocoaç®¡ç†çš„layerä¼šè‡ªåŠ¨è®¾ç½®ï¼Œè‡ªå®šä¹‰çš„ç±»éœ€è¦æ³¨æ„è¿™ä¸ªscale</li>
<li>opacity: å°±æ˜¯viewçš„<code>alpha</code><ul>
<li>Changing the isOpaque property has no effect until the layer redisplays itself.</li>
</ul>
</li>
</ul>
<p><strong>Content Resizing and Positioning</strong></p><ul>
<li>A layerâ€™s content is stored (cached) as a bitmap which is then treated like an image:<ul>
<li>å¦‚æœcontentæ¥è‡ªä¸€å¼ å›¾ç‰‡ï¼Œé‚£ä¹ˆç¼“å­˜çš„å°±æ˜¯å›¾ç‰‡ï¼ˆCGImageï¼‰ï¼Œå¤§å°å°±æ˜¯å›¾ç‰‡çš„point size</li>
<li>å¦‚æœæ¥è‡ªç»˜å›¾ï¼Œé‚£ä¹ˆå­˜çš„æ˜¯graphics context</li>
</ul>
</li>
<li><code>ContentGravity</code>ï¼Œç±»ä¼¼UIViewâ€™s contentMode propertyï¼Œå³ç¼©æ”¾æ‹‰ä¼¸<ul>
<li>å› ä¸ºåæ ‡ç³»ä¸åŒçš„å†å²åŸå› ï¼Œtop, bottomæ˜¯ç›¸åçš„</li>
<li>å¦‚æœæ˜¯è‡ªå·±ç»˜åˆ¶ï¼Œåˆ™è¿™ä¸ªå±æ€§æ— æ„ä¹‰ï¼Œä½†ç»“åˆä¸‹é¢çš„rectå±æ€§åˆæœ‰ç”¨äº†ï¼Œå› ä¸ºæˆªå–äº†rectå¤§å°çš„ç»˜åˆ¶</li>
</ul>
</li>
<li><code>contentsRect</code>ï¼Œç»“åˆä¸Šä¸€ä¸ªå±æ€§ï¼Œåšè´­ç‰©ç½‘ç«™é‚£ç§æˆªå–ä¸€å°å—ï¼Œç»˜åˆ¶åˆ°ä¸€ä¸ªå¤§å›¾ä¸Šå»ã€‚è¿™é‡Œæ˜¯ç»˜åˆ¶åˆ°viewä¸Š<ul>
<li>é»˜è®¤æ˜¯å…¨å›¾(0,0,1,1)</li>
</ul>
</li>
<li><code>contentsCenter</code> ?? å¥½åƒæ˜¯å¯¹ä¸Šè¿°rectå±æ€§åˆ’æˆ9å®«æ ¼ï¼Œä¸åŒä½ç½®çš„æ ¼å­ç¼©æ”¾è§„åˆ™ä¸ä¸€æ ·ï¼Œæ¯”å¦‚å››ä¸ªè§’è½çš„æ ¼å­ï¼Œä¸ä¼šç¼©æ”¾<ul>
<li>æ‰€ä»¥ç»™äº†ä¸€ä¸ªcenter regionï¼ˆrect)ï¼ŒæŠŠå®ƒçš„å››æ¡è¾¹å»¶é•¿ï¼Œå°±æœ‰9ä¸ªæ ¼å­äº†</li>
</ul>
</li>
</ul>
<p><strong>Layers that Draw Themselves</strong></p><p>ç³»ç»Ÿå†…ç½®äº†ä¸€äº›èƒ½è‡ªæˆ‘ç»˜åˆ¶çš„layer:</p><ul>
<li>CATextLayerï¼Œè½»é‡ç‰ˆçš„UILabelã€‚é€šè¿‡<code>string</code>å±æ€§å­˜å–ï¼Œä¸<code>contenta</code>ä¼šå†²çªï¼Œä¸è¦åŒæ—¶è®¾ã€‚</li>
<li>CAShapeLayer, æœ‰pathå±æ€§ï¼Œå¯ä»¥ä¸<code>contents</code>å…±å­˜ï¼Œpathç»˜åˆ¶äºcontentä¹‹ä¸Šï¼Œå¹¶ä¸”ä¸èƒ½è®¾èåˆæ¨¡å¼</li>
<li>CAGradientLayerï¼Œé€šè¿‡èƒŒæ™¯è‰²åšçš„æ¸å˜ï¼Œå»äº†è§£ä¸‹clipå’Œmask</li>
</ul>
<h2>Transforms</h2>
<ul>
<li>viewçš„transformæ˜¯æ ¹æ®å…¶<strong>center</strong>æ¥åº”ç”¨çš„ï¼Œlayerçš„æ˜¯æ ¹æ®<code>anchorPoint</code><ul>
<li>æ‰€ä»¥<code>anchorPoint</code>å°±ä¸¤ä¸ªä½œç”¨ï¼ŒæŠŠå®ƒç§»åŠ¨åˆ°<code>position</code>çš„ä½ç½®ï¼Œå’Œä»¥å®ƒä¸ºä¸­å¿ƒè¿›è¡Œæ—‹è½¬</li>
</ul>
</li>
</ul>
<ol>
<li>ç”»åˆ»åº¦ï¼Œæ ¸å¿ƒæ˜¯æŠŠæ–‡å­—å…ˆå¾€ä¸ŠæŒªåˆ°åœ†åœˆçš„ä½ç½®ï¼Œæ‰€ä»¥anchorPointåªåŠ¨yä¸åŠ¨x (center, midY/textHeight)</li>
</ol>
<div class="highlight"><pre><span></span><span class="n">let</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ABCD&quot;</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">str</span><span class="p">.</span><span class="n">enumerated</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">CATextLayer</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">:</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">:</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">circle</span><span class="p">.</span><span class="n">center</span><span class="w"> </span><span class="c1">// è¿™æ‰æ˜¯æ ¸å¿ƒï¼Œä¸€åˆ‡å®šä½å’Œæ—‹è½¬çš„åŸºå‡†</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">vert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">circle</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">midY</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">height</span><span class="w"></span>
<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">anchorPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="n">vert</span><span class="p">)</span><span class="w"> </span><span class="c1">// åŠåœ†æ˜¯æ–‡å­—è°ƒè“„çš„å¤šå°‘å€ï¼Œå°±ä¸Šç§»å¤šå°‘ï¼Œä½†éšå½¢çš„è„šï¼ˆå³é«˜è··çš„æ”¯ç‚¹ï¼‰ä»åœ¨positionå¤„</span>
<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">foregroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIColor</span><span class="p">.</span><span class="n">red</span><span class="p">.</span><span class="n">cgColor</span><span class="w"></span>

<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">setAffineTransform</span><span class="p">(</span><span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">rotationAngle</span><span class="o">:</span><span class="w"> </span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CGFloat</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="n">circle</span><span class="p">.</span><span class="n">addSublayer</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>ç»“æœå¦‚å›¾ï¼š
<figure class="vertical-figure" style="flex: 49.51923076923077" ><img width="412" height="416" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/031ad73f3f956d76b906cf986e36e22e.png" alt=""/></figure></p><ol start="2">
<li>ç”»ç®­å¤´ï¼Œæ¼”ç¤ºäº†å¤æ‚çš„ç»˜åˆ¶æ€ä¹ˆæŠŠå®ƒä»£ç†å‡ºå»ï¼Œå¹¶ä¸”ä»€ä¹ˆæ—¶æœºè®©å®ƒäº§ç”Ÿç»˜åˆ¶ï¼š</li>
</ol>
<div class="highlight"><pre><span></span><span class="c1">// the arrow</span>
<span class="n">let</span><span class="w"> </span><span class="n">arrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">CALayer</span><span class="p">()</span><span class="w"></span>
<span class="n">arrow</span><span class="p">.</span><span class="n">contentsScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIScreen</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">scale</span><span class="w"></span>
<span class="n">arrow</span><span class="p">.</span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"></span>
<span class="n">arrow</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">center</span><span class="w"></span>
<span class="n">arrow</span><span class="p">.</span><span class="n">anchorPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">)</span><span class="w"> </span><span class="c1">// ç®­å°¾å‡¹è¿›å»çš„ä½ç½®ï¼ˆæ‰€ä»¥ä¸å¯èƒ½æ˜¯1.0ï¼‰</span>
<span class="n">arrow</span><span class="p">.</span><span class="n">delegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">self</span><span class="w"> </span><span class="c1">// we will draw the arrow in the delegate method</span>
<span class="n">arrow</span><span class="p">.</span><span class="n">setAffineTransform</span><span class="p">(</span><span class="bp">CGAffineTransform</span><span class="p">(</span><span class="n">rotationAngle</span><span class="o">:</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">5.0</span><span class="p">))</span><span class="w"></span>
<span class="nb">self</span><span class="p">.</span><span class="n">addSublayer</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span><span class="w"></span>
<span class="n">arrow</span><span class="p">.</span><span class="n">setNeedsDisplay</span><span class="p">()</span><span class="w"> </span><span class="c1">// draw, please</span>
</pre></div>
<p>** 3D Transforms</p><ul>
<li>A layerâ€™s <code>affineTransform</code> is merely a faÃ§ade for accessing its <code>transform</code>.</li>
<li>A layerâ€™s <code>transform</code> is a three-dimensional transform, a <code>CATransform3D</code></li>
</ul>
<p>ç»•Yè½´é•œåƒçš„ç¤ºä¾‹ï¼š</p><div class="highlight"><pre><span></span><span class="n">someLayer</span><span class="p">.</span><span class="n">transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CATransform3DMakeRotation</span><span class="p">(.</span><span class="n">pi</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</pre></div>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œåœ¨Zè½´æ²¡æœ‰åˆ†é‡çš„å¹³é¢å›¾ï¼Œé‚£å°±åªå‰©æ—‹è½¬çš„æ•ˆæœäº†ï¼ˆæ²¡æœ‰ç¿»è½¬)
<figure  style="flex: 51.151315789473685" ><img width="622" height="608" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/714bca8197bc1e5f9e71216b3ccd0745.png" alt=""/></figure></p><p>è¿™æ˜¯æŠŠanchorPointè®¾åœ¨äº†åœ†å¿ƒï¼Œå¦‚æœè®¾åœ¨(0,0):
<figure class="vertical-figure" style="flex: 45.258620689655174" ><img width="1260" height="1392" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/8e747494f676181ffca14504623cb89b.png" alt=""/></figure></p><ul>
<li>layerä¸æ˜¯ä¸ºäº†3Då»ºæ¨¡è€Œè¯ç”Ÿçš„ï¼ˆè€ƒè™‘<code>Metal</code>ï¼‰ï¼Œå®ƒæ˜¯2Då¯¹è±¡ï¼Œä¸º<code>speed</code>å’Œ<code>simplicity</code>è€Œè®¾è®¡</li>
</ul>
<p><strong>depth</strong></p><p>ç°å®ä¸–ç•Œ<code>z-component</code>çš„åŠ å…¥ä¼šè¿‘å¤§è¿œå°ï¼Œlayerç»˜åˆ¶æ²¡æœ‰è¡¨ç°å‡ºè¿™ç§è·ç¦»ï¼Œè€Œæ˜¯å‹å¹³åˆ°ä¸€ä¸ªé¢ï¼š<code>orthographic projection</code>ï¼Œä½†æ˜¯ä½¿ç”¨äº†ä¸€äº›æŠ€å·§æ¥åˆ¶é€ è¿™ç§è§†è§‰æ•ˆæœã€‚</p><p>[waiting for demo]</p><h2>Futher Layer Features</h2>
<p><strong>shadows</strong></p><ul>
<li>The shadow is normally based on the shape of the layerâ€™s <code>nontransparent</code> region<ul>
<li>æ‰€ä»¥å®Œå…¨é€æ˜çš„è§†å›¾æ˜¯æ²¡æœ‰é˜´å½±çš„</li>
</ul>
</li>
<li>clipå’Œshadowæ˜¯ä¸å¯èƒ½åŒæ—¶å­˜åœ¨çš„ï¼ŒæŠ€å·§æ˜¯ç”¨å¦ä¸€ä¸ªviewå åˆ°åº•å±‚ï¼Œè®©å®ƒå®ç°é˜´å½±ã€‚</li>
</ul>
<p><strong>Borders and Rounded Corners</strong></p><ul>
<li>æƒ³è¦åœ†è§’ï¼Œå°±å¿…é¡»ç”¨<code>masksToBounds</code>æ¥å®ç°clipï¼ŒåŒæ—¶è¿˜è¦é˜´å½±çš„è¯ï¼Œåˆå¾—å€ŸåŠ©ä¸Šå›¾çš„æŠ€å·§äº†ã€‚</li>
<li>ä»iOS 11èµ·ï¼Œå¯ä»¥å•ç‹¬è®¾ç½®åœ†è§’äº†ï¼š<code>maskedCorners</code>ï¼Œå®ƒç”±minx, miny, maxx, maxyè¿™ç§é£æ ¼çš„æè¿°è¿›è¡Œç»„åˆï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„top-leftä¹‹ç±»çš„ã€‚</li>
</ul>
<p><strong>Masks</strong></p><ul>
<li>A CALayer can have a mask. This is itself a <strong>layer</strong>, whose content must be provided somehow.</li>
<li>åªæœ‰é€æ˜éƒ¨åˆ†æœ‰ä½œç”¨<ul>
<li>é€æ˜çš„ä½ç½®ï¼Œå¯¹åº”çš„layerä½ç½®ä¹Ÿæ˜¯é€æ˜çš„</li>
<li>åè¿‡æ¥æƒ³ä¸é€æ˜çš„éƒ¨åˆ†ï¼Œè¿˜æ˜¯è¢«åº”ç”¨maskçš„layerèƒ½æ˜¾ç¤ºçš„éƒ¨åˆ†</li>
<li>è¿™å°±æ˜¯photoshopé‡Œå›¾å±‚è’™æ¿â€æ¶‚é»‘å°±æ˜¯æ˜¾ç¤ºâ€œçš„æ„æ€</li>
</ul>
</li>
<li>there is no built-in mechanism for <strong>automatically resizing the mask</strong> as the layer is resized.</li>
<li>æŠŠä¸€ä¸ªviewå½“ä½œå¦ä¸€ä¸ªviewçš„maskå±æ€§ï¼Œåº•å±‚å°±æ˜¯ç›¸åº”çš„layer</li>
</ul>
<p>ä¸‹ä¾‹ç”¨maskæ¥åˆ¶ä½œè‡ªå·±çš„åœ†è§’çŸ©å½¢ï¼Œæ³¨æ„é‡Œé¢contextå’Œpathçš„å…³ç³»ã€‚åœ¨contexté‡Œé¢ï¼Œæ–°å»ºçš„pathéƒ½æ˜¯èƒ½ç›´æ¥ç»˜åˆ¶çš„ï¼Œè€Œä¸éœ€è¦è¿™ä¸ªpathè®¾ä¸ºè°çš„å±æ€§ï¼ˆdrawRect:æ–¹æ³•é‡Œä¹Ÿæ˜¯ä¸€æ ·ï¼Œåªè¦æ–°å»ºpathï¼Œå†è‡ªè¡Œå»stoke, filléƒ½è¡Œï¼Œ</p><p>è€Œcontextä¸Šä¹Ÿå¯ä»¥ç›´æ¥ç»˜åˆ¶</p><div class="highlight"><pre><span></span><span class="n">func</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="n">sz</span><span class="o">:</span><span class="n">CGSize</span><span class="p">,</span><span class="w"> </span><span class="n">roundingCorners</span><span class="w"> </span><span class="n">rad</span><span class="o">:</span><span class="n">CGFloat</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="bp">CALayer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">rect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGRect</span><span class="p">(</span><span class="n">origin</span><span class="o">:</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">:</span><span class="n">sz</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIGraphicsImageRenderer</span><span class="p">(</span><span class="n">bounds</span><span class="o">:</span><span class="n">rect</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">im</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">image</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="k">in</span><span class="w"></span>
<span class="w">        </span><span class="c1">// contextç»˜åˆ¶</span>
<span class="w">        </span><span class="n">let</span><span class="w"> </span><span class="n">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">cgContext</span><span class="w"></span>
<span class="w">        </span><span class="n">con</span><span class="p">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">(</span><span class="n">white</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">:</span><span class="mi">0</span><span class="p">).</span><span class="n">cgColor</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">con</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">con</span><span class="p">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">(</span><span class="n">white</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">:</span><span class="mi">1</span><span class="p">).</span><span class="n">cgColor</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="c1">// pathç»˜åˆ¶</span>
<span class="w">        </span><span class="n">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">UIBezierPath</span><span class="p">(</span><span class="n">roundedRect</span><span class="o">:</span><span class="n">rect</span><span class="p">,</span><span class="w"> </span><span class="n">cornerRadius</span><span class="o">:</span><span class="n">rad</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">fill</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">CALayer</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">mask</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rect</span><span class="w"></span>
<span class="w">    </span><span class="n">mask</span><span class="p">.</span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">im</span><span class="p">.</span><span class="n">cgImage</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">mask</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h2>Layer Efficiency</h2>
<p>ç”±äºç§»åŠ¨è®¾å¤‡ç®—åŠ›çš„å½±å“ï¼Œå¤§é‡å åŠ çš„åŠé€æ˜å›¾å±‚çš„æ¸²æŸ“æ˜¯ä¸€ä»¶å¾ˆæ¶ˆè€—ä¸”ä½æ•ˆçš„äº‹ï¼Œç‰¹åˆ«æ˜¯åŠ¨ç”»çš„æ—¶å€™ã€‚</p><p>debugï¼š</p><ol>
<li>Core Animation template in <strong>Instruments</strong></li>
<li>New in Xcode 12, animation â€œhitchesâ€ can be measured with <code>XCTMetrics</code> during performance testing.</li>
<li>the Simulatorâ€™s <code>Debug</code> menu lets you summon <code>colored overlays</code> that provide clues as to possible sources of <strong>inefficient drawing</strong><ul>
<li>çœŸæœºï¼šDebug â†’ View Debugging â†’ Rendering</li>
</ul>
</li>
<li>New in Xcode 12, the view debugger (â€œView Debuggerâ€ on page 75) can display layers â€” choose Editor â†’ Show Layers â€” and can offer suggestions for improving layer rendering efficiency.</li>
</ol>
<p>tips:</p><ol>
<li><strong>opaque drawing</strong> is most efficient.<ul>
<li>Nonopaque drawing is what the Simulator marks when you check Debug â†’ Color Blended Layers.</li>
</ul>
</li>
<li>â€œfreezingâ€ the entirety of the layerâ€™s drawing as a <strong>bitmap</strong>.<ul>
<li>ç›´æ¥ç»˜åˆ¶æ•ˆç‡ç¡®å®æ¯”ç¼“å­˜æ•ˆç‡é«˜</li>
<li>ä½†æ˜¯è¿‡æ·±è¿‡å¤æ‚çš„ç»§æ‰¿æ ‘ï¼Œæ²¡å¿…è¦æ¯æ¬¡éƒ½å®æ—¶è®¡ç®—æ¸²æŸ“</li>
<li>by <code>shouldRasterize = true</code> and <code>rasterizationScale = UIScreen.main.scale</code></li>
</ul>
</li>
<li><code>drawsAsynchronously = true</code></li>
</ol>
<h2>Layers and Key-Value Coding</h2>
<div class="highlight"><pre><span></span><span class="n">layer</span><span class="p">.</span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mask</span><span class="w"></span>
<span class="c1">// or:</span>
<span class="n">layer</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="n">forKey</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;mask&quot;</span><span class="p">)</span><span class="w"></span>

<span class="nb">self</span><span class="p">.</span><span class="n">rotationLayer</span><span class="p">.</span><span class="n">transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CATransform3DMakeRotation</span><span class="p">(.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="c1">// or:</span>
<span class="nb">self</span><span class="p">.</span><span class="n">rotationLayer</span><span class="p">.</span><span class="n">setValue</span><span class="p">(.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="n">forKeyPath</span><span class="o">:</span><span class="s">&quot;transform.rotation.y&quot;</span><span class="p">)</span><span class="w"></span>
</pre></div>
<ul>
<li><p>ä¸ä»£è¡¨<code>CATransform3D</code>æœ‰<code>rotation</code>å±æ€§</p><ul>
<li>å®ƒæ²¡æœ‰ä»»ä½•å±æ€§</li>
<li>å®ƒç”šè‡³ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡</li>
<li><code>self.rotationLayer.transform.rotation.y = //... no, sorry</code></li>
</ul>
</li>
<li><p>some transform key:</p></li>
</ul>
<p>â€¢ &quot;rotation.x&quot;,&quot;rotation.y&quot;,&quot;rotation.z&quot;
â€¢ &quot;rotation&quot; (same as &quot;rotation.z&quot;)
â€¢ &quot;scale.x&quot;,&quot;scale.y&quot;,&quot;scale.z&quot;
â€¢ &quot;translation.x&quot;,&quot;translation.y&quot;,&quot;translation.z&quot; â€¢ &quot;translation&quot; (two-dimensional, a CGSize)</p><ul>
<li>The<code>Quartz Core</code> framework also injects keyâ€“value coding compliance into <code>CGPoint</code>, <code>CGSize</code>, and <code>CGRect</code>, allowing you to use keys and key paths matching their <code>struct component names</code>.</li>
</ul>
<blockquote>
<p>see â€œCore Animation Extensions to Key-Value Codingâ€ in Appleâ€™s Core Animation Programming Guide</p></blockquote>
<ul>
<li>you can treat a <code>CALayer</code> as a kind of <code>dictionary</code>, and get and set the value for any key.<ul>
<li>viewæœ‰tagï¼Œlayerå°±æœ‰ä»»æ„key</li>
</ul>
</li>
</ul>

            </div>
        </article>
        <div class="prism-post-meta col-md-8 offset-md-2">
    <span>walker</span>
    
    <span>/</span>
    <span>
        <a class="category no-link" href="/category/posts/" target="_self">
        posts
        </a>
    </span>
    
    
    <span>/</span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/drawing/" target="_self">#drawing</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/layer/" target="_self">#layer</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/mask/" target="_self">#mask</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/shadow/" target="_self">#shadow</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/transforms/" target="_self">#transforms</a>
    </span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/anchorpoint/" target="_self">#anchorpoint</a>
    </span>
    
    
    
    <span>/</span>
    <span class="leancloud_visitors" id="/archives/Layer/" data-flag-title="Programming iOS 14 - Layer"><span class="leancloud-visitors-count"></span> Views</span>
    
</div>
    </section>

    
<section id="prism__pagination" class="prism-pagination" class="col-md-8 offset-md-2">
    <ul>
        
        <li class="next">
            <a class="no-link" href="/archives/hittest/" target="_self" title="hitTestç¤ºä¾‹"><i class="fa fa-chevron-left" aria-hidden="true"></i>Newer</a>
        </li>
        
        
        <li class="prev">
            <a class="no-link" href="/archives/%E3%80%8AEffective-Objective-C-2.0%E3%80%8B%E7%AC%94%E8%AE%B0%E7%AC%AC1-2%E7%AB%A0/" target="_self" title="ã€ŠEffective Objective-C 2.0ã€‹ç¬”è®°ç¬¬1-2ç« ">Older<i class="fa fa-chevron-right" aria-hidden="true"></i></a>
        </li>
        
    </ul>
</section>


    
    <script>
        var initValine = function() {
            new Valine({"enable": true, "el": "#vcomments", "appId": "7tP92LoqK2cggW61DvJmWBo0-gzGzoHsz", "appKey": "iQCtrtlr8eKrQllM03GMESMJ", "visitor": true, "recordIP": true});
        }

    </script>
    <script defer src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js' onload="initValine()"></script>
    <div class="prism-comment-section container" id="prism__comment">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <div id="vcomments"></div>
            </div>
        </div>
    </div>
    

</main>

            <footer id="prism__footer">
                <section>
                    <div>
                        <nav class="social-links">
                            <ul><li><a class="no-link" title="Twitter" href="https://twitter.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-twitter"></i></a></li><li><a class="no-link" title="GitHub" href="https://github.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-github"></i></a></li><li><a class="no-link" title="Weibo" href="https://weibo.com/1071696872" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-weibo"></i></a></li></ul>
                        </nav>
                    </div>

                    <section id="prism__external_links">
                        <ul>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://github.com/AlanDecode/Maverick" rel="noopener noreferrer nofollow">Maverick</a>ï¼šğŸ„â€ Go My Own Way.
                                <span>|</span>
                            </li>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://www.imalan.cn" rel="noopener noreferrer nofollow">Triple NULL</a>ï¼šHome page for AlanDecode.
                                <span>|</span>
                            </li>
                            
                        </ul>
                    </section>

                    <div class="copyright">
                        <p class="copyright-text">
                            <span class="brand">walker's code blog</span>
                            <span>Copyright Â© 2022 AlanDecode</span>
                        </p>
                        <p class="copyright-text powered-by">
                            | Powered by <a href="https://github.com/AlanDecode/Maverick" class="no-link" target="_blank" rel="noopener noreferrer nofollow">Maverick</a> | Theme <a href="https://github.com/Reedo0910/Maverick-Theme-Prism" target="_blank" class="no-link" rel="noopener noreferrer nofollow">Prism</a>
                        </p>
                    </div>
                    <div class="footer-addon">
                        
                    </div>
                </section>
                <script>
                    var site_build_date = "2019-12-06T12:00+08:00"

                </script>
                <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-efa8685153.js"></script>
            </footer>
        </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-493cb9cd89.js"></script>

    <!--katex-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.js"></script>
    <script>
        mathOpts = {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false }
            ]
        };

    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
</body>

</html>