<!DOCTYPE HTML>
<html lang="english">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,AlanDecode,Galileo,blog" />
    <meta name="generator" content="Maverick 1.2.1" />
    <meta name="template" content="Prism" />
    <link rel="alternate" type="application/rss+xml" title="walker's code blog &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="walker's code blog &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-b9d78ff38a.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-182e5a8869.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/4089f9a071a74d90ba780992e2fc0383.json"
        }

    </script>
    
<title>RNNä¸­bidirectionalå’Œnum_layerå¯¹outputå’Œhiddenå½¢çŠ¶çš„å½±å“ - walker's code blog</title>
<meta name="author" content="walker" />
<meta name="description" content="Batch first" />
<meta property="og:title" content="RNNä¸­bidirectionalå’Œnum_layerå¯¹outputå’Œhiddenå½¢çŠ¶çš„å½±å“ - walker's code blog" />
<meta property="og:description" content="Batch first" />
<meta property="og:site_name" content="walker's code blog" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/RNN%E4%B8%ADbidirectional%E5%92%8Cnum_layer%E5%AF%B9output%E5%92%8Chidden%E5%BD%A2%E7%8A%B6%E7%9A%84%E5%BD%B1%E5%93%8D/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2021-04-13T00:00:00-00.00" />
<meta name="twitter:title" content="RNNä¸­bidirectionalå’Œnum_layerå¯¹outputå’Œhiddenå½¢çŠ¶çš„å½±å“ - walker's code blog" />
<meta name="twitter:description" content="Batch first" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
</head>

<body>
    <div class="container prism-container">
        <header class="prism-header" id="prism__header">
            <h1 class="text-uppercase brand"><a class="no-link" href="/" target="_self">walker's code blog</a></h1>
            <p>coder, reader</p>
            <nav class="prism-nav"><ul><li><a class="no-link text-uppercase " href="/" target="_self">Home</a></li><li><a class="no-link text-uppercase " href="/archives/" target="_self">Archives</a></li><li><a class="no-link text-uppercase " href="/about/" target="_self">About</a></li><li><a href="#" target="_self" class="search-form-input no-link text-uppercase">Search</a></li></ul></nav>
        </header>
        <div class="prism-wrapper" id="prism__wrapper">
            
<main>
    <section class="prism-section row" id="prism__content">
        <article class="yue col-md-8 offset-md-2">
            <h1 class="prism-post-title">RNNä¸­bidirectionalå’Œnum_layerå¯¹outputå’Œhiddenå½¢çŠ¶çš„å½±å“</h1>
            <div class="prism-post-time">
                <time class="text-uppercase">
                    April 13 2021
                </time>
            </div>
            <div class="prism-content-body">
                <h2>Batch first</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦ä¹ æƒ¯æ¥å—<code>batch_first=False</code>ï¼ˆå°±æ˜¯é»˜è®¤å€¼ï¼‰çš„æ€ç»´ï¼Œå› ä¸ºNLPä¸­æ‰¹é‡å¤„ç†å¥å­ï¼Œæ˜¯æ¯ä¸€å¥å–ç¬¬ä¸€ä¸ªè¯ï¼Œç¬¬äºŒä¸ªè¯ï¼Œä»¥æ­¤ç±»æ¨ã€‚
æŒ‰æˆ‘ä»¬ä¹ æƒ¯çš„æŠŠæ•°æ®æ”¾åœ¨åŒä¸€æ‰¹ï¼ˆå³<code>batch_first=True</code>ï¼‰çš„æ€è·¯è™½ç„¶å¯ä»¥åšåˆ°ï¼ˆå–„ç”¨åˆ‡ç‰‡å³å¯ï¼‰ï¼Œä½†æ˜¯ç»•äº†å¼¯è·¯ã€‚ä½†æ˜¯å¦‚æœç¬¬1æ‰¹éƒ½æ˜¯ç¬¬1ä¸ªå­—ï¼Œç¬¬2æ‰¹å…¨æ˜¯ç¬¬2ä¸ªå­—ï¼Œè¿™ä¼šè‡ªç„¶å¾ˆå¤šï¼ˆ<strong>è¡Œä¼˜å…ˆ</strong>ï¼‰ã€‚</p><p>æ‰€ä»¥è‡³å°‘<code>Pytorch</code>å†…éƒ¨ï¼Œä½ è®¾äº†Trueï¼Œå†…éƒ¨ä¹Ÿæ˜¯æŒ‰Falseæ¥å¤„ç†çš„ï¼Œåªæ˜¯ç»™äº†ä½ ä¸€ä¸ªè¯­æ³•ç³–ï¼ˆå½“ç„¶ä½ ç»„ç»‡æ•°æ®å°±å¿…é¡»æŒ‰Trueæ¥ç»„ç»‡äº†ã€‚</p><p>çœ‹ä¸ªå®ä¾‹ï¼š</p><figure  style="flex: 79.69151670951157" ><img width="1240" height="778" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/d6a0d9ea71601f8b89c0e8465751baf4.png" alt=""/></figure><ol>
<li>å‡å®šæ‰¹æ¬¡æ˜¯64ï¼Œå¥é•¿æˆªä¸º70ï¼Œåœ¨è¿˜æ²¡æœ‰å‘é‡åŒ–çš„æ•°æ®ä¸­ï¼Œé‚£ä¹ˆæ˜¾ç„¶ä¸€æ¬¡çš„è¾“å…¥åº”è¯¥ä¸º(70x64)ï¼Œæ‰¹æ¬¡åœ¨ç¬¬2ä½</li>
<li>æ³¨æ„ç¬¬ä¸€è¡Œï¼Œå…¨æ˜¯2ï¼Œè¿™æ˜¯è®¾å®šçš„<code>&lt;bos&gt;</code>ï¼Œè¿™å·²ç»å¾ˆå¥½åœ°è¡¨ç¤ºäº†åœ¨è¡Œä¼˜å…ˆçš„ç³»ç»Ÿé‡Œï¼ˆæ¯”å¦‚<code>Matlab</code>å°±æ˜¯åˆ—ä¼˜å…ˆï¼‰ï¼Œä¼šè‡ªç„¶è€Œä¸”æŠŠ<strong>æ¯å¥è¯</strong>çš„ç¬¬ä¸€ä¸ªè¯è¯»å‡ºæ¥çš„è®¾å®šäº†ã€‚</li>
</ol>

<pre><code># æˆ‘ç”¨çš„torchtextçš„Fieldè¿›è¡Œæ¼”ç¤ºï¼Œ SRCæ˜¯ä¸€ä¸ªField
[SRC.vocab.itos[i] for i in range(1,4)]  
['&lt;pad&gt;', '&lt;bos&gt;', '&lt;eos&gt;']
</code></pre>
<ol start="3">
<li>å¯è§ï¼Œ2æ˜¯å¼€å§‹ï¼Œ3æ˜¯ç»“æŸï¼Œ1æ˜¯ç©ºæ ¼ï¼ˆå½“ç„¶è¿™æ˜¯æˆ‘è®¾ç½®çš„ï¼‰</li>
<li>åŒæ—¶ä¹Ÿèƒ½æ³¨æ„åˆ°ï¼Œæœ€åä¸€è¡Œæœ‰çš„æ˜¯3ï¼Œæœ‰çš„æ˜¯1ï¼Œæœ‰çš„éƒ½ä¸æ˜¯ï¼Œå°±è¯´æ˜å¥å­æ˜¯ä»¥70ä¸ºé•¿åº¦è¿›è¡Œæˆªæ–­çš„ï¼Œè‡ªç„¶ç»“æŸçš„æ˜¯3ï¼Œè¡¥<code>&lt;pad&gt;</code>çš„æ˜¯1ï¼Œæˆªæ–­çš„é‚£ä¹ˆé‚£ä¸ªå­—æ˜¯å¤šå°‘å°±æ˜¯å¤šå°‘</li>
<li>ç«–å‘å–ä¸€æ¡å°±æ˜¯ä¸€æ•´å¥è¯ï¼Œæ‰“å°å‡ºæ¥å°±æ˜¯ç®­å¤´æŒ‡å‘çš„é‚£ä¸€å¤§å¨ï¼ˆå…±70ä¸ªæ•°å­—ï¼‰</li>
<li>å¯¹å®ƒè¿›è¡Œ<code>index_to_string</code>(itos)ï¼Œåˆ™è¿˜åŸå‡ºäº†è¿™å¥è¯</li>
<li>nn.Embeddingåšäº†ä¸¤ä»¶äº‹ï¼š</li>
</ol>
<ul>
<li>æ ¹æ®vocabularyè¿›è¡Œone-hotï¼ˆç¨€ç–ï¼‰$\rightarrow$ æ‰€ä»¥ä½ è¦å‘Šè¯‰å®ƒè¯å…¸å¤§å°</li>
<li>ç„¶åå†embeddingæˆæŒ‡å®šçš„ä½ç»´å‘é‡ï¼ˆç¨ å¯†ï¼‰</li>
<li>æ‰€ä»¥70ä¸ªæ•°å­—å°±æˆäº†70x300ï¼Œæ‹¼ä¸Šç»´åº¦ï¼Œå°±æ˜¯70x64x300</li>
</ul>
<p>æ—¢ç„¶è®²åˆ°è¿™äº†ï¼Œå¤šè®²ä¸¤è¡Œï¼Œå‡å®šhidden_dim=256, ä¸€ä¸ª<code>nn.RNN</code>ä¼šè¾“å‡ºçš„<code>outputs</code>å’Œ<code>hidden</code>çš„å½¢çŠ¶å¦‚ä¸‹ï¼š</p>
<pre><code>&gt;&gt;&gt; outputs.shape
torch.Size([70, 64, 256])
&gt;&gt;&gt; hidden.shape
torch.Size([1, 64, 256])
</code></pre>
<ol>
<li>å³300ç»´è¿›å»ï¼Œ256ç»´å‡ºæ¥ï¼Œä½†æ˜¯å› ä¸ºå¥å­æœ‰70çš„é•¿åº¦ï¼Œé‚£å°±æ˜¯70ä¸ªoutputï¼Œhiddenæ˜¯ä»å‰ä¼ åˆ°åçš„ï¼Œå½“ç„¶æ˜¯æœ€åä¸€ä¸ª</li>
<li>ä¹Ÿå› æ­¤ï¼Œå¦‚æœä½ ä¸éœ€è¦å åŠ å¤šå±‚RNNï¼Œä½ åªéœ€è¦æœ€åä¸€ä¸ªå­—çš„outputå°±è¡Œäº†<code>outputs[-1,:,:]</code>, è¿™ä¸ªç»“æœé€åˆ°å…¨è¿æ¥å±‚é‡Œå»è¿›è¡Œåˆ†ç±»ã€‚</li>
</ol>
<h2>è‡ªå·±å†™ä¸€ä¸ªRNN</h2>
<p>å…¶å®å°±æ˜¯è¦è‡ªå·±æŠŠä¸Šè¿°å½¢çŠ¶å˜åŒ–åšå¯¹å°±è¡Œäº†ã€‚å°±æ˜¯å‡ ä¸ªçº¿æ€§å˜æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨<code>nn.Linear</code>æ¥æ‹¼æ¥:</p><ol>
<li>input: 2x5x3 $\Rightarrow$ 5ä¸ªåºåˆ—ï¼Œæ¯ä¸€ä¸ª2ä¸ªè¯ï¼Œæ¯ä¸ªè¯ç”¨3ç»´å‘é‡è¡¨ç¤º</li>
<li>hidden=10, æ— embeddingï¼Œnum_class=7</li>
<li>æœŸå¾…å½¢çŠ¶ï¼š</li>
</ol>
<ul>
<li>output: 2x5x7</li>
<li>hidden:1x5x10</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RNN</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_size</span> <span class="o">=</span> <span class="n">hidden_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i2h</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_size</span> <span class="o">+</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i2o</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_size</span> <span class="o">+</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LogSoftmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">hidden</span><span class="p">):</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="nb">input</span><span class="p">,</span> <span class="n">hidden</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># input shape: (2, 5, 3)</span>
        <span class="c1"># hidden shape: (2, 5, 10)</span>
        <span class="c1"># combine shape (2, 5, 13)</span>
        <span class="n">hidden</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i2h</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i2o</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">hidden</span>

    <span class="k">def</span> <span class="nf">initHidden</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">)</span>

<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">num_class</span> <span class="o">=</span> <span class="mi">7</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="n">rnn</span> <span class="o">=</span> <span class="n">RNN</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">hidden_size</span><span class="p">,</span><span class="n">num_class</span><span class="p">)</span>
<span class="n">out</span><span class="p">,</span> <span class="n">hid</span> <span class="o">=</span> <span class="n">rnn</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">))</span>
<span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">hid</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
<p>output:</p>
<pre><code>(torch.Size([2, 5, 7]), torch.Size([2, 5, 10]))
</code></pre>
<p>å¯è§ï¼Œoutputæ˜¯ä¸€æ ·çš„ï¼Œhiddençš„å½¢çŠ¶ä¸ä¸€æ ·ï¼Œäº‹å®ä¸Šæ¯ä¸€ä¸ªå­—ç¡®å®æ˜¯ä¼šäº§ç”Ÿhiddençš„ï¼Œä½†æ˜¯pytorchå¹¶æ²¡æœ‰æŠŠå®ƒè¿”å‡ºæ¥ï¼ˆæ¶ˆè´¹æ‰å°±æ²¡ç”¨äº†ï¼‰ã€‚è¿™é‡Œå°±passäº†ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯çœ‹ä¸€ä¸‹åŒå‘å’Œå¤šå±‚çš„æƒ…å†µä¸‹å½¢çŠ¶çš„å˜åŒ–ï¼Œä¸‹é¢æˆ‘ä»¬ç”¨pytorchè‡ªå·±çš„RNNæ¥æµ‹è¯•ã€‚</p><h1>num_layers</h1>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">num_layers</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">rnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">RNN</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">hidden_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="n">num_layers</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">h0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_layers</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="c1"># å‡ å±‚å°±éœ€è¦åˆå§‹å‡ ä¸ªhidden</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># input: 5x3 -&gt; 1x12 # Nä¸ªæ‰¹æ¬¡ï¼Œ 5ä¸ªåºåˆ—(æ¯”å¦‚5ä¸ªå­—ï¼Œæ¯ä¸ªå­—ç”±3ä¸ªæ•°å­—çš„å‘é‡ç»„æˆ)</span>
<span class="n">o</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">rnn</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">h0</span><span class="p">)</span> <span class="c1"># 5ä¸ªoutput, ä¸€ä¸ªfinal hidden</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;output shape&#39;</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hidden shape&#39;</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<p>è¾“å‡ºï¼š</p>
<pre><code>output shape torch.Size([5, 2, 12])  # 2ä¸ªæ‰¹æ¬¡ï¼Œ5ä¸ªè¯ï¼Œ12ç»´åº¦è¾“å‡º
hidden shape torch.Size([3, 2, 12]) # 3å±‚ä¼šè¾“å‡º3ä¸ªhiddenï¼Œ2ä¸ªæ‰¹æ¬¡
</code></pre>
<p>åŠ ä¸Šembedding, RNNæ”¹æˆGRU</p><div class="highlight"><pre><span></span><span class="c1"># è¿™æ¬¡åŠ embedding</span>
<span class="c1"># é¡ºä¾¿æŠŠ RNN æ”¹ GRU</span>
<span class="n">vocab_size</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">embed_size</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="c1"># è¦æ±‚è¯å…¸é•¿åº¦ä¸è¶…è¿‡5ï¼Œè¾“å‡ºå‘é‡é•¿åº¦ä¸º10</span>
<span class="n">emb</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embed_size</span><span class="p">)</span> 
<span class="c1"># è¾“å…¥ä¸ºembedingç»´åº¦ï¼Œè¾“å‡ºï¼ˆå’Œéšå±‚ï¼‰ä¸º8ç»´åº¦</span>
<span class="n">rnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">embed_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># è¿™æ¬¡è®¾äº†num_layers=2ï¼Œå°±è¦æ±‚æœ‰ä¸¤ä¸ªhiddenäº†</span>
<span class="n">h0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
<span class="c1"># å› ä¸ºæ•°æ®ä¼šç”¨embeddingåŒ…ä¸€æ¬¡ï¼Œæ‰€ä»¥inputæ²¡æœ‰äº†ç»´åº¦è¦æ±‚ï¼ˆåªæœ‰å¤§å°è¦æ±‚ï¼Œæ¯ä¸ªæ•°å­—è¦å°äºå­—å…¸é•¿åº¦ï¼‰</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">))</span> 
<span class="n">e</span> <span class="o">=</span> <span class="n">emb</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;input.shape:&#39;</span><span class="p">,</span> <span class="n">x0</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;embedding.shape:&#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># (3,4)ä¼šæ‰©å±•æˆï¼ˆ3,4,10), 10ç»´æ˜¯rnnçš„inputç»´åº¦ï¼Œæ­£å¥½</span>
<span class="n">o</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">rnn</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">h0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;output.shape:</span><span class="si">{</span><span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, hidden.shape:</span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

<pre><code>input.shape: torch.Size([5, 3])
embedding.shape: torch.Size([5, 3, 10])
output.shape:torch.Size([5, 3, 8]), hidden.shape:torch.Size([2, 3, 8])
</code></pre>
<p>å”¯ä¸€è¦æ³¨æ„çš„å˜åŒ–å°±æ˜¯inputï¼Œå› ä¸ºembeddingæ˜¯æŠŠå­—å…¸å¤§å°çš„ç»´åº¦è½¬æ¢æˆæŒ‡å®šå¤§å°çš„ç»´åº¦ï¼Œæš—å«äº†ä½ é‡Œé¢çš„æ¯ä¸€ä¸ªæ•°å­—éƒ½æ˜¯å­—å…¸çš„ç´¢å¼•ï¼Œæ‰€ä»¥ä½ ç»„è£…demoæ•°æ®çš„æ—¶å€™ï¼Œè¦ç”Ÿæˆå°äºå­—å…¸å¤§å°(<code>vocab_size</code>ï¼‰çš„æ•°å­—ä½œä¸ºè¾“å…¥ã€‚</p><h2>bidirectional</h2>
<p>è¿™æ¬¡åŠ <strong>bidirectional</strong></p><ul>
<li>batch_first = False</li>
<li>x (5, 3) -&gt; 3ä¸ªåºåˆ—ï¼Œæ¯ä¸ªåºåˆ—5ä¸ªæ•°</li>
<li>embedding(5, 10) -&gt; è¾“å…¥å­—å…¸é•¿5ï¼Œè¾“å‡ºå‘é‡é•¿10 -&gt; (5, 3, 10) -&gt; 3ä¸ªåºåˆ—ï¼Œæ¯ä¸ªåºåˆ—5ä¸ª10ç»´å‘é‡</li>
<li>hiddenå¿…é¡»ä¸º8ç»´ï¼Œ4ä¸ªï¼ˆnum_layers=2, bidirection),3ä¸ªæ‰¹æ¬¡ -&gt; (4,3,8)</li>
<li>rnn(10, 8) -&gt; è¾“å…¥10ç»´ï¼Œè¾“å‡º8ç»´</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># è¿™æ¬¡åŠ  bidirection</span>

<span class="n">vocab_size</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">embed_size</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">num_layers</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># è¦æ±‚è¯å…¸é•¿åº¦ä¸è¶…è¿‡5ï¼Œè¾“å‡ºå‘é‡é•¿åº¦ä¸º10</span>
<span class="n">emb</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embed_size</span><span class="p">)</span> 
<span class="c1"># è¾“å…¥ä¸ºembedingç»´åº¦ï¼Œè¾“å‡ºï¼ˆå’Œéšå±‚ï¼‰ä¸º8ç»´åº¦</span>
<span class="n">rnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">embed_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="n">num_layers</span><span class="p">,</span> <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># è¿™æ¬¡è®¾äº†num_layers=2ï¼Œå°±è¦æ±‚æœ‰ä¸¤ä¸ªhiddenäº†</span>
<span class="c1"># åŠ ä¸ŠåŒå‘ï¼Œå°±æœ‰4ä¸ªäº†ï¼Œè¿™é‡Œä¹˜ä»¥2</span>
<span class="c1"># h0 = (torch.rand(2, batch_size, hidden_size), torch.rand(2, batch_size, hidden_size))</span>
<span class="n">h0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_layers</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
<span class="c1"># å› ä¸ºæ•°æ®ä¼šç”¨embeddingåŒ…ä¸€æ¬¡ï¼Œæ‰€ä»¥inputæ²¡æœ‰äº†ç»´åº¦è¦æ±‚ï¼ˆåªæœ‰å¤§å°è¦æ±‚ï¼Œæ¯ä¸ªæ•°è¦å°äºå­—å…¸é•¿åº¦ï¼‰</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">))</span> 
<span class="n">e</span> <span class="o">=</span> <span class="n">emb</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;input.shape:&#39;</span><span class="p">,</span> <span class="n">x0</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;embedding.shape:&#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># (3,4)ä¼šæ‰©å±•æˆï¼ˆ3,4,10), 10ç»´æ˜¯rnnçš„inputç»´åº¦ï¼Œæ­£å¥½</span>
<span class="c1"># hidden = torch.cat((h0[-2,:,:], h0[-1,:,:]),1)</span>
<span class="n">o</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">rnn</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">h0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;output.shape:</span><span class="si">{</span><span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, hidden.shape:</span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

<pre><code>input.shape: torch.Size([5, 3])
embedding.shape: torch.Size([5, 3, 10])
output.shape:torch.Size([5, 3, 16]), hidden.shape:torch.Size([4, 3, 8])
</code></pre>
<p>å¯è§ï¼ŒåŒå‘ä¼šä½¿è¾“å‡ºå¤šä¸€å€ï¼Œå¯ä»¥ç”¨<code>[:hidden_size], [hidden_size:]</code>åˆ†åˆ«å–å‡ºæ¥ï¼Œæˆ‘ä»¬<strong>éªŒè¯</strong>ä¸€ä¸‹ï¼Œç”¨æ¡†æ¶ç”Ÿæˆä¸€ä¸ªåŒå‘çš„GRUï¼Œç„¶åæ‰‹åŠ¨ç”Ÿæˆä¸€ä¸ªæ­£å‘çš„ä¸€ä¸ªè´Ÿå‘çš„ï¼Œå¤åˆ¶å‚æ•°ï¼Œçœ‹ä¸€ä¸‹è¾“å‡ºï¼š</p><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch.autograd</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># åˆ¶ä½œä¸€ä¸ªæ­£åºå’Œååºçš„input</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
<span class="n">random_input</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">normal_</span><span class="p">(),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">reverse_input</span> <span class="o">=</span> <span class="n">random_input</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:]</span>

<span class="n">bi_grus</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hidden_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">reverse_gru</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hidden_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bidirectional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">gru</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hidden_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bidirectional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">reverse_gru</span><span class="o">.</span><span class="n">weight_ih_l0</span> <span class="o">=</span> <span class="n">bi_grus</span><span class="o">.</span><span class="n">weight_ih_l0_reverse</span>
<span class="n">reverse_gru</span><span class="o">.</span><span class="n">weight_hh_l0</span> <span class="o">=</span> <span class="n">bi_grus</span><span class="o">.</span><span class="n">weight_hh_l0_reverse</span>
<span class="n">reverse_gru</span><span class="o">.</span><span class="n">bias_ih_l0</span> <span class="o">=</span> <span class="n">bi_grus</span><span class="o">.</span><span class="n">bias_ih_l0_reverse</span>
<span class="n">reverse_gru</span><span class="o">.</span><span class="n">bias_hh_l0</span> <span class="o">=</span> <span class="n">bi_grus</span><span class="o">.</span><span class="n">bias_hh_l0_reverse</span>
<span class="n">gru</span><span class="o">.</span><span class="n">weight_ih_l0</span> <span class="o">=</span> <span class="n">bi_grus</span><span class="o">.</span><span class="n">weight_ih_l0</span>
<span class="n">gru</span><span class="o">.</span><span class="n">weight_hh_l0</span> <span class="o">=</span> <span class="n">bi_grus</span><span class="o">.</span><span class="n">weight_hh_l0</span>
<span class="n">gru</span><span class="o">.</span><span class="n">bias_ih_l0</span> <span class="o">=</span> <span class="n">bi_grus</span><span class="o">.</span><span class="n">bias_ih_l0</span>
<span class="n">gru</span><span class="o">.</span><span class="n">bias_hh_l0</span> <span class="o">=</span> <span class="n">bi_grus</span><span class="o">.</span><span class="n">bias_hh_l0</span>

<span class="n">bi_output</span><span class="p">,</span> <span class="n">bi_hidden</span> <span class="o">=</span> <span class="n">bi_grus</span><span class="p">(</span><span class="n">random_input</span><span class="p">)</span>
<span class="n">output</span><span class="p">,</span> <span class="n">hidden</span> <span class="o">=</span> <span class="n">gru</span><span class="p">(</span><span class="n">random_input</span><span class="p">)</span>
<span class="n">reverse_output</span><span class="p">,</span> <span class="n">reverse_hidden</span> <span class="o">=</span> <span class="n">reverse_gru</span><span class="p">(</span><span class="n">reverse_input</span><span class="p">)</span>  <span class="c1"># åˆ†åˆ«å–[(4,3,2,1,0),:,:] -&gt; å³å€’åºé€å…¥input</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bi_output:&#39;</span><span class="p">,</span> <span class="n">bi_output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bi_output</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bi_output</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>                <span class="c1"># åŒå‘è¾“å‡ºä¸­çš„ååŠæˆª</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">reverse_output</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">))</span> <span class="c1"># åå‘è¾“å‡º</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>                   <span class="c1"># å•ç‹¬ä¸€ä¸ªrnnçš„è¾“å‡º </span>
<span class="nb">print</span><span class="p">(</span><span class="n">bi_output</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>                <span class="c1"># åŒå‘è¾“å‡ºä¸­çš„å‰åŠæˆª</span>
</pre></div>

<pre><code>bi_output: torch.Size([5, 1, 2])
tensor([[-0.2336, -0.3068],
        [ 0.0660, -0.6004],
        [ 0.0859, -0.5620],
        [ 0.2164, -0.5750],
        [ 0.1229, -0.3608]])
tensor([-0.3068, -0.6004, -0.5620, -0.5750, -0.3608])
tensor([-0.3068, -0.6004, -0.5620, -0.5750, -0.3608])
tensor([-0.2336,  0.0660,  0.0859,  0.2164,  0.1229])
tensor([-0.2336,  0.0660,  0.0859,  0.2164,  0.1229])
</code></pre>
<p>ç°åœ¨ä½ ä»¬åº”è¯¥çŸ¥é“<code>bidirectional</code>çš„åŒå€è¾“å‡ºæ˜¯æ€ä¹ˆå›äº‹äº†ï¼Œå†æ¥çœ‹çœ‹hidden</p><div class="highlight"><pre><span></span><span class="n">hidden</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">reverse_hidden</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">bi_hidden</span><span class="o">.</span><span class="n">shape</span>
<span class="n">bi_hidden</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">reverse_hidden</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">hidden</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div>

<pre><code>(torch.Size([1, 1, 1]), torch.Size([1, 1, 1]), torch.Size([2, 1, 1]))
(tensor([ 0.1229, -0.3068]), tensor([-0.3068]), tensor([0.1229]))
</code></pre>
<ul>
<li>æ­£å‘çš„è¾“å‡ºå°±æ˜¯å•å‘rnn</li>
<li>åå‘çš„è¾“å‡ºå°±æ˜¯æŠŠæ•°æ®åä¼ çš„å•å‘rnn</li>
<li>åŒå‘rnnå‡ºæ¥çš„ç¬¬æœ€åä¸€ä¸ªhiddenï¼ˆååŠæˆªï¼‰å°±æ˜¯åå‘å®Œæˆåçš„hidden</li>
</ul>
<figure  style="flex: 83.6996336996337" ><img width="914" height="546" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/67bb7c8df3810d83a7f07909fbd601f9.png" alt=""/></figure><p>ç”±æ‰“å°å‡ºæ¥çš„æ•°æ®å¯çŸ¥ï¼š</p><ul>
<li>æœ€åä¸€ä¸ªhiddenï¼Œå°±æ˜¯åå‘RNNçš„æœ€åä¸€ä¸ªhiddenï¼ˆæ—¶é—´ç‚¹åœ¨å¼€å¤´ï¼‰</li>
<li>ä¹Ÿæ˜¯åŒå‘RNNé‡Œçš„ç¬¬ä¸€ä¸ªè¾“å‡ºï¼ˆ<strong>çš„æœ€åä¸€ä¸ªå…ƒç´ </strong>ï¼‰</li>
<li>ä¹Ÿæ˜¯å•å‘RNNï¼ˆä½†æ˜¯æ•°æ®åä¼ ï¼‰ï¼ˆæˆ–è€…æ­£å‘ï¼Œä½†é€†æ—¶åºï¼‰é‡Œçš„æœ€åä¸€ä¸ªè¾“å‡º</li>
</ul>
<hr />
<p>åŒå‘RNNé‡Œ</p><ul>
<li>å€’æ•°ç¬¬äºŒä¸ªhiddenï¼Œæ˜¯æ­£å‘çš„æœ€åä¸€ä¸ªhiddenï¼ˆæ—¶é—´ç‚¹åœ¨ç»“å°¾ï¼‰</li>
<li>å®ƒä¹Ÿæ˜¯outputé‡Œé¢çš„å€¼ï¼Œå®ƒæ˜¯åŒå‘è¾“å‡ºé‡Œçš„æœ€åä¸€ä¸ªçš„<strong>ç¬¬ä¸€ä¸ªå…ƒç´ </strong></li>
</ul>
<p>æ€»çš„æ¥è¯´</p><ul>
<li>outputç”±æ­£åå‘è¾“å‡ºæ¨ªå‘æ‹¼æ¥ï¼ˆæ‰€æœ‰ï¼‰</li>
<li>hiddenç”±æ­£åå‘hiddenç«–å‘æ‹¼æ¥ï¼ˆtop layer)</li>
</ul>
<figure  style="flex: 71.92575406032482" ><img width="1240" height="862" src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/archives/assets/671265db99cdb4c1fcda808d82a08794.png" alt=""/></figure>
            </div>
        </article>
        <div class="prism-post-meta col-md-8 offset-md-2">
    <span>walker</span>
    
    <span>/</span>
    <span>
        <a class="category no-link" href="/category/posts/" target="_self">
        posts
        </a>
    </span>
    
    
    <span>/</span>
    
    <span class="prism-tag">
        <a class="no-link" href="/tag/RNN/" target="_self">#RNN</a>
    </span>
    
    
    
    <span>/</span>
    <span class="leancloud_visitors" id="/archives/RNN%E4%B8%ADbidirectional%E5%92%8Cnum_layer%E5%AF%B9output%E5%92%8Chidden%E5%BD%A2%E7%8A%B6%E7%9A%84%E5%BD%B1%E5%93%8D/" data-flag-title="RNNä¸­bidirectionalå’Œnum_layerå¯¹outputå’Œhiddenå½¢çŠ¶çš„å½±å“"><span class="leancloud-visitors-count"></span> Views</span>
    
</div>
    </section>

    
<section id="prism__pagination" class="prism-pagination" class="col-md-8 offset-md-2">
    <ul>
        
        <li class="next">
            <a class="no-link" href="/archives/RNN%E6%A2%AF%E5%BA%A6%E6%B6%88%E5%A4%B1%E4%B8%8E%E6%A2%AF%E5%BA%A6%E7%88%86%E7%82%B8%E6%8E%A8%E5%AF%BC/" target="_self" title="RNNæ¢¯åº¦æ¶ˆå¤±ä¸æ¢¯åº¦çˆ†ç‚¸æ¨å¯¼"><i class="fa fa-chevron-left" aria-hidden="true"></i>Newer</a>
        </li>
        
        
        <li class="prev">
            <a class="no-link" href="/archives/%E5%87%A0%E7%A7%8D%E6%95%99%E6%9D%90%E9%87%8C%E6%B1%82%E8%A7%A3Ax%3D0%E7%AC%94%E8%AE%B0/" target="_self" title="å‡ ç§æ•™æé‡Œæ±‚è§£Ax=0ç¬”è®°">Older<i class="fa fa-chevron-right" aria-hidden="true"></i></a>
        </li>
        
    </ul>
</section>


    
    <script>
        var initValine = function() {
            new Valine({"enable": true, "el": "#vcomments", "appId": "7tP92LoqK2cggW61DvJmWBo0-gzGzoHsz", "appKey": "iQCtrtlr8eKrQllM03GMESMJ", "visitor": true, "recordIP": true});
        }

    </script>
    <script defer src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js' onload="initValine()"></script>
    <div class="prism-comment-section container" id="prism__comment">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <div id="vcomments"></div>
            </div>
        </div>
    </div>
    

</main>

            <footer id="prism__footer">
                <section>
                    <div>
                        <nav class="social-links">
                            <ul><li><a class="no-link" title="Twitter" href="https://twitter.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-twitter"></i></a></li><li><a class="no-link" title="GitHub" href="https://github.com/walkerwzy" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-github"></i></a></li><li><a class="no-link" title="Weibo" href="https://weibo.com/1071696872" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-weibo"></i></a></li></ul>
                        </nav>
                    </div>

                    <section id="prism__external_links">
                        <ul>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://github.com/AlanDecode/Maverick" rel="noopener noreferrer nofollow">Maverick</a>ï¼šğŸ„â€ Go My Own Way.
                                <span>|</span>
                            </li>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://www.imalan.cn" rel="noopener noreferrer nofollow">Triple NULL</a>ï¼šHome page for AlanDecode.
                                <span>|</span>
                            </li>
                            
                        </ul>
                    </section>

                    <div class="copyright">
                        <p class="copyright-text">
                            <span class="brand">walker's code blog</span>
                            <span>Copyright Â© 2022 AlanDecode</span>
                        </p>
                        <p class="copyright-text powered-by">
                            | Powered by <a href="https://github.com/AlanDecode/Maverick" class="no-link" target="_blank" rel="noopener noreferrer nofollow">Maverick</a> | Theme <a href="https://github.com/Reedo0910/Maverick-Theme-Prism" target="_blank" class="no-link" rel="noopener noreferrer nofollow">Prism</a>
                        </p>
                    </div>
                    <div class="footer-addon">
                        
                    </div>
                </section>
                <script>
                    var site_build_date = "2019-12-06T12:00+08:00"

                </script>
                <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/prism-efa8685153.js"></script>
            </footer>
        </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/ExSearch/ExSearch-493cb9cd89.js"></script>

    <!--katex-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/katex.min.js"></script>
    <script>
        mathOpts = {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false }
            ]
        };

    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/wzywalker/wzywalker.github.io@main/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
</body>

</html>